---
title: GeoMesa Raster Support
author: aannex
layout: tutorial
redirect_from:
    - /2015/06/18/geomesa-raster/
---

{% include tutorial-header.html %}

### This tutorial will introduce how to:

1. Deploy and use the raster data support in GeoMesa.
2. Prepare and ingest raster data.
3. Conduct WMS/WCS queries of raster data.
<!--more-->

### PREREQUISITES

<div class="callout callout-warning">
    <span class="glyphicon glyphicon-exclamation-sign"></span>
    For Accumulo deployment, you will need access to a Hadoop 2.2 installation as well as an Accumulo {{ site.accumuloVersion }} database.
</div>

Before you begin, you should have these:

* basic knowledge of [GeoTools](http://www.geotools.org) and [GeoServer](http://geoserver.org),
* access to a [GeoServer](http://geoserver.org/) 2.5.2 installation,
* an Accumulo user that has both create-table and write permissions, and
* the [Geospatial Data Abstraction Library (GDAL)](http://www.gdal.org/) installed. 

Before you begin, you should have also completed the [GeoMesa Deployment Tutorial](/geomesa-deployment/).

### INTRODUCTION

The Raster support in GeoMesa was produced to support image pyramids in EPSG:4326.

Currently WMS and WCS (version 1.0.0) queries are supported via the GeoServer plugin. 

### INGEST

First, download and extract the example data set [Natural Earth 2 with Shaded Relief, Water, and Drainages](http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/raster/NE2_HR_LC_SR_W_DR.zip).
To ingest the raster image into GeoMesa, you must first produce an image pyramid from this file by using ``gdal_retile.py``. For an explanation of the 
parameters used below, see the [gdal_retile documentation](http://www.gdal.org/gdal_retile.html).

{% highlight bash %}
$ gdal_retile.py -v -pyramidOnly -r lanczos -levels 4 -ps 675 675 -targetDir ./ NE2_HR_LC_SR_W_DR.tif 
{% endhighlight %}

Once the image pyramid has been prepared, ingest the tiles using the GeoMesa command line tools.
To do this you will first need to follow the tools deployment instructions in the [GeoMesa Deployment Tutorial](/geomesa-deployment/).
Once the GeoMesa tools have been deployed you will be able to ingest the prepared pyramid:

{% highlight bash %}
$ geomesa ingestraster -u username -p password -t natearth -f "./some/path/to/pyramid/level_1/" -fmt geotiff
{% endhighlight %}

The ingest needs to be repeated per level of the pyramid generated by GDAL. Keep the table name (in this case "natearth") the same between runs of the ingest.
Once this process is complete you will need to register the table into a GeoServer coverage store of the type "GeoMesa Coverage Format". 

When attempting to ingest your own rasters, tiles should be on the order of 128x128 to 1024x1024 pixels.

### REGISTERING IN GEOSERVER

To view the ingested pyramid via WMS and WCS you must register the new table in a "GeoMesa Coverage Format" store in the GeoServer UI. 
Login to your GeoServer and follow these steps:

1. Add a new datastore to GeoServer by navigating to the Stores page and then click "Add new Store".
2. Click the "GeoMesa Coverage Format" as an option under "Raster Data Sources"
3. Fill in the fields as appropriate to your Accumulo and Zookeeper configurations. The "tableName" field must match the name of the table we ingested the demo data to.
    !["GeoMesa Coverage Format configuration example"](/img/tutorials/2015-06-18-geomesa-raster/geomesa_coverage_format_1.png)
4. Click "Save", then click "Publish" when GeoServer prompts you to add the layer. 
5. Once you have completed registering the layer, you should be able to use the open layers preview for the layer to view the raster via WMS.
    !["GeoMesa Raster WMS example"](/img/tutorials/2015-06-18-geomesa-raster/geomesa_raster_wms.png)

### WCS QUERIES

WCS version 1.0.0 queries are fairly similar to WMS queries. Try running the following WCS query on the Natural Earth test data table by first 
modifying and running the following url as needed for your GeoServer configuration.

{% highlight html %}
http://localhost:8080/geoserver/workspace?service=WCS&version=1.0.0&request=GetCoverage&coverage=workspace:natearth&bbox=-180.0,-90.0,180.0,90.0&width=660&height=330&crs=EPSG:4326&format=geotiff
{% endhighlight %}

This will return a GeoTIFF of the extension requested. As in the WMS open layers viewer, the tiles are concatenated together into a mosaic. 
