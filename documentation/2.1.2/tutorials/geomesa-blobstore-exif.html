

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GeoMesa BlobStore EXIF &mdash; GeoMesa 2.1.2 Manuals</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme_custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GeoMesa Storm Quick Start" href="geomesa-quickstart-storm.html" />
    <link rel="prev" title="GeoMesa BlobStore" href="geomesa-blobstore.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                2.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#data-in-out">Data In/Out</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="geomesa-examples-gdelt.html">Map-Reduce Ingest of GDELT</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-examples-transformations.html">GeoMesa Transformations Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-examples-avro.html">GeoMesa Avro Binary Format Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-blobstore.html">GeoMesa BlobStore</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">GeoMesa BlobStore EXIF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geomesa-blobstore-exif-handler-installation-instructions">GeoMesa BlobStore EXIF Handler Installation Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-exif-handler">Using the EXIF Handler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#register-index-table-in-geoserver">Register Index table in GeoServer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#querying-the-index-for-blobs">Querying the Index for Blobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#downloading-blobs">Downloading Blobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-storm.html">GeoMesa Storm Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-raster.html">GeoMesa Raster Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-analysis">Data Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#security">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indexing-and-queries">Indexing and Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#about-tutorial-versions">About Tutorial Versions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GeoMesa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>GeoMesa BlobStore EXIF</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/geomesa-blobstore-exif.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomesa-blobstore-exif">
<h1>GeoMesa BlobStore EXIF<a class="headerlink" href="#geomesa-blobstore-exif" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will show you:</p>
<ol class="arabic simple">
<li>How to deploy the EXIF handler to ingest geotagged images</li>
<li>How to view the spatial index of the BlobStore in geoserver</li>
<li>How to query the index for individual blobs</li>
<li>How to download blobs from the BlobStore</li>
</ol>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For Accumulo deployment, you will need access to an Accumulo 1.9.2 or later instance.</p>
</div>
<p>Before you begin, you should have these:</p>
<ul class="simple">
<li>basic knowledge of <a class="reference external" href="http://www.geotools.org">GeoTools</a> and
<a class="reference external" href="http://geoserver.org">GeoServer</a></li>
<li>access to a <a class="reference external" href="http://geoserver.org/">GeoServer</a> 2.8.x installation</li>
<li>an Accumulo user that has both create-table and write permissions</li>
</ul>
<p>Before you begin, you should have followed the instructions for setting up the blobstore in <a class="reference internal" href="../user/blobstore.html"><span class="doc">GeoMesa Blob Store</span></a>.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The GeoMesa BlobStore is able to handle a variety of file types by using a pluggable interface for FileHandlers.
This allows support for new file formats to be quickly integrated. GeoMesa comes with a handler for EXIF headers,
which are included in a variety of image formats from digital cameras that will be demonstrated by this tutorial.
Also demonstrated in this tutorial is querying the BlobStore’s DataStore index for Blobs and demonstrating the two
step query - fetch workflow users use to interact with the BlobStore.</p>
</div>
<div class="section" id="geomesa-blobstore-exif-handler-installation-instructions">
<h2>GeoMesa BlobStore EXIF Handler Installation Instructions<a class="headerlink" href="#geomesa-blobstore-exif-handler-installation-instructions" title="Permalink to this headline">¶</a></h2>
<p>As the FileHandlers use the Java Service Registry, they can be loaded at runtime by simply placing the jar
for the handler into the existing classpath. For this tutorial, we assume the user is deploying
the EXIF FileHandler to an existing GeoServer with the BlobStore web servlet. See instructions above for
setting up the BlobStore in the prerequisites.</p>
<p>To deploy the EXIF FileHandler if you are using Tomcat run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tar -xzvf <span class="se">\</span>
  geomesa-<span class="nv">$VERSION</span>/geomesa-blobstore/geomesa-blobstore-handler/geomesa-blobstore-exif-handler/target/geomesa-blobstore-exif-handler_2.11-<span class="nv">$VERSION</span>.jar <span class="se">\</span>
  -C /path/to/tomcat/webapps/geoserver/WEB-INF/lib/
</pre></div>
</div>
<p>To deploy the EXIF FileHandler if you are using GeoServer’s built in Jetty web server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tar -xzvf <span class="se">\</span>
  geomesa-<span class="nv">$VERSION</span>/geomesa-blobstore/geomesa-blobstore-handler/geomesa-blobstore-exif-handler/target/geomesa-blobstore-exif-handler_2.11-<span class="nv">$VERSION</span>.jar <span class="se">\</span>
  -C /path/to/geoserver/webapps/geoserver/WEB-INF/lib/
</pre></div>
</div>
<p>Now the BlobStore is able to read image files with EXIF metadata headers.</p>
</div>
<div class="section" id="using-the-exif-handler">
<h2>Using the EXIF Handler<a class="headerlink" href="#using-the-exif-handler" title="Permalink to this headline">¶</a></h2>
<p>In order to use our new handler, we will need to get some geotagged images.
Below is a partial Python script that uses the Flickr API to grab some geotagged images taken around Monument Valley.
Using the Flickr API is beyond the scope of this tutorial; however the Python code snippet is provided for those
interested in obtaining a test data set. The below script will download 100 images to the user’s home directory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flickrapi</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;Some API Key&#39;</span>
<span class="n">secret</span>  <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;some secret&#39;</span>

<span class="n">flickr</span> <span class="o">=</span> <span class="n">flickrapi</span><span class="o">.</span><span class="n">FlickrAPI</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
<span class="n">flickr</span><span class="o">.</span><span class="n">authenticate_console</span><span class="p">(</span><span class="n">perms</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">)</span>
<span class="n">photos</span> <span class="o">=</span> <span class="n">flickr</span><span class="o">.</span><span class="n">photos_search</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="s1">&#39;37.0000&#39;</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="s1">&#39;-110.1700&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">safe_search</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">extras</span><span class="o">=</span><span class="s1">&#39;url_o&#39;</span><span class="p">)</span>

<span class="n">urls</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;url_o&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">photos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;url_o&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="mi">100</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;~/flickr{0:03d}.jpg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>
</div>
<p>First we need to register a BlobStore using the following command. Note that the parameters for user/password/zookeepers/instanceId need to be modified to suite your environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -d <span class="s1">&#39;instanceId=myCloud&#39;</span> -d <span class="s1">&#39;zookeepers=zoo1,zoo2,zoo3&#39;</span> -d <span class="s1">&#39;tableName=myblobstore&#39;</span> -d <span class="s1">&#39;user=user&#39;</span> -d <span class="s1">&#39;password=password&#39;</span> http://localhost:8080/geoserver/geomesa/blobstore/ds/myblobstore
</pre></div>
</div>
<p>To ingest the files, we can write a simple bash loop to use cURL on each file to ingest to the BlobStore.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="k">for</span> f in *.jpg<span class="p">;</span> <span class="k">do</span> curl -X POST -F <span class="nv">file</span><span class="o">=</span>@<span class="nv">$f</span> http://localhost:8080/geoserver/geomesa/blobstore/blob/myblobstore <span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
<p>The files have now been ingested.</p>
</div>
<div class="section" id="register-index-table-in-geoserver">
<h2>Register Index table in GeoServer<a class="headerlink" href="#register-index-table-in-geoserver" title="Permalink to this headline">¶</a></h2>
<p>The BlobStore index DataStore is an ordinary GeoTools DataStore, so the registration in GeoServer is no different than for other DataStores.
For an example of registering a DataStore in GeoServer please follow these <a class="reference internal" href="../user/geoserver.html"><span class="doc">GeoServer Plugins</span></a>.</p>
<p>Once the layer is registered we can view the layer in the GeoServer layer previewer.</p>
<div class="figure">
<img alt="Figure of locations of Blobs" src="../_images/blob-index-map.png" />
</div>
</div>
<div class="section" id="querying-the-index-for-blobs">
<h2>Querying the Index for Blobs<a class="headerlink" href="#querying-the-index-for-blobs" title="Permalink to this headline">¶</a></h2>
<p>To Query for blobs in the spatio-temporal index we will need to enable WFS queries for the layer in GeoServer.
Ensure the Workspace in which the BlobStore index DataStore was registered has the WFS service enabled.
This can be verified by clicking through to Workspaces -&gt; (your workspace) -&gt; Checkbox next to WFS -&gt; Save, in the GeoServer UI.</p>
<div class="figure">
<img alt="GeoServer Workspace Settings View" src="../_images/geoserver-wfs-enable.png" />
</div>
<p>This can also be achieved through the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/rest/index.html">GeoServer REST API</a>
which is beyond the scope of this tutorial.</p>
<p>Explaining WFS requests are beyond the scope of this tutorial, however listed below are some links to relevant documentation.
A detailed description of WFS can be found here <a class="reference external" href="http://docs.geoserver.org/stable/en/user/services/wfs/reference.html">GeoServer WFS reference</a> .
Further details on ECQL predicates are listed here: <a class="reference external" href="http://docs.geoserver.org/stable/en/user/filter/ecql_reference.html#filter-ecql-reference">GeoServer ECQL reference</a> .</p>
<p>Request for all features of provided type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -X GET <span class="s1">&#39;http://localhost:8080/geoserver/wfs?service=wfs&amp;version=2.0.0&amp;request=GetFeature&amp;typeNames=&lt;workspace&gt;:blob&#39;</span>
</pre></div>
</div>
<p>Request for all filenames contained in index:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -X GET <span class="s1">&#39;http://localhost:8080/geoserver/wfs?service=wfs&amp;version=2.0.0&amp;request=GetFeature&amp;typeNames=&lt;workspace&gt;:blob&amp;propertyName=filename&#39;</span>
</pre></div>
</div>
<p>Request for all features within a BBOX via ECQL:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -X GET <span class="s1">&#39;http://localhost:8080/geoserver/wfs?service=wfs&amp;version=2.0.0&amp;request=GetFeature&amp;typeNames=&lt;workspace&gt;:blob&amp;cql_filter=BBOX(geom,0,0,90,-180)&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="downloading-blobs">
<h2>Downloading Blobs<a class="headerlink" href="#downloading-blobs" title="Permalink to this headline">¶</a></h2>
<p>After performing a WFS query for relevant blob ids, you can use the BlobStore RESTful api to download a given blob by
the blob id and alias for the BlobStore.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -JO http://localhost:8080/geoserver/geomesa/blobstore/blob/:alias/some-id
</pre></div>
</div>
<p>You can also use the GZip support to minimize network utilization by running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl --compressed -JO http://localhost:8080/geoserver/geomesa/blobstore/blob/:alias/some-id
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="geomesa-quickstart-storm.html" class="btn btn-neutral float-right" title="GeoMesa Storm Quick Start" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="geomesa-blobstore.html" class="btn btn-neutral" title="GeoMesa BlobStore" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2017 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>