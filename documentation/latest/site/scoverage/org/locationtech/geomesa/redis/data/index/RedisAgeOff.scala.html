<html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title id="title">
          org/locationtech/geomesa/redis/data/index/RedisAgeOff.scala.html
        </title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.20.1/css/theme.default.min.css" type="text/css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.20.1/js/jquery.tablesorter.min.js"></script><link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" type="text/css"/><script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script><script type="text/javascript">
        $(document).ready(function() {$(".tablesorter").tablesorter();});
      </script>
        <style>
          table.codegrid { font-family: monospace; font-size: 12px; width: auto!important; }table.statementlist { width: auto!important; font-size: 13px; } table.codegrid td { padding: 0!important; border: 0!important } table td.linenumber { width: 40px!important; } 
        </style>
      </head>
      <body style="font-family: monospace;">
        <ul class="nav nav-tabs">
          <li>
            <a href="#codegrid" data-toggle="tab">Codegrid</a>
          </li>
          <li>
            <a href="#statementlist" data-toggle="tab">Statement List</a>
          </li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="codegrid">
            <pre style='font-size: 12pt; font-family: courier, monospace;'>1 <span style=''>/***********************************************************************
</span>2 <span style=''> * Copyright (c) 2013-2024 Commonwealth Computer Research, Inc.
</span>3 <span style=''> * All rights reserved. This program and the accompanying materials
</span>4 <span style=''> * are made available under the terms of the Apache License, Version 2.0
</span>5 <span style=''> * which accompanies this distribution and is available at
</span>6 <span style=''> * http://www.opensource.org/licenses/apache2.0.php.
</span>7 <span style=''> ***********************************************************************/
</span>8 <span style=''>
</span>9 <span style=''>package org.locationtech.geomesa.redis.data.index
</span>10 <span style=''>
</span>11 <span style=''>import com.typesafe.scalalogging.StrictLogging
</span>12 <span style=''>import org.geotools.api.data.Transaction
</span>13 <span style=''>import org.geotools.api.feature.simple.SimpleFeatureType
</span>14 <span style=''>import org.geotools.api.filter.identity.Identifier
</span>15 <span style=''>import org.locationtech.geomesa.filter.FilterHelper
</span>16 <span style=''>import org.locationtech.geomesa.redis.data.index.RedisAgeOff.{AgeOffExecutor, AgeOffWriter}
</span>17 <span style=''>import org.locationtech.geomesa.redis.data.util.RedisLocking
</span>18 <span style=''>import org.locationtech.geomesa.redis.data.{RedisDataStore, RedisSystemProperties}
</span>19 <span style=''>import org.locationtech.geomesa.utils.conf.GeoMesaSystemProperties.SystemProperty
</span>20 <span style=''>import org.locationtech.geomesa.utils.io.WithClose
</span>21 <span style=''>import redis.clients.jedis.JedisPool
</span>22 <span style=''>import redis.clients.jedis.params.ZAddParams
</span>23 <span style=''>
</span>24 <span style=''>import java.io.{Closeable, Flushable}
</span>25 <span style=''>import java.nio.charset.StandardCharsets
</span>26 <span style=''>import java.util.Collections
</span>27 <span style=''>import java.util.concurrent.{Executors, ScheduledFuture, TimeUnit}
</span>28 <span style=''>import scala.collection.mutable.{ArrayBuffer, ListBuffer}
</span>29 <span style=''>import scala.concurrent.duration.Duration
</span>30 <span style=''>import scala.util.control.NonFatal
</span>31 <span style=''>
</span>32 <span style=''>/**
</span>33 <span style=''>  * Tracks and deletes features based on a time-to-live.
</span>34 <span style=''>  *
</span>35 <span style=''>  * TTLs are stored in a separate sorted set for each feature type, with the score of the set being the
</span>36 <span style=''>  * system time in millis when the feature should be expired. We do a two-step process to expire features:
</span>37 <span style=''>  *
</span>38 <span style=''>  * 1. Scan and remove the TTL set by score range, which will return all the feature IDs for expired features
</span>39 <span style=''>  * 2. Remove the features from the index tables based on the feature ID
</span>40 <span style=''>  *
</span>41 <span style=''>  * @param ds data store
</span>42 <span style=''>  */
</span>43 <span style=''>class RedisAgeOff(ds: RedisDataStore) extends Closeable {
</span>44 <span style=''>
</span>45 <span style=''>  import RedisAgeOff.key
</span>46 <span style=''>  import org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType
</span>47 <span style=''>
</span>48 <span style=''>  private val executor = </span><span style='background: #AEF1AE'>RedisSystemProperties.AgeOffInterval.toDuration.collect {
</span>49 <span style=''></span><span style='background: #AEF1AE'>    case i if i.isFinite =&gt; new AgeOffExecutor(ds, i)
</span>50 <span style=''></span><span style='background: #AEF1AE'>  }</span><span style=''>
</span>51 <span style=''>
</span>52 <span style=''>  /**
</span>53 <span style=''>    * Start the age-off for a feature type
</span>54 <span style=''>    *
</span>55 <span style=''>    * @param sft simple feature type
</span>56 <span style=''>    */
</span>57 <span style=''>  def add(sft: SimpleFeatureType): Unit = {
</span>58 <span style=''>    if (</span><span style='background: #AEF1AE'>sft.isFeatureExpirationEnabled</span><span style=''>) {
</span>59 <span style=''>      </span><span style='background: #AEF1AE'>executor.foreach(_.schedule(sft.getTypeName))</span><span style=''>
</span>60 <span style=''>    }
</span>61 <span style=''>  }
</span>62 <span style=''>
</span>63 <span style=''>  /**
</span>64 <span style=''>    * Update the age-off for a modified feature type
</span>65 <span style=''>    *
</span>66 <span style=''>    * @param sft modified simple feature type
</span>67 <span style=''>    * @param previous previous simple feature type
</span>68 <span style=''>    */
</span>69 <span style=''>  def update(sft: SimpleFeatureType, previous: SimpleFeatureType): Unit = {
</span>70 <span style=''>    if (</span><span style='background: #F0ADAD'>previous.isFeatureExpirationEnabled</span><span style=''>) {
</span>71 <span style=''>      </span><span style='background: #F0ADAD'>if (!sft.isFeatureExpirationEnabled) {
</span>72 <span style=''></span><span style='background: #F0ADAD'>        remove(previous)
</span>73 <span style=''></span><span style='background: #F0ADAD'>      } else if (sft.getTypeName != previous.getTypeName) {
</span>74 <span style=''></span><span style='background: #F0ADAD'>        executor.foreach(_.cancel(previous.getTypeName))
</span>75 <span style=''></span><span style='background: #F0ADAD'>        // rename the ttl table to match the new type name
</span>76 <span style=''></span><span style='background: #F0ADAD'>        WithClose(ds.connection.getResource)(_.renamenx(key(ds, previous.getTypeName), key(ds, sft.getTypeName)))
</span>77 <span style=''></span><span style='background: #F0ADAD'>        executor.foreach(_.schedule(sft.getTypeName))
</span>78 <span style=''></span><span style='background: #F0ADAD'>      }</span><span style=''>
</span>79 <span style=''>    } else </span><span style='background: #F0ADAD'>if (sft.isFeatureExpirationEnabled) {
</span>80 <span style=''></span><span style='background: #F0ADAD'>      executor.foreach(_.schedule(sft.getTypeName))
</span>81 <span style=''></span><span style='background: #F0ADAD'>    }</span><span style=''>
</span>82 <span style=''>  }
</span>83 <span style=''>
</span>84 <span style=''>  /**
</span>85 <span style=''>    * Remove the age-off for a feature type
</span>86 <span style=''>    *
</span>87 <span style=''>    * @param sft simple feature type
</span>88 <span style=''>    */
</span>89 <span style=''>  def remove(sft: SimpleFeatureType): Unit = {
</span>90 <span style=''>    if (</span><span style='background: #AEF1AE'>sft.isFeatureExpirationEnabled</span><span style=''>) </span><span style='background: #AEF1AE'>{
</span>91 <span style=''></span><span style='background: #AEF1AE'>      executor.foreach(_.cancel(sft.getTypeName))
</span>92 <span style=''></span><span style='background: #AEF1AE'>      WithClose(ds.connection.getResource)(_.del(key(ds, sft.getTypeName)))
</span>93 <span style=''></span><span style='background: #AEF1AE'>    }</span><span style=''>
</span>94 <span style=''>  }
</span>95 <span style=''>
</span>96 <span style=''>  /**
</span>97 <span style=''>    * Gets a writer to track ttl for features
</span>98 <span style=''>    *
</span>99 <span style=''>    * @param sft simple feature type
</span>100 <span style=''>    * @return
</span>101 <span style=''>    */
</span>102 <span style=''>  def writer(sft: SimpleFeatureType): Option[AgeOffWriter] = {
</span>103 <span style=''>    if (</span><span style='background: #AEF1AE'>sft.isFeatureExpirationEnabled</span><span style=''>) {
</span>104 <span style=''>      </span><span style='background: #AEF1AE'>Some(new AgeOffWriter(ds.connection, key(ds, sft.getTypeName)))</span><span style=''>
</span>105 <span style=''>    } else {
</span>106 <span style=''>      </span><span style='background: #AEF1AE'>None</span><span style=''>
</span>107 <span style=''>    }
</span>108 <span style=''>  }
</span>109 <span style=''>
</span>110 <span style=''>  override def close(): Unit = </span><span style='background: #AEF1AE'>executor.foreach(_.close())</span><span style=''>
</span>111 <span style=''>}
</span>112 <span style=''>
</span>113 <span style=''>object RedisAgeOff extends StrictLogging {
</span>114 <span style=''>
</span>115 <span style=''>  import redis.clients.jedis.resps.{Tuple =&gt; JedisTuple}
</span>116 <span style=''>
</span>117 <span style=''>  val TtlUserDataKey = </span><span style='background: #AEF1AE'>&quot;t&quot;</span><span style=''> // the user data is cleared, so no chance of key collision - save space with a short key
</span>118 <span style=''>
</span>119 <span style=''>  val AgeOffLockTimeout: SystemProperty = </span><span style='background: #AEF1AE'>SystemProperty(&quot;geomesa.redis.age.off.lock.timeout&quot;, &quot;1 second&quot;)</span><span style=''>
</span>120 <span style=''>
</span>121 <span style=''>  /**
</span>122 <span style=''>    * Initialize the age-off for the data store
</span>123 <span style=''>    *
</span>124 <span style=''>    * @param ds data store
</span>125 <span style=''>    */
</span>126 <span style=''>  def init(ds: RedisDataStore): Unit = </span><span style='background: #AEF1AE'>ds.getTypeNames.foreach(n =&gt; </span><span style='background: #F0ADAD'>ds.aging.add(ds.getSchema(n))</span><span style='background: #AEF1AE'>)</span><span style=''>
</span>127 <span style=''>
</span>128 <span style=''>  /**
</span>129 <span style=''>    * Key of the Redis SortedSet containing the ttl for the given feature type
</span>130 <span style=''>    *
</span>131 <span style=''>    * @param ds data store
</span>132 <span style=''>    * @param typeName simple feature type name
</span>133 <span style=''>    * @return
</span>134 <span style=''>    */
</span>135 <span style=''>  private def key(ds: RedisDataStore, typeName: String): Array[Byte] =
</span>136 <span style=''>    </span><span style='background: #AEF1AE'>s&quot;${ds.config.catalog}_${typeName}_ttl&quot;.getBytes(StandardCharsets.UTF_8)</span><span style=''>
</span>137 <span style=''>
</span>138 <span style=''>  /**
</span>139 <span style=''>    * Writes time-to-lives for new features
</span>140 <span style=''>    *
</span>141 <span style=''>    * @param connection jedis connection
</span>142 <span style=''>    * @param table ttl table for the feature type
</span>143 <span style=''>    */
</span>144 <span style=''>  class AgeOffWriter(connection: JedisPool, table: Array[Byte]) extends Closeable with Flushable {
</span>145 <span style=''>
</span>146 <span style=''>    private val writes = </span><span style='background: #AEF1AE'>new java.util.HashMap[Array[Byte], java.lang.Double]</span><span style=''>
</span>147 <span style=''>    private val deletes = </span><span style='background: #AEF1AE'>ArrayBuffer.empty[Array[Byte]]</span><span style=''>
</span>148 <span style=''>
</span>149 <span style=''>    // note: the regular feature ids have the length pre-pended as a 2-byte short, so use the raw id instead
</span>150 <span style=''>    def write(feature: RedisWritableFeature): Unit = </span><span style='background: #AEF1AE'>writes.put(feature.rawId, feature.ttl)</span><span style=''>
</span>151 <span style=''>    def delete(feature: RedisWritableFeature): Unit = </span><span style='background: #AEF1AE'>deletes += feature.rawId</span><span style=''>
</span>152 <span style=''>
</span>153 <span style=''>    override def flush(): Unit = {
</span>154 <span style=''>      if (</span><span style='background: #AEF1AE'>!writes.isEmpty || deletes.nonEmpty</span><span style=''>) {
</span>155 <span style=''>        </span><span style='background: #AEF1AE'>try {
</span>156 <span style=''></span><span style='background: #AEF1AE'>          WithClose(connection.getResource) { jedis =&gt;
</span>157 <span style=''></span><span style='background: #AEF1AE'>            if (deletes.nonEmpty) {
</span>158 <span style=''></span><span style='background: #AEF1AE'>              jedis.zrem(table, deletes.toSeq: _*)
</span>159 <span style=''></span><span style='background: #AEF1AE'>            }
</span>160 <span style=''></span><span style='background: #AEF1AE'>            if (!writes.isEmpty) {
</span>161 <span style=''></span><span style='background: #AEF1AE'>              jedis.zadd(table, writes)
</span>162 <span style=''></span><span style='background: #AEF1AE'>            }
</span>163 <span style=''></span><span style='background: #AEF1AE'>          }
</span>164 <span style=''></span><span style='background: #AEF1AE'>        } finally {
</span>165 <span style=''></span><span style='background: #AEF1AE'>          writes.clear()
</span>166 <span style=''></span><span style='background: #AEF1AE'>          deletes.clear()
</span>167 <span style=''></span><span style='background: #AEF1AE'>        }</span><span style=''>
</span>168 <span style=''>      }
</span>169 <span style=''>    }
</span>170 <span style=''>
</span>171 <span style=''>    override def close(): Unit = </span><span style='background: #AEF1AE'>flush()</span><span style=''>
</span>172 <span style=''>  }
</span>173 <span style=''>
</span>174 <span style=''>  /**
</span>175 <span style=''>    * Class for tracking scheduled expiration tasks
</span>176 <span style=''>    *
</span>177 <span style=''>    * @param ds data store
</span>178 <span style=''>    * @param frequency run frequency
</span>179 <span style=''>    */
</span>180 <span style=''>  private class AgeOffExecutor(ds: RedisDataStore, frequency: Duration) extends Closeable {
</span>181 <span style=''>
</span>182 <span style=''>    // expiration tasks, keyed by feature type name
</span>183 <span style=''>    // note: synchronize access to ensure thread safety
</span>184 <span style=''>    private val tasks = </span><span style='background: #AEF1AE'>scala.collection.mutable.Map.empty[String, ScheduledFuture[_]]</span><span style=''>
</span>185 <span style=''>    private val rate = </span><span style='background: #AEF1AE'>frequency.toMillis</span><span style=''>
</span>186 <span style=''>    private val es = </span><span style='background: #AEF1AE'>Executors.newScheduledThreadPool(3)</span><span style=''>
</span>187 <span style=''>
</span>188 <span style=''>    /**
</span>189 <span style=''>      * Schedule the removal of features for the feature type
</span>190 <span style=''>      *
</span>191 <span style=''>      * @param typeName simple feature type name
</span>192 <span style=''>      */
</span>193 <span style=''>    def schedule(typeName: String): Unit = {
</span>194 <span style=''>      // schedule with a short initial delay to quickly remove any features that may
</span>195 <span style=''>      // have expired since the last time there was an active datastore running
</span>196 <span style=''>      val future = </span><span style='background: #AEF1AE'>es.scheduleAtFixedRate(new AgeOffRunner(ds, typeName), 5000L, rate, TimeUnit.MILLISECONDS)</span><span style=''>
</span>197 <span style=''>      </span><span style='background: #AEF1AE'>synchronized {
</span>198 <span style=''></span><span style='background: #AEF1AE'>        tasks.put(typeName, future).foreach(</span><span style='background: #F0ADAD'>_.cancel(false)</span><span style='background: #AEF1AE'>)
</span>199 <span style=''></span><span style='background: #AEF1AE'>      }</span><span style=''>
</span>200 <span style=''>    }
</span>201 <span style=''>
</span>202 <span style=''>    /**
</span>203 <span style=''>      * Cancel any scheduled tasks for the feature type
</span>204 <span style=''>      *
</span>205 <span style=''>      * @param typeName simple feature type name
</span>206 <span style=''>      */
</span>207 <span style=''>    def cancel(typeName: String): Unit = {
</span>208 <span style=''>      </span><span style='background: #AEF1AE'>synchronized {
</span>209 <span style=''></span><span style='background: #AEF1AE'>        tasks.remove(typeName).foreach(_.cancel(false))
</span>210 <span style=''></span><span style='background: #AEF1AE'>      }</span><span style=''>
</span>211 <span style=''>    }
</span>212 <span style=''>
</span>213 <span style=''>    override def close(): Unit = </span><span style='background: #AEF1AE'>es.shutdown()</span><span style=''>
</span>214 <span style=''>  }
</span>215 <span style=''>
</span>216 <span style=''>  /**
</span>217 <span style=''>    * Runnable class to check and remove expired features
</span>218 <span style=''>    *
</span>219 <span style=''>    * @param ds data store
</span>220 <span style=''>    * @param typeName simple feature type name to check
</span>221 <span style=''>    */
</span>222 <span style=''>  private class AgeOffRunner(ds: RedisDataStore, typeName: String) extends Runnable with RedisLocking {
</span>223 <span style=''>
</span>224 <span style=''>    import scala.collection.JavaConverters._
</span>225 <span style=''>
</span>226 <span style=''>    private val table = </span><span style='background: #AEF1AE'>key(ds, typeName)</span><span style=''>
</span>227 <span style=''>    private val lockPath = </span><span style='background: #AEF1AE'>s&quot;/org.locationtech.geomesa.redis.${ds.config.catalog}.ttl.$typeName&quot;</span><span style=''>
</span>228 <span style=''>
</span>229 <span style=''>    private val timeout = </span><span style='background: #AEF1AE'>AgeOffLockTimeout.toDuration.map(_.toMillis).getOrElse {
</span>230 <span style=''></span><span style='background: #AEF1AE'>      // note: should always be valid due to the default
</span>231 <span style=''></span><span style='background: #AEF1AE'>      </span><span style='background: #F0ADAD'>throw new IllegalStateException(&quot;Invalid age-off lock timeout&quot;)</span><span style='background: #AEF1AE'>
</span>232 <span style=''></span><span style='background: #AEF1AE'>    }</span><span style=''>
</span>233 <span style=''>
</span>234 <span style=''>    override def connection: JedisPool = </span><span style='background: #AEF1AE'>ds.connection</span><span style=''>
</span>235 <span style=''>
</span>236 <span style=''>    override def run(): Unit = {
</span>237 <span style=''>      val timestamp = </span><span style='background: #AEF1AE'>System.currentTimeMillis()</span><span style=''>
</span>238 <span style=''>      logger.debug(s&quot;Age-off for schema '$typeName' starting with timestamp $timestamp&quot;)
</span>239 <span style=''>
</span>240 <span style=''>      val ids = </span><span style='background: #AEF1AE'>removeExpiredIds(timestamp)</span><span style=''>
</span>241 <span style=''>      if (</span><span style='background: #AEF1AE'>!ids.isEmpty</span><span style=''>) {
</span>242 <span style=''>        </span><span style='background: #AEF1AE'>removeExpiredFeatures(ids, timestamp)</span><span style=''>
</span>243 <span style=''>      }
</span>244 <span style=''>    }
</span>245 <span style=''>
</span>246 <span style=''>    /**
</span>247 <span style=''>      * Queries and removes expired ids and ttls
</span>248 <span style=''>      *
</span>249 <span style=''>      * @param timestamp expiration time
</span>250 <span style=''>      * @return
</span>251 <span style=''>      */
</span>252 <span style=''>    private def removeExpiredIds(timestamp: Long): java.util.List[JedisTuple] = {
</span>253 <span style=''>      def exec: java.util.List[JedisTuple] = {
</span>254 <span style=''>        </span><span style='background: #AEF1AE'>WithClose(ds.connection.getResource) { jedis =&gt;
</span>255 <span style=''></span><span style='background: #AEF1AE'>          // run the select and remove in an atomic transaction
</span>256 <span style=''></span><span style='background: #AEF1AE'>          val tx = jedis.multi()
</span>257 <span style=''></span><span style='background: #AEF1AE'>          val scores = tx.zrangeByScoreWithScores(table, 0, timestamp)
</span>258 <span style=''></span><span style='background: #AEF1AE'>          tx.zremrangeByScore(table, 0, timestamp)
</span>259 <span style=''></span><span style='background: #AEF1AE'>          tx.exec()
</span>260 <span style=''></span><span style='background: #AEF1AE'>          scores.get
</span>261 <span style=''></span><span style='background: #AEF1AE'>        }</span><span style=''>
</span>262 <span style=''>      }
</span>263 <span style=''>
</span>264 <span style=''>      def noLock: java.util.List[JedisTuple] = {
</span>265 <span style=''>        logger.debug(s&quot;Could not acquire distributed lock for schema '$typeName' after ${timeout}ms&quot;)
</span>266 <span style=''>        </span><span style='background: #F0ADAD'>Collections.emptyList[JedisTuple]()</span><span style=''>
</span>267 <span style=''>      }
</span>268 <span style=''>
</span>269 <span style=''>      // acquire a lock so that we're not repeating work in multiple data store instances
</span>270 <span style=''>      val ids = try { </span><span style='background: #AEF1AE'>withLock(lockPath, timeout, exec, noLock)</span><span style=''> } catch {
</span>271 <span style=''>        case NonFatal(e) </span><span style='background: #F0ADAD'>=&gt;
</span>272 <span style=''></span><span style='background: #F0ADAD'>          logger.error(&quot;Error executing ttl transaction:&quot;, e)
</span>273 <span style=''></span><span style='background: #F0ADAD'>          Collections.emptyList[JedisTuple]()</span><span style=''>
</span>274 <span style=''>      }
</span>275 <span style=''>
</span>276 <span style=''>      logger.debug(s&quot;Age-off for schema '$typeName' found ${ids.size} features for expiration&quot;)
</span>277 <span style=''>
</span>278 <span style=''>      ids
</span>279 <span style=''>    }
</span>280 <span style=''>
</span>281 <span style=''>    /**
</span>282 <span style=''>      * Removes expired features from the data store
</span>283 <span style=''>      *
</span>284 <span style=''>      * @param ids expired ids and ttls
</span>285 <span style=''>      * @param timestamp expiration time
</span>286 <span style=''>      */
</span>287 <span style=''>    private def removeExpiredFeatures(ids: java.util.List[JedisTuple], timestamp: Long): Unit = {
</span>288 <span style=''>      try {
</span>289 <span style=''>        </span><span style='background: #AEF1AE'>val fids = new java.util.HashSet[Identifier](ids.size)
</span>290 <span style=''></span><span style='background: #AEF1AE'>        ids.asScala.foreach(id =&gt; fids.add(FilterHelper.ff.featureId(id.getElement)))
</span>291 <span style=''></span><span style='background: #AEF1AE'>
</span>292 <span style=''></span><span style='background: #AEF1AE'>        logger.trace(s&quot;Age-off for schema '$typeName' found the following features: $fids&quot;)
</span>293 <span style=''></span><span style='background: #AEF1AE'>        val trace = logger.underlying.isTraceEnabled
</span>294 <span style=''></span><span style='background: #AEF1AE'>        lazy val results = ListBuffer.empty[String]
</span>295 <span style=''></span><span style='background: #AEF1AE'>
</span>296 <span style=''></span><span style='background: #AEF1AE'>        var i = 0
</span>297 <span style=''></span><span style='background: #AEF1AE'>        WithClose(ds.getFeatureWriter(typeName, FilterHelper.ff.id(fids), Transaction.AUTO_COMMIT)) { writer =&gt;
</span>298 <span style=''></span><span style='background: #AEF1AE'>          while (writer.hasNext) {
</span>299 <span style=''></span><span style='background: #AEF1AE'>            val sf = writer.next()
</span>300 <span style=''></span><span style='background: #AEF1AE'>            // verify that the feature hasn't been updated since we fetched the expired ids
</span>301 <span style=''></span><span style='background: #AEF1AE'>            // note: if the feature is updated between our call to `next` and `remove`, the
</span>302 <span style=''></span><span style='background: #AEF1AE'>            // member keys won't match and our deletion will not affect anything, as desired
</span>303 <span style=''></span><span style='background: #AEF1AE'>            val ttl = sf.getUserData.get(TtlUserDataKey)
</span>304 <span style=''></span><span style='background: #AEF1AE'>            if (ttl != null &amp;&amp; ttl.asInstanceOf[Long] &lt;= timestamp) {
</span>305 <span style=''></span><span style='background: #AEF1AE'>              writer.remove()
</span>306 <span style=''></span><span style='background: #AEF1AE'>              i += 1
</span>307 <span style=''></span><span style='background: #AEF1AE'>              if (trace) {
</span>308 <span style=''></span><span style='background: #AEF1AE'>                </span><span style='background: #F0ADAD'>results += sf.getID</span><span style='background: #AEF1AE'>
</span>309 <span style=''></span><span style='background: #AEF1AE'>              }
</span>310 <span style=''></span><span style='background: #AEF1AE'>            } else {
</span>311 <span style=''></span><span style='background: #AEF1AE'>              </span><span style='background: #F0ADAD'>logger.debug(s&quot;Age-off for schema '$typeName' ignoring updated feature: ${sf.getID}&quot;)</span><span style='background: #AEF1AE'>
</span>312 <span style=''></span><span style='background: #AEF1AE'>            }
</span>313 <span style=''></span><span style='background: #AEF1AE'>          }
</span>314 <span style=''></span><span style='background: #AEF1AE'>        }
</span>315 <span style=''></span><span style='background: #AEF1AE'>        logger.debug(s&quot;Age-off for schema '$typeName' removed $i features&quot;)
</span>316 <span style=''></span><span style='background: #AEF1AE'>        logger.trace(s&quot;Age-off for schema '$typeName' removed the following features: [${results.mkString(&quot;, &quot;)}]&quot;)</span><span style=''>
</span>317 <span style=''>      } catch {
</span>318 <span style=''>        case NonFatal(e) </span><span style='background: #F0ADAD'>=&gt;
</span>319 <span style=''></span><span style='background: #F0ADAD'>          logger.error(s&quot;Error executing age-off for schema '$typeName':&quot;, e)
</span>320 <span style=''></span><span style='background: #F0ADAD'>          // try to re-insert the keys, otherwise they might never expire
</span>321 <span style=''></span><span style='background: #F0ADAD'>          reinsertFailedIds(ids)</span><span style=''>
</span>322 <span style=''>      }
</span>323 <span style=''>    }
</span>324 <span style=''>
</span>325 <span style=''>    /**
</span>326 <span style=''>      * Reinserts ids for features that were not deleted from the data store
</span>327 <span style=''>      *
</span>328 <span style=''>      * @param ids expired ids and ttls
</span>329 <span style=''>      */
</span>330 <span style=''>    private def reinsertFailedIds(ids: java.util.List[JedisTuple]): Unit = {
</span>331 <span style=''>      try {
</span>332 <span style=''>        </span><span style='background: #F0ADAD'>logger.debug(s&quot;Age-off for schema '$typeName' re-inserting ttls&quot;)
</span>333 <span style=''></span><span style='background: #F0ADAD'>        val reinserts = new java.util.HashMap[Array[Byte], java.lang.Double](ids.size)
</span>334 <span style=''></span><span style='background: #F0ADAD'>        ids.asScala.foreach(id =&gt; reinserts.put(id.getBinaryElement, id.getScore))
</span>335 <span style=''></span><span style='background: #F0ADAD'>        // use nx so that if a feature update has come through we don't overwrite the new ttl
</span>336 <span style=''></span><span style='background: #F0ADAD'>        WithClose(ds.connection.getResource)(_.zadd(table, reinserts, new ZAddParams().nx()))</span><span style=''>
</span>337 <span style=''>      } catch {
</span>338 <span style=''>        case NonFatal(e) =&gt;
</span>339 <span style=''>          </span><span style='background: #F0ADAD'>logger.error(s&quot;Error re-inserting ttls for schema '$typeName'. The following features &quot; +
</span>340 <span style=''></span><span style='background: #F0ADAD'>              s&quot;may never expire: [${ids.asScala.map(_.getElement).mkString(&quot;, &quot;)}]&quot;, e)</span><span style=''>
</span>341 <span style=''>      }
</span>342 <span style=''>    }
</span>343 <span style=''>  }
</span>344 <span style=''>}
</span></pre>
          </div>
          <div class="tab-pane" id="statementlist">
            <table cellspacing="0" cellpadding="0" class="table statementlist">
      <tr>
        <th>Line</th>
        <th>Stmt Id</th>
        <th>Pos</th>
        <th>Tree</th>
        <th>Symbol</th>
        <th>Tests</th>
        <th>Code</th>
      </tr><tr>
        <td>
          48
        </td>
        <td>
          97861
        </td>
        <td>
          2227
          -
          2342
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.collect
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.redis.data.`package`.RedisSystemProperties.AgeOffInterval.toDuration.collect[org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor](({
  @SerialVersionUID(value = 0) final &lt;synthetic&gt; class $anonfun extends scala.runtime.AbstractPartialFunction[scala.concurrent.duration.Duration,org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor] with Serializable {
    def &lt;init&gt;(): &lt;$anon: scala.concurrent.duration.Duration =&gt; org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor&gt; = {
      $anonfun.super.&lt;init&gt;();
      ()
    };
    final override def applyOrElse[A1 &lt;: scala.concurrent.duration.Duration, B1 &gt;: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor](x1: A1, default: A1 =&gt; B1): B1 = ((x1.asInstanceOf[scala.concurrent.duration.Duration]: scala.concurrent.duration.Duration): scala.concurrent.duration.Duration @unchecked) match {
      case (i @ _) if i.isFinite() =&gt; new org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor(RedisAgeOff.this.ds, i)
      case (defaultCase$ @ _) =&gt; default.apply(x1)
    };
    final def isDefinedAt(x1: scala.concurrent.duration.Duration): Boolean = ((x1.asInstanceOf[scala.concurrent.duration.Duration]: scala.concurrent.duration.Duration): scala.concurrent.duration.Duration @unchecked) match {
      case (i @ _) if i.isFinite() =&gt; true
      case (defaultCase$ @ _) =&gt; false
    }
  };
  new $anonfun()
}: PartialFunction[scala.concurrent.duration.Duration,org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor]))
        </td>
      </tr><tr>
        <td>
          48
        </td>
        <td>
          97860
        </td>
        <td>
          2283
          -
          2283
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.$anonfun.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          new $anonfun()
        </td>
      </tr><tr>
        <td>
          49
        </td>
        <td>
          97857
        </td>
        <td>
          2332
          -
          2334
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.ds
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.ds
        </td>
      </tr><tr>
        <td>
          49
        </td>
        <td>
          97856
        </td>
        <td>
          2299
          -
          2309
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.concurrent.duration.Duration.isFinite
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          i.isFinite()
        </td>
      </tr><tr>
        <td>
          49
        </td>
        <td>
          97859
        </td>
        <td>
          2313
          -
          2338
        </td>
        <td>
          Block
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          new org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor(RedisAgeOff.this.ds, i)
        </td>
      </tr><tr>
        <td>
          49
        </td>
        <td>
          97858
        </td>
        <td>
          2313
          -
          2338
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          new org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor(RedisAgeOff.this.ds, i)
        </td>
      </tr><tr>
        <td>
          58
        </td>
        <td>
          97862
        </td>
        <td>
          2495
          -
          2525
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType.isFeatureExpirationEnabled
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType(sft).isFeatureExpirationEnabled
        </td>
      </tr><tr>
        <td>
          58
        </td>
        <td>
          97867
        </td>
        <td>
          2491
          -
          2491
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          58
        </td>
        <td>
          97868
        </td>
        <td>
          2491
          -
          2491
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          59
        </td>
        <td>
          97863
        </td>
        <td>
          2563
          -
          2578
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          sft.getTypeName()
        </td>
      </tr><tr>
        <td>
          59
        </td>
        <td>
          97865
        </td>
        <td>
          2535
          -
          2580
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.executor.foreach[Unit](((x$1: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$1.schedule(sft.getTypeName())))
        </td>
      </tr><tr>
        <td>
          59
        </td>
        <td>
          97864
        </td>
        <td>
          2552
          -
          2579
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.schedule
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          x$1.schedule(sft.getTypeName())
        </td>
      </tr><tr>
        <td>
          59
        </td>
        <td>
          97866
        </td>
        <td>
          2535
          -
          2580
        </td>
        <td>
          Block
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.executor.foreach[Unit](((x$1: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$1.schedule(sft.getTypeName())))
        </td>
      </tr><tr>
        <td>
          70
        </td>
        <td>
          97869
        </td>
        <td>
          2845
          -
          2880
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType.isFeatureExpirationEnabled
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType(previous).isFeatureExpirationEnabled
        </td>
      </tr><tr>
        <td>
          71
        </td>
        <td>
          97870
        </td>
        <td>
          2894
          -
          2925
        </td>
        <td>
          Select
        </td>
        <td>
          scala.Boolean.unary_!
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType(sft).isFeatureExpirationEnabled.unary_!
        </td>
      </tr><tr>
        <td>
          71
        </td>
        <td>
          97895
        </td>
        <td>
          2890
          -
          3305
        </td>
        <td>
          If
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          if (org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType(sft).isFeatureExpirationEnabled.unary_!)
  RedisAgeOff.this.remove(previous)
else
  if (sft.getTypeName().!=(previous.getTypeName()))
    {
      RedisAgeOff.this.executor.foreach[Unit](((x$2: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$2.cancel(previous.getTypeName())));
      org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, Long](RedisAgeOff.this.ds.connection.getResource())(((x$3: redis.clients.jedis.Jedis) =&gt; x$3.renamenx(RedisAgeOff.key(RedisAgeOff.this.ds, previous.getTypeName()), RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName()))))(io.this.IsCloseable.closeableIsCloseable);
      RedisAgeOff.this.executor.foreach[Unit](((x$4: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$4.schedule(sft.getTypeName())))
    }
  else
    ()
        </td>
      </tr><tr>
        <td>
          72
        </td>
        <td>
          97871
        </td>
        <td>
          2937
          -
          2953
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.remove
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.this.remove(previous)
        </td>
      </tr><tr>
        <td>
          72
        </td>
        <td>
          97872
        </td>
        <td>
          2937
          -
          2953
        </td>
        <td>
          Block
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.remove
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.this.remove(previous)
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          97873
        </td>
        <td>
          2990
          -
          3010
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          previous.getTypeName()
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          97874
        </td>
        <td>
          2971
          -
          3010
        </td>
        <td>
          Apply
        </td>
        <td>
          java.lang.Object.!=
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          sft.getTypeName().!=(previous.getTypeName())
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          97891
        </td>
        <td>
          3012
          -
          3305
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          {
  RedisAgeOff.this.executor.foreach[Unit](((x$2: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$2.cancel(previous.getTypeName())));
  org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, Long](RedisAgeOff.this.ds.connection.getResource())(((x$3: redis.clients.jedis.Jedis) =&gt; x$3.renamenx(RedisAgeOff.key(RedisAgeOff.this.ds, previous.getTypeName()), RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName()))))(io.this.IsCloseable.closeableIsCloseable);
  RedisAgeOff.this.executor.foreach[Unit](((x$4: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$4.schedule(sft.getTypeName())))
}
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          97893
        </td>
        <td>
          2967
          -
          2967
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          97892
        </td>
        <td>
          2967
          -
          2967
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          97894
        </td>
        <td>
          2967
          -
          3305
        </td>
        <td>
          If
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          if (sft.getTypeName().!=(previous.getTypeName()))
  {
    RedisAgeOff.this.executor.foreach[Unit](((x$2: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$2.cancel(previous.getTypeName())));
    org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, Long](RedisAgeOff.this.ds.connection.getResource())(((x$3: redis.clients.jedis.Jedis) =&gt; x$3.renamenx(RedisAgeOff.key(RedisAgeOff.this.ds, previous.getTypeName()), RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName()))))(io.this.IsCloseable.closeableIsCloseable);
    RedisAgeOff.this.executor.foreach[Unit](((x$4: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$4.schedule(sft.getTypeName())))
  }
else
  ()
        </td>
      </tr><tr>
        <td>
          74
        </td>
        <td>
          97875
        </td>
        <td>
          3048
          -
          3068
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          previous.getTypeName()
        </td>
      </tr><tr>
        <td>
          74
        </td>
        <td>
          97877
        </td>
        <td>
          3022
          -
          3070
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.this.executor.foreach[Unit](((x$2: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$2.cancel(previous.getTypeName())))
        </td>
      </tr><tr>
        <td>
          74
        </td>
        <td>
          97876
        </td>
        <td>
          3039
          -
          3069
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.cancel
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          x$2.cancel(previous.getTypeName())
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97879
        </td>
        <td>
          3190
          -
          3192
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.ds
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.this.ds
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97878
        </td>
        <td>
          3148
          -
          3173
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.JedisPool.getResource
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.this.ds.connection.getResource()
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97881
        </td>
        <td>
          3186
          -
          3215
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.key
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.key(RedisAgeOff.this.ds, previous.getTypeName())
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97880
        </td>
        <td>
          3194
          -
          3214
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          previous.getTypeName()
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97883
        </td>
        <td>
          3225
          -
          3240
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          sft.getTypeName()
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97882
        </td>
        <td>
          3221
          -
          3223
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.ds
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.this.ds
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97885
        </td>
        <td>
          3175
          -
          3242
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.Jedis.renamenx
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          x$3.renamenx(RedisAgeOff.key(RedisAgeOff.this.ds, previous.getTypeName()), RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName()))
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97884
        </td>
        <td>
          3217
          -
          3241
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.key
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName())
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97887
        </td>
        <td>
          3138
          -
          3243
        </td>
        <td>
          ApplyToImplicitArgs
        </td>
        <td>
          org.locationtech.geomesa.utils.io.WithClose.apply
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, Long](RedisAgeOff.this.ds.connection.getResource())(((x$3: redis.clients.jedis.Jedis) =&gt; x$3.renamenx(RedisAgeOff.key(RedisAgeOff.this.ds, previous.getTypeName()), RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName()))))(io.this.IsCloseable.closeableIsCloseable)
        </td>
      </tr><tr>
        <td>
          76
        </td>
        <td>
          97886
        </td>
        <td>
          3174
          -
          3174
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.io.IsCloseableImplicits.closeableIsCloseable
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          io.this.IsCloseable.closeableIsCloseable
        </td>
      </tr><tr>
        <td>
          77
        </td>
        <td>
          97889
        </td>
        <td>
          3269
          -
          3296
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.schedule
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          x$4.schedule(sft.getTypeName())
        </td>
      </tr><tr>
        <td>
          77
        </td>
        <td>
          97888
        </td>
        <td>
          3280
          -
          3295
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          sft.getTypeName()
        </td>
      </tr><tr>
        <td>
          77
        </td>
        <td>
          97890
        </td>
        <td>
          3252
          -
          3297
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.this.executor.foreach[Unit](((x$4: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$4.schedule(sft.getTypeName())))
        </td>
      </tr><tr>
        <td>
          79
        </td>
        <td>
          97896
        </td>
        <td>
          3321
          -
          3351
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType.isFeatureExpirationEnabled
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType(sft).isFeatureExpirationEnabled
        </td>
      </tr><tr>
        <td>
          79
        </td>
        <td>
          97901
        </td>
        <td>
          3317
          -
          3317
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          79
        </td>
        <td>
          97903
        </td>
        <td>
          3317
          -
          3412
        </td>
        <td>
          If
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          if (org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType(sft).isFeatureExpirationEnabled)
  RedisAgeOff.this.executor.foreach[Unit](((x$5: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$5.schedule(sft.getTypeName())))
else
  ()
        </td>
      </tr><tr>
        <td>
          79
        </td>
        <td>
          97902
        </td>
        <td>
          3317
          -
          3317
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          80
        </td>
        <td>
          97897
        </td>
        <td>
          3389
          -
          3404
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          sft.getTypeName()
        </td>
      </tr><tr>
        <td>
          80
        </td>
        <td>
          97899
        </td>
        <td>
          3361
          -
          3406
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.this.executor.foreach[Unit](((x$5: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$5.schedule(sft.getTypeName())))
        </td>
      </tr><tr>
        <td>
          80
        </td>
        <td>
          97898
        </td>
        <td>
          3378
          -
          3405
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.schedule
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          x$5.schedule(sft.getTypeName())
        </td>
      </tr><tr>
        <td>
          80
        </td>
        <td>
          97900
        </td>
        <td>
          3361
          -
          3406
        </td>
        <td>
          Block
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          RedisAgeOff.this.executor.foreach[Unit](((x$5: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$5.schedule(sft.getTypeName())))
        </td>
      </tr><tr>
        <td>
          90
        </td>
        <td>
          97904
        </td>
        <td>
          3573
          -
          3603
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType.isFeatureExpirationEnabled
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType(sft).isFeatureExpirationEnabled
        </td>
      </tr><tr>
        <td>
          90
        </td>
        <td>
          97917
        </td>
        <td>
          3569
          -
          3569
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          90
        </td>
        <td>
          97916
        </td>
        <td>
          3605
          -
          3738
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  RedisAgeOff.this.executor.foreach[Unit](((x$6: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$6.cancel(sft.getTypeName())));
  {
    org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, Long](RedisAgeOff.this.ds.connection.getResource())(((x$7: redis.clients.jedis.Jedis) =&gt; x$7.del(RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName()))))(io.this.IsCloseable.closeableIsCloseable);
    ()
  }
}
        </td>
      </tr><tr>
        <td>
          90
        </td>
        <td>
          97918
        </td>
        <td>
          3569
          -
          3569
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          91
        </td>
        <td>
          97905
        </td>
        <td>
          3639
          -
          3654
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          sft.getTypeName()
        </td>
      </tr><tr>
        <td>
          91
        </td>
        <td>
          97907
        </td>
        <td>
          3613
          -
          3656
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.executor.foreach[Unit](((x$6: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$6.cancel(sft.getTypeName())))
        </td>
      </tr><tr>
        <td>
          91
        </td>
        <td>
          97906
        </td>
        <td>
          3630
          -
          3655
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.cancel
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          x$6.cancel(sft.getTypeName())
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          97909
        </td>
        <td>
          3710
          -
          3712
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.ds
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.ds
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          97908
        </td>
        <td>
          3673
          -
          3698
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.JedisPool.getResource
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.ds.connection.getResource()
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          97911
        </td>
        <td>
          3706
          -
          3730
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.key
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName())
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          97910
        </td>
        <td>
          3714
          -
          3729
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          sft.getTypeName()
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          97913
        </td>
        <td>
          3699
          -
          3699
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.io.IsCloseableImplicits.closeableIsCloseable
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          io.this.IsCloseable.closeableIsCloseable
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          97912
        </td>
        <td>
          3700
          -
          3731
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.Jedis.del
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          x$7.del(RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName()))
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          97915
        </td>
        <td>
          3699
          -
          3699
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          97914
        </td>
        <td>
          3663
          -
          3732
        </td>
        <td>
          ApplyToImplicitArgs
        </td>
        <td>
          org.locationtech.geomesa.utils.io.WithClose.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, Long](RedisAgeOff.this.ds.connection.getResource())(((x$7: redis.clients.jedis.Jedis) =&gt; x$7.del(RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName()))))(io.this.IsCloseable.closeableIsCloseable)
        </td>
      </tr><tr>
        <td>
          103
        </td>
        <td>
          97919
        </td>
        <td>
          3931
          -
          3961
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType.isFeatureExpirationEnabled
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.utils.geotools.RichSimpleFeatureType.RichSimpleFeatureType(sft).isFeatureExpirationEnabled
        </td>
      </tr><tr>
        <td>
          104
        </td>
        <td>
          97921
        </td>
        <td>
          4012
          -
          4014
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.ds
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.ds
        </td>
      </tr><tr>
        <td>
          104
        </td>
        <td>
          97920
        </td>
        <td>
          3993
          -
          4006
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.RedisDataStore.connection
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.ds.connection
        </td>
      </tr><tr>
        <td>
          104
        </td>
        <td>
          97923
        </td>
        <td>
          4008
          -
          4032
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.key
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName())
        </td>
      </tr><tr>
        <td>
          104
        </td>
        <td>
          97922
        </td>
        <td>
          4016
          -
          4031
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeatureType.getTypeName
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          sft.getTypeName()
        </td>
      </tr><tr>
        <td>
          104
        </td>
        <td>
          97925
        </td>
        <td>
          3971
          -
          4034
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Some.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.Some.apply[org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter](new org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter(RedisAgeOff.this.ds.connection, RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName())))
        </td>
      </tr><tr>
        <td>
          104
        </td>
        <td>
          97924
        </td>
        <td>
          3976
          -
          4033
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          new org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter(RedisAgeOff.this.ds.connection, RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName()))
        </td>
      </tr><tr>
        <td>
          104
        </td>
        <td>
          97926
        </td>
        <td>
          3971
          -
          4034
        </td>
        <td>
          Block
        </td>
        <td>
          scala.Some.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.Some.apply[org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter](new org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter(RedisAgeOff.this.ds.connection, RedisAgeOff.key(RedisAgeOff.this.ds, sft.getTypeName())))
        </td>
      </tr><tr>
        <td>
          106
        </td>
        <td>
          97927
        </td>
        <td>
          4054
          -
          4058
        </td>
        <td>
          Select
        </td>
        <td>
          scala.None
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.None
        </td>
      </tr><tr>
        <td>
          106
        </td>
        <td>
          97928
        </td>
        <td>
          4054
          -
          4058
        </td>
        <td>
          Block
        </td>
        <td>
          scala.None
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.None
        </td>
      </tr><tr>
        <td>
          110
        </td>
        <td>
          97929
        </td>
        <td>
          4118
          -
          4127
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.close
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          x$8.close()
        </td>
      </tr><tr>
        <td>
          110
        </td>
        <td>
          97930
        </td>
        <td>
          4101
          -
          4128
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.executor.foreach[Unit](((x$8: org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor) =&gt; x$8.close()))
        </td>
      </tr><tr>
        <td>
          117
        </td>
        <td>
          97931
        </td>
        <td>
          4257
          -
          4260
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          &quot;t&quot;
        </td>
      </tr><tr>
        <td>
          119
        </td>
        <td>
          97932
        </td>
        <td>
          4393
          -
          4457
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.utils.conf.GeoMesaSystemProperties.SystemProperty.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.utils.conf.GeoMesaSystemProperties.SystemProperty.apply(&quot;geomesa.redis.age.off.lock.timeout&quot;, &quot;1 second&quot;)
        </td>
      </tr><tr>
        <td>
          126
        </td>
        <td>
          97933
        </td>
        <td>
          4592
          -
          4607
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.index.geotools.MetadataBackedDataStore.getTypeNames
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ds.getTypeNames()
        </td>
      </tr><tr>
        <td>
          126
        </td>
        <td>
          97935
        </td>
        <td>
          4621
          -
          4650
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.add
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ds.aging.add(ds.getSchema(n))
        </td>
      </tr><tr>
        <td>
          126
        </td>
        <td>
          97934
        </td>
        <td>
          4634
          -
          4649
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.index.geotools.GeoMesaDataStore.getSchema
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ds.getSchema(n)
        </td>
      </tr><tr>
        <td>
          126
        </td>
        <td>
          97936
        </td>
        <td>
          4592
          -
          4651
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.collection.IndexedSeqOptimized.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.Predef.refArrayOps[String](ds.getTypeNames()).foreach[Unit](((n: String) =&gt; ds.aging.add(ds.getSchema(n))))
        </td>
      </tr><tr>
        <td>
          136
        </td>
        <td>
          97937
        </td>
        <td>
          4916
          -
          4917
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          &quot;&quot;
        </td>
      </tr><tr>
        <td>
          136
        </td>
        <td>
          97939
        </td>
        <td>
          4948
          -
          4953
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          &quot;_ttl&quot;
        </td>
      </tr><tr>
        <td>
          136
        </td>
        <td>
          97938
        </td>
        <td>
          4936
          -
          4938
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          &quot;_&quot;
        </td>
      </tr><tr>
        <td>
          136
        </td>
        <td>
          97941
        </td>
        <td>
          4963
          -
          4985
        </td>
        <td>
          Select
        </td>
        <td>
          java.nio.charset.StandardCharsets.UTF_8
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          java.nio.charset.StandardCharsets.UTF_8
        </td>
      </tr><tr>
        <td>
          136
        </td>
        <td>
          97940
        </td>
        <td>
          4918
          -
          4935
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.RedisDataStoreFactory.RedisDataStoreConfig.catalog
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ds.config.catalog
        </td>
      </tr><tr>
        <td>
          136
        </td>
        <td>
          97942
        </td>
        <td>
          4914
          -
          4986
        </td>
        <td>
          Apply
        </td>
        <td>
          java.lang.String.getBytes
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.StringContext.apply(&quot;&quot;, &quot;_&quot;, &quot;_ttl&quot;).s(ds.config.catalog, typeName).getBytes(java.nio.charset.StandardCharsets.UTF_8)
        </td>
      </tr><tr>
        <td>
          146
        </td>
        <td>
          97943
        </td>
        <td>
          5267
          -
          5319
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.HashMap.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          new java.util.HashMap[Array[Byte],Double]()
        </td>
      </tr><tr>
        <td>
          147
        </td>
        <td>
          97944
        </td>
        <td>
          5346
          -
          5376
        </td>
        <td>
          TypeApply
        </td>
        <td>
          scala.collection.generic.GenericCompanion.empty
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.collection.mutable.ArrayBuffer.empty[Array[Byte]]
        </td>
      </tr><tr>
        <td>
          150
        </td>
        <td>
          97945
        </td>
        <td>
          5566
          -
          5577
        </td>
        <td>
          ApplyImplicitView
        </td>
        <td>
          scala.Predef.double2Double
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.Predef.double2Double(feature.ttl)
        </td>
      </tr><tr>
        <td>
          150
        </td>
        <td>
          97947
        </td>
        <td>
          5550
          -
          5550
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          150
        </td>
        <td>
          97946
        </td>
        <td>
          5540
          -
          5578
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.HashMap.put
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.writes.put(feature.rawId, scala.Predef.double2Double(feature.ttl))
        </td>
      </tr><tr>
        <td>
          151
        </td>
        <td>
          97949
        </td>
        <td>
          5641
          -
          5641
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          151
        </td>
        <td>
          97948
        </td>
        <td>
          5633
          -
          5657
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.collection.mutable.ArrayBuffer.+=
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.deletes.+=(feature.rawId)
        </td>
      </tr><tr>
        <td>
          154
        </td>
        <td>
          97951
        </td>
        <td>
          5704
          -
          5739
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Boolean.||
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.writes.isEmpty().unary_!.||(AgeOffWriter.this.deletes.nonEmpty)
        </td>
      </tr><tr>
        <td>
          154
        </td>
        <td>
          97950
        </td>
        <td>
          5723
          -
          5739
        </td>
        <td>
          Select
        </td>
        <td>
          scala.collection.TraversableOnce.nonEmpty
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.deletes.nonEmpty
        </td>
      </tr><tr>
        <td>
          154
        </td>
        <td>
          97975
        </td>
        <td>
          5700
          -
          5700
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          154
        </td>
        <td>
          97976
        </td>
        <td>
          5700
          -
          5700
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          155
        </td>
        <td>
          97974
        </td>
        <td>
          5751
          -
          6094
        </td>
        <td>
          Try
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          try {
  org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, AnyVal](AgeOffWriter.this.connection.getResource())(((jedis: redis.clients.jedis.Jedis) =&gt; {
    if (AgeOffWriter.this.deletes.nonEmpty)
      jedis.zrem(AgeOffWriter.this.table, (AgeOffWriter.this.deletes.toSeq: _*))
    else
      ();
    if (AgeOffWriter.this.writes.isEmpty().unary_!)
      jedis.zadd(AgeOffWriter.this.table, AgeOffWriter.this.writes)
    else
      ()
  }))(io.this.IsCloseable.closeableIsCloseable);
  ()
} finally {
  AgeOffWriter.this.writes.clear();
  AgeOffWriter.this.deletes.clear()
}
        </td>
      </tr><tr>
        <td>
          156
        </td>
        <td>
          97952
        </td>
        <td>
          5777
          -
          5799
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.JedisPool.getResource
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.connection.getResource()
        </td>
      </tr><tr>
        <td>
          156
        </td>
        <td>
          97967
        </td>
        <td>
          5801
          -
          5801
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.io.IsCloseableImplicits.closeableIsCloseable
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          io.this.IsCloseable.closeableIsCloseable
        </td>
      </tr><tr>
        <td>
          156
        </td>
        <td>
          97969
        </td>
        <td>
          5801
          -
          5801
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          156
        </td>
        <td>
          97968
        </td>
        <td>
          5767
          -
          6013
        </td>
        <td>
          ApplyToImplicitArgs
        </td>
        <td>
          org.locationtech.geomesa.utils.io.WithClose.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, AnyVal](AgeOffWriter.this.connection.getResource())(((jedis: redis.clients.jedis.Jedis) =&gt; {
  if (AgeOffWriter.this.deletes.nonEmpty)
    jedis.zrem(AgeOffWriter.this.table, (AgeOffWriter.this.deletes.toSeq: _*))
  else
    ();
  if (AgeOffWriter.this.writes.isEmpty().unary_!)
    jedis.zadd(AgeOffWriter.this.table, AgeOffWriter.this.writes)
  else
    ()
}))(io.this.IsCloseable.closeableIsCloseable)
        </td>
      </tr><tr>
        <td>
          156
        </td>
        <td>
          97970
        </td>
        <td>
          5767
          -
          6013
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, AnyVal](AgeOffWriter.this.connection.getResource())(((jedis: redis.clients.jedis.Jedis) =&gt; {
    if (AgeOffWriter.this.deletes.nonEmpty)
      jedis.zrem(AgeOffWriter.this.table, (AgeOffWriter.this.deletes.toSeq: _*))
    else
      ();
    if (AgeOffWriter.this.writes.isEmpty().unary_!)
      jedis.zadd(AgeOffWriter.this.table, AgeOffWriter.this.writes)
    else
      ()
  }))(io.this.IsCloseable.closeableIsCloseable);
  ()
}
        </td>
      </tr><tr>
        <td>
          157
        </td>
        <td>
          97953
        </td>
        <td>
          5828
          -
          5844
        </td>
        <td>
          Select
        </td>
        <td>
          scala.collection.TraversableOnce.nonEmpty
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.deletes.nonEmpty
        </td>
      </tr><tr>
        <td>
          157
        </td>
        <td>
          97959
        </td>
        <td>
          5824
          -
          5824
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          157
        </td>
        <td>
          97958
        </td>
        <td>
          5824
          -
          5824
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          158
        </td>
        <td>
          97955
        </td>
        <td>
          5880
          -
          5893
        </td>
        <td>
          Select
        </td>
        <td>
          scala.collection.SeqLike.toSeq
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.deletes.toSeq
        </td>
      </tr><tr>
        <td>
          158
        </td>
        <td>
          97954
        </td>
        <td>
          5873
          -
          5878
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter.table
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.table
        </td>
      </tr><tr>
        <td>
          158
        </td>
        <td>
          97957
        </td>
        <td>
          5862
          -
          5898
        </td>
        <td>
          Block
        </td>
        <td>
          redis.clients.jedis.Jedis.zrem
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          jedis.zrem(AgeOffWriter.this.table, (AgeOffWriter.this.deletes.toSeq: _*))
        </td>
      </tr><tr>
        <td>
          158
        </td>
        <td>
          97956
        </td>
        <td>
          5862
          -
          5898
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.Jedis.zrem
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          jedis.zrem(AgeOffWriter.this.table, (AgeOffWriter.this.deletes.toSeq: _*))
        </td>
      </tr><tr>
        <td>
          160
        </td>
        <td>
          97960
        </td>
        <td>
          5929
          -
          5944
        </td>
        <td>
          Select
        </td>
        <td>
          scala.Boolean.unary_!
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.writes.isEmpty().unary_!
        </td>
      </tr><tr>
        <td>
          160
        </td>
        <td>
          97965
        </td>
        <td>
          5925
          -
          5925
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          160
        </td>
        <td>
          97966
        </td>
        <td>
          5925
          -
          5925
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          161
        </td>
        <td>
          97961
        </td>
        <td>
          5973
          -
          5978
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter.table
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.table
        </td>
      </tr><tr>
        <td>
          161
        </td>
        <td>
          97963
        </td>
        <td>
          5962
          -
          5987
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.Jedis.zadd
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          jedis.zadd(AgeOffWriter.this.table, AgeOffWriter.this.writes)
        </td>
      </tr><tr>
        <td>
          161
        </td>
        <td>
          97962
        </td>
        <td>
          5980
          -
          5986
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter.writes
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.writes
        </td>
      </tr><tr>
        <td>
          161
        </td>
        <td>
          97964
        </td>
        <td>
          5962
          -
          5987
        </td>
        <td>
          Block
        </td>
        <td>
          redis.clients.jedis.Jedis.zadd
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          jedis.zadd(AgeOffWriter.this.table, AgeOffWriter.this.writes)
        </td>
      </tr><tr>
        <td>
          164
        </td>
        <td>
          97973
        </td>
        <td>
          6032
          -
          6094
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  AgeOffWriter.this.writes.clear();
  AgeOffWriter.this.deletes.clear()
}
        </td>
      </tr><tr>
        <td>
          165
        </td>
        <td>
          97971
        </td>
        <td>
          6044
          -
          6058
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.HashMap.clear
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.writes.clear()
        </td>
      </tr><tr>
        <td>
          166
        </td>
        <td>
          97972
        </td>
        <td>
          6069
          -
          6084
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.collection.mutable.ArrayBuffer.clear
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.deletes.clear()
        </td>
      </tr><tr>
        <td>
          171
        </td>
        <td>
          97977
        </td>
        <td>
          6143
          -
          6150
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffWriter.flush
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffWriter.this.flush()
        </td>
      </tr><tr>
        <td>
          184
        </td>
        <td>
          97978
        </td>
        <td>
          6516
          -
          6578
        </td>
        <td>
          TypeApply
        </td>
        <td>
          scala.collection.mutable.Map.empty
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.collection.mutable.Map.empty[String, java.util.concurrent.ScheduledFuture[_]]
        </td>
      </tr><tr>
        <td>
          185
        </td>
        <td>
          97979
        </td>
        <td>
          6602
          -
          6620
        </td>
        <td>
          Select
        </td>
        <td>
          scala.concurrent.duration.Duration.toMillis
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffExecutor.this.frequency.toMillis
        </td>
      </tr><tr>
        <td>
          186
        </td>
        <td>
          97980
        </td>
        <td>
          6642
          -
          6677
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.concurrent.Executors.newScheduledThreadPool
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          java.util.concurrent.Executors.newScheduledThreadPool(3)
        </td>
      </tr><tr>
        <td>
          196
        </td>
        <td>
          97981
        </td>
        <td>
          7084
          -
          7086
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.ds
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffExecutor.this.ds
        </td>
      </tr><tr>
        <td>
          196
        </td>
        <td>
          97983
        </td>
        <td>
          7099
          -
          7104
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          5000L
        </td>
      </tr><tr>
        <td>
          196
        </td>
        <td>
          97982
        </td>
        <td>
          7067
          -
          7097
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          new RedisAgeOff.this.AgeOffRunner(AgeOffExecutor.this.ds, typeName)
        </td>
      </tr><tr>
        <td>
          196
        </td>
        <td>
          97985
        </td>
        <td>
          7112
          -
          7133
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          MILLISECONDS
        </td>
      </tr><tr>
        <td>
          196
        </td>
        <td>
          97984
        </td>
        <td>
          7106
          -
          7110
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffExecutor.rate
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffExecutor.this.rate
        </td>
      </tr><tr>
        <td>
          196
        </td>
        <td>
          97986
        </td>
        <td>
          7044
          -
          7134
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.concurrent.ScheduledExecutorService.scheduleAtFixedRate
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffExecutor.this.es.scheduleAtFixedRate(new RedisAgeOff.this.AgeOffRunner(AgeOffExecutor.this.ds, typeName), 5000L, AgeOffExecutor.this.rate, MILLISECONDS)
        </td>
      </tr><tr>
        <td>
          197
        </td>
        <td>
          97989
        </td>
        <td>
          7141
          -
          7224
        </td>
        <td>
          Apply
        </td>
        <td>
          java.lang.Object.synchronized
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffExecutor.this.synchronized[Unit](AgeOffExecutor.this.tasks.put(typeName, future).foreach[Boolean](((x$9: java.util.concurrent.ScheduledFuture[_]) =&gt; x$9.cancel(false))))
        </td>
      </tr><tr>
        <td>
          198
        </td>
        <td>
          97987
        </td>
        <td>
          7200
          -
          7215
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.concurrent.Future.cancel
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          x$9.cancel(false)
        </td>
      </tr><tr>
        <td>
          198
        </td>
        <td>
          97988
        </td>
        <td>
          7164
          -
          7216
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffExecutor.this.tasks.put(typeName, future).foreach[Boolean](((x$9: java.util.concurrent.ScheduledFuture[_]) =&gt; x$9.cancel(false)))
        </td>
      </tr><tr>
        <td>
          208
        </td>
        <td>
          97992
        </td>
        <td>
          7411
          -
          7489
        </td>
        <td>
          Apply
        </td>
        <td>
          java.lang.Object.synchronized
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffExecutor.this.synchronized[Unit](AgeOffExecutor.this.tasks.remove(typeName).foreach[Boolean](((x$10: java.util.concurrent.ScheduledFuture[_]) =&gt; x$10.cancel(false))))
        </td>
      </tr><tr>
        <td>
          209
        </td>
        <td>
          97991
        </td>
        <td>
          7434
          -
          7481
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffExecutor.this.tasks.remove(typeName).foreach[Boolean](((x$10: java.util.concurrent.ScheduledFuture[_]) =&gt; x$10.cancel(false)))
        </td>
      </tr><tr>
        <td>
          209
        </td>
        <td>
          97990
        </td>
        <td>
          7465
          -
          7480
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.concurrent.Future.cancel
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          x$10.cancel(false)
        </td>
      </tr><tr>
        <td>
          213
        </td>
        <td>
          97993
        </td>
        <td>
          7530
          -
          7543
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.concurrent.ExecutorService.shutdown
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffExecutor.this.es.shutdown()
        </td>
      </tr><tr>
        <td>
          226
        </td>
        <td>
          97995
        </td>
        <td>
          7892
          -
          7900
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.typeName
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.typeName
        </td>
      </tr><tr>
        <td>
          226
        </td>
        <td>
          97994
        </td>
        <td>
          7888
          -
          7890
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.ds
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.ds
        </td>
      </tr><tr>
        <td>
          226
        </td>
        <td>
          97996
        </td>
        <td>
          7884
          -
          7901
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.key
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.key(AgeOffRunner.this.ds, AgeOffRunner.this.typeName)
        </td>
      </tr><tr>
        <td>
          227
        </td>
        <td>
          97997
        </td>
        <td>
          7931
          -
          7964
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          &quot;/org.locationtech.geomesa.redis.&quot;
        </td>
      </tr><tr>
        <td>
          227
        </td>
        <td>
          97999
        </td>
        <td>
          7997
          -
          7998
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          &quot;&quot;
        </td>
      </tr><tr>
        <td>
          227
        </td>
        <td>
          97998
        </td>
        <td>
          7983
          -
          7989
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          &quot;.ttl.&quot;
        </td>
      </tr><tr>
        <td>
          227
        </td>
        <td>
          98001
        </td>
        <td>
          7989
          -
          7997
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.typeName
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.typeName
        </td>
      </tr><tr>
        <td>
          227
        </td>
        <td>
          98000
        </td>
        <td>
          7965
          -
          7982
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.RedisDataStoreFactory.RedisDataStoreConfig.catalog
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.ds.config.catalog
        </td>
      </tr><tr>
        <td>
          227
        </td>
        <td>
          98002
        </td>
        <td>
          7929
          -
          7998
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.StringContext.s
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.StringContext.apply(&quot;/org.locationtech.geomesa.redis.&quot;, &quot;.ttl.&quot;, &quot;&quot;).s(AgeOffRunner.this.ds.config.catalog, AgeOffRunner.this.typeName)
        </td>
      </tr><tr>
        <td>
          229
        </td>
        <td>
          98003
        </td>
        <td>
          8059
          -
          8069
        </td>
        <td>
          Select
        </td>
        <td>
          scala.concurrent.duration.Duration.toMillis
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          x$11.toMillis
        </td>
      </tr><tr>
        <td>
          229
        </td>
        <td>
          98005
        </td>
        <td>
          8026
          -
          8215
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.getOrElse
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.AgeOffLockTimeout.toDuration.map[Long](((x$11: scala.concurrent.duration.Duration) =&gt; x$11.toMillis)).getOrElse[Long](throw new java.lang.IllegalStateException(&quot;Invalid age-off lock timeout&quot;))
        </td>
      </tr><tr>
        <td>
          231
        </td>
        <td>
          98004
        </td>
        <td>
          8146
          -
          8209
        </td>
        <td>
          Throw
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          throw new java.lang.IllegalStateException(&quot;Invalid age-off lock timeout&quot;)
        </td>
      </tr><tr>
        <td>
          234
        </td>
        <td>
          98006
        </td>
        <td>
          8258
          -
          8271
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.RedisDataStore.connection
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.ds.connection
        </td>
      </tr><tr>
        <td>
          237
        </td>
        <td>
          98007
        </td>
        <td>
          8328
          -
          8354
        </td>
        <td>
          Apply
        </td>
        <td>
          java.lang.System.currentTimeMillis
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          java.lang.System.currentTimeMillis()
        </td>
      </tr><tr>
        <td>
          240
        </td>
        <td>
          98008
        </td>
        <td>
          8461
          -
          8488
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.removeExpiredIds
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.removeExpiredIds(timestamp)
        </td>
      </tr><tr>
        <td>
          241
        </td>
        <td>
          98009
        </td>
        <td>
          8499
          -
          8511
        </td>
        <td>
          Select
        </td>
        <td>
          scala.Boolean.unary_!
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ids.isEmpty().unary_!
        </td>
      </tr><tr>
        <td>
          241
        </td>
        <td>
          98013
        </td>
        <td>
          8495
          -
          8495
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          241
        </td>
        <td>
          98012
        </td>
        <td>
          8495
          -
          8495
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          242
        </td>
        <td>
          98011
        </td>
        <td>
          8523
          -
          8560
        </td>
        <td>
          Block
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.removeExpiredFeatures
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.removeExpiredFeatures(ids, timestamp)
        </td>
      </tr><tr>
        <td>
          242
        </td>
        <td>
          98010
        </td>
        <td>
          8523
          -
          8560
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.removeExpiredFeatures
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.removeExpiredFeatures(ids, timestamp)
        </td>
      </tr><tr>
        <td>
          254
        </td>
        <td>
          98014
        </td>
        <td>
          8854
          -
          8879
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.JedisPool.getResource
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.ds.connection.getResource()
        </td>
      </tr><tr>
        <td>
          254
        </td>
        <td>
          98027
        </td>
        <td>
          8844
          -
          9161
        </td>
        <td>
          ApplyToImplicitArgs
        </td>
        <td>
          org.locationtech.geomesa.utils.io.WithClose.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, java.util.List[redis.clients.jedis.resps.Tuple]](AgeOffRunner.this.ds.connection.getResource())(((jedis: redis.clients.jedis.Jedis) =&gt; {
  val tx: redis.clients.jedis.Transaction = jedis.multi();
  val scores: redis.clients.jedis.Response[java.util.List[redis.clients.jedis.resps.Tuple]] = tx.zrangeByScoreWithScores(AgeOffRunner.this.table, 0.0, timestamp.toDouble);
  tx.zremrangeByScore(AgeOffRunner.this.table, 0.0, timestamp.toDouble);
  tx.exec();
  scores.get()
}))(io.this.IsCloseable.closeableIsCloseable)
        </td>
      </tr><tr>
        <td>
          254
        </td>
        <td>
          98026
        </td>
        <td>
          8881
          -
          8881
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.io.IsCloseableImplicits.closeableIsCloseable
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          io.this.IsCloseable.closeableIsCloseable
        </td>
      </tr><tr>
        <td>
          256
        </td>
        <td>
          98015
        </td>
        <td>
          8975
          -
          8988
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.Jedis.multi
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          jedis.multi()
        </td>
      </tr><tr>
        <td>
          257
        </td>
        <td>
          98017
        </td>
        <td>
          9046
          -
          9047
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          0.0
        </td>
      </tr><tr>
        <td>
          257
        </td>
        <td>
          98016
        </td>
        <td>
          9039
          -
          9044
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.table
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.table
        </td>
      </tr><tr>
        <td>
          257
        </td>
        <td>
          98019
        </td>
        <td>
          9012
          -
          9059
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.PipeliningBase.zrangeByScoreWithScores
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          tx.zrangeByScoreWithScores(AgeOffRunner.this.table, 0.0, timestamp.toDouble)
        </td>
      </tr><tr>
        <td>
          257
        </td>
        <td>
          98018
        </td>
        <td>
          9049
          -
          9058
        </td>
        <td>
          Select
        </td>
        <td>
          scala.Long.toDouble
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          timestamp.toDouble
        </td>
      </tr><tr>
        <td>
          258
        </td>
        <td>
          98021
        </td>
        <td>
          9097
          -
          9098
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          0.0
        </td>
      </tr><tr>
        <td>
          258
        </td>
        <td>
          98020
        </td>
        <td>
          9090
          -
          9095
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.table
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.table
        </td>
      </tr><tr>
        <td>
          258
        </td>
        <td>
          98023
        </td>
        <td>
          9070
          -
          9110
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.PipeliningBase.zremrangeByScore
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          tx.zremrangeByScore(AgeOffRunner.this.table, 0.0, timestamp.toDouble)
        </td>
      </tr><tr>
        <td>
          258
        </td>
        <td>
          98022
        </td>
        <td>
          9100
          -
          9109
        </td>
        <td>
          Select
        </td>
        <td>
          scala.Long.toDouble
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          timestamp.toDouble
        </td>
      </tr><tr>
        <td>
          259
        </td>
        <td>
          98024
        </td>
        <td>
          9121
          -
          9130
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.Transaction.exec
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          tx.exec()
        </td>
      </tr><tr>
        <td>
          260
        </td>
        <td>
          98025
        </td>
        <td>
          9141
          -
          9151
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.Response.get
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scores.get()
        </td>
      </tr><tr>
        <td>
          266
        </td>
        <td>
          98028
        </td>
        <td>
          9330
          -
          9365
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.Collections.emptyList
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          java.util.Collections.emptyList[redis.clients.jedis.resps.Tuple]()
        </td>
      </tr><tr>
        <td>
          270
        </td>
        <td>
          98029
        </td>
        <td>
          9496
          -
          9504
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.lockPath
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.lockPath
        </td>
      </tr><tr>
        <td>
          270
        </td>
        <td>
          98031
        </td>
        <td>
          9487
          -
          9528
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.index.utils.DistributedLocking.withLock
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.withLock[java.util.List[redis.clients.jedis.resps.Tuple]](AgeOffRunner.this.lockPath, AgeOffRunner.this.timeout, exec, noLock)
        </td>
      </tr><tr>
        <td>
          270
        </td>
        <td>
          98030
        </td>
        <td>
          9506
          -
          9513
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.timeout
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.timeout
        </td>
      </tr><tr>
        <td>
          270
        </td>
        <td>
          98032
        </td>
        <td>
          9487
          -
          9528
        </td>
        <td>
          Block
        </td>
        <td>
          org.locationtech.geomesa.index.utils.DistributedLocking.withLock
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.withLock[java.util.List[redis.clients.jedis.resps.Tuple]](AgeOffRunner.this.lockPath, AgeOffRunner.this.timeout, exec, noLock)
        </td>
      </tr><tr>
        <td>
          271
        </td>
        <td>
          98034
        </td>
        <td>
          9564
          -
          9674
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          {
  (if (RedisAgeOff.this.logger.underlying.isErrorEnabled())
    RedisAgeOff.this.logger.underlying.error(&quot;Error executing ttl transaction:&quot;, e)
  else
    (): Unit);
  java.util.Collections.emptyList[redis.clients.jedis.resps.Tuple]()
}
        </td>
      </tr><tr>
        <td>
          273
        </td>
        <td>
          98033
        </td>
        <td>
          9639
          -
          9674
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.Collections.emptyList
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          java.util.Collections.emptyList[redis.clients.jedis.resps.Tuple]()
        </td>
      </tr><tr>
        <td>
          288
        </td>
        <td>
          98069
        </td>
        <td>
          10075
          -
          11497
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  val fids: java.util.HashSet[org.geotools.api.filter.identity.Identifier] = new java.util.HashSet[org.geotools.api.filter.identity.Identifier](ids.size());
  scala.collection.JavaConverters.asScalaBufferConverter[redis.clients.jedis.resps.Tuple](ids).asScala.foreach[Boolean](((id: redis.clients.jedis.resps.Tuple) =&gt; fids.add(org.locationtech.geomesa.filter.FilterHelper.ff.featureId(id.getElement()))));
  (if (RedisAgeOff.this.logger.underlying.isTraceEnabled())
    RedisAgeOff.this.logger.underlying.trace(&quot;Age-off for schema \'{}\' found the following features: {}&quot;, (scala.Array.apply[AnyRef]((AgeOffRunner.this.typeName: AnyRef), (fids: AnyRef))((ClassTag.AnyRef: scala.reflect.ClassTag[AnyRef])): _*))
  else
    (): Unit);
  val trace: Boolean = RedisAgeOff.this.logger.underlying.isTraceEnabled();
  &lt;stable&gt; &lt;accessor&gt; lazy val results: scala.collection.mutable.ListBuffer[String] = scala.collection.mutable.ListBuffer.empty[String];
  var i: Int = 0;
  org.locationtech.geomesa.utils.io.`package`.WithClose.apply[org.locationtech.geomesa.index.FlushableFeatureWriter, Unit](AgeOffRunner.this.ds.getFeatureWriter(AgeOffRunner.this.typeName, org.locationtech.geomesa.filter.FilterHelper.ff.id(fids), org.geotools.api.data.Transaction.AUTO_COMMIT))(((writer: org.locationtech.geomesa.index.FlushableFeatureWriter) =&gt; while$1(){
    if (writer.hasNext())
      {
        {
          val sf: org.geotools.api.feature.simple.SimpleFeature = writer.next();
          val ttl: Object = sf.getUserData().get(RedisAgeOff.this.TtlUserDataKey);
          if (ttl.!=(null).&amp;&amp;(ttl.asInstanceOf[Long].&lt;=(timestamp)))
            {
              writer.remove();
              i = i.+(1);
              if (trace)
                results.+=(sf.getID())
              else
                ()
            }
          else
            (if (RedisAgeOff.this.logger.underlying.isDebugEnabled())
              RedisAgeOff.this.logger.underlying.debug(&quot;Age-off for schema \'{}\' ignoring updated feature: {}&quot;, (scala.Array.apply[AnyRef]((AgeOffRunner.this.typeName: AnyRef), (sf.getID(): AnyRef))((ClassTag.AnyRef: scala.reflect.ClassTag[AnyRef])): _*))
            else
              (): Unit)
        };
        while$1()
      }
    else
      ()
  }))(io.this.IsCloseable.closeableIsCloseable);
  (if (RedisAgeOff.this.logger.underlying.isDebugEnabled())
    RedisAgeOff.this.logger.underlying.debug(&quot;Age-off for schema \'{}\' removed {} features&quot;, (scala.Array.apply[AnyRef]((AgeOffRunner.this.typeName: AnyRef), i.asInstanceOf[AnyRef])((ClassTag.AnyRef: scala.reflect.ClassTag[AnyRef])): _*))
  else
    (): Unit);
  (if (RedisAgeOff.this.logger.underlying.isTraceEnabled())
    RedisAgeOff.this.logger.underlying.trace(&quot;Age-off for schema \'{}\' removed the following features: [{}]&quot;, (scala.Array.apply[AnyRef]((AgeOffRunner.this.typeName: AnyRef), (results.mkString(&quot;, &quot;): AnyRef))((ClassTag.AnyRef: scala.reflect.ClassTag[AnyRef])): _*))
  else
    (): Unit)
}
        </td>
      </tr><tr>
        <td>
          289
        </td>
        <td>
          98035
        </td>
        <td>
          10120
          -
          10128
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.List.size
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ids.size()
        </td>
      </tr><tr>
        <td>
          289
        </td>
        <td>
          98036
        </td>
        <td>
          10086
          -
          10129
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.HashSet.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          new java.util.HashSet[org.geotools.api.filter.identity.Identifier](ids.size())
        </td>
      </tr><tr>
        <td>
          290
        </td>
        <td>
          98037
        </td>
        <td>
          10199
          -
          10212
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.resps.Tuple.getElement
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          id.getElement()
        </td>
      </tr><tr>
        <td>
          290
        </td>
        <td>
          98039
        </td>
        <td>
          10164
          -
          10214
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.HashSet.add
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          fids.add(org.locationtech.geomesa.filter.FilterHelper.ff.featureId(id.getElement()))
        </td>
      </tr><tr>
        <td>
          290
        </td>
        <td>
          98038
        </td>
        <td>
          10173
          -
          10213
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.filter.FilterFactory.featureId
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.filter.FilterHelper.ff.featureId(id.getElement())
        </td>
      </tr><tr>
        <td>
          290
        </td>
        <td>
          98040
        </td>
        <td>
          10138
          -
          10215
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.collection.IterableLike.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.collection.JavaConverters.asScalaBufferConverter[redis.clients.jedis.resps.Tuple](ids).asScala.foreach[Boolean](((id: redis.clients.jedis.resps.Tuple) =&gt; fids.add(org.locationtech.geomesa.filter.FilterHelper.ff.featureId(id.getElement()))))
        </td>
      </tr><tr>
        <td>
          293
        </td>
        <td>
          98041
        </td>
        <td>
          10329
          -
          10361
        </td>
        <td>
          Apply
        </td>
        <td>
          org.slf4j.Logger.isTraceEnabled
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.logger.underlying.isTraceEnabled()
        </td>
      </tr><tr>
        <td>
          296
        </td>
        <td>
          98042
        </td>
        <td>
          10431
          -
          10432
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          0
        </td>
      </tr><tr>
        <td>
          297
        </td>
        <td>
          98043
        </td>
        <td>
          10471
          -
          10479
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.typeName
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.typeName
        </td>
      </tr><tr>
        <td>
          297
        </td>
        <td>
          98045
        </td>
        <td>
          10507
          -
          10530
        </td>
        <td>
          Select
        </td>
        <td>
          org.geotools.api.data.Transaction.AUTO_COMMIT
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.geotools.api.data.Transaction.AUTO_COMMIT
        </td>
      </tr><tr>
        <td>
          297
        </td>
        <td>
          98044
        </td>
        <td>
          10481
          -
          10505
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.filter.FilterFactory.id
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.filter.FilterHelper.ff.id(fids)
        </td>
      </tr><tr>
        <td>
          297
        </td>
        <td>
          98046
        </td>
        <td>
          10451
          -
          10531
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.index.geotools.MetadataBackedDataStore.getFeatureWriter
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          AgeOffRunner.this.ds.getFeatureWriter(AgeOffRunner.this.typeName, org.locationtech.geomesa.filter.FilterHelper.ff.id(fids), org.geotools.api.data.Transaction.AUTO_COMMIT)
        </td>
      </tr><tr>
        <td>
          297
        </td>
        <td>
          98067
        </td>
        <td>
          10533
          -
          10533
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.io.IsCloseableImplicits.closeableIsCloseable
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          io.this.IsCloseable.closeableIsCloseable
        </td>
      </tr><tr>
        <td>
          297
        </td>
        <td>
          98068
        </td>
        <td>
          10441
          -
          11305
        </td>
        <td>
          ApplyToImplicitArgs
        </td>
        <td>
          org.locationtech.geomesa.utils.io.WithClose.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.utils.io.`package`.WithClose.apply[org.locationtech.geomesa.index.FlushableFeatureWriter, Unit](AgeOffRunner.this.ds.getFeatureWriter(AgeOffRunner.this.typeName, org.locationtech.geomesa.filter.FilterHelper.ff.id(fids), org.geotools.api.data.Transaction.AUTO_COMMIT))(((writer: org.locationtech.geomesa.index.FlushableFeatureWriter) =&gt; while$1(){
  if (writer.hasNext())
    {
      {
        val sf: org.geotools.api.feature.simple.SimpleFeature = writer.next();
        val ttl: Object = sf.getUserData().get(RedisAgeOff.this.TtlUserDataKey);
        if (ttl.!=(null).&amp;&amp;(ttl.asInstanceOf[Long].&lt;=(timestamp)))
          {
            writer.remove();
            i = i.+(1);
            if (trace)
              results.+=(sf.getID())
            else
              ()
          }
        else
          (if (RedisAgeOff.this.logger.underlying.isDebugEnabled())
            RedisAgeOff.this.logger.underlying.debug(&quot;Age-off for schema \'{}\' ignoring updated feature: {}&quot;, (scala.Array.apply[AnyRef]((AgeOffRunner.this.typeName: AnyRef), (sf.getID(): AnyRef))((ClassTag.AnyRef: scala.reflect.ClassTag[AnyRef])): _*))
          else
            (): Unit)
      };
      while$1()
    }
  else
    ()
}))(io.this.IsCloseable.closeableIsCloseable)
        </td>
      </tr><tr>
        <td>
          298
        </td>
        <td>
          98047
        </td>
        <td>
          10562
          -
          10576
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.data.FeatureWriter.hasNext
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          writer.hasNext()
        </td>
      </tr><tr>
        <td>
          298
        </td>
        <td>
          98063
        </td>
        <td>
          10578
          -
          10578
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.while$1
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          while$1()
        </td>
      </tr><tr>
        <td>
          298
        </td>
        <td>
          98065
        </td>
        <td>
          10555
          -
          10555
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          298
        </td>
        <td>
          98064
        </td>
        <td>
          10578
          -
          11295
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  {
    val sf: org.geotools.api.feature.simple.SimpleFeature = writer.next();
    val ttl: Object = sf.getUserData().get(RedisAgeOff.this.TtlUserDataKey);
    if (ttl.!=(null).&amp;&amp;(ttl.asInstanceOf[Long].&lt;=(timestamp)))
      {
        writer.remove();
        i = i.+(1);
        if (trace)
          results.+=(sf.getID())
        else
          ()
      }
    else
      (if (RedisAgeOff.this.logger.underlying.isDebugEnabled())
        RedisAgeOff.this.logger.underlying.debug(&quot;Age-off for schema \'{}\' ignoring updated feature: {}&quot;, (scala.Array.apply[AnyRef]((AgeOffRunner.this.typeName: AnyRef), (sf.getID(): AnyRef))((ClassTag.AnyRef: scala.reflect.ClassTag[AnyRef])): _*))
      else
        (): Unit)
  };
  while$1()
}
        </td>
      </tr><tr>
        <td>
          298
        </td>
        <td>
          98066
        </td>
        <td>
          10555
          -
          10555
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          299
        </td>
        <td>
          98048
        </td>
        <td>
          10601
          -
          10614
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.data.FeatureWriter.next
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          writer.next()
        </td>
      </tr><tr>
        <td>
          303
        </td>
        <td>
          98049
        </td>
        <td>
          10933
          -
          10947
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.TtlUserDataKey
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          RedisAgeOff.this.TtlUserDataKey
        </td>
      </tr><tr>
        <td>
          303
        </td>
        <td>
          98050
        </td>
        <td>
          10914
          -
          10948
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.Map.get
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          sf.getUserData().get(RedisAgeOff.this.TtlUserDataKey)
        </td>
      </tr><tr>
        <td>
          304
        </td>
        <td>
          98051
        </td>
        <td>
          10972
          -
          10976
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          null
        </td>
      </tr><tr>
        <td>
          304
        </td>
        <td>
          98053
        </td>
        <td>
          10965
          -
          11015
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Boolean.&amp;&amp;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ttl.!=(null).&amp;&amp;(ttl.asInstanceOf[Long].&lt;=(timestamp))
        </td>
      </tr><tr>
        <td>
          304
        </td>
        <td>
          98052
        </td>
        <td>
          10980
          -
          11015
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Long.&lt;=
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ttl.asInstanceOf[Long].&lt;=(timestamp)
        </td>
      </tr><tr>
        <td>
          304
        </td>
        <td>
          98061
        </td>
        <td>
          11017
          -
          11162
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  writer.remove();
  i = i.+(1);
  if (trace)
    results.+=(sf.getID())
  else
    ()
}
        </td>
      </tr><tr>
        <td>
          305
        </td>
        <td>
          98054
        </td>
        <td>
          11033
          -
          11048
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.data.FeatureWriter.remove
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          writer.remove()
        </td>
      </tr><tr>
        <td>
          306
        </td>
        <td>
          98055
        </td>
        <td>
          11063
          -
          11069
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Int.+
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          i.+(1)
        </td>
      </tr><tr>
        <td>
          307
        </td>
        <td>
          98059
        </td>
        <td>
          11084
          -
          11084
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          307
        </td>
        <td>
          98060
        </td>
        <td>
          11084
          -
          11084
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          ()
        </td>
      </tr><tr>
        <td>
          308
        </td>
        <td>
          98057
        </td>
        <td>
          11113
          -
          11132
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.collection.mutable.ListBuffer.+=
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          results.+=(sf.getID())
        </td>
      </tr><tr>
        <td>
          308
        </td>
        <td>
          98056
        </td>
        <td>
          11124
          -
          11132
        </td>
        <td>
          Apply
        </td>
        <td>
          org.geotools.api.feature.simple.SimpleFeature.getID
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          sf.getID()
        </td>
      </tr><tr>
        <td>
          308
        </td>
        <td>
          98058
        </td>
        <td>
          11113
          -
          11132
        </td>
        <td>
          Block
        </td>
        <td>
          scala.collection.mutable.ListBuffer.+=
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          results.+=(sf.getID())
        </td>
      </tr><tr>
        <td>
          311
        </td>
        <td>
          98062
        </td>
        <td>
          11184
          -
          11269
        </td>
        <td>
          Typed
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          (if (RedisAgeOff.this.logger.underlying.isDebugEnabled())
  RedisAgeOff.this.logger.underlying.debug(&quot;Age-off for schema \'{}\' ignoring updated feature: {}&quot;, (scala.Array.apply[AnyRef]((AgeOffRunner.this.typeName: AnyRef), (sf.getID(): AnyRef))((ClassTag.AnyRef: scala.reflect.ClassTag[AnyRef])): _*))
else
  (): Unit)
        </td>
      </tr><tr>
        <td>
          318
        </td>
        <td>
          98071
        </td>
        <td>
          11539
          -
          11726
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          {
  (if (RedisAgeOff.this.logger.underlying.isErrorEnabled())
    RedisAgeOff.this.logger.underlying.error(scala.StringContext.apply(&quot;Error executing age-off for schema \'&quot;, &quot;\':&quot;).s(AgeOffRunner.this.typeName), e)
  else
    (): Unit);
  AgeOffRunner.this.reinsertFailedIds(ids)
}
        </td>
      </tr><tr>
        <td>
          321
        </td>
        <td>
          98070
        </td>
        <td>
          11704
          -
          11726
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.reinsertFailedIds
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          AgeOffRunner.this.reinsertFailedIds(ids)
        </td>
      </tr><tr>
        <td>
          331
        </td>
        <td>
          98086
        </td>
        <td>
          11981
          -
          12404
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          {
  (if (RedisAgeOff.this.logger.underlying.isDebugEnabled())
    RedisAgeOff.this.logger.underlying.debug(&quot;Age-off for schema \'{}\' re-inserting ttls&quot;, (AgeOffRunner.this.typeName: AnyRef))
  else
    (): Unit);
  val reinserts: java.util.HashMap[Array[Byte],Double] = new java.util.HashMap[Array[Byte],Double](ids.size());
  scala.collection.JavaConverters.asScalaBufferConverter[redis.clients.jedis.resps.Tuple](ids).asScala.foreach[Double](((id: redis.clients.jedis.resps.Tuple) =&gt; reinserts.put(id.getBinaryElement(), scala.Predef.double2Double(id.getScore()))));
  {
    org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, Long](AgeOffRunner.this.ds.connection.getResource())(((x$12: redis.clients.jedis.Jedis) =&gt; x$12.zadd(AgeOffRunner.this.table, reinserts, new redis.clients.jedis.params.ZAddParams().nx())))(io.this.IsCloseable.closeableIsCloseable);
    ()
  }
}
        </td>
      </tr><tr>
        <td>
          333
        </td>
        <td>
          98073
        </td>
        <td>
          12071
          -
          12133
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.HashMap.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          new java.util.HashMap[Array[Byte],Double](ids.size())
        </td>
      </tr><tr>
        <td>
          333
        </td>
        <td>
          98072
        </td>
        <td>
          12124
          -
          12132
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.List.size
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ids.size()
        </td>
      </tr><tr>
        <td>
          334
        </td>
        <td>
          98075
        </td>
        <td>
          12203
          -
          12214
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.resps.Tuple.getScore
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          id.getScore()
        </td>
      </tr><tr>
        <td>
          334
        </td>
        <td>
          98074
        </td>
        <td>
          12182
          -
          12201
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.resps.Tuple.getBinaryElement
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          id.getBinaryElement()
        </td>
      </tr><tr>
        <td>
          334
        </td>
        <td>
          98077
        </td>
        <td>
          12168
          -
          12215
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.HashMap.put
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          reinserts.put(id.getBinaryElement(), scala.Predef.double2Double(id.getScore()))
        </td>
      </tr><tr>
        <td>
          334
        </td>
        <td>
          98076
        </td>
        <td>
          12203
          -
          12214
        </td>
        <td>
          ApplyImplicitView
        </td>
        <td>
          scala.Predef.double2Double
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          scala.Predef.double2Double(id.getScore())
        </td>
      </tr><tr>
        <td>
          334
        </td>
        <td>
          98078
        </td>
        <td>
          12142
          -
          12216
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.collection.IterableLike.foreach
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          scala.collection.JavaConverters.asScalaBufferConverter[redis.clients.jedis.resps.Tuple](ids).asScala.foreach[Double](((id: redis.clients.jedis.resps.Tuple) =&gt; reinserts.put(id.getBinaryElement(), scala.Predef.double2Double(id.getScore()))))
        </td>
      </tr><tr>
        <td>
          336
        </td>
        <td>
          98079
        </td>
        <td>
          12329
          -
          12354
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.JedisPool.getResource
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          AgeOffRunner.this.ds.connection.getResource()
        </td>
      </tr><tr>
        <td>
          336
        </td>
        <td>
          98081
        </td>
        <td>
          12381
          -
          12402
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.params.ZAddParams.nx
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          new redis.clients.jedis.params.ZAddParams().nx()
        </td>
      </tr><tr>
        <td>
          336
        </td>
        <td>
          98080
        </td>
        <td>
          12363
          -
          12368
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.redis.data.index.RedisAgeOff.AgeOffRunner.table
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          AgeOffRunner.this.table
        </td>
      </tr><tr>
        <td>
          336
        </td>
        <td>
          98083
        </td>
        <td>
          12355
          -
          12355
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.io.IsCloseableImplicits.closeableIsCloseable
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          io.this.IsCloseable.closeableIsCloseable
        </td>
      </tr><tr>
        <td>
          336
        </td>
        <td>
          98082
        </td>
        <td>
          12356
          -
          12403
        </td>
        <td>
          Apply
        </td>
        <td>
          redis.clients.jedis.Jedis.zadd
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          x$12.zadd(AgeOffRunner.this.table, reinserts, new redis.clients.jedis.params.ZAddParams().nx())
        </td>
      </tr><tr>
        <td>
          336
        </td>
        <td>
          98085
        </td>
        <td>
          12355
          -
          12355
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          336
        </td>
        <td>
          98084
        </td>
        <td>
          12319
          -
          12404
        </td>
        <td>
          ApplyToImplicitArgs
        </td>
        <td>
          org.locationtech.geomesa.utils.io.WithClose.apply
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          org.locationtech.geomesa.utils.io.`package`.WithClose.apply[redis.clients.jedis.Jedis, Long](AgeOffRunner.this.ds.connection.getResource())(((x$12: redis.clients.jedis.Jedis) =&gt; x$12.zadd(AgeOffRunner.this.table, reinserts, new redis.clients.jedis.params.ZAddParams().nx())))(io.this.IsCloseable.closeableIsCloseable)
        </td>
      </tr><tr>
        <td>
          339
        </td>
        <td>
          98087
        </td>
        <td>
          12459
          -
          12637
        </td>
        <td>
          Typed
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          (if (RedisAgeOff.this.logger.underlying.isErrorEnabled())
  RedisAgeOff.this.logger.underlying.error(scala.StringContext.apply(&quot;Error re-inserting ttls for schema \'&quot;, &quot;\'. The following features &quot;).s(AgeOffRunner.this.typeName).+(scala.StringContext.apply(&quot;may never expire: [&quot;, &quot;]&quot;).s(scala.collection.JavaConverters.asScalaBufferConverter[redis.clients.jedis.resps.Tuple](ids).asScala.map[String, scala.collection.mutable.Buffer[String]](((x$13: redis.clients.jedis.resps.Tuple) =&gt; x$13.getElement()))(mutable.this.Buffer.canBuildFrom[String]).mkString(&quot;, &quot;))), e)
else
  (): Unit)
        </td>
      </tr>
    </table>
          </div>
        </div>
      </body>
    </html>