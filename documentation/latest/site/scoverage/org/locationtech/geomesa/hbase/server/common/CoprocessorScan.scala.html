<html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title id="title">
          org/locationtech/geomesa/hbase/server/common/CoprocessorScan.scala.html
        </title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.20.1/css/theme.default.min.css" type="text/css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.20.1/js/jquery.tablesorter.min.js"></script><link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" type="text/css"/><script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script><script type="text/javascript">
        $(document).ready(function() {$(".tablesorter").tablesorter();});
      </script>
        <style>
          table.codegrid { font-family: monospace; font-size: 12px; width: auto!important; }table.statementlist { width: auto!important; font-size: 13px; } table.codegrid td { padding: 0!important; border: 0!important } table td.linenumber { width: 40px!important; } 
        </style>
      </head>
      <body style="font-family: monospace;">
        <ul class="nav nav-tabs">
          <li>
            <a href="#codegrid" data-toggle="tab">Codegrid</a>
          </li>
          <li>
            <a href="#statementlist" data-toggle="tab">Statement List</a>
          </li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="codegrid">
            <pre style='font-size: 12pt; font-family: courier, monospace;'>1 <span style=''>/***********************************************************************
</span>2 <span style=''> * Copyright (c) 2013-2024 Commonwealth Computer Research, Inc.
</span>3 <span style=''> * All rights reserved. This program and the accompanying materials
</span>4 <span style=''> * are made available under the terms of the Apache License, Version 2.0
</span>5 <span style=''> * which accompanies this distribution and is available at
</span>6 <span style=''> * http://www.opensource.org/licenses/apache2.0.php.
</span>7 <span style=''> ***********************************************************************/
</span>8 <span style=''>
</span>9 <span style=''>package org.locationtech.geomesa.hbase.server.common
</span>10 <span style=''>
</span>11 <span style=''>import com.google.protobuf.{ByteString, RpcCallback, RpcController}
</span>12 <span style=''>import com.typesafe.scalalogging.StrictLogging
</span>13 <span style=''>import org.apache.hadoop.hbase.client.Scan
</span>14 <span style=''>import org.apache.hadoop.hbase.protobuf.ProtobufUtil
</span>15 <span style=''>import org.apache.hadoop.hbase.protobuf.generated.ClientProtos
</span>16 <span style=''>import org.apache.hadoop.hbase.regionserver.RegionScanner
</span>17 <span style=''>import org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter
</span>18 <span style=''>import org.locationtech.geomesa.hbase.proto.GeoMesaProto
</span>19 <span style=''>import org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse
</span>20 <span style=''>import org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor
</span>21 <span style=''>import org.locationtech.geomesa.hbase.server.common.CoprocessorScan.Aggregator
</span>22 <span style=''>import org.locationtech.geomesa.index.iterators.AggregatingScan
</span>23 <span style=''>import org.locationtech.geomesa.index.iterators.AggregatingScan.AggregateCallback
</span>24 <span style=''>import org.locationtech.geomesa.utils.index.ByteArrays
</span>25 <span style=''>import org.locationtech.geomesa.utils.io.WithClose
</span>26 <span style=''>
</span>27 <span style=''>import java.io.{IOException, InterruptedIOException}
</span>28 <span style=''>import java.util.Base64
</span>29 <span style=''>import scala.util.control.NonFatal
</span>30 <span style=''>
</span>31 <span style=''>/**
</span>32 <span style=''> * Common trait for server side coprocessor class
</span>33 <span style=''> */
</span>34 <span style=''>trait CoprocessorScan extends StrictLogging {
</span>35 <span style=''>
</span>36 <span style=''>  import scala.collection.JavaConverters._
</span>37 <span style=''>
</span>38 <span style=''>  /**
</span>39 <span style=''>   * Gets a scanner for the current region
</span>40 <span style=''>   *
</span>41 <span style=''>   * @param scan scan
</span>42 <span style=''>   * @return
</span>43 <span style=''>   */
</span>44 <span style=''>  protected def getScanner(scan: Scan): RegionScanner
</span>45 <span style=''>
</span>46 <span style=''>  /**
</span>47 <span style=''>   * Execute an RPC request against this coprocessor
</span>48 <span style=''>   *
</span>49 <span style=''>   * @param controller controller
</span>50 <span style=''>   * @param request request
</span>51 <span style=''>   * @param done callback
</span>52 <span style=''>   */
</span>53 <span style=''>  protected def execute(
</span>54 <span style=''>      controller: RpcController,
</span>55 <span style=''>      request: GeoMesaProto.GeoMesaCoprocessorRequest,
</span>56 <span style=''>      done: RpcCallback[GeoMesaProto.GeoMesaCoprocessorResponse]): Unit = {
</span>57 <span style=''>
</span>58 <span style=''>    val results = </span><span style='background: #AEF1AE'>GeoMesaCoprocessorResponse.newBuilder()</span><span style=''>
</span>59 <span style=''>
</span>60 <span style=''>    if (</span><span style='background: #AEF1AE'>request.getVersion != CoprocessorScan.AllowableRequestVersion</span><span style=''>) </span><span style='background: #F0ADAD'>{
</span>61 <span style=''></span><span style='background: #F0ADAD'>      // We cannot handle this request.
</span>62 <span style=''></span><span style='background: #F0ADAD'>      // Immediately return an empty response indicating the highest response version
</span>63 <span style=''></span><span style='background: #F0ADAD'>      logger.error(
</span>64 <span style=''></span><span style='background: #F0ADAD'>        s&quot;Got a coprocessor request with version ${request.getVersion}, &quot; +
</span>65 <span style=''></span><span style='background: #F0ADAD'>            s&quot;but can only handle ${CoprocessorScan.AllowableRequestVersion}.&quot;)
</span>66 <span style=''></span><span style='background: #F0ADAD'>      results.setVersion(CoprocessorScan.AllowableRequestVersion)
</span>67 <span style=''></span><span style='background: #F0ADAD'>      done.run(results.build)
</span>68 <span style=''></span><span style='background: #F0ADAD'>    }</span><span style=''> else </span><span style='background: #AEF1AE'>{
</span>69 <span style=''></span><span style='background: #AEF1AE'>      try {
</span>70 <span style=''></span><span style='background: #AEF1AE'>        val options = GeoMesaCoprocessor.deserializeOptions(request.getOptions.toByteArray)
</span>71 <span style=''></span><span style='background: #AEF1AE'>        val timeout = options.get(GeoMesaCoprocessor.TimeoutOpt).map(</span><span style='background: #F0ADAD'>_.toLong</span><span style='background: #AEF1AE'>)
</span>72 <span style=''></span><span style='background: #AEF1AE'>        val yieldPartialResults = options.get(GeoMesaCoprocessor.YieldOpt).exists(_.toBoolean)
</span>73 <span style=''></span><span style='background: #AEF1AE'>        if (!controller.isCanceled &amp;&amp; timeout.forall(</span><span style='background: #F0ADAD'>_ &gt; System.currentTimeMillis()</span><span style='background: #AEF1AE'>)) {
</span>74 <span style=''></span><span style='background: #AEF1AE'>          val clas = options(GeoMesaCoprocessor.AggregatorClass)
</span>75 <span style=''></span><span style='background: #AEF1AE'>          val aggregator = Class.forName(clas).newInstance().asInstanceOf[Aggregator]
</span>76 <span style=''></span><span style='background: #AEF1AE'>          logger.debug(s&quot;Initializing aggregator $aggregator.&quot;)
</span>77 <span style=''></span><span style='background: #AEF1AE'>          aggregator.init(options)
</span>78 <span style=''></span><span style='background: #AEF1AE'>
</span>79 <span style=''></span><span style='background: #AEF1AE'>          val scan = {
</span>80 <span style=''></span><span style='background: #AEF1AE'>            val bytes = Base64.getDecoder.decode(options(GeoMesaCoprocessor.ScanOpt))
</span>81 <span style=''></span><span style='background: #AEF1AE'>            ProtobufUtil.toScan(ClientProtos.Scan.parseFrom(bytes))
</span>82 <span style=''></span><span style='background: #AEF1AE'>          }
</span>83 <span style=''></span><span style='background: #AEF1AE'>
</span>84 <span style=''></span><span style='background: #AEF1AE'>          WithClose(getScanner(scan)) { scanner =&gt;
</span>85 <span style=''></span><span style='background: #AEF1AE'>            aggregator.setScanner(scanner)
</span>86 <span style=''></span><span style='background: #AEF1AE'>            aggregator.aggregate(
</span>87 <span style=''></span><span style='background: #AEF1AE'>              new CoprocessorAggregateCallback(controller, aggregator, results, yieldPartialResults, timeout))
</span>88 <span style=''></span><span style='background: #AEF1AE'>          }
</span>89 <span style=''></span><span style='background: #AEF1AE'>        }
</span>90 <span style=''></span><span style='background: #AEF1AE'>      } catch {
</span>91 <span style=''></span><span style='background: #AEF1AE'>        case _: InterruptedException | _: InterruptedIOException </span><span style='background: #F0ADAD'>=&gt;</span><span style='background: #AEF1AE'> // stop processing, but don't return an error to prevent retries
</span>92 <span style=''></span><span style='background: #AEF1AE'>        case e: IOException =&gt; </span><span style='background: #F0ADAD'>ResponseConverter.setControllerException(controller, e)</span><span style='background: #AEF1AE'>
</span>93 <span style=''></span><span style='background: #AEF1AE'>        case NonFatal(e) =&gt; </span><span style='background: #F0ADAD'>ResponseConverter.setControllerException(controller, new IOException(e))</span><span style='background: #AEF1AE'>
</span>94 <span style=''></span><span style='background: #AEF1AE'>      }
</span>95 <span style=''></span><span style='background: #AEF1AE'>
</span>96 <span style=''></span><span style='background: #AEF1AE'>      logger.debug(
</span>97 <span style=''></span><span style='background: #AEF1AE'>        s&quot;Results total size: ${results.getPayloadList.asScala.map(_.size()).sum}&quot; +
</span>98 <span style=''></span><span style='background: #AEF1AE'>          s&quot;\n\tBatch sizes: ${results.getPayloadList.asScala.map(_.size()).mkString(&quot;, &quot;)}&quot;)
</span>99 <span style=''></span><span style='background: #AEF1AE'>
</span>100 <span style=''></span><span style='background: #AEF1AE'>      done.run(results.build)
</span>101 <span style=''></span><span style='background: #AEF1AE'>    }</span><span style=''>
</span>102 <span style=''>  }
</span>103 <span style=''>
</span>104 <span style=''>  /**
</span>105 <span style=''>   * Coprocessor aggregate callback
</span>106 <span style=''>   *
</span>107 <span style=''>   * @param controller controller
</span>108 <span style=''>   * @param aggregator aggregator instance
</span>109 <span style=''>   * @param results result builder
</span>110 <span style=''>   * @param timeout timeout
</span>111 <span style=''>   */
</span>112 <span style=''>  private class CoprocessorAggregateCallback(
</span>113 <span style=''>      controller: RpcController,
</span>114 <span style=''>      aggregator: Aggregator,
</span>115 <span style=''>      results: GeoMesaCoprocessorResponse.Builder,
</span>116 <span style=''>      yieldPartialResults: Boolean,
</span>117 <span style=''>      timeout: Option[Long]
</span>118 <span style=''>    ) extends AggregateCallback {
</span>119 <span style=''>
</span>120 <span style=''>    private val start = </span><span style='background: #AEF1AE'>System.currentTimeMillis()</span><span style=''>
</span>121 <span style=''>
</span>122 <span style=''>    logger.trace(
</span>123 <span style=''>      s&quot;Running first batch on aggregator $aggregator&quot; +
</span>124 <span style=''>        timeout.map(t =&gt; s&quot; with remaining timeout ${t - System.currentTimeMillis()}ms&quot;).getOrElse(&quot;&quot;))
</span>125 <span style=''>
</span>126 <span style=''>    override def batch(bytes: Array[Byte]): Boolean = {
</span>127 <span style=''>      </span><span style='background: #AEF1AE'>results.addPayload(ByteString.copyFrom(bytes))</span><span style=''>
</span>128 <span style=''>      </span><span style='background: #AEF1AE'>continue()</span><span style=''>
</span>129 <span style=''>    }
</span>130 <span style=''>
</span>131 <span style=''>    override def partial(bytes: =&gt; Array[Byte]): Boolean = {
</span>132 <span style=''>      if (</span><span style='background: #F0ADAD'>continue()</span><span style=''>) { </span><span style='background: #F0ADAD'>true</span><span style=''> } else </span><span style='background: #F0ADAD'>{
</span>133 <span style=''></span><span style='background: #F0ADAD'>        // add the partial results and stop scanning
</span>134 <span style=''></span><span style='background: #F0ADAD'>        results.addPayload(ByteString.copyFrom(bytes))
</span>135 <span style=''></span><span style='background: #F0ADAD'>        false
</span>136 <span style=''></span><span style='background: #F0ADAD'>      }</span><span style=''>
</span>137 <span style=''>    }
</span>138 <span style=''>
</span>139 <span style=''>    private def continue(): Boolean = {
</span>140 <span style=''>      if (</span><span style='background: #AEF1AE'>controller.isCanceled</span><span style=''>) </span><span style='background: #F0ADAD'>{
</span>141 <span style=''></span><span style='background: #F0ADAD'>        logger.warn(s&quot;Stopping aggregator $aggregator due to controller being cancelled&quot;)
</span>142 <span style=''></span><span style='background: #F0ADAD'>        false
</span>143 <span style=''></span><span style='background: #F0ADAD'>      }</span><span style=''> else </span><span style='background: #AEF1AE'>if (timeout.exists(</span><span style='background: #F0ADAD'>_ &lt; System.currentTimeMillis()</span><span style='background: #AEF1AE'>)) </span><span style='background: #F0ADAD'>{
</span>144 <span style=''></span><span style='background: #F0ADAD'>        logger.warn(s&quot;Stopping aggregator $aggregator due to timeout of ${timeout.get}ms&quot;)
</span>145 <span style=''></span><span style='background: #F0ADAD'>        false
</span>146 <span style=''></span><span style='background: #F0ADAD'>      }</span><span style='background: #AEF1AE'> else if (yieldPartialResults) {
</span>147 <span style=''></span><span style='background: #AEF1AE'>        val lastScanned = aggregator.getLastScanned
</span>148 <span style=''></span><span style='background: #AEF1AE'>        logger.trace(
</span>149 <span style=''></span><span style='background: #AEF1AE'>          s&quot;Stopping aggregator $aggregator at row ${ByteArrays.printable(lastScanned)} and &quot; +
</span>150 <span style=''></span><span style='background: #AEF1AE'>              &quot;returning intermediate results&quot;)
</span>151 <span style=''></span><span style='background: #AEF1AE'>        // This check covers the HBase Version Aggregator case
</span>152 <span style=''></span><span style='background: #AEF1AE'>        if (lastScanned != null &amp;&amp; !lastScanned.isEmpty) {
</span>153 <span style=''></span><span style='background: #AEF1AE'>          results.setLastScanned(ByteString.copyFrom(lastScanned))
</span>154 <span style=''></span><span style='background: #AEF1AE'>        }
</span>155 <span style=''></span><span style='background: #AEF1AE'>        false
</span>156 <span style=''></span><span style='background: #AEF1AE'>      } else {
</span>157 <span style=''></span><span style='background: #AEF1AE'>        logger.trace(
</span>158 <span style=''></span><span style='background: #AEF1AE'>          s&quot;Running next batch on aggregator $aggregator &quot; +
</span>159 <span style=''></span><span style='background: #AEF1AE'>            s&quot;with elapsed time ${System.currentTimeMillis() - start}ms&quot; +
</span>160 <span style=''></span><span style='background: #AEF1AE'>            timeout.map(t =&gt; s&quot; and remaining timeout ${t - System.currentTimeMillis()}ms&quot;).getOrElse(&quot;&quot;))
</span>161 <span style=''></span><span style='background: #AEF1AE'>        true
</span>162 <span style=''></span><span style='background: #AEF1AE'>      }</span><span style=''>
</span>163 <span style=''>    }
</span>164 <span style=''>  }
</span>165 <span style=''>}
</span>166 <span style=''>
</span>167 <span style=''>object CoprocessorScan {
</span>168 <span style=''>  type Aggregator = HBaseAggregator[_ &lt;: AggregatingScan.Result]
</span>169 <span style=''>  val AllowableRequestVersion = </span><span style='background: #AEF1AE'>1</span><span style=''>
</span>170 <span style=''>}
</span></pre>
          </div>
          <div class="tab-pane" id="statementlist">
            <table cellspacing="0" cellpadding="0" class="table statementlist">
      <tr>
        <th>Line</th>
        <th>Stmt Id</th>
        <th>Pos</th>
        <th>Tree</th>
        <th>Symbol</th>
        <th>Tests</th>
        <th>Code</th>
      </tr><tr>
        <td>
          58
        </td>
        <td>
          88802
        </td>
        <td>
          2240
          -
          2279
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse.newBuilder
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse.newBuilder()
        </td>
      </tr><tr>
        <td>
          60
        </td>
        <td>
          88803
        </td>
        <td>
          2311
          -
          2350
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.hbase.server.common.CoprocessorScan.AllowableRequestVersion
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorScan.AllowableRequestVersion
        </td>
      </tr><tr>
        <td>
          60
        </td>
        <td>
          88804
        </td>
        <td>
          2289
          -
          2350
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Int.!=
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          request.getVersion().!=(CoprocessorScan.AllowableRequestVersion)
        </td>
      </tr><tr>
        <td>
          60
        </td>
        <td>
          88809
        </td>
        <td>
          2352
          -
          2757
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          {
  (if (CoprocessorScan.this.logger.underlying.isErrorEnabled())
    CoprocessorScan.this.logger.underlying.error(scala.StringContext.apply(&quot;Got a coprocessor request with version &quot;, &quot;, &quot;).s(request.getVersion()).+(scala.StringContext.apply(&quot;but can only handle &quot;, &quot;.&quot;).s(CoprocessorScan.AllowableRequestVersion)))
  else
    (): Unit);
  results.setVersion(CoprocessorScan.AllowableRequestVersion);
  done.run(results.build())
}
        </td>
      </tr><tr>
        <td>
          66
        </td>
        <td>
          88805
        </td>
        <td>
          2681
          -
          2720
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.hbase.server.common.CoprocessorScan.AllowableRequestVersion
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          CoprocessorScan.AllowableRequestVersion
        </td>
      </tr><tr>
        <td>
          66
        </td>
        <td>
          88806
        </td>
        <td>
          2662
          -
          2721
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse.Builder.setVersion
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          results.setVersion(CoprocessorScan.AllowableRequestVersion)
        </td>
      </tr><tr>
        <td>
          67
        </td>
        <td>
          88807
        </td>
        <td>
          2737
          -
          2750
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse.Builder.build
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          results.build()
        </td>
      </tr><tr>
        <td>
          67
        </td>
        <td>
          88808
        </td>
        <td>
          2728
          -
          2751
        </td>
        <td>
          Apply
        </td>
        <td>
          com.google.protobuf.RpcCallback.run
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          done.run(results.build())
        </td>
      </tr><tr>
        <td>
          68
        </td>
        <td>
          88850
        </td>
        <td>
          2763
          -
          4414
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  try {
    val options: Map[String,String] = org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.deserializeOptions(request.getOptions().toByteArray());
    val timeout: Option[Long] = options.get(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.TimeoutOpt).map[Long](((x$1: String) =&gt; scala.Predef.augmentString(x$1).toLong));
    val yieldPartialResults: Boolean = options.get(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.YieldOpt).exists(((x$2: String) =&gt; scala.Predef.augmentString(x$2).toBoolean));
    if (controller.isCanceled().unary_!.&amp;&amp;(timeout.forall(((x$3: Long) =&gt; x$3.&gt;(java.lang.System.currentTimeMillis())))))
      {
        val clas: String = options.apply(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.AggregatorClass);
        val aggregator: org.locationtech.geomesa.hbase.server.common.HBaseAggregator[_ &lt;: org.locationtech.geomesa.index.iterators.AggregatingScan.Result] = java.lang.Class.forName(clas).newInstance().asInstanceOf[org.locationtech.geomesa.hbase.server.common.CoprocessorScan.Aggregator];
        (if (CoprocessorScan.this.logger.underlying.isDebugEnabled())
          CoprocessorScan.this.logger.underlying.debug(&quot;Initializing aggregator {}.&quot;, (aggregator: AnyRef))
        else
          (): Unit);
        aggregator.init(options);
        val scan: org.apache.hadoop.hbase.client.Scan = {
          val bytes: Array[Byte] = java.util.Base64.getDecoder().decode(options.apply(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.ScanOpt));
          org.apache.hadoop.hbase.protobuf.ProtobufUtil.toScan(org.apache.hadoop.hbase.protobuf.generated.ClientProtos.Scan.parseFrom(bytes))
        };
        org.locationtech.geomesa.utils.io.`package`.WithClose.apply[org.apache.hadoop.hbase.regionserver.RegionScanner, CoprocessorScan.this.CoprocessorAggregateCallback](CoprocessorScan.this.getScanner(scan))(((scanner: org.apache.hadoop.hbase.regionserver.RegionScanner) =&gt; {
          aggregator.setScanner(scanner);
          aggregator.aggregate[CoprocessorScan.this.CoprocessorAggregateCallback](new CoprocessorScan.this.CoprocessorAggregateCallback(controller, aggregator, results, yieldPartialResults, timeout))
        }))(io.this.IsCloseable.closeableIsCloseable)
      }
    else
      ()
  } catch {
    case ((_: InterruptedException)| (_: java.io.InterruptedIOException)) =&gt; ()
    case (e @ (_: java.io.IOException)) =&gt; org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException(controller, e)
    case scala.util.control.NonFatal.unapply(&lt;unapply-selector&gt;) &lt;unapply&gt; ((e @ _)) =&gt; org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException(controller, new java.io.IOException(e))
  };
  (if (CoprocessorScan.this.logger.underlying.isDebugEnabled())
    CoprocessorScan.this.logger.underlying.debug(scala.StringContext.apply(&quot;Results total size: &quot;, &quot;&quot;).s(scala.collection.JavaConverters.asScalaBufferConverter[com.google.protobuf.ByteString](results.getPayloadList()).asScala.map[Int, scala.collection.mutable.Buffer[Int]](((x$4: com.google.protobuf.ByteString) =&gt; x$4.size()))(mutable.this.Buffer.canBuildFrom[Int]).sum[Int](math.this.Numeric.IntIsIntegral)).+(scala.StringContext.apply(&quot;\\n\\tBatch sizes: &quot;, &quot;&quot;).s(scala.collection.JavaConverters.asScalaBufferConverter[com.google.protobuf.ByteString](results.getPayloadList()).asScala.map[Int, scala.collection.mutable.Buffer[Int]](((x$5: com.google.protobuf.ByteString) =&gt; x$5.size()))(mutable.this.Buffer.canBuildFrom[Int]).mkString(&quot;, &quot;))))
  else
    (): Unit);
  done.run(results.build())
}
        </td>
      </tr><tr>
        <td>
          69
        </td>
        <td>
          88840
        </td>
        <td>
          2785
          -
          3832
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  val options: Map[String,String] = org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.deserializeOptions(request.getOptions().toByteArray());
  val timeout: Option[Long] = options.get(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.TimeoutOpt).map[Long](((x$1: String) =&gt; scala.Predef.augmentString(x$1).toLong));
  val yieldPartialResults: Boolean = options.get(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.YieldOpt).exists(((x$2: String) =&gt; scala.Predef.augmentString(x$2).toBoolean));
  if (controller.isCanceled().unary_!.&amp;&amp;(timeout.forall(((x$3: Long) =&gt; x$3.&gt;(java.lang.System.currentTimeMillis())))))
    {
      val clas: String = options.apply(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.AggregatorClass);
      val aggregator: org.locationtech.geomesa.hbase.server.common.HBaseAggregator[_ &lt;: org.locationtech.geomesa.index.iterators.AggregatingScan.Result] = java.lang.Class.forName(clas).newInstance().asInstanceOf[org.locationtech.geomesa.hbase.server.common.CoprocessorScan.Aggregator];
      (if (CoprocessorScan.this.logger.underlying.isDebugEnabled())
        CoprocessorScan.this.logger.underlying.debug(&quot;Initializing aggregator {}.&quot;, (aggregator: AnyRef))
      else
        (): Unit);
      aggregator.init(options);
      val scan: org.apache.hadoop.hbase.client.Scan = {
        val bytes: Array[Byte] = java.util.Base64.getDecoder().decode(options.apply(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.ScanOpt));
        org.apache.hadoop.hbase.protobuf.ProtobufUtil.toScan(org.apache.hadoop.hbase.protobuf.generated.ClientProtos.Scan.parseFrom(bytes))
      };
      org.locationtech.geomesa.utils.io.`package`.WithClose.apply[org.apache.hadoop.hbase.regionserver.RegionScanner, CoprocessorScan.this.CoprocessorAggregateCallback](CoprocessorScan.this.getScanner(scan))(((scanner: org.apache.hadoop.hbase.regionserver.RegionScanner) =&gt; {
        aggregator.setScanner(scanner);
        aggregator.aggregate[CoprocessorScan.this.CoprocessorAggregateCallback](new CoprocessorScan.this.CoprocessorAggregateCallback(controller, aggregator, results, yieldPartialResults, timeout))
      }))(io.this.IsCloseable.closeableIsCloseable)
    }
  else
    ()
}
        </td>
      </tr><tr>
        <td>
          70
        </td>
        <td>
          88811
        </td>
        <td>
          2799
          -
          2868
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.deserializeOptions
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.deserializeOptions(request.getOptions().toByteArray())
        </td>
      </tr><tr>
        <td>
          70
        </td>
        <td>
          88810
        </td>
        <td>
          2837
          -
          2867
        </td>
        <td>
          Apply
        </td>
        <td>
          com.google.protobuf.ByteString.toByteArray
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          request.getOptions().toByteArray()
        </td>
      </tr><tr>
        <td>
          71
        </td>
        <td>
          88813
        </td>
        <td>
          2938
          -
          2946
        </td>
        <td>
          Select
        </td>
        <td>
          scala.collection.immutable.StringLike.toLong
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          scala.Predef.augmentString(x$1).toLong
        </td>
      </tr><tr>
        <td>
          71
        </td>
        <td>
          88812
        </td>
        <td>
          2903
          -
          2932
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.TimeoutOpt
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.TimeoutOpt
        </td>
      </tr><tr>
        <td>
          71
        </td>
        <td>
          88814
        </td>
        <td>
          2891
          -
          2947
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.map
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          options.get(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.TimeoutOpt).map[Long](((x$1: String) =&gt; scala.Predef.augmentString(x$1).toLong))
        </td>
      </tr><tr>
        <td>
          72
        </td>
        <td>
          88815
        </td>
        <td>
          2994
          -
          3021
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.YieldOpt
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.YieldOpt
        </td>
      </tr><tr>
        <td>
          72
        </td>
        <td>
          88817
        </td>
        <td>
          2982
          -
          3042
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.exists
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          options.get(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.YieldOpt).exists(((x$2: String) =&gt; scala.Predef.augmentString(x$2).toBoolean))
        </td>
      </tr><tr>
        <td>
          72
        </td>
        <td>
          88816
        </td>
        <td>
          3030
          -
          3041
        </td>
        <td>
          Select
        </td>
        <td>
          scala.collection.immutable.StringLike.toBoolean
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.Predef.augmentString(x$2).toBoolean
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          88819
        </td>
        <td>
          3096
          -
          3126
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Long.&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          x$3.&gt;(java.lang.System.currentTimeMillis())
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          88818
        </td>
        <td>
          3100
          -
          3126
        </td>
        <td>
          Apply
        </td>
        <td>
          java.lang.System.currentTimeMillis
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          java.lang.System.currentTimeMillis()
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          88821
        </td>
        <td>
          3055
          -
          3127
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Boolean.&amp;&amp;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          controller.isCanceled().unary_!.&amp;&amp;(timeout.forall(((x$3: Long) =&gt; x$3.&gt;(java.lang.System.currentTimeMillis()))))
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          88820
        </td>
        <td>
          3081
          -
          3127
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.forall
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          timeout.forall(((x$3: Long) =&gt; x$3.&gt;(java.lang.System.currentTimeMillis())))
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          88837
        </td>
        <td>
          3129
          -
          3832
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  val clas: String = options.apply(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.AggregatorClass);
  val aggregator: org.locationtech.geomesa.hbase.server.common.HBaseAggregator[_ &lt;: org.locationtech.geomesa.index.iterators.AggregatingScan.Result] = java.lang.Class.forName(clas).newInstance().asInstanceOf[org.locationtech.geomesa.hbase.server.common.CoprocessorScan.Aggregator];
  (if (CoprocessorScan.this.logger.underlying.isDebugEnabled())
    CoprocessorScan.this.logger.underlying.debug(&quot;Initializing aggregator {}.&quot;, (aggregator: AnyRef))
  else
    (): Unit);
  aggregator.init(options);
  val scan: org.apache.hadoop.hbase.client.Scan = {
    val bytes: Array[Byte] = java.util.Base64.getDecoder().decode(options.apply(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.ScanOpt));
    org.apache.hadoop.hbase.protobuf.ProtobufUtil.toScan(org.apache.hadoop.hbase.protobuf.generated.ClientProtos.Scan.parseFrom(bytes))
  };
  org.locationtech.geomesa.utils.io.`package`.WithClose.apply[org.apache.hadoop.hbase.regionserver.RegionScanner, CoprocessorScan.this.CoprocessorAggregateCallback](CoprocessorScan.this.getScanner(scan))(((scanner: org.apache.hadoop.hbase.regionserver.RegionScanner) =&gt; {
    aggregator.setScanner(scanner);
    aggregator.aggregate[CoprocessorScan.this.CoprocessorAggregateCallback](new CoprocessorScan.this.CoprocessorAggregateCallback(controller, aggregator, results, yieldPartialResults, timeout))
  }))(io.this.IsCloseable.closeableIsCloseable)
}
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          88839
        </td>
        <td>
          3051
          -
          3051
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          73
        </td>
        <td>
          88838
        </td>
        <td>
          3051
          -
          3051
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          74
        </td>
        <td>
          88823
        </td>
        <td>
          3152
          -
          3195
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.collection.MapLike.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          options.apply(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.AggregatorClass)
        </td>
      </tr><tr>
        <td>
          74
        </td>
        <td>
          88822
        </td>
        <td>
          3160
          -
          3194
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.AggregatorClass
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.AggregatorClass
        </td>
      </tr><tr>
        <td>
          75
        </td>
        <td>
          88824
        </td>
        <td>
          3223
          -
          3281
        </td>
        <td>
          TypeApply
        </td>
        <td>
          scala.Any.asInstanceOf
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          java.lang.Class.forName(clas).newInstance().asInstanceOf[org.locationtech.geomesa.hbase.server.common.CoprocessorScan.Aggregator]
        </td>
      </tr><tr>
        <td>
          77
        </td>
        <td>
          88825
        </td>
        <td>
          3356
          -
          3380
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.index.iterators.AggregatingScan.init
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          aggregator.init(options)
        </td>
      </tr><tr>
        <td>
          80
        </td>
        <td>
          88827
        </td>
        <td>
          3454
          -
          3489
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.collection.MapLike.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          options.apply(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.ScanOpt)
        </td>
      </tr><tr>
        <td>
          80
        </td>
        <td>
          88826
        </td>
        <td>
          3462
          -
          3488
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.ScanOpt
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.ScanOpt
        </td>
      </tr><tr>
        <td>
          80
        </td>
        <td>
          88828
        </td>
        <td>
          3429
          -
          3490
        </td>
        <td>
          Apply
        </td>
        <td>
          java.util.Base64.Decoder.decode
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          java.util.Base64.getDecoder().decode(options.apply(org.locationtech.geomesa.hbase.rpc.coprocessor.GeoMesaCoprocessor.ScanOpt))
        </td>
      </tr><tr>
        <td>
          81
        </td>
        <td>
          88829
        </td>
        <td>
          3523
          -
          3557
        </td>
        <td>
          Apply
        </td>
        <td>
          org.apache.hadoop.hbase.protobuf.generated.ClientProtos.Scan.parseFrom
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.apache.hadoop.hbase.protobuf.generated.ClientProtos.Scan.parseFrom(bytes)
        </td>
      </tr><tr>
        <td>
          81
        </td>
        <td>
          88830
        </td>
        <td>
          3503
          -
          3558
        </td>
        <td>
          Apply
        </td>
        <td>
          org.apache.hadoop.hbase.protobuf.ProtobufUtil.toScan
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.apache.hadoop.hbase.protobuf.ProtobufUtil.toScan(org.apache.hadoop.hbase.protobuf.generated.ClientProtos.Scan.parseFrom(bytes))
        </td>
      </tr><tr>
        <td>
          84
        </td>
        <td>
          88831
        </td>
        <td>
          3592
          -
          3608
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.server.common.CoprocessorScan.getScanner
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorScan.this.getScanner(scan)
        </td>
      </tr><tr>
        <td>
          84
        </td>
        <td>
          88835
        </td>
        <td>
          3610
          -
          3610
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.utils.io.IsCloseableImplicits.closeableIsCloseable
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          io.this.IsCloseable.closeableIsCloseable
        </td>
      </tr><tr>
        <td>
          84
        </td>
        <td>
          88836
        </td>
        <td>
          3582
          -
          3822
        </td>
        <td>
          ApplyToImplicitArgs
        </td>
        <td>
          org.locationtech.geomesa.utils.io.WithClose.apply
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          org.locationtech.geomesa.utils.io.`package`.WithClose.apply[org.apache.hadoop.hbase.regionserver.RegionScanner, CoprocessorScan.this.CoprocessorAggregateCallback](CoprocessorScan.this.getScanner(scan))(((scanner: org.apache.hadoop.hbase.regionserver.RegionScanner) =&gt; {
  aggregator.setScanner(scanner);
  aggregator.aggregate[CoprocessorScan.this.CoprocessorAggregateCallback](new CoprocessorScan.this.CoprocessorAggregateCallback(controller, aggregator, results, yieldPartialResults, timeout))
}))(io.this.IsCloseable.closeableIsCloseable)
        </td>
      </tr><tr>
        <td>
          85
        </td>
        <td>
          88832
        </td>
        <td>
          3635
          -
          3665
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.server.common.HBaseAggregator.setScanner
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          aggregator.setScanner(scanner)
        </td>
      </tr><tr>
        <td>
          86
        </td>
        <td>
          88834
        </td>
        <td>
          3678
          -
          3810
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.index.iterators.AggregatingScan.aggregate
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          aggregator.aggregate[CoprocessorScan.this.CoprocessorAggregateCallback](new CoprocessorScan.this.CoprocessorAggregateCallback(controller, aggregator, results, yieldPartialResults, timeout))
        </td>
      </tr><tr>
        <td>
          87
        </td>
        <td>
          88833
        </td>
        <td>
          3714
          -
          3809
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.server.common.CoprocessorScan.CoprocessorAggregateCallback.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          new CoprocessorScan.this.CoprocessorAggregateCallback(controller, aggregator, results, yieldPartialResults, timeout)
        </td>
      </tr><tr>
        <td>
          91
        </td>
        <td>
          88841
        </td>
        <td>
          3914
          -
          3916
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          91
        </td>
        <td>
          88842
        </td>
        <td>
          3914
          -
          3916
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          88843
        </td>
        <td>
          4013
          -
          4068
        </td>
        <td>
          Apply
        </td>
        <td>
          org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException(controller, e)
        </td>
      </tr><tr>
        <td>
          92
        </td>
        <td>
          88844
        </td>
        <td>
          4013
          -
          4068
        </td>
        <td>
          Block
        </td>
        <td>
          org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException(controller, e)
        </td>
      </tr><tr>
        <td>
          93
        </td>
        <td>
          88845
        </td>
        <td>
          4150
          -
          4168
        </td>
        <td>
          Apply
        </td>
        <td>
          java.io.IOException.&lt;init&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          new java.io.IOException(e)
        </td>
      </tr><tr>
        <td>
          93
        </td>
        <td>
          88847
        </td>
        <td>
          4097
          -
          4169
        </td>
        <td>
          Block
        </td>
        <td>
          org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException(controller, new java.io.IOException(e))
        </td>
      </tr><tr>
        <td>
          93
        </td>
        <td>
          88846
        </td>
        <td>
          4097
          -
          4169
        </td>
        <td>
          Apply
        </td>
        <td>
          org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          org.apache.hadoop.hbase.shaded.protobuf.ResponseConverter.setControllerException(controller, new java.io.IOException(e))
        </td>
      </tr><tr>
        <td>
          100
        </td>
        <td>
          88849
        </td>
        <td>
          4385
          -
          4408
        </td>
        <td>
          Apply
        </td>
        <td>
          com.google.protobuf.RpcCallback.run
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          done.run(results.build())
        </td>
      </tr><tr>
        <td>
          100
        </td>
        <td>
          88848
        </td>
        <td>
          4394
          -
          4407
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse.Builder.build
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          results.build()
        </td>
      </tr><tr>
        <td>
          120
        </td>
        <td>
          88851
        </td>
        <td>
          4896
          -
          4922
        </td>
        <td>
          Apply
        </td>
        <td>
          java.lang.System.currentTimeMillis
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          java.lang.System.currentTimeMillis()
        </td>
      </tr><tr>
        <td>
          127
        </td>
        <td>
          88853
        </td>
        <td>
          5166
          -
          5212
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse.Builder.addPayload
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorAggregateCallback.this.results.addPayload(com.google.protobuf.ByteString.copyFrom(bytes))
        </td>
      </tr><tr>
        <td>
          127
        </td>
        <td>
          88852
        </td>
        <td>
          5185
          -
          5211
        </td>
        <td>
          Apply
        </td>
        <td>
          com.google.protobuf.ByteString.copyFrom
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          com.google.protobuf.ByteString.copyFrom(bytes)
        </td>
      </tr><tr>
        <td>
          128
        </td>
        <td>
          88854
        </td>
        <td>
          5219
          -
          5229
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.server.common.CoprocessorScan.CoprocessorAggregateCallback.continue
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorAggregateCallback.this.continue()
        </td>
      </tr><tr>
        <td>
          132
        </td>
        <td>
          88855
        </td>
        <td>
          5308
          -
          5318
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.server.common.CoprocessorScan.CoprocessorAggregateCallback.continue
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          CoprocessorAggregateCallback.this.continue()
        </td>
      </tr><tr>
        <td>
          132
        </td>
        <td>
          88857
        </td>
        <td>
          5322
          -
          5326
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          true
        </td>
      </tr><tr>
        <td>
          132
        </td>
        <td>
          88856
        </td>
        <td>
          5322
          -
          5326
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          true
        </td>
      </tr><tr>
        <td>
          132
        </td>
        <td>
          88861
        </td>
        <td>
          5334
          -
          5465
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          {
  CoprocessorAggregateCallback.this.results.addPayload(com.google.protobuf.ByteString.copyFrom(bytes));
  false
}
        </td>
      </tr><tr>
        <td>
          134
        </td>
        <td>
          88859
        </td>
        <td>
          5397
          -
          5443
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse.Builder.addPayload
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          CoprocessorAggregateCallback.this.results.addPayload(com.google.protobuf.ByteString.copyFrom(bytes))
        </td>
      </tr><tr>
        <td>
          134
        </td>
        <td>
          88858
        </td>
        <td>
          5416
          -
          5442
        </td>
        <td>
          Apply
        </td>
        <td>
          com.google.protobuf.ByteString.copyFrom
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          com.google.protobuf.ByteString.copyFrom(bytes)
        </td>
      </tr><tr>
        <td>
          135
        </td>
        <td>
          88860
        </td>
        <td>
          5452
          -
          5457
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          false
        </td>
      </tr><tr>
        <td>
          140
        </td>
        <td>
          88862
        </td>
        <td>
          5523
          -
          5544
        </td>
        <td>
          Apply
        </td>
        <td>
          com.google.protobuf.RpcController.isCanceled
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorAggregateCallback.this.controller.isCanceled()
        </td>
      </tr><tr>
        <td>
          140
        </td>
        <td>
          88864
        </td>
        <td>
          5546
          -
          5659
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          {
  (if (CoprocessorScan.this.logger.underlying.isWarnEnabled())
    CoprocessorScan.this.logger.underlying.warn(&quot;Stopping aggregator {} due to controller being cancelled&quot;, (CoprocessorAggregateCallback.this.aggregator: AnyRef))
  else
    (): Unit);
  false
}
        </td>
      </tr><tr>
        <td>
          142
        </td>
        <td>
          88863
        </td>
        <td>
          5646
          -
          5651
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          false
        </td>
      </tr><tr>
        <td>
          143
        </td>
        <td>
          88865
        </td>
        <td>
          5688
          -
          5714
        </td>
        <td>
          Apply
        </td>
        <td>
          java.lang.System.currentTimeMillis
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          java.lang.System.currentTimeMillis()
        </td>
      </tr><tr>
        <td>
          143
        </td>
        <td>
          88867
        </td>
        <td>
          5669
          -
          5715
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Option.exists
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorAggregateCallback.this.timeout.exists(((x$6: Long) =&gt; x$6.&lt;(java.lang.System.currentTimeMillis())))
        </td>
      </tr><tr>
        <td>
          143
        </td>
        <td>
          88866
        </td>
        <td>
          5684
          -
          5714
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Long.&lt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          x$6.&lt;(java.lang.System.currentTimeMillis())
        </td>
      </tr><tr>
        <td>
          143
        </td>
        <td>
          88869
        </td>
        <td>
          5717
          -
          5831
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          {
  (if (CoprocessorScan.this.logger.underlying.isWarnEnabled())
    CoprocessorScan.this.logger.underlying.warn(&quot;Stopping aggregator {} due to timeout of {}ms&quot;, (scala.Array.apply[AnyRef]((CoprocessorAggregateCallback.this.aggregator: AnyRef), CoprocessorAggregateCallback.this.timeout.get.asInstanceOf[AnyRef])((ClassTag.AnyRef: scala.reflect.ClassTag[AnyRef])): _*))
  else
    (): Unit);
  false
}
        </td>
      </tr><tr>
        <td>
          143
        </td>
        <td>
          88885
        </td>
        <td>
          5665
          -
          6595
        </td>
        <td>
          If
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          if (CoprocessorAggregateCallback.this.timeout.exists(((x$6: Long) =&gt; x$6.&lt;(java.lang.System.currentTimeMillis()))))
  {
    (if (CoprocessorScan.this.logger.underlying.isWarnEnabled())
      CoprocessorScan.this.logger.underlying.warn(&quot;Stopping aggregator {} due to timeout of {}ms&quot;, (scala.Array.apply[AnyRef]((CoprocessorAggregateCallback.this.aggregator: AnyRef), CoprocessorAggregateCallback.this.timeout.get.asInstanceOf[AnyRef])((ClassTag.AnyRef: scala.reflect.ClassTag[AnyRef])): _*))
    else
      (): Unit);
    false
  }
else
  if (CoprocessorAggregateCallback.this.yieldPartialResults)
    {
      val lastScanned: Array[Byte] = CoprocessorAggregateCallback.this.aggregator.getLastScanned;
      (if (CoprocessorScan.this.logger.underlying.isTraceEnabled())
        CoprocessorScan.this.logger.underlying.trace(scala.StringContext.apply(&quot;Stopping aggregator &quot;, &quot; at row &quot;, &quot; and &quot;).s(CoprocessorAggregateCallback.this.aggregator, org.locationtech.geomesa.utils.index.ByteArrays.printable(lastScanned)).+(&quot;returning intermediate results&quot;))
      else
        (): Unit);
      if (lastScanned.!=(null).&amp;&amp;(scala.Predef.byteArrayOps(lastScanned).isEmpty.unary_!))
        CoprocessorAggregateCallback.this.results.setLastScanned(com.google.protobuf.ByteString.copyFrom(lastScanned))
      else
        ();
      false
    }
  else
    {
      (if (CoprocessorScan.this.logger.underlying.isTraceEnabled())
        CoprocessorScan.this.logger.underlying.trace(scala.StringContext.apply(&quot;Running next batch on aggregator &quot;, &quot; &quot;).s(CoprocessorAggregateCallback.this.aggregator).+(scala.StringContext.apply(&quot;with elapsed time &quot;, &quot;ms&quot;).s(java.lang.System.currentTimeMillis().-(CoprocessorAggregateCallback.this.start))).+(CoprocessorAggregateCallback.this.timeout.map[String](((t: Long) =&gt; scala.StringContext.apply(&quot; and remaining timeout &quot;, &quot;ms&quot;).s(t.-(java.lang.System.currentTimeMillis())))).getOrElse[String](&quot;&quot;)))
      else
        (): Unit);
      true
    }
        </td>
      </tr><tr>
        <td>
          145
        </td>
        <td>
          88868
        </td>
        <td>
          5818
          -
          5823
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          false
        </td>
      </tr><tr>
        <td>
          146
        </td>
        <td>
          88870
        </td>
        <td>
          5841
          -
          5860
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.hbase.server.common.CoprocessorScan.CoprocessorAggregateCallback.yieldPartialResults
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorAggregateCallback.this.yieldPartialResults
        </td>
      </tr><tr>
        <td>
          146
        </td>
        <td>
          88881
        </td>
        <td>
          5862
          -
          6302
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  val lastScanned: Array[Byte] = CoprocessorAggregateCallback.this.aggregator.getLastScanned;
  (if (CoprocessorScan.this.logger.underlying.isTraceEnabled())
    CoprocessorScan.this.logger.underlying.trace(scala.StringContext.apply(&quot;Stopping aggregator &quot;, &quot; at row &quot;, &quot; and &quot;).s(CoprocessorAggregateCallback.this.aggregator, org.locationtech.geomesa.utils.index.ByteArrays.printable(lastScanned)).+(&quot;returning intermediate results&quot;))
  else
    (): Unit);
  if (lastScanned.!=(null).&amp;&amp;(scala.Predef.byteArrayOps(lastScanned).isEmpty.unary_!))
    CoprocessorAggregateCallback.this.results.setLastScanned(com.google.protobuf.ByteString.copyFrom(lastScanned))
  else
    ();
  false
}
        </td>
      </tr><tr>
        <td>
          146
        </td>
        <td>
          88884
        </td>
        <td>
          5837
          -
          6595
        </td>
        <td>
          If
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          if (CoprocessorAggregateCallback.this.yieldPartialResults)
  {
    val lastScanned: Array[Byte] = CoprocessorAggregateCallback.this.aggregator.getLastScanned;
    (if (CoprocessorScan.this.logger.underlying.isTraceEnabled())
      CoprocessorScan.this.logger.underlying.trace(scala.StringContext.apply(&quot;Stopping aggregator &quot;, &quot; at row &quot;, &quot; and &quot;).s(CoprocessorAggregateCallback.this.aggregator, org.locationtech.geomesa.utils.index.ByteArrays.printable(lastScanned)).+(&quot;returning intermediate results&quot;))
    else
      (): Unit);
    if (lastScanned.!=(null).&amp;&amp;(scala.Predef.byteArrayOps(lastScanned).isEmpty.unary_!))
      CoprocessorAggregateCallback.this.results.setLastScanned(com.google.protobuf.ByteString.copyFrom(lastScanned))
    else
      ();
    false
  }
else
  {
    (if (CoprocessorScan.this.logger.underlying.isTraceEnabled())
      CoprocessorScan.this.logger.underlying.trace(scala.StringContext.apply(&quot;Running next batch on aggregator &quot;, &quot; &quot;).s(CoprocessorAggregateCallback.this.aggregator).+(scala.StringContext.apply(&quot;with elapsed time &quot;, &quot;ms&quot;).s(java.lang.System.currentTimeMillis().-(CoprocessorAggregateCallback.this.start))).+(CoprocessorAggregateCallback.this.timeout.map[String](((t: Long) =&gt; scala.StringContext.apply(&quot; and remaining timeout &quot;, &quot;ms&quot;).s(t.-(java.lang.System.currentTimeMillis())))).getOrElse[String](&quot;&quot;)))
    else
      (): Unit);
    true
  }
        </td>
      </tr><tr>
        <td>
          147
        </td>
        <td>
          88871
        </td>
        <td>
          5890
          -
          5915
        </td>
        <td>
          Select
        </td>
        <td>
          org.locationtech.geomesa.hbase.server.common.HBaseAggregator.getLastScanned
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorAggregateCallback.this.aggregator.getLastScanned
        </td>
      </tr><tr>
        <td>
          152
        </td>
        <td>
          88873
        </td>
        <td>
          6180
          -
          6200
        </td>
        <td>
          Select
        </td>
        <td>
          scala.Boolean.unary_!
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          scala.Predef.byteArrayOps(lastScanned).isEmpty.unary_!
        </td>
      </tr><tr>
        <td>
          152
        </td>
        <td>
          88872
        </td>
        <td>
          6172
          -
          6176
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          null
        </td>
      </tr><tr>
        <td>
          152
        </td>
        <td>
          88874
        </td>
        <td>
          6157
          -
          6200
        </td>
        <td>
          Apply
        </td>
        <td>
          scala.Boolean.&amp;&amp;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          lastScanned.!=(null).&amp;&amp;(scala.Predef.byteArrayOps(lastScanned).isEmpty.unary_!)
        </td>
      </tr><tr>
        <td>
          152
        </td>
        <td>
          88879
        </td>
        <td>
          6153
          -
          6153
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          152
        </td>
        <td>
          88878
        </td>
        <td>
          6153
          -
          6153
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #F0ADAD">
          ()
        </td>
      </tr><tr>
        <td>
          153
        </td>
        <td>
          88875
        </td>
        <td>
          6237
          -
          6269
        </td>
        <td>
          Apply
        </td>
        <td>
          com.google.protobuf.ByteString.copyFrom
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          com.google.protobuf.ByteString.copyFrom(lastScanned)
        </td>
      </tr><tr>
        <td>
          153
        </td>
        <td>
          88877
        </td>
        <td>
          6214
          -
          6270
        </td>
        <td>
          Block
        </td>
        <td>
          org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse.Builder.setLastScanned
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorAggregateCallback.this.results.setLastScanned(com.google.protobuf.ByteString.copyFrom(lastScanned))
        </td>
      </tr><tr>
        <td>
          153
        </td>
        <td>
          88876
        </td>
        <td>
          6214
          -
          6270
        </td>
        <td>
          Apply
        </td>
        <td>
          org.locationtech.geomesa.hbase.proto.GeoMesaProto.GeoMesaCoprocessorResponse.Builder.setLastScanned
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          CoprocessorAggregateCallback.this.results.setLastScanned(com.google.protobuf.ByteString.copyFrom(lastScanned))
        </td>
      </tr><tr>
        <td>
          155
        </td>
        <td>
          88880
        </td>
        <td>
          6289
          -
          6294
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          false
        </td>
      </tr><tr>
        <td>
          156
        </td>
        <td>
          88883
        </td>
        <td>
          6308
          -
          6595
        </td>
        <td>
          Block
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          {
  (if (CoprocessorScan.this.logger.underlying.isTraceEnabled())
    CoprocessorScan.this.logger.underlying.trace(scala.StringContext.apply(&quot;Running next batch on aggregator &quot;, &quot; &quot;).s(CoprocessorAggregateCallback.this.aggregator).+(scala.StringContext.apply(&quot;with elapsed time &quot;, &quot;ms&quot;).s(java.lang.System.currentTimeMillis().-(CoprocessorAggregateCallback.this.start))).+(CoprocessorAggregateCallback.this.timeout.map[String](((t: Long) =&gt; scala.StringContext.apply(&quot; and remaining timeout &quot;, &quot;ms&quot;).s(t.-(java.lang.System.currentTimeMillis())))).getOrElse[String](&quot;&quot;)))
  else
    (): Unit);
  true
}
        </td>
      </tr><tr>
        <td>
          161
        </td>
        <td>
          88882
        </td>
        <td>
          6583
          -
          6587
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          true
        </td>
      </tr><tr>
        <td>
          169
        </td>
        <td>
          88886
        </td>
        <td>
          6731
          -
          6732
        </td>
        <td>
          Literal
        </td>
        <td>
          &lt;nosymbol&gt;
        </td>
        <td>
          
        </td>
        <td style="background: #AEF1AE">
          1
        </td>
      </tr>
    </table>
          </div>
        </div>
      </body>
    </html>