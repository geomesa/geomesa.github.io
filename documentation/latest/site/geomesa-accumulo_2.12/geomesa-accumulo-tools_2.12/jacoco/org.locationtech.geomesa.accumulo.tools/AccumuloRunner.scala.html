<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AccumuloRunner.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Accumulo Tools</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.accumulo.tools</a> &gt; <span class="el_source">AccumuloRunner.scala</span></div><h1>AccumuloRunner.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * Portions Crown Copyright (c) 2016-2025 Dstl
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.accumulo.tools

import com.beust.jcommander.ParameterException
import org.apache.accumulo.core.conf.ClientProperty
import org.locationtech.geomesa.accumulo.data.AccumuloClientConfig
import org.locationtech.geomesa.tools._
import org.locationtech.geomesa.tools.utils.Prompt

<span class="nc bnc" id="L18" title="All 4 branches missed.">object AccumuloRunner extends RunnerWithAccumuloEnvironment {</span>

  import org.locationtech.geomesa.accumulo.tools

<span class="nc" id="L22">  override val name: String = &quot;geomesa-accumulo&quot;</span>

  override protected def commands: Seq[Command] = {
<span class="nc" id="L25">    super.commands ++ Seq(</span>
<span class="nc" id="L26">      new tools.data.AccumuloAgeOffCommand,</span>
<span class="nc" id="L27">      new tools.data.AccumuloCompactCommand,</span>
<span class="nc" id="L28">      new tools.data.AccumuloManagePartitionsCommand,</span>
<span class="nc" id="L29">      new tools.data.AddAttributeIndexCommand,</span>
<span class="nc" id="L30">      new tools.data.AddIndexCommand,</span>
<span class="nc" id="L31">      new tools.data.TableConfCommand,</span>
<span class="nc" id="L32">      new tools.export.AccumuloExplainCommand,</span>
<span class="nc" id="L33">      new tools.export.AccumuloExportCommand,</span>
<span class="nc" id="L34">      new tools.export.AccumuloPlaybackCommand,</span>
<span class="nc" id="L35">      new tools.ingest.AccumuloBulkCopyCommand,</span>
<span class="nc" id="L36">      new tools.ingest.AccumuloBulkIngestCommand,</span>
<span class="nc" id="L37">      new tools.ingest.AccumuloDeleteFeaturesCommand,</span>
<span class="nc" id="L38">      new tools.ingest.AccumuloIngestCommand,</span>
<span class="nc" id="L39">      new tools.ingest.AccumuloUpdateFeaturesCommand,</span>
<span class="nc" id="L40">      new tools.schema.AccumuloCreateSchemaCommand,</span>
<span class="nc" id="L41">      new tools.schema.AccumuloDeleteCatalogCommand,</span>
<span class="nc" id="L42">      new tools.schema.AccumuloRemoveSchemaCommand,</span>
<span class="nc" id="L43">      new tools.schema.AccumuloUpdateSchemaCommand,</span>
<span class="nc" id="L44">      new tools.status.AccumuloDescribeSchemaCommand,</span>
<span class="nc" id="L45">      new tools.status.AccumuloGetSftConfigCommand,</span>
<span class="nc" id="L46">      new tools.status.AccumuloGetTypeNamesCommand,</span>
<span class="nc" id="L47">      new tools.status.AccumuloVersionRemoteCommand,</span>
<span class="nc" id="L48">      new tools.stats.AccumuloQueryAuditCommand,</span>
<span class="nc" id="L49">      new tools.stats.AccumuloStatsAnalyzeCommand,</span>
<span class="nc" id="L50">      new tools.stats.AccumuloStatsBoundsCommand,</span>
<span class="nc" id="L51">      new tools.stats.AccumuloStatsConfigureCommand,</span>
<span class="nc" id="L52">      new tools.stats.AccumuloStatsCountCommand,</span>
<span class="nc" id="L53">      new tools.stats.AccumuloStatsTopKCommand,</span>
<span class="nc" id="L54">      new tools.stats.AccumuloStatsHistogramCommand</span>
    )
  }
}

<span class="nc" id="L59">trait RunnerWithAccumuloEnvironment extends Runner {</span>

  /**
    * Loads Accumulo properties from `accumulo-client.properties` or `accumulo.conf`
    */
  override def resolveEnvironment(command: Command): Unit = {
<span class="nc bnc" id="L65" title="All 2 branches missed.">    lazy val config = AccumuloClientConfig.load()</span>

<span class="nc bnc" id="L67" title="All 4 branches missed.">    Option(command.params).collect { case p: AccumuloConnectionParams =&gt; p }.foreach { p =&gt;</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">      if (p.user == null) {</span>
<span class="nc" id="L69">        config.getProperty(ClientProperty.AUTH_PRINCIPAL.getKey) match {</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">          case null =&gt; throw new ParameterException(&quot;Parameter '--user' is required&quot;)</span>
<span class="nc" id="L71">          case u =&gt; p.user = u</span>
        }
      }
<span class="nc bnc" id="L74" title="All 4 branches missed.">      if (p.password != null &amp;&amp; p.keytab != null) {</span>
        // error if both password and keytab supplied
<span class="nc" id="L76">        throw new ParameterException(&quot;Cannot specify both password and keytab&quot;)</span>
<span class="nc bnc" id="L77" title="All 4 branches missed.">      } else if (p.password == null &amp;&amp; p.keytab == null &amp;&amp;</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">          AccumuloClientConfig.PasswordAuthType.equalsIgnoreCase(ClientProperty.AUTH_TYPE.getValue(config))) {</span>
        // if password not supplied, and not using keytab, prompt for it
<span class="nc" id="L80">        p.password = Option(config.getProperty(ClientProperty.AUTH_TOKEN.getKey)).getOrElse(Prompt.readPassword())</span>
      }
    }

<span class="nc bnc" id="L84" title="All 4 branches missed.">    Option(command.params).collect { case p: InstanceNameParams =&gt; p }.foreach { p =&gt;</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">      if (p.instance == null) {</span>
<span class="nc" id="L86">        Option(config.getProperty(ClientProperty.INSTANCE_NAME.getKey)).foreach(p.instance = _)</span>
      }
<span class="nc bnc" id="L88" title="All 2 branches missed.">      if (p.zookeepers == null) {</span>
<span class="nc" id="L89">        Option(config.getProperty(ClientProperty.INSTANCE_ZOOKEEPERS.getKey)).foreach(p.zookeepers = _)</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">        if (p.zkTimeout == null) {</span>
<span class="nc" id="L91">          Option(config.getProperty(ClientProperty.INSTANCE_ZOOKEEPERS_TIMEOUT.getKey)).foreach(p.zkTimeout = _)</span>
        }
      }
    }
  }

<span class="nc" id="L97">  override protected def classpathEnvironments: Seq[String] = Seq(&quot;ACCUMULO_HOME&quot;, &quot;HADOOP_HOME&quot;)</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>