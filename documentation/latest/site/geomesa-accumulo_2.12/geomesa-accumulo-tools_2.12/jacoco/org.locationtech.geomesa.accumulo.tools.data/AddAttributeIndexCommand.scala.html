<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AddAttributeIndexCommand.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Accumulo Tools</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.accumulo.tools.data</a> &gt; <span class="el_source">AddAttributeIndexCommand.scala</span></div><h1>AddAttributeIndexCommand.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.accumulo.tools.data

import com.beust.jcommander.{Parameter, Parameters}
import org.locationtech.geomesa.accumulo.jobs.index.AttributeIndexJob
import org.locationtech.geomesa.accumulo.jobs.index.AttributeIndexJob.AttributeIndexArgs
import org.locationtech.geomesa.accumulo.tools.data.AddAttributeIndexCommand.AddAttributeIndexParams
import org.locationtech.geomesa.accumulo.tools.{AccumuloDataStoreCommand, AccumuloDataStoreParams}
import org.locationtech.geomesa.tools.{Command, RequiredAttributesParam, RequiredTypeNameParam}

<span class="nc" id="L18">class AddAttributeIndexCommand extends AccumuloDataStoreCommand {</span>

<span class="nc" id="L20">  override val name = &quot;add-attribute-index&quot;</span>
<span class="nc" id="L21">  override val params = new AddAttributeIndexParams</span>

  override def execute(): Unit = {
    // We instantiate the class at runtime to avoid classpath dependencies from commands that are not being used.
<span class="nc" id="L25">    new AddAttributeIndexCommandExecutor(params).run()</span>
  }
}

<span class="nc" id="L29">object AddAttributeIndexCommand {</span>
  @Parameters(commandDescription = &quot;Run a Hadoop map reduce job to add an index for attributes&quot;)
<span class="nc" id="L31">  class AddAttributeIndexParams extends AccumuloDataStoreParams with RequiredTypeNameParam with RequiredAttributesParam {</span>
    @Parameter(names = Array(&quot;--coverage&quot;),
      description = &quot;Type of index (join or full)&quot;, required = true)
<span class="nc" id="L34">    var coverage: String = _</span>
  }
}

<span class="nc" id="L38">class AddAttributeIndexCommandExecutor(params: AddAttributeIndexParams) extends Runnable {</span>
  override def run(): Unit = {
    // Imported here to avoid classpath issues when generating the autocomplete script
    import org.apache.hadoop.util.ToolRunner

    try {
<span class="nc" id="L44">      val args = new AttributeIndexArgs(Array.empty)</span>
<span class="nc" id="L45">      args.inZookeepers = params.zookeepers</span>
<span class="nc" id="L46">      args.inInstanceId = params.instance</span>
<span class="nc" id="L47">      args.inUser       = params.user</span>
<span class="nc" id="L48">      args.inPassword   = params.password</span>
<span class="nc" id="L49">      args.inTableName  = params.catalog</span>
<span class="nc" id="L50">      args.inFeature    = params.featureName</span>
<span class="nc" id="L51">      args.coverage     = params.coverage</span>
<span class="nc" id="L52">      args.attributes.addAll(params.attributes)</span>

<span class="nc bnc" id="L54" title="All 2 branches missed.">      Command.user.info(s&quot;Running map reduce index job for attributes: ${params.attributes} with coverage: ${params.coverage}...&quot;)</span>

<span class="nc" id="L56">      val result = ToolRunner.run(new AttributeIndexJob(), args.unparse())</span>

<span class="nc bnc" id="L58" title="All 2 branches missed.">      if (result == 0) {</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">        Command.user.info(&quot;Add attribute index command finished successfully.&quot;)</span>
      } else {
<span class="nc bnc" id="L61" title="All 2 branches missed.">        Command.user.error(&quot;Error encountered running attribute index command. Check hadoop's job history logs for more information.&quot;)</span>
      }

    } catch {
      case e: Exception =&gt;
<span class="nc bnc" id="L66" title="All 2 branches missed.">        Command.user.error(s&quot;Exception encountered running attribute index command. &quot; +</span>
<span class="nc" id="L67">          s&quot;Check hadoop's job history logs for more information if necessary: &quot; + e.getMessage, e)</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>