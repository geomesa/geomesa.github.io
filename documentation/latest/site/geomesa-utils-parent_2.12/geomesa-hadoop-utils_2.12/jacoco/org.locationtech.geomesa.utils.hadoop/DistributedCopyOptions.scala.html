<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DistributedCopyOptions.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Hadoop Utils</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.utils.hadoop</a> &gt; <span class="el_source">DistributedCopyOptions.scala</span></div><h1>DistributedCopyOptions.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.utils.hadoop

import org.apache.hadoop.fs.Path
import org.apache.hadoop.tools.DistCpOptions

<span class="nc" id="L14">object DistributedCopyOptions {</span>

  import scala.collection.JavaConverters._

  /**
   * Create the options
   *
   * @param sources source files to copy
   * @param dest destination
   * @return
   */
  def apply(sources: Seq[Path], dest: Path): DistCpOptions =
<span class="nc" id="L26">    try { distCpOptions3(Left(sources), dest) } catch { case _: ClassNotFoundException =&gt; distCpOptions2(Left(sources), dest) }</span>

  /**
   * Create the options
   *
   * @param sourceFileList file containing list of sources to copy
   * @param dest destination
   * @return
   */
  def apply(sourceFileList: Path, dest: Path): DistCpOptions =
<span class="nc" id="L36">    try { distCpOptions3(Right(sourceFileList), dest) } catch { case _: ClassNotFoundException =&gt; distCpOptions2(Right(sourceFileList), dest) }</span>

  // hadoop 3 API
  private def distCpOptions3(sources: Either[Seq[Path], Path], dest: Path): DistCpOptions = {
<span class="nc" id="L40">    val builder = sources match {</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">      case Right(file) =&gt; new DistCpOptions.Builder(file, dest)</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">      case Left(dirs)  =&gt; new DistCpOptions.Builder(dirs.asJava, dest)</span>
    }
<span class="nc" id="L44">    builder.withAppend(false).withOverwrite(true).withBlocking(false).withCopyStrategy(&quot;dynamic&quot;).build()</span>
  }

  // hadoop 2 API
  private def distCpOptions2(sources: Either[Seq[Path], Path], dest: Path): DistCpOptions = {
<span class="nc" id="L49">    val clas = classOf[DistCpOptions]</span>
<span class="nc" id="L50">    val opts = sources match {</span>
<span class="nc bnc" id="L51" title="All 2 branches missed.">      case Right(file) =&gt; clas.getConstructor(classOf[Path], classOf[Path]).newInstance(file, dest)</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">      case Left(dirs)  =&gt; clas.getConstructor(classOf[java.util.List[Path]], classOf[Path]).newInstance(dirs.asJava, dest)</span>
    }
<span class="nc" id="L54">    clas.getMethod(&quot;setAppend&quot;, classOf[Boolean]).invoke(opts, java.lang.Boolean.FALSE)</span>
<span class="nc" id="L55">    clas.getMethod(&quot;setOverwrite&quot;, classOf[Boolean]).invoke(opts, java.lang.Boolean.TRUE)</span>
<span class="nc" id="L56">    clas.getMethod(&quot;setCopyStrategy&quot;, classOf[String]).invoke(opts, &quot;dynamic&quot;)</span>
<span class="nc" id="L57">    opts</span>
  }
<span class="nc" id="L59">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>