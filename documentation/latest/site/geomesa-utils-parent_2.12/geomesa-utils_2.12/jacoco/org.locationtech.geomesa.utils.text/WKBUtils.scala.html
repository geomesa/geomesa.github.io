<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WKBUtils.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Utils</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.utils.text</a> &gt; <span class="el_source">WKBUtils.scala</span></div><h1>WKBUtils.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.utils.text

import org.locationtech.jts.geom.Geometry
import org.locationtech.jts.io.{WKBReader, WKBWriter}

<span class="nc" id="L14">object WKBUtils extends WKBUtils</span>

<span class="nc" id="L16">trait WKBUtils {</span>

<span class="nc" id="L18">  private[this] val readerPool = new ThreadLocal[WKBReader]{</span>
<span class="nc" id="L19">    override def initialValue = new WKBReader</span>
  }

<span class="nc" id="L22">  private[this] val writer2dPool = new ThreadLocal[WKBWriter]{</span>
<span class="nc" id="L23">    override def initialValue = new WKBWriter(2)</span>
  }

<span class="nc" id="L26">  private[this] val writer3dPool = new ThreadLocal[WKBWriter]{</span>
<span class="nc" id="L27">    override def initialValue = new WKBWriter(3)</span>
  }

<span class="nc" id="L30">  def read(s: String): Geometry = read(s.getBytes)</span>
<span class="nc" id="L31">  def read(b: Array[Byte]): Geometry = readerPool.get.read(b)</span>

  def write(g: Geometry): Array[Byte] = {
<span class="nc bnc" id="L34" title="All 2 branches missed.">    val writer = if (is2d(g)) { writer2dPool } else { writer3dPool }</span>
<span class="nc" id="L35">    writer.get.write(g)</span>
  }

  private def is2d(geometry: Geometry): Boolean = {
    // don't trust coord.getDimensions - it always returns 3 in jts
    // instead, check for NaN for the z dimension
    // note that we only check the first coordinate - if a geometry is written with different
    // dimensions in each coordinate, some information may be lost
<span class="nc bnc" id="L43" title="All 2 branches missed.">    if (geometry == null) { true } else {</span>
<span class="nc" id="L44">      val coord = geometry.getCoordinate</span>
      // check for dimensions
      // TODO WKBWriter still only supports z or m but not both
<span class="nc bnc" id="L47" title="All 6 branches missed.">      coord == null || (java.lang.Double.isNaN(coord.getZ) &amp;&amp; java.lang.Double.isNaN(coord.getM))</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>