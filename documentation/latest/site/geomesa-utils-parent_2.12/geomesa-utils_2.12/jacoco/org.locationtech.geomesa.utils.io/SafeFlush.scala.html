<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SafeFlush.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Utils</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.utils.io</a> &gt; <span class="el_source">SafeFlush.scala</span></div><h1>SafeFlush.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.utils.io

import org.locationtech.geomesa.utils.io.IsFlushableImplicits.{ArrayIsFlushable, IterableIsFlushable, OptionIsFlushable}

import java.io.Flushable
import scala.util.{Failure, Success, Try}

/**
 * Flushes anything with a 'flush' method without throwing an exception
 */
<span class="nc" id="L19">trait SafeFlush {</span>

  def apply[F : IsFlushable](f: F): Option[Throwable]

  def apply[F1 : IsFlushable, F2 : IsFlushable](f1: F1, f2: F2): Option[Throwable] = {
<span class="nc" id="L24">    apply(f1) match {</span>
<span class="nc bnc" id="L25" title="All 2 branches missed.">      case None =&gt; apply(f2)</span>
<span class="nc bnc" id="L26" title="All 2 branches missed.">      case Some(e) =&gt; apply(f2).foreach(e.addSuppressed); Some(e)</span>
    }
  }

<span class="nc" id="L30">  def raise[F : IsFlushable](f: F): Unit = apply(f).foreach(e =&gt; throw e)</span>

<span class="nc" id="L32">  def raise[F1 : IsFlushable, F2 : IsFlushable](f1: F1, f2: F2): Unit = apply(f1, f2).foreach(e =&gt; throw e)</span>
}

trait IsFlushable[-F] {
  def flush(obj: F): Try[Unit]
}

<span class="nc" id="L39">object IsFlushable extends IsFlushableImplicits[Flushable] {</span>
<span class="nc" id="L40">  override protected def flush(f: Flushable): Try[Unit] = Try(f.flush())</span>
}

<span class="nc" id="L43">trait IsFlushableImplicits[F] {</span>

  protected def flush(f: F): Try[Unit]

<span class="nc bnc" id="L47" title="All 2 branches missed.">  implicit val flushableIsFlushable: IsFlushable[F] = new IsFlushable[F] {</span>
<span class="nc" id="L48">    override def flush(obj: F): Try[Unit] = IsFlushableImplicits.this.flush(obj)</span>
  }

<span class="nc" id="L51">  implicit val iterableIsFlushable: IterableIsFlushable[F] = new IterableIsFlushable()</span>
<span class="nc" id="L52">  implicit val optionIsFlushable: OptionIsFlushable[F] = new OptionIsFlushable()</span>
<span class="nc" id="L53">  implicit val arrayIsFlushable: ArrayIsFlushable[F] = new ArrayIsFlushable()</span>
}

<span class="nc" id="L56">object IsFlushableImplicits {</span>

<span class="nc" id="L58">  class IterableIsFlushable[F : IsFlushable] extends IsFlushable[Iterable[_ &lt;: F]] {</span>

<span class="nc" id="L60">    private val ev = implicitly[IsFlushable[F]]</span>

    override def flush(obj: Iterable[_ &lt;: F]): Try[Unit] = {
<span class="nc" id="L63">      var error: Throwable = null</span>
<span class="nc" id="L64">      obj.foreach { f =&gt;</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">        ev.flush(f).failed.foreach(e =&gt; if (error == null) { error = e } else { error.addSuppressed(e) })</span>
      }
<span class="nc bnc" id="L67" title="All 2 branches missed.">      if (error == null) { Success() } else { Failure(error) }</span>
    }
  }

<span class="nc" id="L71">  class OptionIsFlushable[F : IsFlushable] extends IsFlushable[Option[_ &lt;: F]] {</span>

<span class="nc" id="L73">    private val ev = implicitly[IsFlushable[F]]</span>

    override def flush(obj: Option[_ &lt;: F]): Try[Unit] = {
<span class="nc" id="L76">      obj match {</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">        case None =&gt; Success()</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">        case Some(o) =&gt; ev.flush(o)</span>
      }
    }
  }

<span class="nc" id="L83">  class ArrayIsFlushable[F : IsFlushable] extends IsFlushable[Array[_ &lt;: F]] {</span>

<span class="nc" id="L85">    private val ev = implicitly[IsFlushable[F]]</span>

    override def flush(obj: Array[_ &lt;: F]): Try[Unit] = {
<span class="nc" id="L88">      var error: Throwable = null</span>
<span class="nc" id="L89">      obj.foreach { f =&gt;</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">        ev.flush(f).failed.foreach(e =&gt; if (error == null) { error = e } else { error.addSuppressed(e) })</span>
      }
<span class="nc bnc" id="L92" title="All 2 branches missed.">      if (error == null) { Success() } else { Failure(error) }</span>
    }
  }
<span class="nc" id="L95">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>