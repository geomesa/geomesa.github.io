<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>StringFunctionFactory.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Convert Common</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.convert2.transforms</a> &gt; <span class="el_source">StringFunctionFactory.scala</span></div><h1>StringFunctionFactory.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0 
 ***********************************************************************/

package org.locationtech.geomesa.convert2.transforms

import org.apache.commons.lang3.StringUtils

import scala.util.matching.Regex


<span class="nc" id="L16">class StringFunctionFactory extends TransformerFunctionFactory {</span>

  override def functions: Seq[TransformerFunction] =
<span class="nc" id="L19">    Seq(stripQuotes, strip, stripPrefix, stripSuffix, replace, remove,</span>
<span class="nc" id="L20">      strLen, trim, capitalize, lowercase, uppercase, regexReplace, concat,</span>
<span class="nc" id="L21">      substr, string, mkstring, emptyToNull, printf)</span>

<span class="nc" id="L23">  private val string = TransformerFunction.pure(&quot;toString&quot;) { args =&gt;</span>
<span class="nc bnc" id="L24" title="All 2 branches missed.">    if (args(0) == null) { null } else { args(0).toString }</span>
  }

<span class="nc" id="L27">  private val stripQuotes = TransformerFunction.pure(&quot;stripQuotes&quot;) { args =&gt;</span>
<span class="nc bnc" id="L28" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L29">      val s = args(0) match {</span>
<span class="nc bnc" id="L30" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L31">        case s =&gt; s.toString</span>
      }
<span class="nc" id="L33">      StringUtils.strip(s, &quot;'\&quot;&quot;)</span>
    }
  }

<span class="nc" id="L37">  private val strip = TransformerFunction.pure(&quot;strip&quot;) { args =&gt;</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L39">      val s = args(0) match {</span>
<span class="nc bnc" id="L40" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L41">        case s =&gt; s.toString</span>
      }
<span class="nc bnc" id="L43" title="All 2 branches missed.">      val toStrip = if (args.length == 1) { null } else { args(1).asInstanceOf[String] }</span>
<span class="nc" id="L44">      StringUtils.strip(s, toStrip)</span>
    }
  }

<span class="nc" id="L48">  private val stripPrefix = TransformerFunction.pure(&quot;stripPrefix&quot;) { args =&gt;</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L50">      val s = args(0) match {</span>
<span class="nc bnc" id="L51" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L52">        case s =&gt; s.toString</span>
      }
<span class="nc bnc" id="L54" title="All 2 branches missed.">      val toStrip = if (args.lengthCompare(1) &gt; 0) { args(1).asInstanceOf[String] } else { null }</span>
<span class="nc" id="L55">      StringUtils.stripStart(s, toStrip)</span>
    }
  }

<span class="nc" id="L59">  private val stripSuffix = TransformerFunction.pure(&quot;stripSuffix&quot;) { args =&gt;</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L61">      val s = args(0) match {</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L63">        case s =&gt; s.toString</span>
      }
<span class="nc bnc" id="L65" title="All 2 branches missed.">      val toStrip = if (args.lengthCompare(1) &gt; 0) { args(1).asInstanceOf[String] } else { null }</span>
<span class="nc" id="L66">      StringUtils.stripEnd(s, toStrip)</span>
    }
  }

<span class="nc" id="L70">  private val replace = TransformerFunction.pure(&quot;replace&quot;) { args =&gt;</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L72">      val s = args(0) match {</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L74">        case s =&gt; s.toString</span>
      }
<span class="nc" id="L76">      val toRemove = args(1).asInstanceOf[String]</span>
<span class="nc" id="L77">      val replacement = args(2).asInstanceOf[String]</span>
<span class="nc" id="L78">      s.replaceAllLiterally(toRemove, replacement)</span>
    }
  }

<span class="nc" id="L82">  private val remove = TransformerFunction.pure(&quot;remove&quot;) { args =&gt;</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L84">      val s = args(0) match {</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L86">        case s =&gt; s.toString</span>
      }
<span class="nc" id="L88">      val toRemove = args(1).asInstanceOf[String]</span>
<span class="nc" id="L89">      StringUtils.remove(s, toRemove)</span>
    }
  }

<span class="nc" id="L93">  private val trim = TransformerFunction.pure(&quot;trim&quot;) { args =&gt;</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L95">      val s = args(0) match {</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L97">        case s =&gt; s.toString</span>
      }
<span class="nc" id="L99">      s.trim</span>
    }
  }

<span class="nc" id="L103">  private val capitalize = TransformerFunction.pure(&quot;capitalize&quot;) { args =&gt;</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L105">      val s = args(0) match {</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L107">        case s =&gt; s.toString</span>
      }
<span class="nc" id="L109">      s.capitalize</span>
    }
  }

<span class="nc" id="L113">  private val lowercase = TransformerFunction.pure(&quot;lowercase&quot;) { args =&gt;</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L115">      val s = args(0) match {</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L117">        case s =&gt; s.toString</span>
      }
<span class="nc" id="L119">      s.toLowerCase</span>
    }
  }

<span class="nc" id="L123">  private val uppercase = TransformerFunction.pure(&quot;uppercase&quot;) { args =&gt;</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L125">      val s = args(0) match {</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L127">        case s =&gt; s.toString</span>
      }
<span class="nc" id="L129">      s.toUpperCase</span>
    }
  }

<span class="nc" id="L133">  private val concat = TransformerFunction.pure(&quot;concat&quot;, &quot;concatenate&quot;) { args =&gt;</span>
<span class="nc" id="L134">    val strings = args.map {</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">      case s: String =&gt; s</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">      case null =&gt; &quot;null&quot;</span>
<span class="nc" id="L137">      case s =&gt; s.toString</span>
    }
<span class="nc" id="L139">    strings.mkString</span>
  }

<span class="nc" id="L142">  private val mkstring = TransformerFunction.pure(&quot;mkstring&quot;) { args =&gt;</span>
<span class="nc" id="L143">    val delim = args(0).asInstanceOf[String]</span>
<span class="nc" id="L144">    val strings = args.drop(1).map {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">      case s: String =&gt; s</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">      case null =&gt; &quot;null&quot;</span>
<span class="nc" id="L147">      case s =&gt; s.toString</span>
    }
<span class="nc" id="L149">    strings.mkString(delim)</span>
  }

<span class="nc" id="L152">  private val emptyToNull = TransformerFunction.pure(&quot;emptyToNull&quot;) { args =&gt;</span>
<span class="nc bnc" id="L153" title="All 4 branches missed.">    if (args(0) == null || args(0).toString.trim.isEmpty) { null } else { args(0) }</span>
  }

<span class="nc" id="L156">  private val regexReplace = TransformerFunction.pure(&quot;regexReplace&quot;) { args =&gt;</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">    if (args(2) == null) { null } else {</span>
<span class="nc" id="L158">      val s = args(2) match {</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L160">        case s =&gt; s.toString</span>
      }
<span class="nc" id="L162">      val regex = args(0).asInstanceOf[Regex]</span>
<span class="nc" id="L163">      val replacement = args(1).asInstanceOf[String]</span>
<span class="nc" id="L164">      regex.replaceAllIn(s, replacement)</span>
    }
  }

<span class="nc" id="L168">  private val substr = TransformerFunction.pure(&quot;substr&quot;, &quot;substring&quot;) { args =&gt;</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">    if (args(0) == null) { null } else {</span>
<span class="nc" id="L170">      val s = args(0) match {</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">        case s: String =&gt; s</span>
<span class="nc" id="L172">        case s =&gt; s.toString</span>
      }
<span class="nc" id="L174">      val from = args(1).asInstanceOf[Int]</span>
<span class="nc" id="L175">      val to = args(2).asInstanceOf[Int]</span>
<span class="nc" id="L176">      s.substring(from, to)</span>
    }
  }

<span class="nc" id="L180">  private val strLen = TransformerFunction.pure(&quot;strlen&quot;, &quot;stringLength&quot;, &quot;length&quot;) { args =&gt;</span>
<span class="nc" id="L181">    val s = args(0) match {</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">      case s: String =&gt; s</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">      case null =&gt; &quot;&quot;</span>
<span class="nc" id="L184">      case s =&gt; s.toString</span>
    }
<span class="nc" id="L186">    s.length</span>
  }

<span class="nc" id="L189">  private val printf = TransformerFunction.pure(&quot;printf&quot;) { args =&gt;</span>
<span class="nc" id="L190">    String.format(args(0).toString, args.drop(1).asInstanceOf[Array[AnyRef]]: _*)</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>