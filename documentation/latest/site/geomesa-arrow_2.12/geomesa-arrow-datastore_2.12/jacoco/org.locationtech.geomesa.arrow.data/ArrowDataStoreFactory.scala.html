<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ArrowDataStoreFactory.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Arrow DataStore</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.arrow.data</a> &gt; <span class="el_source">ArrowDataStoreFactory.scala</span></div><h1>ArrowDataStoreFactory.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.arrow.data

import org.geotools.api.data.DataAccessFactory.Param
import org.geotools.api.data.{DataStore, FileDataStore, FileDataStoreFactorySpi}
import org.locationtech.geomesa.index.geotools.GeoMesaDataStoreFactory.NamespaceParams
import org.locationtech.geomesa.utils.geotools.GeoMesaParam
import org.locationtech.geomesa.utils.geotools.GeoMesaParam.ReadWriteFlag

import java.awt.RenderingHints.Key
import java.net.URL
import scala.util.Try

<span class="nc" id="L21">class ArrowDataStoreFactory extends FileDataStoreFactorySpi {</span>
  import ArrowDataStoreFactory._

  // FileDataStoreFactory methods

<span class="nc" id="L26">  override def createDataStore(url: URL): FileDataStore = new ArrowDataStore(url, false)</span>

  override def getTypeName(url: URL): String = {
<span class="nc" id="L29">    val ds = new ArrowDataStore(url, false)</span>
<span class="nc" id="L30">    try { ds.getSchema().getTypeName } finally { ds.dispose() }</span>
  }

  // TODO support gz files
<span class="nc" id="L34">  override def getFileExtensions: Array[String] = Array(&quot;arrow&quot;)</span>

<span class="nc bnc" id="L36" title="All 4 branches missed.">  override def canProcess(url: URL): Boolean = url != null &amp;&amp; url.getFile.endsWith(&quot;.arrow&quot;)</span>

  // DataStoreFactory methods

  override def createDataStore(params: java.util.Map[String, _]): DataStore = {
<span class="nc" id="L41">    val caching = CachingParam.lookup(params) // default false</span>
<span class="nc" id="L42">    val ds = UrlParam.lookupOpt(params).map(new ArrowDataStore(_, caching)).getOrElse {</span>
<span class="nc" id="L43">      throw new IllegalArgumentException(s&quot;Could not create data store using $params&quot;)</span>
    }
<span class="nc" id="L45">    NamespaceParam.lookupOpt(params).foreach(ds.setNamespaceURI)</span>
<span class="nc" id="L46">    ds</span>
  }

<span class="nc" id="L49">  override def createNewDataStore(params: java.util.Map[String, _]): DataStore = createDataStore(params)</span>

  override def canProcess(params: java.util.Map[String, _]): Boolean =
<span class="nc" id="L52">    Try(UrlParam.lookupOpt(params).exists(canProcess)).getOrElse(false)</span>

<span class="nc" id="L54">  override def getParametersInfo: Array[Param] = Array(UrlParam, CachingParam, NamespaceParam)</span>

<span class="nc" id="L56">  override def getDisplayName: String = DisplayName</span>

<span class="nc" id="L58">  override def getDescription: String = Description</span>

<span class="nc" id="L60">  override def isAvailable: Boolean = true</span>

<span class="nc" id="L62">  override def getImplementationHints: java.util.Map[Key, _] = java.util.Collections.emptyMap()</span>
}

<span class="nc" id="L65">object ArrowDataStoreFactory extends NamespaceParams {</span>

<span class="nc" id="L67">  val UrlParam =</span>
<span class="nc" id="L68">    new GeoMesaParam[URL](</span>
<span class="nc" id="L69">      &quot;arrow.url&quot;,</span>
<span class="nc" id="L70">      &quot;URL to an arrow file&quot;,</span>
<span class="nc" id="L71">      optional = false,</span>
<span class="nc" id="L72">      extension = &quot;arrow&quot;,</span>
<span class="nc" id="L73">      deprecatedKeys = Seq(&quot;url&quot;)</span>
    )

<span class="nc" id="L76">  val CachingParam =</span>
<span class="nc" id="L77">    new GeoMesaParam[java.lang.Boolean](</span>
<span class="nc" id="L78">      &quot;arrow.caching&quot;,</span>
<span class="nc" id="L79">      &quot;Enable caching of the arrow file. This will improve query speeds, but may require substantial memory. Note: for performance reasons, writing is disabled if caching is on&quot;,</span>
<span class="nc" id="L80">      default = false,</span>
<span class="nc" id="L81">      deprecatedKeys = Seq(&quot;caching&quot;),</span>
<span class="nc" id="L82">      readWrite = ReadWriteFlag.ReadOnly</span>
    )

<span class="nc" id="L85">  private val DisplayName = &quot;Apache Arrow (GeoMesa)&quot;</span>

<span class="nc" id="L87">  private val Description = &quot;Arrow file-based data store&quot;</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>