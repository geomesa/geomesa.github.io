<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ArrowSimpleFeature.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Arrow GeoTools Abstractions</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.arrow.features</a> &gt; <span class="el_source">ArrowSimpleFeature.scala</span></div><h1>ArrowSimpleFeature.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.arrow.features

import org.geotools.api.feature.`type`.{AttributeDescriptor, Name}
import org.geotools.api.feature.simple.{SimpleFeature, SimpleFeatureType}
import org.geotools.api.feature.{GeometryAttribute, Property}
import org.geotools.api.filter.identity.FeatureId
import org.geotools.api.geometry.BoundingBox
import org.geotools.geometry.jts.ReferencedEnvelope
import org.locationtech.geomesa.arrow.vector.ArrowAttributeReader
import org.locationtech.geomesa.features.geotools.ImmutableFeatureId
import org.locationtech.jts.geom.Geometry

import java.util.{Objects, Collection =&gt; jCollection, List =&gt; jList, Map =&gt; jMap}

/**
  * Simple feature backed by an arrow vector. Attributes are lazily evaluated - this allows filters to only
  * examine the relevant arrow vectors for optimized reads, but also means that they are tied to the underlying
  * vectors
  *
  * @param sft simple feature type
  * @param idReader id reader
  * @param attributeReaders attribute readers
  * @param index index of the feature in the arrow vector
  */
<span class="nc" id="L33">class ArrowSimpleFeature(sft: SimpleFeatureType,</span>
<span class="nc" id="L34">                         idReader: ArrowAttributeReader,</span>
<span class="nc" id="L35">                         attributeReaders: Array[ArrowAttributeReader],</span>
<span class="nc" id="L36">                         private [arrow] var index: Int) extends SimpleFeature {</span>
  import scala.collection.JavaConverters._

<span class="nc bnc" id="L39" title="All 4 branches missed.">  private lazy val geomIndex = sft.indexOf(sft.getGeometryDescriptor.getLocalName)</span>

<span class="nc" id="L41">  override def getAttribute(i: Int): AnyRef = attributeReaders(i).apply(index)</span>

  /**
    * Gets the underlying arrow reader for this feature
    *
    * @param i attribute to be read
    * @return reader
    */
<span class="nc" id="L49">  def getReader(i: Int): ArrowAttributeReader = attributeReaders(i)</span>

  /**
    * Gets the index of this feature, for use with the attribute reader
    *
    * @return
    */
<span class="nc" id="L56">  def getIndex: Int = index</span>

<span class="nc" id="L58">  override def getID: String = idReader.apply(index).asInstanceOf[String]</span>
<span class="nc" id="L59">  override def getIdentifier: FeatureId = new ImmutableFeatureId(getID)</span>

<span class="nc" id="L61">  override def getUserData: jMap[AnyRef, AnyRef] = Map.empty[AnyRef, AnyRef].asJava</span>

<span class="nc" id="L63">  override def getType: SimpleFeatureType = sft</span>
<span class="nc" id="L64">  override def getFeatureType: SimpleFeatureType = sft</span>
<span class="nc" id="L65">  override def getName: Name = sft.getName</span>

<span class="nc" id="L67">  override def getAttribute(name: Name): AnyRef = getAttribute(name.getLocalPart)</span>
  override def getAttribute(name: String): AnyRef = {
<span class="nc" id="L69">    val index = sft.indexOf(name)</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">    if (index == -1) { null } else { getAttribute(index) }</span>
  }

<span class="nc" id="L73">  override def getDefaultGeometry: AnyRef = getAttribute(geomIndex)</span>
<span class="nc" id="L74">  override def getAttributeCount: Int = sft.getAttributeCount</span>

<span class="nc" id="L76">  override def getBounds: BoundingBox = getDefaultGeometry match {</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">    case g: Geometry =&gt; new ReferencedEnvelope(g.getEnvelopeInternal, sft.getCoordinateReferenceSystem)</span>
<span class="nc" id="L78">    case _           =&gt; new ReferencedEnvelope(sft.getCoordinateReferenceSystem)</span>
  }

  override def getAttributes: jList[AnyRef] = {
<span class="nc" id="L82">    val attributes = new java.util.ArrayList[AnyRef](sft.getAttributeCount)</span>
<span class="nc" id="L83">    var i = 0</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">    while (i &lt; sft.getAttributeCount) {</span>
<span class="nc" id="L85">      attributes.add(getAttribute(i))</span>
<span class="nc" id="L86">      i += 1</span>
    }
<span class="nc" id="L88">    attributes</span>
  }

<span class="nc" id="L91">  override def getDefaultGeometryProperty: GeometryAttribute = throw new UnsupportedOperationException()</span>
<span class="nc" id="L92">  override def getProperties: jCollection[Property] = throw new UnsupportedOperationException()</span>
<span class="nc" id="L93">  override def getProperties(name: Name): jCollection[Property] = throw new UnsupportedOperationException()</span>
<span class="nc" id="L94">  override def getProperties(name: String): jCollection[Property] = throw new UnsupportedOperationException()</span>
<span class="nc" id="L95">  override def getProperty(name: Name): Property = throw new UnsupportedOperationException()</span>
<span class="nc" id="L96">  override def getProperty(name: String): Property = throw new UnsupportedOperationException()</span>
<span class="nc" id="L97">  override def getValue: jCollection[Property] = throw new UnsupportedOperationException()</span>
<span class="nc" id="L98">  override def getDescriptor: AttributeDescriptor = throw new UnsupportedOperationException()</span>

<span class="nc" id="L100">  override def setAttribute(name: Name, value: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L101">  override def setAttribute(name: String, value: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L102">  override def setAttribute(index: Int, value: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L103">  override def setAttributes(vals: jList[Object]): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L104">  override def setAttributes(vals: Array[Object]): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L105">  override def setDefaultGeometry(geo: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L106">  override def setDefaultGeometryProperty(geoAttr: GeometryAttribute): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L107">  override def setValue(newValue: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L108">  override def setValue(values: jCollection[Property]): Unit = throw new UnsupportedOperationException()</span>

<span class="nc" id="L110">  override def isNillable: Boolean = true</span>
<span class="nc" id="L111">  override def validate(): Unit = throw new UnsupportedOperationException()</span>

<span class="nc" id="L113">  override def toString: String = s&quot;ArrowSimpleFeature:$getID:${getAttributes.asScala.mkString(&quot;|&quot;)}&quot;</span>

<span class="nc" id="L115">  override def hashCode: Int = Objects.hash(getID, getName, getAttributes)</span>

<span class="nc" id="L117">  override def equals(obj: scala.Any): Boolean = obj match {</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">    case other: SimpleFeature =&gt;</span>
<span class="nc bnc" id="L119" title="All 18 branches missed.">      getID == other.getID &amp;&amp; getName == other.getName &amp;&amp; getAttributes == other.getAttributes</span>
<span class="nc" id="L120">    case _ =&gt; false</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>