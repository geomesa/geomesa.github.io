<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>XZ2Scheme.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa FileSystem Storage Common</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.fs.storage.common.partitions</a> &gt; <span class="el_source">XZ2Scheme.scala</span></div><h1>XZ2Scheme.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.fs.storage.common.partitions

import org.geotools.api.feature.simple.SimpleFeature
import org.geotools.api.filter.Filter
import org.locationtech.geomesa.curve.XZ2SFC
import org.locationtech.geomesa.fs.storage.common.partitions.SpatialScheme.SpatialPartitionSchemeFactory
import org.locationtech.geomesa.zorder.sfcurve.IndexRange
import org.locationtech.jts.geom.Geometry

<span class="nc bnc" id="L18" title="All 24 branches missed.">case class XZ2Scheme(bits: Int, geom: String, geomIndex: Int) extends SpatialScheme(bits, geom) {</span>

<span class="nc" id="L20">  private val xz2 = XZ2SFC((bits / 2).asInstanceOf[Short])</span>

<span class="nc" id="L22">  override def pattern: String = s&quot;$bits-bit-xz2&quot;</span>

  override def getPartitionName(feature: SimpleFeature): String = {
<span class="nc" id="L25">    val geometry = feature.getAttribute(geom).asInstanceOf[Geometry]</span>
<span class="nc" id="L26">    val envelope = geometry.getEnvelopeInternal</span>
<span class="nc" id="L27">    xz2.index(envelope.getMinX, envelope.getMinY, envelope.getMaxX, envelope.getMaxY).formatted(format)</span>
  }

  // TODO https://geomesa.atlassian.net/browse/GEOMESA-2967
  override def getCoveringFilter(partition: String): Filter =
<span class="nc" id="L32">    throw new UnsupportedOperationException(&quot;https://geomesa.atlassian.net/browse/GEOMESA-2967&quot;)</span>

  // the max XZ2 value is (4^((bits / 2) + 1) - 1) / 3
  // this calculates the number of digits in that value
<span class="nc" id="L36">  override protected def digits(bits: Int): Int = math.ceil(((bits / 2) + 1) * math.log10(4) - math.log10(3)).toInt</span>

<span class="nc" id="L38">  override protected def generateRanges(xy: Seq[(Double, Double, Double, Double)]): Seq[IndexRange] = xz2.ranges(xy)</span>
}

<span class="nc" id="L41">object XZ2Scheme {</span>

<span class="nc" id="L43">  val Name = &quot;xz2&quot;</span>

<span class="nc" id="L45">  class XZ2PartitionSchemeFactory extends SpatialPartitionSchemeFactory(Name) {</span>
    override def buildPartitionScheme(bits: Int, geom: String, geomIndex: Int): SpatialScheme =
<span class="nc" id="L47">      XZ2Scheme(bits, geom, geomIndex)</span>
  }
<span class="nc" id="L49">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>