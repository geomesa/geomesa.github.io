<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GeometricConstructorFunctions.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Spark JTS</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.spark.jts.udf</a> &gt; <span class="el_source">GeometricConstructorFunctions.scala</span></div><h1>GeometricConstructorFunctions.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.spark.jts.udf

import org.apache.spark.sql.SQLContext
import org.locationtech.geomesa.spark.jts.util.GeoHashUtils._
import org.locationtech.geomesa.spark.jts.util.SQLFunctionHelper._
import org.locationtech.geomesa.spark.jts.util.{GeometryUtils, WKBUtils, WKTUtils}
import org.locationtech.jts.geom._
import org.locationtech.jts.io.geojson.GeoJsonReader

<span class="nc" id="L18">object GeometricConstructorFunctions {</span>

  @transient
<span class="nc" id="L21">  private val geomFactory: GeometryFactory = new GeometryFactory()</span>

  @transient
<span class="nc bnc" id="L24" title="All 4 branches missed.">  private lazy val geoJsonReader: GeoJsonReader = new GeoJsonReader(geomFactory)</span>

<span class="nc" id="L26">  val ST_GeomFromGeoHash: (String, Int) =&gt; Geometry = nullableUDF((hash, prec) =&gt; decode(hash, prec))</span>
<span class="nc" id="L27">  val ST_GeomFromGeoJSON: String =&gt; Geometry = nullableUDF(text =&gt; geoJsonReader.read(text))</span>
<span class="nc" id="L28">  val ST_GeomFromWKT: String =&gt; Geometry = nullableUDF(text =&gt; WKTUtils.read(text))</span>
<span class="nc" id="L29">  val ST_GeomFromWKB: Array[Byte] =&gt; Geometry = nullableUDF(array =&gt; WKBUtils.read(array))</span>
<span class="nc" id="L30">  val ST_LineFromText: String =&gt; LineString = nullableUDF(text =&gt; WKTUtils.read(text).asInstanceOf[LineString])</span>
<span class="nc" id="L31">  val ST_MakeBox2D: (Point, Point) =&gt; Geometry = nullableUDF((lowerLeft, upperRight) =&gt;</span>
<span class="nc" id="L32">    geomFactory.toGeometry(new Envelope(lowerLeft.getX, upperRight.getX, lowerLeft.getY, upperRight.getY)))</span>
<span class="nc" id="L33">  val ST_MakeBBOX: (Double, Double, Double, Double) =&gt; Geometry = nullableUDF((lowerX, lowerY, upperX, upperY) =&gt;</span>
<span class="nc" id="L34">    GeometryUtils.addWayPointsToBBOX(geomFactory.toGeometry(new Envelope(lowerX, upperX, lowerY, upperY))))</span>
<span class="nc" id="L35">  val ST_MakePolygon: LineString =&gt; Polygon = nullableUDF(shell =&gt; {</span>
<span class="nc" id="L36">    val ring = geomFactory.createLinearRing(shell.getCoordinateSequence)</span>
<span class="nc" id="L37">    geomFactory.createPolygon(ring)</span>
  })
<span class="nc" id="L39">  val ST_MakePoint: (Double, Double) =&gt; Point = nullableUDF((x, y) =&gt; geomFactory.createPoint(new Coordinate(x, y)))</span>
<span class="nc" id="L40">  val ST_MakeLine: Seq[Point] =&gt; LineString = nullableUDF(s =&gt; geomFactory.createLineString(s.map(_.getCoordinate).toArray))</span>
<span class="nc" id="L41">  val ST_MakePointM: (Double, Double, Double) =&gt; Point = nullableUDF((x, y, m) =&gt;</span>
<span class="nc" id="L42">    WKTUtils.read(s&quot;POINT($x $y $m)&quot;).asInstanceOf[Point])</span>
<span class="nc" id="L43">  val ST_MLineFromText: String =&gt; MultiLineString = nullableUDF(text =&gt; WKTUtils.read(text).asInstanceOf[MultiLineString])</span>
<span class="nc" id="L44">  val ST_MPointFromText: String =&gt; MultiPoint = nullableUDF(text =&gt; WKTUtils.read(text).asInstanceOf[MultiPoint])</span>
<span class="nc" id="L45">  val ST_MPolyFromText: String =&gt; MultiPolygon = nullableUDF(text =&gt; WKTUtils.read(text).asInstanceOf[MultiPolygon])</span>
<span class="nc" id="L46">  val ST_Point: (Double, Double) =&gt; Point = (x, y) =&gt; ST_MakePoint(x, y)</span>
<span class="nc" id="L47">  val ST_PointFromGeoHash: (String, Int) =&gt; Point = nullableUDF((hash, prec) =&gt; decode(hash, prec).getInteriorPoint)</span>
<span class="nc" id="L48">  val ST_PointFromText: String =&gt; Point = nullableUDF(text =&gt; WKTUtils.read(text).asInstanceOf[Point])</span>
<span class="nc" id="L49">  val ST_PointFromWKB: Array[Byte] =&gt; Point = array =&gt; ST_GeomFromWKB(array).asInstanceOf[Point]</span>
<span class="nc" id="L50">  val ST_Polygon: LineString =&gt; Polygon = shell =&gt; ST_MakePolygon(shell)</span>
<span class="nc" id="L51">  val ST_PolygonFromText: String =&gt; Polygon = nullableUDF(text =&gt; WKTUtils.read(text).asInstanceOf[Polygon])</span>

<span class="nc" id="L53">  private[geomesa] val constructorNames = Map(</span>
<span class="nc" id="L54">    ST_GeomFromGeoHash -&gt; &quot;st_geomFromGeoHash&quot;,</span>
<span class="nc" id="L55">    ST_GeomFromGeoJSON -&gt; &quot;st_geomFromGeoJSON&quot;,</span>
<span class="nc" id="L56">    ST_GeomFromWKT -&gt; &quot;st_geomFromWKT&quot;,</span>
<span class="nc" id="L57">    ST_GeomFromWKB -&gt; &quot;st_geomFromWKB&quot;,</span>
<span class="nc" id="L58">    ST_LineFromText -&gt; &quot;st_lineFromText&quot;,</span>
<span class="nc" id="L59">    ST_MakeBox2D -&gt; &quot;st_makeBox2D&quot;,</span>
<span class="nc" id="L60">    ST_MakeBBOX -&gt; &quot;st_makeBBOX&quot;,</span>
<span class="nc" id="L61">    ST_MakePolygon -&gt; &quot;st_makePolygon&quot;,</span>
<span class="nc" id="L62">    ST_MakePoint -&gt; &quot;st_makePoint&quot;,</span>
<span class="nc" id="L63">    ST_MakeLine -&gt; &quot;st_makeLine&quot;,</span>
<span class="nc" id="L64">    ST_MakePointM -&gt; &quot;st_makePointM&quot;,</span>
<span class="nc" id="L65">    ST_MLineFromText -&gt; &quot;st_mLineFromText&quot;,</span>
<span class="nc" id="L66">    ST_MPointFromText -&gt; &quot;st_mPointFromText&quot;,</span>
<span class="nc" id="L67">    ST_MPolyFromText -&gt; &quot;st_mPolyFromText&quot;,</span>
<span class="nc" id="L68">    ST_Point -&gt; &quot;st_point&quot;,</span>
<span class="nc" id="L69">    ST_PointFromGeoHash -&gt; &quot;st_pointFromGeoHash&quot;,</span>
<span class="nc" id="L70">    ST_PointFromText -&gt; &quot;st_pointFromText&quot;,</span>
<span class="nc" id="L71">    ST_PointFromWKB -&gt; &quot;st_pointFromWKB&quot;,</span>
<span class="nc" id="L72">    ST_Polygon -&gt; &quot;st_polygon&quot;,</span>
<span class="nc" id="L73">    ST_PolygonFromText  -&gt; &quot;st_polygonFromText&quot;</span>
  )

  private[jts] def registerFunctions(sqlContext: SQLContext): Unit = {
<span class="nc" id="L77">    sqlContext.udf.register(&quot;st_box2DFromGeoHash&quot;, ST_GeomFromGeoHash)</span>
<span class="nc" id="L78">    sqlContext.udf.register(constructorNames(ST_GeomFromGeoHash), ST_GeomFromGeoHash)</span>
<span class="nc" id="L79">    sqlContext.udf.register(constructorNames(ST_GeomFromGeoJSON), ST_GeomFromGeoJSON)</span>
<span class="nc" id="L80">    sqlContext.udf.register(&quot;st_geomFromText&quot;, ST_GeomFromWKT)</span>
<span class="nc" id="L81">    sqlContext.udf.register(&quot;st_geometryFromText&quot;, ST_GeomFromWKT)</span>
<span class="nc" id="L82">    sqlContext.udf.register(constructorNames(ST_GeomFromWKT), ST_GeomFromWKT)</span>
<span class="nc" id="L83">    sqlContext.udf.register(constructorNames(ST_GeomFromWKB), ST_GeomFromWKB)</span>
<span class="nc" id="L84">    sqlContext.udf.register(constructorNames(ST_LineFromText), ST_LineFromText)</span>
<span class="nc" id="L85">    sqlContext.udf.register(constructorNames(ST_MLineFromText), ST_MLineFromText)</span>
<span class="nc" id="L86">    sqlContext.udf.register(constructorNames(ST_MPointFromText), ST_MPointFromText)</span>
<span class="nc" id="L87">    sqlContext.udf.register(constructorNames(ST_MPolyFromText), ST_MPolyFromText)</span>
<span class="nc" id="L88">    sqlContext.udf.register(constructorNames(ST_MakeBBOX), ST_MakeBBOX)</span>
<span class="nc" id="L89">    sqlContext.udf.register(constructorNames(ST_MakeBox2D), ST_MakeBox2D)</span>
<span class="nc" id="L90">    sqlContext.udf.register(constructorNames(ST_MakeLine), ST_MakeLine)</span>
<span class="nc" id="L91">    sqlContext.udf.register(constructorNames(ST_MakePoint), ST_MakePoint)</span>
<span class="nc" id="L92">    sqlContext.udf.register(constructorNames(ST_MakePointM), ST_MakePointM)</span>
<span class="nc" id="L93">    sqlContext.udf.register(constructorNames(ST_MakePolygon), ST_MakePolygon)</span>
<span class="nc" id="L94">    sqlContext.udf.register(constructorNames(ST_Point), ST_Point)</span>
<span class="nc" id="L95">    sqlContext.udf.register(constructorNames(ST_PointFromGeoHash), ST_PointFromGeoHash)</span>
<span class="nc" id="L96">    sqlContext.udf.register(constructorNames(ST_PointFromText), ST_PointFromText)</span>
<span class="nc" id="L97">    sqlContext.udf.register(constructorNames(ST_PointFromWKB), ST_PointFromWKB)</span>
<span class="nc" id="L98">    sqlContext.udf.register(constructorNames(ST_Polygon), ST_Polygon)</span>
<span class="nc" id="L99">    sqlContext.udf.register(constructorNames(ST_PolygonFromText), ST_PolygonFromText)</span>
  }
<span class="nc" id="L101">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>