<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FastComparisonOperator.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Filters and Functions</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.filter.expression</a> &gt; <span class="el_source">FastComparisonOperator.scala</span></div><h1>FastComparisonOperator.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.filter.expression

import org.geotools.api.filter._
import org.geotools.api.filter.expression.{Expression, Literal}
import org.locationtech.geomesa.utils.geotools.converters.FastConverter


<span class="nc" id="L16">object FastComparisonOperator {</span>

<span class="nc" id="L18">  def lessThan(exp1: Expression, exp2: Literal): PropertyIsLessThan = new FastLessThanLiteral(exp1, exp2)</span>
<span class="nc" id="L19">  def lessThan(exp1: Literal, exp2: Expression): PropertyIsLessThan = new FastLessThanExpression(exp1, exp2)</span>

  def lessThanOrEqual(exp1: Expression, exp2: Literal): PropertyIsLessThanOrEqualTo =
<span class="nc" id="L22">    new FastLessThanOrEqualToLiteral(exp1, exp2)</span>
  def lessThanOrEqual(exp1: Literal, exp2: Expression): PropertyIsLessThanOrEqualTo =
<span class="nc" id="L24">    new FastLessThanOrEqualToExpression(exp1, exp2)</span>

<span class="nc" id="L26">  def greaterThan(exp1: Expression, exp2: Literal): PropertyIsGreaterThan = new FastGreaterThanLiteral(exp1, exp2)</span>
<span class="nc" id="L27">  def greaterThan(exp1: Literal, exp2: Expression): PropertyIsGreaterThan = new FastGreaterThanExpression(exp1, exp2)</span>

  def greaterThanOrEqual(exp1: Expression, exp2: Literal): PropertyIsGreaterThanOrEqualTo =
<span class="nc" id="L30">    new FastGreaterThanOrEqualToLiteral(exp1, exp2)</span>
  def greaterThanOrEqual(exp1: Literal, exp2: Expression): PropertyIsGreaterThanOrEqualTo =
<span class="nc" id="L32">    new FastGreaterThanOrEqualToExpression(exp1, exp2)</span>

  /**
    * Less than filter comparing an expression (e.g. property or function) to a literal
    *
    * @param exp1 expression
    * @param exp2 literal
    */
<span class="nc" id="L40">  private final class FastLessThanLiteral(exp1: Expression, exp2: Literal)</span>
<span class="nc" id="L41">      extends FastComparisonOperator(exp1, exp2, &quot;&lt;&quot;) with PropertyIsLessThan {</span>

<span class="nc" id="L43">    private val lit = FastConverter.convert(exp2.evaluate(null), classOf[Comparable[Any]])</span>

    override def evaluate(obj: AnyRef): Boolean = {
<span class="nc" id="L46">      val value = exp1.evaluate(obj).asInstanceOf[Comparable[Any]]</span>
<span class="nc bnc" id="L47" title="All 6 branches missed.">      value != null &amp;&amp; lit != null &amp;&amp; value.compareTo(lit) &lt; 0</span>
    }

<span class="nc" id="L50">    override def accept(visitor: FilterVisitor, extraData: AnyRef): AnyRef = visitor.visit(this, extraData)</span>
  }

  /**
    * Less than filter comparing a literal to an expression (e.g. property or function)
    *
    * @param exp1 literal
    * @param exp2 expression
    */
<span class="nc" id="L59">  private final class FastLessThanExpression(exp1: Literal, exp2: Expression)</span>
<span class="nc" id="L60">      extends FastComparisonOperator(exp1, exp2, &quot;&lt;&quot;) with PropertyIsLessThan {</span>

<span class="nc" id="L62">    private val lit = FastConverter.convert(exp1.evaluate(null), classOf[Comparable[Any]])</span>

    override def evaluate(obj: AnyRef): Boolean = {
<span class="nc" id="L65">      val value = exp2.evaluate(obj).asInstanceOf[Comparable[Any]]</span>
<span class="nc bnc" id="L66" title="All 6 branches missed.">      value != null &amp;&amp; lit != null &amp;&amp; lit.compareTo(value) &lt; 0</span>
    }

<span class="nc" id="L69">    override def accept(visitor: FilterVisitor, extraData: AnyRef): AnyRef = visitor.visit(this, extraData)</span>
  }

  /**
    * Less than filter comparing an expression (e.g. property or function) to a literal
    *
    * @param exp1 expression
    * @param exp2 literal
    */
<span class="nc" id="L78">  private final class FastLessThanOrEqualToLiteral(exp1: Expression, exp2: Literal)</span>
<span class="nc" id="L79">      extends FastComparisonOperator(exp1, exp2, &quot;&lt;=&quot;) with PropertyIsLessThanOrEqualTo {</span>

<span class="nc" id="L81">    private val lit = FastConverter.convert(exp2.evaluate(null), classOf[Comparable[Any]])</span>

    override def evaluate(obj: AnyRef): Boolean = {
<span class="nc" id="L84">      val value = exp1.evaluate(obj).asInstanceOf[Comparable[Any]]</span>
<span class="nc bnc" id="L85" title="All 6 branches missed.">      value != null &amp;&amp; lit != null &amp;&amp; value.compareTo(lit) &lt;= 0</span>
    }

<span class="nc" id="L88">    override def accept(visitor: FilterVisitor, extraData: AnyRef): AnyRef = visitor.visit(this, extraData)</span>
  }

  /**
    * Less than filter comparing a literal to an expression (e.g. property or function)
    *
    * @param exp1 literal
    * @param exp2 expression
    */
<span class="nc" id="L97">  private final class FastLessThanOrEqualToExpression(exp1: Literal, exp2: Expression)</span>
<span class="nc" id="L98">      extends FastComparisonOperator(exp1, exp2, &quot;&lt;=&quot;) with PropertyIsLessThanOrEqualTo {</span>

<span class="nc" id="L100">    private val lit = FastConverter.convert(exp1.evaluate(null), classOf[Comparable[Any]])</span>

    override def evaluate(obj: AnyRef): Boolean = {
<span class="nc" id="L103">      val value = exp2.evaluate(obj).asInstanceOf[Comparable[Any]]</span>
<span class="nc bnc" id="L104" title="All 6 branches missed.">      value != null &amp;&amp; lit != null &amp;&amp; lit.compareTo(value) &lt;= 0</span>
    }

<span class="nc" id="L107">    override def accept(visitor: FilterVisitor, extraData: AnyRef): AnyRef = visitor.visit(this, extraData)</span>
  }

  /**
    * Greater than filter comparing an expression (e.g. property or function) to a literal
    *
    * @param exp1 expression
    * @param exp2 literal
    */
<span class="nc" id="L116">  private final class FastGreaterThanLiteral(exp1: Expression, exp2: Literal)</span>
<span class="nc" id="L117">      extends FastComparisonOperator(exp1, exp2, &quot;&gt;&quot;) with PropertyIsGreaterThan {</span>

<span class="nc" id="L119">    private val lit = FastConverter.convert(exp2.evaluate(null), classOf[Comparable[Any]])</span>

    override def evaluate(obj: AnyRef): Boolean = {
<span class="nc" id="L122">      val value = exp1.evaluate(obj).asInstanceOf[Comparable[Any]]</span>
<span class="nc bnc" id="L123" title="All 6 branches missed.">      value != null &amp;&amp; lit != null &amp;&amp; value.compareTo(lit) &gt; 0</span>
    }

<span class="nc" id="L126">    override def accept(visitor: FilterVisitor, extraData: AnyRef): AnyRef = visitor.visit(this, extraData)</span>
  }

  /**
    * Greater than filter comparing a literal to an expression (e.g. property or function)
    *
    * @param exp1 literal
    * @param exp2 expression
    */
<span class="nc" id="L135">  private final class FastGreaterThanExpression(exp1: Literal, exp2: Expression)</span>
<span class="nc" id="L136">      extends FastComparisonOperator(exp1, exp2, &quot;&gt;&quot;) with PropertyIsGreaterThan {</span>

<span class="nc" id="L138">    private val lit = FastConverter.convert(exp1.evaluate(null), classOf[Comparable[Any]])</span>

    override def evaluate(obj: AnyRef): Boolean = {
<span class="nc" id="L141">      val value = exp2.evaluate(obj).asInstanceOf[Comparable[Any]]</span>
<span class="nc bnc" id="L142" title="All 6 branches missed.">      value != null &amp;&amp; lit != null &amp;&amp; lit.compareTo(value) &gt; 0</span>
    }

<span class="nc" id="L145">    override def accept(visitor: FilterVisitor, extraData: AnyRef): AnyRef = visitor.visit(this, extraData)</span>
  }

  /**
    * Greater than or equal filter comparing an expression (e.g. property or function) to a literal
    *
    * @param exp1 expression
    * @param exp2 literal
    */
<span class="nc" id="L154">  private final class FastGreaterThanOrEqualToLiteral(exp1: Expression, exp2: Literal)</span>
<span class="nc" id="L155">      extends FastComparisonOperator(exp1, exp2, &quot;&gt;=&quot;) with PropertyIsGreaterThanOrEqualTo {</span>

<span class="nc" id="L157">    private val lit = FastConverter.convert(exp2.evaluate(null), classOf[Comparable[Any]])</span>

    override def evaluate(obj: AnyRef): Boolean = {
<span class="nc" id="L160">      val value = exp1.evaluate(obj).asInstanceOf[Comparable[Any]]</span>
<span class="nc bnc" id="L161" title="All 6 branches missed.">      value != null &amp;&amp; lit != null &amp;&amp; value.compareTo(lit) &gt;= 0</span>
    }

<span class="nc" id="L164">    override def accept(visitor: FilterVisitor, extraData: AnyRef): AnyRef = visitor.visit(this, extraData)</span>
  }

  /**
    * Greater than or equal filter comparing a literal to an expression (e.g. property or function)
    *
    * @param exp1 literal
    * @param exp2 expression
    */
<span class="nc" id="L173">  private final class FastGreaterThanOrEqualToExpression(exp1: Literal, exp2: Expression)</span>
<span class="nc" id="L174">      extends FastComparisonOperator(exp1, exp2, &quot;&gt;=&quot;) with PropertyIsGreaterThanOrEqualTo {</span>

<span class="nc" id="L176">    private val lit = FastConverter.convert(exp1.evaluate(null), classOf[Comparable[Any]])</span>

    override def evaluate(obj: AnyRef): Boolean = {
<span class="nc" id="L179">      val value = exp2.evaluate(obj).asInstanceOf[Comparable[Any]]</span>
<span class="nc bnc" id="L180" title="All 6 branches missed.">      value != null &amp;&amp; lit != null &amp;&amp; lit.compareTo(value) &gt;= 0</span>
    }

<span class="nc" id="L183">    override def accept(visitor: FilterVisitor, extraData: AnyRef): AnyRef = visitor.visit(this, extraData)</span>
  }
}

<span class="nc" id="L187">sealed private abstract class FastComparisonOperator(exp1: Expression, exp2: Expression, private val op: String)</span>
<span class="nc" id="L188">    extends BinaryComparisonOperator {</span>

<span class="nc" id="L190">  override def getExpression1: Expression = exp1</span>

<span class="nc" id="L192">  override def getExpression2: Expression = exp2</span>

<span class="nc" id="L194">  override def isMatchingCase: Boolean = false</span>

<span class="nc" id="L196">  override def getMatchAction: MultiValuedFilter.MatchAction = MultiValuedFilter.MatchAction.ANY</span>

<span class="nc" id="L198">  override def toString: String = s&quot;[ $exp1 $op $exp2 ]&quot;</span>

<span class="nc" id="L200">  def canEqual(other: Any): Boolean = other.isInstanceOf[FastComparisonOperator]</span>

<span class="nc" id="L202">  override def equals(other: Any): Boolean = other match {</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">    case that: FastComparisonOperator =&gt;</span>
<span class="nc bnc" id="L204" title="All 20 branches missed.">      (that canEqual this) &amp;&amp; exp1 == that.getExpression1 &amp;&amp; exp2 == that.getExpression2 &amp;&amp; op == that.op</span>
<span class="nc" id="L205">    case _ =&gt; false</span>
  }

  override def hashCode(): Int =
<span class="nc" id="L209">    Seq(exp1, exp2, op).map(_.hashCode()).foldLeft(0)((a, b) =&gt; 31 * a + b)</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>