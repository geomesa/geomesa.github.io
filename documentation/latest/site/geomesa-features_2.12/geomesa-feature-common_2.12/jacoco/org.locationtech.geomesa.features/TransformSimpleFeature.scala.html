<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TransformSimpleFeature.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Features Common</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.features</a> &gt; <span class="el_source">TransformSimpleFeature.scala</span></div><h1>TransformSimpleFeature.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.features

import org.geotools.api.feature.`type`.Name
import org.geotools.api.feature.simple.{SimpleFeature, SimpleFeatureType}
import org.geotools.api.feature.{GeometryAttribute, Property}
import org.geotools.api.filter.identity.FeatureId
import org.geotools.api.geometry.BoundingBox
import org.geotools.geometry.jts.ReferencedEnvelope
import org.locationtech.geomesa.utils.geotools.Transform
import org.locationtech.geomesa.utils.geotools.Transform.Transforms
import org.locationtech.geomesa.utils.io.Sizable
import org.locationtech.jts.geom.Geometry

import java.util.{Collection =&gt; jCollection, List =&gt; jList, Map =&gt; jMap}

/**
  * Simple feature implementation that wraps another feature type and applies a transform/projection
  *
  * @param transformSchema transformed feature type
  * @param attributes attribute evaluations, in order
  */
<span class="nc" id="L30">class TransformSimpleFeature(</span>
<span class="nc" id="L31">    transformSchema: SimpleFeatureType,</span>
<span class="nc" id="L32">    attributes: Array[Transform],</span>
<span class="nc" id="L33">    private var underlying: SimpleFeature = null</span>
<span class="nc" id="L34">  ) extends SimpleFeature with Sizable {</span>

<span class="nc bnc" id="L36" title="All 4 branches missed.">  private lazy val geomIndex = transformSchema.indexOf(transformSchema.getGeometryDescriptor.getLocalName)</span>

  def setFeature(sf: SimpleFeature): TransformSimpleFeature = {
<span class="nc" id="L39">    underlying = sf</span>
<span class="nc" id="L40">    this</span>
  }

<span class="nc" id="L43">  override def calculateSizeOf(): Long = underlying match {</span>
<span class="nc bnc" id="L44" title="All 2 branches missed.">    case s: Sizable =&gt; s.calculateSizeOf()</span>
<span class="nc" id="L45">    case _ =&gt; Sizable.sizeOf(underlying) + Sizable.deepSizeOf(underlying.getAttributes, underlying.getUserData)</span>
  }

<span class="nc" id="L48">  override def getAttribute(index: Int): AnyRef = attributes(index).evaluate(underlying)</span>

<span class="nc" id="L50">  override def getIdentifier: FeatureId = underlying.getIdentifier</span>
<span class="nc" id="L51">  override def getID: String = underlying.getID</span>

<span class="nc" id="L53">  override def getUserData: jMap[AnyRef, AnyRef] = underlying.getUserData</span>

<span class="nc" id="L55">  override def getType: SimpleFeatureType = transformSchema</span>
<span class="nc" id="L56">  override def getFeatureType: SimpleFeatureType = transformSchema</span>
<span class="nc" id="L57">  override def getName: Name = transformSchema.getName</span>

<span class="nc" id="L59">  override def getAttribute(name: Name): AnyRef = getAttribute(name.getLocalPart)</span>
  override def getAttribute(name: String): Object = {
<span class="nc" id="L61">    val index = transformSchema.indexOf(name)</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">    if (index == -1) null else getAttribute(index)</span>
  }

<span class="nc" id="L65">  override def getDefaultGeometry: AnyRef = getAttribute(geomIndex)</span>
<span class="nc" id="L66">  override def getAttributeCount: Int = transformSchema.getAttributeCount</span>

<span class="nc" id="L68">  override def getBounds: BoundingBox = getDefaultGeometry match {</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">    case g: Geometry =&gt; new ReferencedEnvelope(g.getEnvelopeInternal, transformSchema.getCoordinateReferenceSystem)</span>
<span class="nc" id="L70">    case _           =&gt; new ReferencedEnvelope(transformSchema.getCoordinateReferenceSystem)</span>
  }

  override def getAttributes: jList[AnyRef] = {
<span class="nc" id="L74">    val attributes = new java.util.ArrayList[AnyRef](transformSchema.getAttributeCount)</span>
<span class="nc" id="L75">    var i = 0</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">    while (i &lt; transformSchema.getAttributeCount) {</span>
<span class="nc" id="L77">      attributes.add(getAttribute(i))</span>
<span class="nc" id="L78">      i += 1</span>
    }
<span class="nc" id="L80">    attributes</span>
  }

<span class="nc" id="L83">  override def getDefaultGeometryProperty = throw new UnsupportedOperationException()</span>
<span class="nc" id="L84">  override def getProperties: jCollection[Property] = throw new UnsupportedOperationException()</span>
<span class="nc" id="L85">  override def getProperties(name: Name) = throw new UnsupportedOperationException()</span>
<span class="nc" id="L86">  override def getProperties(name: String) = throw new UnsupportedOperationException()</span>
<span class="nc" id="L87">  override def getProperty(name: Name) = throw new UnsupportedOperationException()</span>
<span class="nc" id="L88">  override def getProperty(name: String) = throw new UnsupportedOperationException()</span>
<span class="nc" id="L89">  override def getValue = throw new UnsupportedOperationException()</span>
<span class="nc" id="L90">  override def getDescriptor = throw new UnsupportedOperationException()</span>

<span class="nc" id="L92">  override def setAttribute(name: Name, value: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L93">  override def setAttribute(name: String, value: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L94">  override def setAttribute(index: Int, value: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L95">  override def setAttributes(vals: jList[Object]): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L96">  override def setAttributes(vals: Array[Object]): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L97">  override def setDefaultGeometry(geo: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L98">  override def setDefaultGeometryProperty(geoAttr: GeometryAttribute): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L99">  override def setValue(newValue: Object): Unit = throw new UnsupportedOperationException()</span>
<span class="nc" id="L100">  override def setValue(values: jCollection[Property]): Unit = throw new UnsupportedOperationException()</span>

<span class="nc" id="L102">  override def isNillable: Boolean = true</span>
<span class="nc" id="L103">  override def validate(): Unit = throw new UnsupportedOperationException()</span>

<span class="nc" id="L105">  override def hashCode: Int = getID.hashCode()</span>

<span class="nc" id="L107">  override def equals(obj: scala.Any): Boolean = obj match {</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">    case other: SimpleFeature =&gt;</span>
<span class="nc bnc" id="L109" title="All 14 branches missed.">      getID == other.getID &amp;&amp; getName == other.getName &amp;&amp; getAttributeCount == other.getAttributeCount &amp;&amp; {</span>
<span class="nc" id="L110">        var i = 0</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">        while (i &lt; getAttributeCount) {</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">          if (getAttribute(i) != other.getAttribute(i)) {</span>
<span class="nc" id="L113">            return false</span>
          }
<span class="nc" id="L115">          i += 1</span>
        }
<span class="nc bnc" id="L117" title="All 2 branches missed.">        true</span>
      }
<span class="nc" id="L119">    case _ =&gt; false</span>
  }

<span class="nc" id="L122">  override def toString = s&quot;TransformSimpleFeature:$getID&quot;</span>
}

<span class="nc" id="L125">object TransformSimpleFeature {</span>

  def apply(
      sft: SimpleFeatureType,
      transformSchema: SimpleFeatureType,
      transforms: String): TransformSimpleFeature = {
<span class="nc" id="L131">    new TransformSimpleFeature(transformSchema, Transforms(sft, transforms).toArray)</span>
  }

  def apply(transformSchema: SimpleFeatureType, transforms: Seq[Transform]): TransformSimpleFeature =
<span class="nc" id="L135">    new TransformSimpleFeature(transformSchema, transforms.toArray)</span>
<span class="nc" id="L136">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>