<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimpleFeatureSerializer.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GeoMesa Features Common</a> &gt; <a href="index.source.html" class="el_package">org.locationtech.geomesa.features</a> &gt; <span class="el_source">SimpleFeatureSerializer.scala</span></div><h1>SimpleFeatureSerializer.scala</h1><pre class="source lang-java linenums">/***********************************************************************
 * Copyright (c) 2013-2025 General Atomics Integrated Intelligence, Inc.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Apache License, Version 2.0
 * which accompanies this distribution and is available at
 * https://www.apache.org/licenses/LICENSE-2.0
 ***********************************************************************/

package org.locationtech.geomesa.features

import org.geotools.api.feature.simple.SimpleFeature
import org.locationtech.geomesa.features.SerializationOption.SerializationOption

import java.io.{InputStream, OutputStream}

trait HasEncodingOptions {
  def options: Set[SerializationOption]
}

/**
 * Interface to encode SimpleFeatures with a configurable serialization format.
 *
 * A SimpleFeatureEncoder is bound to a given SimpleFeatureType since serialization
 * may depend upon the schema of the feature type.
 *
 * SimpleFeatureEncoder classes may not be thread safe and should generally be used
 * as instance variables for performance reasons.
 */
<span class="nc" id="L29">trait SimpleFeatureSerializer extends HasEncodingOptions {</span>

  /**
    * Serialize a simple feature to a byte array
    *
    * @param feature feature
    * @return
    */
  def serialize(feature: SimpleFeature): Array[Byte]

  /**
    * Serialize a simple feature to an output stream
    *
    * @param feature feature
    * @param out output stream
    */
  def serialize(feature: SimpleFeature, out: OutputStream): Unit

  /**
    * Deserialize a simple feature from a byte array
    *
    * @param bytes bytes
    * @return
    */
<span class="nc" id="L53">  def deserialize(bytes: Array[Byte]): SimpleFeature = deserialize(bytes, 0, bytes.length)</span>

  /**
    * Deserialize a simple feature from an input stream
    *
    * @param in input
    * @return
    */
  def deserialize(in: InputStream): SimpleFeature

  /**
    * Deserialize a simple feature from a subset of a byte array
    *
    * @param bytes bytes
    * @param offset offset of first byte to read
    * @param length total bytes to read
    * @return
    */
  def deserialize(bytes: Array[Byte], offset: Int, length: Int): SimpleFeature

  /**
    * Deserialize a simple feature from a byte array, with a feature id provided separately.
    *
    * Note that this only makes sense when used in conjunction with
    * `org.locationtech.geomesa.features.SerializationOption.WithoutId()`
    *
    * @param id feature id
    * @param bytes bytes
    * @return
    */
<span class="nc" id="L83">  def deserialize(id: String, bytes: Array[Byte]): SimpleFeature = deserialize(id, bytes, 0, bytes.length)</span>

  /**
    * Deserialize a simple feature from an input stream, with a feature id provided separately
    *
    * Note that this only makes sense when used in conjunction with
    * `org.locationtech.geomesa.features.SerializationOption.WithoutId()`
    *
    * @param id feature id
    * @param in input
    * @return
    */
  def deserialize(id: String, in: InputStream): SimpleFeature

  /**
    * Deserialize a simple feature from a subset of a byte array, with a feature id provided separately
    *
    * Note that this only makes sense when used in conjunction with
    * `org.locationtech.geomesa.features.SerializationOption.WithoutId()`
    *
    * @param id feature id
    * @param bytes bytes
    * @param offset offset of first byte to read
    * @param length total bytes to read
    * @return
    */
  def deserialize(id: String, bytes: Array[Byte], offset: Int, length: Int): SimpleFeature
}

<span class="nc" id="L112">object SimpleFeatureSerializer {</span>

<span class="nc" id="L114">  trait Builder[T &lt;: Builder[T]] {</span>

    this: T =&gt;

<span class="nc" id="L118">    protected val options = scala.collection.mutable.Set.empty[SerializationOption]</span>

<span class="nc" id="L120">    protected def add(key: SerializationOption): T = { options.add(key); this }</span>
<span class="nc" id="L121">    protected def remove(key: SerializationOption): T = { options.remove(key); this }</span>

<span class="nc" id="L123">    def immutable: T = add(SerializationOption.Immutable)</span>
<span class="nc" id="L124">    def mutable: T = remove(SerializationOption.Immutable)</span>
<span class="nc" id="L125">    def withUserData: T = add(SerializationOption.WithUserData)</span>
<span class="nc" id="L126">    def withoutUserData: T = remove(SerializationOption.WithUserData)</span>
<span class="nc" id="L127">    def withId: T = remove(SerializationOption.WithoutId)</span>
<span class="nc" id="L128">    def withoutId: T = add(SerializationOption.WithoutId)</span>
<span class="nc" id="L129">    def `lazy`: T = add(SerializationOption.Lazy)</span>
<span class="nc" id="L130">    def active: T = remove(SerializationOption.Lazy)</span>
<span class="nc" id="L131">    def opts(opts: Set[SerializationOption]): T = { options ++= opts; this }</span>

    def build(): SimpleFeatureSerializer
  }

  /**
    * Serializer that doesn't implement all the semi-optional methods
    */
<span class="nc" id="L139">  trait LimitedSerialization extends SimpleFeatureSerializer {</span>
    override def serialize(feature: SimpleFeature, out: OutputStream): Unit =
<span class="nc" id="L141">      throw new UnsupportedOperationException()</span>
    override def deserialize(in: InputStream): SimpleFeature =
<span class="nc" id="L143">      throw new UnsupportedOperationException()</span>
    override def deserialize(bytes: Array[Byte], offset: Int, length: Int): SimpleFeature =
<span class="nc" id="L145">      throw new UnsupportedOperationException()</span>
    override def deserialize(id: String, in: InputStream): SimpleFeature =
<span class="nc" id="L147">      throw new UnsupportedOperationException()</span>
    override def deserialize(id: String, bytes: Array[Byte], offset: Int, length: Int): SimpleFeature =
<span class="nc" id="L149">      throw new UnsupportedOperationException()</span>
  }
<span class="nc" id="L151">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>