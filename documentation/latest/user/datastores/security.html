<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7.15. Data Security &mdash; GeoMesa 5.0.0 Manuals</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="canonical" href="https://www.geomesa.org/documentation/user/datastores/security.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="7.16. Query Auditing" href="auditing.html" />
    <link rel="prev" title="7.14. Analytic Querying" href="analytic_queries.html" />


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          </a>
              <div class="version">
                5.1.0-SNAPSHOT
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">2. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">3. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">4. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">5. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geotools.html">6. GeoTools Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">7. GeoMesa Data Stores</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="attributes.html">7.1. GeoTools Feature Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html">7.2. JSON Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_overview.html">7.3. Index Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_basics.html">7.4. Index Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_basics.html#index-versioning">7.5. Index Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_ext.html">7.6. Additional Index Implementations</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_config.html">7.7. Index Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="runtime_config.html">7.8. Runtime Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_planning.html">7.9. Query Planning</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_planning.html#explaining-query-plans">7.10. Explaining Query Plans</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_interceptor.html">7.11. Query Interceptors and Guards</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_config.html">7.12. Query Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="filter_functions.html">7.13. Filter Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="analytic_queries.html">7.14. Analytic Querying</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">7.15. Data Security</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#writing-visibility-labels">7.15.1. Writing Visibility Labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reading-visibility-labels">7.15.2. Reading Visibility Labels</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auditing.html">7.16. Query Auditing</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html">7.17. Moving and Migrating Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="reserved_words.html">7.18. Reserved Words</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cli/index.html">8. Command-Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">9. GeoMesa Converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">10. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">11. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi/index.html">12. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">13. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">14. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">15. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">16. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">17. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../redis/index.html">18. Redis Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem/index.html">19. FileSystem Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../postgis/index.html">20. Partitioned PostGIS Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">21. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds_views.html">22. Combined Data Store Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade.html">23. Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GeoMesa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">User Manual</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">7. </span>GeoMesa Data Stores</a></li>
      <li class="breadcrumb-item active"><span class="section-number">7.15. </span>Data Security</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-security">
<span id="id1"></span><h1><span class="section-number">7.15. </span>Data Security<a class="headerlink" href="#data-security" title="Permalink to this headline">¶</a></h1>
<p>GeoMesa supports the concept of visibility labels on each piece of data, which can be used to govern which users
can see which records. Visibilities were originally part of Apache Accumulo, and were later adopted by Apache HBase.
GeoMesa supports visibilities across all provided data stores, using native methods where possible or implicit
filtering where not natively supported.</p>
<p>See the <a class="reference external" href="https://accumulo.apache.org/docs/2.x/security/authorizations">Apache Accumulo documentation</a> for
an overview of the concepts involved.</p>
<section id="writing-visibility-labels">
<h2><span class="section-number">7.15.1. </span>Writing Visibility Labels<a class="headerlink" href="#writing-visibility-labels" title="Permalink to this headline">¶</a></h2>
<p>Visibility labels are simple Boolean expressions based on a set of arbitrary tags. For example, you may define
two tags, <code class="docutils literal notranslate"><span class="pre">admin</span></code> and <code class="docutils literal notranslate"><span class="pre">user</span></code>. An expression could be <code class="docutils literal notranslate"><span class="pre">admin</span></code>, <code class="docutils literal notranslate"><span class="pre">user</span></code>, <code class="docutils literal notranslate"><span class="pre">admin&amp;user</span></code>, or <code class="docutils literal notranslate"><span class="pre">admin|user</span></code>,
depending on how you want to grant access to your data. For more complex expressions, parentheses can be used
for operation order.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="index_config.html#required-vis-config"><span class="std std-ref">Configuring Required Visibilities</span></a> to enforce visibility labels on all writes.</p>
</div>
<p>Visibility labels can be written in two different ways, either at the level of each feature, or at the level
of each attribute in a feature.</p>
<section id="feature-level-visibilities">
<h3><span class="section-number">7.15.1.1. </span>Feature Level Visibilities<a class="headerlink" href="#feature-level-visibilities" title="Permalink to this headline">¶</a></h3>
<p>Visibilities can be set on individual features using the simple feature user data:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.security.SecurityUtils</span><span class="p">;</span>

<span class="n">SecurityUtils</span><span class="p">.</span><span class="na">setFeatureVisibility</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;admin&amp;user&quot;</span><span class="p">)</span>
<span class="c1">// or, equivalently:</span>
<span class="n">feature</span><span class="p">.</span><span class="na">getUserData</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.feature.visibility&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;admin&amp;user&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="attribute-level-visibilities">
<h3><span class="section-number">7.15.1.2. </span>Attribute-Level Visibilities<a class="headerlink" href="#attribute-level-visibilities" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Attribute-level visibilities are currently only implemented for the Accumulo data store.</p>
</div>
<p>For more advanced use cases, visibilities can be set at the attribute level.
Attribute-level visibilities must be enabled when creating your simple feature type by setting
the appropriate user data value:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">sft</span><span class="p">.</span><span class="na">getUserData</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.visibility.level&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;attribute&quot;</span><span class="p">);</span>
<span class="n">dataStore</span><span class="p">.</span><span class="na">createSchema</span><span class="p">(</span><span class="n">sft</span><span class="p">);</span>
</pre></div>
</div>
<p>When writing each feature, the per-attribute visibilities must be set in a comma-delimited string in the user data.
Each attribute must have a corresponding value in the delimited string, otherwise an error will be thrown.</p>
<p>For example, if your feature type has four attributes:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.security.SecurityUtils</span><span class="p">;</span>

<span class="n">SecurityUtils</span><span class="p">.</span><span class="na">setFeatureVisibility</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;admin,user,admin,user&quot;</span><span class="p">)</span>
<span class="c1">// or, equivalently:</span>
<span class="n">feature</span><span class="p">.</span><span class="na">getUserData</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.feature.visibility&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;admin,user,admin,user&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="reading-visibility-labels">
<h2><span class="section-number">7.15.2. </span>Reading Visibility Labels<a class="headerlink" href="#reading-visibility-labels" title="Permalink to this headline">¶</a></h2>
<p>When reading back data, GeoMesa supports the concept of authorizations to determine who can see what.
Authorizations are a list of tags, corresponding to the visibility label tags being used. For example, a regular
user might have an authorization of <code class="docutils literal notranslate"><span class="pre">user</span></code>, while an admin user might have an authorization of <code class="docutils literal notranslate"><span class="pre">admin,user</span></code>.
Authorizations are simple string matches. They can be thought of as roles, although there is no hierarchy.</p>
<p>When running a query, GeoMesa supports a pluggable service provider interface for determining which authorizations
to use. Since different environments have different security architectures, there is no default implementation
available; users must provide their own service provider.</p>
<p>Providers must implement the following interface:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.security</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AuthorizationsProvider</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Gets the authorizations for the current context. This may change over time</span>
<span class="cm">     * (e.g. in a multi-user environment), so the result should not be cached.</span>
<span class="cm">     *</span>
<span class="cm">     * @return authorizations</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAuthorizations</span><span class="p">();</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configures this instance with parameters passed into the DataStoreFinder</span>
<span class="cm">     *</span>
<span class="cm">     * @param params parameters</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="o">?&gt;</span><span class="w"> </span><span class="n">params</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When a GeoMesa data store is instantiated, it will scan for available service providers
via Java SPI. Third-party implementations can be enabled by placing them on the classpath
and including a special service descriptor file. See the
<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html">Oracle Javadoc</a>
for details on implementing a service provider.</p>
<p>The GeoMesa data store will call <code class="docutils literal notranslate"><span class="pre">configure()</span></code> on the <code class="docutils literal notranslate"><span class="pre">AuthorizationsProvider</span></code>
implementation, passing in the parameter map from the call to <code class="docutils literal notranslate"><span class="pre">DataStoreFinder.getDataStore(Map</span> <span class="pre">params)</span></code>.
This allows the <code class="docutils literal notranslate"><span class="pre">AuthorizationsProvider</span></code> to configure itself based on the environment.</p>
<p>To ensure that the correct <code class="docutils literal notranslate"><span class="pre">AuthorizationsProvider</span></code> is used, GeoMesa will throw an exception if multiple
third-party service providers are found on the classpath. In this scenario, the particular service
provider class to use can be specified by the following system property:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// equivalent to &quot;geomesa.auth.provider.impl&quot;</span>
<span class="n">org</span><span class="p">.</span><span class="na">locationtech</span><span class="p">.</span><span class="na">geomesa</span><span class="p">.</span><span class="na">security</span><span class="p">.</span><span class="na">AuthorizationsProvider</span><span class="p">.</span><span class="na">AUTH_PROVIDER_SYS_PROPERTY</span>
</pre></div>
</div>
<p>For simple scenarios, the set of authorizations to apply to all queries can be specified when creating
the GeoMesa data store by using the <code class="docutils literal notranslate"><span class="pre">geomesa.security.auths</span></code> configuration parameter. This will use a
default <code class="docutils literal notranslate"><span class="pre">AuthorizationsProvider</span></code> implementation provided by GeoMesa.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// create a map containing initialization data for the GeoMesa data store</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="n">configuration</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.security.auths&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user,admin&quot;</span><span class="p">);</span>
<span class="n">DataStore</span><span class="w"> </span><span class="n">dataStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataStoreFinder</span><span class="p">.</span><span class="na">getDataStore</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For HBase and Accumulo, which support native visibilities, the authorizations of the underlying connection
will be used if nothing else is configured. This is convenient for testing, but is not a recommended approach
for a production system.</p>
<p>In addition, please note that the authorizations used in any scenario cannot exceed
the authorizations of the underlying Accumulo or HBase connection.</p>
</div>
<p>For examples on implementing an <code class="docutils literal notranslate"><span class="pre">AuthorizationsProvider</span></code> see the <a class="reference internal" href="../../tutorials/index.html#accumulo-tutorials-security"><span class="std std-ref">Security</span></a> tutorials.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="analytic_queries.html" class="btn btn-neutral float-left" title="7.14. Analytic Querying" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="auditing.html" class="btn btn-neutral float-right" title="7.16. Query Auditing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2024 <a href="https://www.ga-ccri.com/">General Atomics</a>
    <br/>
    Licensed under the <a href="https://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

<div role="contentinfo">
  <p>
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
    using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>
    - contribute to this page on
    <a href="https://github.com/locationtech/geomesa/edit/main/docs/user/datastores/security.rst">GitHub <img src="../../_static/launch.svg"/></a>
  </p>

</div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>