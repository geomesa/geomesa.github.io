

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11.9. GeoMesa Jobs &mdash; GeoMesa 2.3.1 Manuals</title>
  

  
  
  
  
    <link rel="canonical" href="https://www.geomesa.org/documentation/user/accumulo/jobs.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="11.10. GeoMesa Raster" href="raster.html" />
    <link rel="prev" title="11.8. Data Management" href="data_management.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                2.3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">2. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">3. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">4. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">5. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastores/index.html">6. GeoMesa Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/index.html">7. Command-Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">8. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">9. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">10. HBase Data Store</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">11. Accumulo Data Store</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="install.html">11.1. Installing GeoMesa Accumulo</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">11.2. Accumulo Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html">11.3. Using the Accumulo Data Store Programmatically</a></li>
<li class="toctree-l3"><a class="reference internal" href="geoserver.html">11.4. Using the Accumulo Data Store in GeoServer</a></li>
<li class="toctree-l3"><a class="reference internal" href="commandline.html">11.5. Accumulo Command-Line Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples.html">11.6. Command Line Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="visibilities.html">11.7. Accumulo Visibilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_management.html">11.8. Data Management</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">11.9. GeoMesa Jobs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-instructions">11.9.1. Building Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geomesa-input-and-output-formats">11.9.2. GeoMesa Input and Output Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#map-reduce-jobs">11.9.3. Map/Reduce Jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="raster.html">11.10. GeoMesa Raster</a></li>
<li class="toctree-l3"><a class="reference internal" href="internals.html">11.11. Internals</a></li>
<li class="toctree-l3"><a class="reference internal" href="kerberos.html">11.12. Kerberos</a></li>
<li class="toctree-l3"><a class="reference internal" href="ageoff.html">11.13. Age-Off Iterators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../bigtable/index.html">12. Bigtable Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">13. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">14. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../redis/index.html">15. Redis Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem/index.html">16. FileSystem Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kudu/index.html">17. Kudu Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">18. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../merged_view.html">19. Merged Data Store View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">20. GeoMesa Convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">21. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geojson.html">22. GeoMesa GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi.html">23. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blobstore.html">24. GeoMesa Blob Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_api.html">25. GeoMesa Native API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">26. GeoMesa Stream Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade.html">27. Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GeoMesa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User Manual</a> &raquo;</li>
        
          <li><a href="index.html">11. Accumulo Data Store</a> &raquo;</li>
        
      <li>11.9. GeoMesa Jobs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomesa-jobs">
<h1>11.9. GeoMesa Jobs<a class="headerlink" href="#geomesa-jobs" title="Permalink to this headline">¶</a></h1>
<p>This project (<code class="docutils literal notranslate"><span class="pre">geomesa-accumulo/geomesa-accumulo-jobs</span></code> in the source distribution) contains Map-Reduce
jobs for maintaining GeoMesa Accumulo.</p>
<div class="section" id="building-instructions">
<h2>11.9.1. Building Instructions<a class="headerlink" href="#building-instructions" title="Permalink to this headline">¶</a></h2>
<p>If you wish to build <code class="docutils literal notranslate"><span class="pre">geomesa-accumulo-jobs</span></code> separately, you can with Maven:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geomesa-accumulo$ mvn clean install -pl geomesa-accumulo-jobs
</pre></div>
</div>
</div>
<div class="section" id="geomesa-input-and-output-formats">
<h2>11.9.2. GeoMesa Input and Output Formats<a class="headerlink" href="#geomesa-input-and-output-formats" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa provides input and output formats that can be used in Hadoop
map/reduce jobs. The input/output formats can be used directly in Scala,
or there are Java interfaces under the <code class="docutils literal notranslate"><span class="pre">interop</span></code> package.</p>
<p>The input/output formats have two versions each, for compatibility with
the ‘old’ Hadoop api (under the <code class="docutils literal notranslate"><span class="pre">mapred</span></code> package) and the ‘new’ Hadoop
api (under the <code class="docutils literal notranslate"><span class="pre">mapreduce</span></code> package).</p>
<p>There are sample jobs provided that can be used as templates for more
complex operations. These are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">org</span><span class="o">.</span><span class="n">locationtech</span><span class="o">.</span><span class="n">geomesa</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">interop</span><span class="o">.</span><span class="n">mapred</span><span class="o">.</span><span class="n">FeatureCountJob</span>
<span class="n">org</span><span class="o">.</span><span class="n">locationtech</span><span class="o">.</span><span class="n">geomesa</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">interop</span><span class="o">.</span><span class="n">mapred</span><span class="o">.</span><span class="n">FeatureWriterJob</span>
<span class="n">org</span><span class="o">.</span><span class="n">locationtech</span><span class="o">.</span><span class="n">geomesa</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">interop</span><span class="o">.</span><span class="n">mapreduce</span><span class="o">.</span><span class="n">FeatureCountJob</span>
<span class="n">org</span><span class="o">.</span><span class="n">locationtech</span><span class="o">.</span><span class="n">geomesa</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">interop</span><span class="o">.</span><span class="n">mapreduce</span><span class="o">.</span><span class="n">FeatureWriterJob</span>
</pre></div>
</div>
<div class="section" id="geomesainputformat">
<h3>11.9.2.1. GeoMesaInputFormat<a class="headerlink" href="#geomesainputformat" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">GeoMesaInputFormat</span></code> can be used to get <code class="docutils literal notranslate"><span class="pre">SimpleFeature</span></code>s into
your jobs directly from GeoMesa.</p>
<p>Use the static <code class="docutils literal notranslate"><span class="pre">configure</span></code> method to set up your job. You need to
provide it with a map of connection parameters, which will be used to
retrieve the GeoTools DataStore. You also need to provide a feature type
name. Optionally, you can provide a CQL filter, which will be used to
select a subset of features in your store.</p>
<p>The key provided to your mapper with be a <code class="docutils literal notranslate"><span class="pre">Text</span></code> with the
<code class="docutils literal notranslate"><span class="pre">SimpleFeature</span></code> ID. The value will be the <code class="docutils literal notranslate"><span class="pre">SimpleFeature</span></code>.</p>
</div>
<div class="section" id="geomesaoutputformat">
<h3>11.9.2.2. GeoMesaOutputFormat<a class="headerlink" href="#geomesaoutputformat" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">GeoMesaOutputFormat</span></code> can be used to write <code class="docutils literal notranslate"><span class="pre">SimpleFeature</span></code>s
back into GeoMesa.</p>
<p>Use the static <code class="docutils literal notranslate"><span class="pre">configure</span></code> method to set up your job. You need to
provide it with a map of connection parameters, which will be used to
retrieve the GeoTools <code class="docutils literal notranslate"><span class="pre">DataStore</span></code>. Optionally, you can also configure
the BatchWriter configuration used to write data to Accumulo.</p>
<p>The key you output does not matter, and will be ignored. The value
should be a <code class="docutils literal notranslate"><span class="pre">SimpleFeature</span></code> that you wish to write. If the
<code class="docutils literal notranslate"><span class="pre">SimpleFeatureType</span></code> associated with the <code class="docutils literal notranslate"><span class="pre">SimpleFeature</span></code> does not yet
exist in GeoMesa, it will be created for you. You may write different
<code class="docutils literal notranslate"><span class="pre">SimpleFeatureType</span></code>s, but note that they will all share a common
catalog table.</p>
</div>
</div>
<div class="section" id="map-reduce-jobs">
<h2>11.9.3. Map/Reduce Jobs<a class="headerlink" href="#map-reduce-jobs" title="Permalink to this headline">¶</a></h2>
<p>To facilitate running jobs, you may wish to build a shaded JAR that
contains all the required dependencies. Ensure that the <code class="docutils literal notranslate"><span class="pre">pom.xml</span></code> references
the correct versions of Hadoop, Accumulo, etc. for your cluster, then
build the project using the <code class="docutils literal notranslate"><span class="pre">assemble</span></code> profile:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geomesa-accumulo$ mvn clean install -P assemble -pl geomesa-accumulo-jobs
</pre></div>
</div>
<p>The following instructions assume you have built a shaded JAR; if not
you will need to use the <code class="docutils literal notranslate"><span class="pre">-libjars</span></code> argument to ensure the correct JARs
are available on the distributed classpath.</p>
<div class="section" id="attribute-indexing">
<span id="attribute-indexing-job"></span><h3>11.9.3.1. Attribute Indexing<a class="headerlink" href="#attribute-indexing" title="Permalink to this headline">¶</a></h3>
<p>GeoMesa provides indexing on attributes to improve certain queries. You
can indicate attributes that should be indexed when you create your
schema (simple feature type). If you decide later on that you would like
to index additional attributes, you can use the attribute indexing job.
You only need to run this job once; the job will create attribute indices
for each attribute listed in <code class="docutils literal notranslate"><span class="pre">--geomesa.index.attributes</span></code>.</p>
<p>The job can be invoked through Yarn as follows (the JAR version may vary
slightly):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geomesa-accumulo$ yarn jar geomesa-accumulo-jobs/target/geomesa-accumulo-jobs_2.11-<span class="nv">$VERSION</span>-shaded.jar <span class="se">\</span>
    org.locationtech.geomesa.jobs.index.AttributeIndexJob <span class="se">\</span>
    --geomesa.input.instanceId &lt;instance&gt; <span class="se">\</span>
    --geomesa.input.zookeepers &lt;zookeepers&gt; <span class="se">\</span>
    --geomesa.input.user &lt;user&gt; <span class="se">\</span>
    --geomesa.input.password &lt;pwd&gt; <span class="se">\</span>
    --geomesa.input.tableName &lt;catalog-table&gt; <span class="se">\</span>
    --geomesa.input.feature &lt;feature&gt; <span class="se">\</span>
    --geomesa.index.coverage &lt;full<span class="p">|</span>join&gt; <span class="se">\ </span><span class="c1"># optional attribute</span>
    --geomesa.index.attributes &lt;attributes to index - space separated&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you did not build with the <code class="docutils literal notranslate"><span class="pre">assemble</span></code> profile, you will also need to
include an extensive <code class="docutils literal notranslate"><span class="pre">-libjars</span></code> argument with all dependent JARs.</p>
</div>
</div>
<div class="section" id="updating-existing-data-to-the-latest-index-format">
<span id="update-index-format-job"></span><h3>11.9.3.2. Updating Existing Data to the Latest Index Format<a class="headerlink" href="#updating-existing-data-to-the-latest-index-format" title="Permalink to this headline">¶</a></h3>
<p>The indexing in GeoMesa is constantly being improved. We strive to maintain
backwards compatibility, but old data can’t always take advantage of the
improvements we make. However, old data can be updated through the
<code class="docutils literal notranslate"><span class="pre">SchemaCopyJob</span></code>. This will copy it to a new table (or feature name),
rewriting all the data using the latest codebase. Once the data is
updated, you can drop the old tables and rename the new tables back to
the original names.</p>
<p>The job can be invoked through Yarn as follows (JAR version may vary
slightly):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geomesa-accumulo$ yarn jar geomesa-accumulo-jobs/target/geomesa-accumulo-jobs_2.11-<span class="nv">$VERSION</span>-shaded.jar <span class="se">\</span>
    org.locationtech.geomesa.jobs.index.SchemaCopyJob <span class="se">\</span>
    --geomesa.input.instanceId &lt;instance&gt; <span class="se">\</span>
    --geomesa.output.instanceId &lt;instance&gt; <span class="se">\</span>
    --geomesa.input.zookeepers &lt;zookeepers&gt; <span class="se">\</span>
    --geomesa.output.zookeepers &lt;zookeepers&gt; <span class="se">\</span>
    --geomesa.input.user &lt;user&gt; <span class="se">\</span>
    --geomesa.output.user &lt;user&gt; <span class="se">\</span>
    --geomesa.input.password &lt;pwd&gt; <span class="se">\</span>
    --geomesa.output.password &lt;pwd&gt; <span class="se">\</span>
    --geomesa.input.tableName &lt;catalog-table&gt; <span class="se">\</span>
    --geomesa.output.tableName &lt;new-catalog-table&gt; <span class="se">\</span>
    --geomesa.input.feature &lt;feature&gt; <span class="se">\</span>
    --geomesa.output.feature &lt;feature&gt; <span class="se">\</span>
    --geomesa.input.cql &lt;options cql filter <span class="k">for</span> input features&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you did not build with the <code class="docutils literal notranslate"><span class="pre">assemble</span></code> profile, you will also need to
include an extensive <code class="docutils literal notranslate"><span class="pre">-libjars</span></code> argument with all dependent JARs.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="raster.html" class="btn btn-neutral float-right" title="11.10. GeoMesa Raster" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="data_management.html" class="btn btn-neutral" title="11.8. Data Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2019 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

<div role="contentinfo">
  <p>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a>
    using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>
    
    - view <a href="../../_sources/user/accumulo/jobs.rst.txt" rel="nofollow">page source</a>
    
  </p>
</div>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 

<!-- analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-53087457-1', 'auto');
ga('send', 'pageview');
</script>




</body>
</html>