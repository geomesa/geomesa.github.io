

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.2. Index Configuration &mdash; GeoMesa 1.3.0 Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  

  

  
    <link rel="top" title="GeoMesa 1.3.0 Manuals" href="../../index.html"/>
        <link rel="up" title="6. GeoMesa Data Stores" href="index.html"/>
        <link rel="next" title="6.3. Runtime Configuration" href="runtime_config.html"/>
        <link rel="prev" title="6.1. GeoMesa Index Structure" href="index_structure.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">2. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">4. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">5. Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">6. GeoMesa Data Stores</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index_structure.html">6.1. GeoMesa Index Structure</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">6.2. Index Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-schema-options">6.2.1. Setting Schema Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-index-creation">6.2.2. Customizing Index Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-z-index-shards">6.2.3. Configuring Z-Index Shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-z-index-time-interval">6.2.4. Configuring Z-Index Time Interval</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-xz-index-precision">6.2.5. Configuring XZ-Index Precision</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mixed-geometry-types">6.2.6. Mixed Geometry Types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="runtime_config.html">6.3. Runtime Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="explaining.html">6.4. Explaining Query Plans</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_config.html">6.5. Query Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="logging.html">6.6. Logging Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="reserved_words.html">6.7. Reserved Words</a></li>
<li class="toctree-l3"><a class="reference internal" href="security.html">6.8. Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">7. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">8. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">9. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bigtable/index.html">10. Bigtable Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">11. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">12. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blobstore.html">13. GeoMesa Blob Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">14. GeoMesa Convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geojson.html">15. GeoMesa GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">16. GeoMesa Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_api.html">17. GeoMesa Native API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">18. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">19. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">20. GeoMesa Stream Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web_data.html">21. GeoMesa Web Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">User Manual</a> &raquo;</li>
      
          <li><a href="index.html">6. GeoMesa Data Stores</a> &raquo;</li>
      
    <li>6.2. Index Configuration</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/user/datastores/index_config.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="index-configuration">
<h1>6.2. Index Configuration<a class="headerlink" href="#index-configuration" title="Permalink to this headline">¶</a></h1>
<p>GeoMesa exposes a variety of configuration options that can be used to customize and optimize a given installation.</p>
<div class="section" id="setting-schema-options">
<span id="set-sft-options"></span><h2>6.2.1. Setting Schema Options<a class="headerlink" href="#setting-schema-options" title="Permalink to this headline">¶</a></h2>
<p>Static properties of a <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> must be set when calling <code class="docutils literal"><span class="pre">createSchema</span></code>, and can&#8217;t be changed
afterwards. Most properties are controlled through user-data values, either on the <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code>
or on a particular attribute. Setting the user data can be done in multiple ways.</p>
<p>If you are using a string to indicate your <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> (e.g. through the command line tools,
or when using <code class="docutils literal"><span class="pre">SimpleFeatureTypes.createType</span></code>), you can append the type-level options to the end of
the string, like so:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// append the user-data hints to the end of the string, separated by a semi-colon</span>
<span class="n">String</span> <span class="n">spec</span> <span class="o">=</span> <span class="s">&quot;name:String,dtg:Date,*geom:Point:srid=4326;option.one=&#39;foo&#39;,option.two=&#39;bar&#39;&quot;</span><span class="o">;</span>
<span class="n">SimpleFeatureType</span> <span class="n">sft</span> <span class="o">=</span> <span class="n">SimpleFeatureTypes</span><span class="o">.</span><span class="na">createType</span><span class="o">(</span><span class="s">&quot;mySft&quot;</span><span class="o">,</span> <span class="n">spec</span><span class="o">);</span>
</pre></div>
</div>
<p>If you have an existing simple feature type, or you are not using <code class="docutils literal"><span class="pre">SimpleFeatureTypes.createType</span></code>,
you may set the hints directly in the feature type:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// set the hint directly</span>
<span class="n">SimpleFeatureType</span> <span class="n">sft</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">sft</span><span class="o">.</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;option.one&quot;</span><span class="o">,</span> <span class="s">&quot;foo&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>If you are using TypeSafe configuration files to define your simple feature type, you may include
a &#8216;user-data&#8217; key:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">geomesa</span> <span class="p">{</span>
  <span class="nx">sfts</span> <span class="p">{</span>
    <span class="s2">&quot;mySft&quot;</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="nb">String</span>             <span class="p">}</span>
        <span class="p">{</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">dtg</span><span class="p">,</span>  <span class="nx">type</span> <span class="o">=</span> <span class="nb">Date</span>               <span class="p">}</span>
        <span class="p">{</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">geom</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">Point</span><span class="p">,</span> <span class="nx">srid</span> <span class="o">=</span> <span class="mi">4326</span> <span class="p">}</span>
      <span class="p">]</span>
      <span class="nx">user</span><span class="o">-</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">option</span><span class="p">.</span><span class="nx">one</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-index-creation">
<span id="id1"></span><h2>6.2.2. Customizing Index Creation<a class="headerlink" href="#customizing-index-creation" title="Permalink to this headline">¶</a></h2>
<p>To speed up ingestion, or because you are only using certain query patterns, you may disable some indices.
The indices are created when calling <code class="docutils literal"><span class="pre">createSchema</span></code>. If nothing is specified, the Z2/Z3 (or XZ2/XZ3
depending on geometry type) indices and record indices will all be created, as well as any attribute
indices you have defined.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Certain queries may be much slower if you disable an index.</p>
</div>
<p>To enable only certain indices, you may set a hint in your simple feature type. The hint key is
<code class="docutils literal"><span class="pre">geomesa.indexes.enabled</span></code>, and it should contain a comma-delimited list containing a subset of:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">z2</span></code> - corresponds to the Z2 index</li>
<li><code class="docutils literal"><span class="pre">z3</span></code> - corresponds to the Z3 index</li>
<li><code class="docutils literal"><span class="pre">records</span></code> - corresponds to the id/record index (for Accumulo data stores)</li>
<li><code class="docutils literal"><span class="pre">id</span></code> - corresponds to the id/record index (for non-Accumulo data stores)</li>
<li><code class="docutils literal"><span class="pre">attr</span></code> - corresponds to the attribute index</li>
</ul>
<p>You may set the hint using <a class="reference internal" href="#set-sft-options"><span class="std std-ref">Setting Schema Options</span></a>. If you are using the GeoMesa <code class="docutils literal"><span class="pre">SftBuilder</span></code>,
you may instead call the <code class="docutils literal"><span class="pre">withIndexes</span></code> methods:</p>
<div class="highlight-scala"><div class="highlight"><pre><span></span><span class="c1">// scala example</span>
<span class="k">import</span> <span class="nn">org.locationtech.geomesa.utils.geotools.SftBuilder.SftBuilder</span>

<span class="k">val</span> <span class="n">sft</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SftBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="n">stringType</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="n">date</span><span class="o">(</span><span class="s">&quot;dtg&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="n">geometry</span><span class="o">(</span><span class="s">&quot;geom&quot;</span><span class="o">,</span> <span class="n">default</span> <span class="k">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="n">withIndexes</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">&quot;records&quot;</span><span class="o">,</span> <span class="s">&quot;z3&quot;</span><span class="o">,</span> <span class="s">&quot;attr_idx&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">build</span><span class="o">(</span><span class="s">&quot;mySft&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-z-index-shards">
<span id="configuring-z-shards"></span><h2>6.2.3. Configuring Z-Index Shards<a class="headerlink" href="#configuring-z-index-shards" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa allows configuration of the number of shards (or splits) into which the Z2/Z3/XZ2/XZ3 indices are
divided. This parameter may be changed individually for each <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code>. If nothing is specified,
GeoMesa will default to 4 shards. The number of shards must be between 1 and 127.</p>
<p>Shards allow us to pre-split tables, which provides some initial parallelism for reads and writes. As more data is
written, tables will generally split based on size, thus obviating the need for explicit shards. For small data sets,
shards are more important as the tables might never split due to size. Setting the number of shards too high can
reduce performance, as it requires more calculations to be performed per query.</p>
<p>The number of shards is set when calling <code class="docutils literal"><span class="pre">createSchema</span></code>. It may be specified through the simple feature type
user data using the hint <code class="docutils literal"><span class="pre">geomesa.z.splits</span></code>. See <a class="reference internal" href="#set-sft-options"><span class="std std-ref">Setting Schema Options</span></a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">sft</span><span class="o">.</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;geomesa.z.splits&quot;</span><span class="o">,</span> <span class="s">&quot;4&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-z-index-time-interval">
<span id="customizing-z-index"></span><h2>6.2.4. Configuring Z-Index Time Interval<a class="headerlink" href="#configuring-z-index-time-interval" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa uses a z-curve index for time-based queries. By default, time is split into week-long chunks and indexed
per week. If your queries are typically much larger or smaller than one week, you may wish to partition at a
different interval. GeoMesa provides four intervals - <code class="docutils literal"><span class="pre">day</span></code>, <code class="docutils literal"><span class="pre">week</span></code>, <code class="docutils literal"><span class="pre">month</span></code> or <code class="docutils literal"><span class="pre">year</span></code>. As the interval
gets larger, fewer partitions must be examined for a query, but the precision of each interval will go down.</p>
<p>If you typically query months of data at a time, then indexing per month may provide better performance.
Alternatively, if you typically query minutes of data at a time, indexing per day may be faster. The default
per week partitioning tends to provides a good balance for most scenarios. Note that the optimal partitioning
depends on query patterns, not the distribution of data.</p>
<p>The time partitioning is set when calling <code class="docutils literal"><span class="pre">createSchema</span></code>. It may be specified through the simple feature type
user data using the hint <code class="docutils literal"><span class="pre">geomesa.z3.interval</span></code>.  See <a class="reference internal" href="#set-sft-options"><span class="std std-ref">Setting Schema Options</span></a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">sft</span><span class="o">.</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;geomesa.z3.interval&quot;</span><span class="o">,</span> <span class="s">&quot;month&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-xz-index-precision">
<span id="customizing-xz-index"></span><h2>6.2.5. Configuring XZ-Index Precision<a class="headerlink" href="#configuring-xz-index-precision" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa uses an extended z-curve index for storing geometries with extents. The index can be customized
by specifying the resolution level used to store geometries. By default, the resolution level is 12. If
you have very large geometries, you may want to lower this value. Conversely, if you have very small
geometries, you may want to raise it.</p>
<p>The resolution level for an index is set when calling <code class="docutils literal"><span class="pre">createSchema</span></code>. It may be specified through
the simple feature type user data using the hint <code class="docutils literal"><span class="pre">geomesa.xz.precision</span></code>.  See <a class="reference internal" href="#set-sft-options"><span class="std std-ref">Setting Schema Options</span></a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">sft</span><span class="o">.</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;geomesa.xz.precision&quot;</span><span class="o">,</span> <span class="mi">12</span><span class="o">);</span>
</pre></div>
</div>
<p>For more information on resolution level (g), see
&#8220;XZ-Ordering: A Space-Filling Curve for Objects with Spatial Extension&#8221; by Böhm, Klump and Kriegel.</p>
</div>
<div class="section" id="mixed-geometry-types">
<h2>6.2.6. Mixed Geometry Types<a class="headerlink" href="#mixed-geometry-types" title="Permalink to this headline">¶</a></h2>
<p>A common pitfall is to unnecessarily specify a generic geometry type when creating a schema.
Because GeoMesa relies on the geometry type for indexing decisions, this can negatively impact performance.</p>
<p>If the default geometry type is <code class="docutils literal"><span class="pre">Geometry</span></code> (i.e. supporting both point and non-point
features), you must explicitly enable &#8220;mixed&#8221; indexing mode. Any other geometry type (<code class="docutils literal"><span class="pre">Point</span></code>,
<code class="docutils literal"><span class="pre">LineString</span></code>, <code class="docutils literal"><span class="pre">Polygon</span></code>, etc) are not affected.</p>
<p>Mixed geometries must be declared when calling <code class="docutils literal"><span class="pre">createSchema</span></code>. It may be specified through
the simple feature type user data using the hint <code class="docutils literal"><span class="pre">geomesa.mixed.geometries</span></code>.  See <a class="reference internal" href="#set-sft-options"><span class="std std-ref">Setting Schema Options</span></a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">sft</span><span class="o">.</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;geomesa.mixed.geometries&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="runtime_config.html" class="btn btn-neutral float-right" title="6.3. Runtime Configuration" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index_structure.html" class="btn btn-neutral" title="6.1. GeoMesa Index Structure" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2016 Commonwealth Computer Research, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>