

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>24.2. GeoMesa FileSystem CommandLine Tools &mdash; GeoMesa 1.3.3 Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.7/segment.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.7/menu.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.css" type="text/css" />
  

  
    <link rel="top" title="GeoMesa 1.3.3 Manuals" href="../../index.html"/>
        <link rel="up" title="24. FileSystem Datastore (Amazon S3, HDFS Datastore)" href="index.html"/>
        <link rel="next" title="24.3. Partition Schemes" href="partition_schemes.html"/>
        <link rel="prev" title="24.1. FileSystem Datastore Architecture" href="architecture.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.3.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">2. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">4. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">5. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastores/index.html">6. GeoMesa Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">7. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">8. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bigtable/index.html">9. Bigtable Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">10. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">11. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">12. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">13. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blobstore.html">14. GeoMesa Blob Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">15. GeoMesa Convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geojson.html">16. GeoMesa GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">17. GeoMesa Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_api.html">18. GeoMesa Native API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi.html">19. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">20. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">21. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">22. GeoMesa Stream Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web_data.html">23. GeoMesa Web Data</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">24. FileSystem Datastore (Amazon S3, HDFS Datastore)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="architecture.html">24.1. FileSystem Datastore Architecture</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">24.2. GeoMesa FileSystem CommandLine Tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-from-source">24.2.1. Building from Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation">24.2.2. Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#command-overview">24.2.3. Command Overview</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="partition_schemes.html">24.3. Partition Schemes</a></li>
<li class="toctree-l3"><a class="reference internal" href="geoserver.html">24.4. Using the FileSystem Data Store in GeoServer</a></li>
<li class="toctree-l3"><a class="reference internal" href="sql.html">24.5. GeoMesa FileSystem Data Store with Spark SQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="example.html">24.6. FileSystem Datastore Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">User Manual</a> &raquo;</li>
      
          <li><a href="index.html">24. FileSystem Datastore (Amazon S3, HDFS Datastore)</a> &raquo;</li>
      
    <li>24.2. GeoMesa FileSystem CommandLine Tools</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/user/filesystem/commandline.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomesa-filesystem-commandline-tools">
<h1>24.2. GeoMesa FileSystem CommandLine Tools<a class="headerlink" href="#geomesa-filesystem-commandline-tools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="building-from-source">
<h2>24.2.1. Building from Source<a class="headerlink" href="#building-from-source" title="Permalink to this headline">¶</a></h2>
<p>To build from source make sure you have Maven, Git, and Java SDK 1.8 installed. To build just the GeoMesa FileSystem
distribution do this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone git@github.com:locationtech/geomesa.git
<span class="nb">cd</span> geomesa
build/mvn clean install -pl geomesa-fs/geomesa-fs-dist -am -T4
</pre></div>
</div>
<p>The tarball can also be downloaded from geomesa.org.</p>
</div>
<div class="section" id="installation">
<h2>24.2.2. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To install the command line tools simply untar the distribution tarball:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># If building from source</span>
tar xvf geomesa-fs/geomesa-fs-dist/target/geomesa-fs_2.11-<span class="nv">$VERSION</span>-dist.tar.gz
<span class="nb">export</span> <span class="nv">GEOMESA_FS_HOME</span><span class="o">=</span>/path/to/geomesa-fs_2.11-<span class="nv">$VERSION</span>
</pre></div>
</div>
<p>After untaring the archive you&#8217;ll need to either define the standard Hadoop environmental variables or install hadoop
using the <code class="docutils literal"><span class="pre">bin/install-hadoop.sh</span></code> script provided in the tarball. Note that you will need the proper Yarn/Hadoop
environment configured if you would like to run a distributed ingest job to create files.</p>
<p>If you are using a service such as Amazon Elastic MapReduce (EMR) or have a distribution of Apache Hadoop, Cloudera, or
Hortonworks installed you can likely run something like this to configure hadoop for the tools:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># These will be specific to your Hadoop environment</span>
. /etc/hadoop/conf/hadoop-env.sh
. /etc/hadoop/conf/yarn-env.sh
<span class="nb">export</span> <span class="nv">HADOOP_CONF_DIR</span><span class="o">=</span>/etc/hadoop/conf
</pre></div>
</div>
<p>After installing the tarball you should be able to run the <code class="docutils literal"><span class="pre">geomesa-fs</span></code> command like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$GEOMESA_FS_HOME</span>
$ bin/geomesa-fs
</pre></div>
</div>
<p>The output should look like this:</p>
</div>
<div class="section" id="command-overview">
<h2>24.2.3. Command Overview<a class="headerlink" href="#command-overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configure">
<h3>24.2.3.1. configure<a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h3>
<p>Used to configure the current environment for using the commandline tools. This is frequently run after the tools are
first installed to ensure the environment is configured correctly:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ geomesa-fs configure
</pre></div>
</div>
</div>
<div class="section" id="classpath">
<h3>24.2.3.2. classpath<a class="headerlink" href="#classpath" title="Permalink to this headline">¶</a></h3>
<p>Prints out the current classpath configuration:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ geomesa-fs classpath
</pre></div>
</div>
</div>
<div class="section" id="ingest">
<span id="fsds-ingest-command"></span><h3>24.2.3.3. ingest<a class="headerlink" href="#ingest" title="Permalink to this headline">¶</a></h3>
<p>Ingests files into a GeoMesa FS Datastore. Note that a &#8220;datastore&#8221; is simply a path in the filesystem. All data and
metadata will be stored in the filesystem under the hierarchy of the root path. Before ingesting data you will need
to define a SimpleFeatureType schema and a GeoMesa converter for your data. Many default type schemas and converters
for formats such as gdelt, twitter, etc. are provided in the conf directory of GeoMesa.</p>
<p>If you are not using one of these data types you can provide a file containing your schema and converter or configure
the GeoMesa tools to reference the schema configuration by name (see <a class="reference internal" href="partition_schemes.html#fsds-partition-schemes"><span class="std std-ref">Partition Schemes</span></a>). Schemas files
can also be stored in a remote filesystem such as HDFS, S3, GCS, or WASB.</p>
<p>Commonly used arguments for ingest are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-p</span></code> - Root path for storage (e.g. s3a://bucket/datastores/myds)</li>
<li><code class="docutils literal"><span class="pre">-e`</span></code> - Encoding to use for file storage (e.g. parquet)</li>
<li><code class="docutils literal"><span class="pre">--partition-scheme</span></code> - Common partition scheme name (e.g. daily,z2) or path to a file containing a scheme config</li>
<li><code class="docutils literal"><span class="pre">--temp-dir</span></code> - A temp dir in HDFS to use when doing S3 ingest (can speed up writes for parquet)</li>
<li><code class="docutils literal"><span class="pre">--num-reducers</span></code> - The number of reducers to use when performing distributed ingest (try to set to num-partitions / 2)</li>
<li><code class="docutils literal"><span class="pre">-C</span></code> - Path to a converter or named convert available in the environment</li>
<li><code class="docutils literal"><span class="pre">-s</span></code> - Path to a SimpleFeatureType config or named type available in the environment</li>
</ul>
<p>For example lets say we have all our data for 2016 stored in an S3 bucket:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">geomesa</span><span class="o">-</span><span class="n">fs</span> <span class="n">ingest</span> \
  <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;s3a://mybucket/datastores/test&#39;</span> \
  <span class="o">-</span><span class="n">e</span> <span class="n">parquet</span> \
  <span class="o">--</span><span class="n">partition</span><span class="o">-</span><span class="n">scheme</span> <span class="n">daily</span><span class="p">,</span><span class="n">z2</span><span class="o">-</span><span class="mi">2</span><span class="n">bits</span> \
  <span class="o">-</span><span class="n">s</span> <span class="n">s3a</span><span class="p">:</span><span class="o">//</span><span class="n">mybucket</span><span class="o">/</span><span class="n">schemas</span><span class="o">/</span><span class="n">my</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">conf</span> \
  <span class="o">-</span><span class="n">C</span> <span class="n">s3a</span><span class="p">:</span><span class="o">//</span><span class="n">mybucket</span><span class="o">/</span><span class="n">schemas</span><span class="o">/</span><span class="n">my</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">conf</span> \
  <span class="o">--</span><span class="n">temp</span><span class="o">-</span><span class="nb">dir</span> <span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="n">namenode</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">gm</span><span class="o">/</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">num</span><span class="o">-</span><span class="n">reducers</span> <span class="mi">20</span> \
  <span class="s1">&#39;s3a://mybucket/data/2016/*&#39;</span>
</pre></div>
</div>
<p>After ingest we expect to see a file structure with metadata and parquet files in S3 for our type named &#8220;myfeature&#8221;:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">aws</span> <span class="n">s3</span> <span class="n">ls</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">mybucket</span><span class="o">/</span><span class="n">datastores</span><span class="o">/</span><span class="n">test</span>

<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">sft</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="n">metadata</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
</pre></div>
</div>
<p>Two metadata files (<code class="docutils literal"><span class="pre">schema.sft</span></code> and <code class="docutils literal"><span class="pre">metadata</span></code>) store information about the schema, partition scheme, and list of
files that have been created. Note that the list of created files allows the datastore to quickly compute available
files to avoid possibly expensive directly listings against the filesystem. You may need to run update-metadata if you
decide to insert new files.</p>
<p>Notice that the bucket &#8220;directory structure&#8221; includes year, month, day and then a 0,1,2,3 representing a quadrant of the
Z2 Space Filling Curve with 2bit resolution (i.e. 0 = lower left, 1 = lower right, 2 = upper left, 3 = upper right).
Note that in our example January 1st and 2nd both do not have all four quadrants represented. This means that the input
dataset for that day didn&#8217;t have any data in that region of the world. If additional data were ingested, the directory
and a corresponding file would be created.</p>
</div>
<div class="section" id="update-metadata">
<h3>24.2.3.4. update-metadata<a class="headerlink" href="#update-metadata" title="Permalink to this headline">¶</a></h3>
<p>Recompute the list of partitions stored within the metadata file in a filesystem datastore. This metadata file
is used at query time in lieu of performing repeated directory listings.</p>
</div>
<div class="section" id="export">
<h3>24.2.3.5. export<a class="headerlink" href="#export" title="Permalink to this headline">¶</a></h3>
<p>Export GeoMesa features. Commonly used arguments to control export are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-a</span></code> - A comma-separated list of attributes and/or filter functions to export (e.g. geom,dtg,user_name)</li>
<li><code class="docutils literal"><span class="pre">-q`</span></code> - a GeoTools CQL query to select rows of data from the datastore</li>
<li><code class="docutils literal"><span class="pre">-F</span></code> - an output format (e.g. csv, tsv, avro)</li>
<li><code class="docutils literal"><span class="pre">--query-threads</span></code> - The number of threads to read files from the datastore</li>
<li><code class="docutils literal"><span class="pre">-m</span></code> - Maxiumum number of features to export</li>
</ul>
<p>Example export commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ geomesa-fs export  \
  -p &#39;s3a://mybucket/datastores/myds&#39; \
  -e parquet \
  -f test_feature

$ geomesa-fs \
  -p &#39;s3a://mybucket/datastores/myds&#39; \
  -e parquet \
  -f test_feature \
  -F TSV \
  -q &quot;dtg &gt;= &#39;2016-01-02&#39; and dtg &lt; &#39;2016-01-10&#39; and bbox(geom, -5, -5, 50, 50)&quot;
</pre></div>
</div>
</div>
<div class="section" id="version">
<h3>24.2.3.6. version<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h3>
<p>Prints out the version, git branch, and commit ID that the tools were built with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ geomesa-fs version
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="partition_schemes.html" class="btn btn-neutral float-right" title="24.3. Partition Schemes" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="architecture.html" class="btn btn-neutral" title="24.1. FileSystem Datastore Architecture" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2017 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.3.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../_static/sphinx_tabs/tabs.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>