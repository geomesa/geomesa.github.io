

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GeoMesa Authorizations &mdash; GeoMesa 1.3.5 Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme_custom.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="GeoMesa 1.3.5 Manuals" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="Feature Level Visibility and Security" href="geomesa-examples-featurelevelvis.html"/>
        <link rel="prev" title="Web Processing Services (WPS) Tube Select" href="geomesa-tubeselect.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.3.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-in-out">Data In/Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-analysis">Data Analysis</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#security">Security</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">GeoMesa Authorizations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#visibilities-and-authorizations">Visibilities and Authorizations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visibilities-in-geomesa">Visibilities in GeoMesa</a></li>
<li class="toctree-l4"><a class="reference internal" href="#authorizations-in-geomesa">Authorizations in GeoMesa</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ingest-gdelt-data-with-visibilities">Ingest GDELT Data with Visibilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#download-and-build-the-tutorial">Download and Build the Tutorial</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-tutorial">Run the Tutorial</a></li>
<li class="toctree-l4"><a class="reference internal" href="#insight-into-how-the-authorizations-tutorial-works">Insight into How the Authorizations Tutorial Works</a></li>
<li class="toctree-l4"><a class="reference internal" href="#applying-authorizations-and-visibilities-to-geoserver-using-pkis-and-ldap">Applying Authorizations and Visibilities to GeoServer Using PKIS and LDAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#querying-geoserver-through-a-web-feature-service-wfs-with-a-java-client">Querying GeoServer through a Web Feature Service (WFS) with a Java Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="#insight-into-how-the-geoserverauthorizations-tutorial-works">Insight into How the GeoServerAuthorizations Tutorial Works</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-examples-featurelevelvis.html">Feature Level Visibility and Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indexing-and-queries">Indexing and Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#about-tutorial-versions">About Tutorial Versions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Tutorials</a> &raquo;</li>
      
    <li>GeoMesa Authorizations</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorials/geomesa-examples-authorizations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomesa-authorizations">
<h1>GeoMesa Authorizations<a class="headerlink" href="#geomesa-authorizations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="visibilities-and-authorizations">
<h2>Visibilities and Authorizations<a class="headerlink" href="#visibilities-and-authorizations" title="Permalink to this headline">¶</a></h2>
<p>One of the most powerful features of Accumulo is the implementation of
cell-level security, using <strong>visibilities</strong> and <strong>authorizations</strong>. Data
that is protected by visibilities can only be seen by users that have
the corresponding authorizations. This allows for the fine-grained
protection of data, based on arbitrary labels.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Authorizations are distinct from table-level
permissions, and operate at a much finer grain.</p>
</div>
<p>If you are not familiar with Accumulo authorizations, you should review
the relevant Accumulo
<a class="reference external" href="http://accumulo.apache.org/1.7/accumulo_user_manual.html#_security">documentation</a>,
with more examples
<a class="reference external" href="http://accumulo.apache.org/1.7/examples/visibility.html">here</a>.</p>
<div class="section" id="public-key-infrastructure-pki">
<h3>Public Key Infrastructure (PKI)<a class="headerlink" href="#public-key-infrastructure-pki" title="Permalink to this headline">¶</a></h3>
<p>Public key infrastructure can be used to securely authenticate end
users. In PKI, a <strong>*certificate authority*</strong> (CA) will issue digital
certificates that verify that a particular public key belongs to a
particular individual. Other users can then trust that certificate
because it has been digitally signed by the CA.</p>
<p>In this tutorial, the keys used are not provided by trusted CAs. As
such, it is necessary to import the CA’s certificate into the Java
keystore, which allows Java (and by extension Tomcat) to trust any keys
verified by the CA.</p>
<p>PKI solves the issue of <strong>*authentication*</strong> (<em>who</em> a user is) but not
<strong>*authorization*</strong> (<em>what</em> a user can do). For this tutorial,
authorization is provided by an LDAP server.</p>
</div>
<div class="section" id="this-tutorial-will-show-you-how-to">
<h3>This tutorial will show you how to:<a class="headerlink" href="#this-tutorial-will-show-you-how-to" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Set visibilities on your data during ingestion through GeoMesa</li>
<li>Apply authorizations to your queries through GeoMesa</li>
<li>Implement user authorizations through the GeoMesa GeoServer plugin,
using PKI certs to authenticate with GeoServer and LDAP to store
authorizations</li>
<li>Query GeoServer over WFS with a Java client using PKI certs for
authentication</li>
</ol>
</div>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before you begin, you must have the following:</p>
<ul class="simple">
<li>an instance of Accumulo 1.7 or 1.8 running on Hadoop 2.2 or better,</li>
<li>an Accumulo user that has appropriate permissions to query your data,</li>
<li><a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java JDK
8</a></li>
<li><a class="reference external" href="http://maven.apache.org/">Apache Maven</a> 3.2.2 or better, and</li>
<li>a <a class="reference external" href="http://git-scm.com/">git</a> client.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ensure that the version of Accumulo, Hadoop, etc in
the root <code class="docutils literal"><span class="pre">pom.xml</span></code> match your environment.</p>
</div>
</div>
<div class="section" id="visibilities-in-geomesa">
<h2>Visibilities in GeoMesa<a class="headerlink" href="#visibilities-in-geomesa" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa supports applying a single set of visibilities to all data in a
<code class="docutils literal"><span class="pre">DataStore</span></code>. When configuring a <code class="docutils literal"><span class="pre">DataStore</span></code>, the visibilities can be
set with the <code class="docutils literal"><span class="pre">visibilities</span></code> parameter:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// create a map containing initialization data for the GeoMesa data store</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
<span class="n">configuration</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;visibilities&quot;</span><span class="o">,</span> <span class="s">&quot;user&amp;admin&quot;</span><span class="o">);</span>
<span class="n">DataStore</span> <span class="n">dataStore</span> <span class="o">=</span> <span class="n">DataStoreFinder</span><span class="o">.</span><span class="na">getDataStore</span><span class="o">(</span><span class="n">configuration</span><span class="o">);</span>
</pre></div>
</div>
<p>Any data written by this <code class="docutils literal"><span class="pre">DataStore</span></code> will have the visibilities
“user&amp;admin” applied.</p>
<p>Alternatively, GeoMesa also supports feature-level visibilities. This
can be set through user data in a simple feature:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.locationtech.geomesa.security.SecurityUtils</span><span class="o">;</span>
<span class="o">...</span>
<span class="n">SimpleFeature</span> <span class="n">sf</span> <span class="o">=</span> <span class="o">...</span>
<span class="c1">// set user data directly</span>
<span class="n">sf</span><span class="o">.</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="n">SecurityUtils</span><span class="o">.</span><span class="na">FEATURE_VISIBILITY</span><span class="o">,</span> <span class="s">&quot;user&amp;admin&quot;</span><span class="o">);</span>
<span class="c1">// alternatively, use static utility methods</span>
<span class="n">SecurityUtils</span><span class="o">.</span><span class="na">setFeatureVisibilities</span><span class="o">(</span><span class="n">sf</span><span class="o">,</span> <span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;admin&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>This tutorial uses DataStore level visibilities.</p>
</div>
<div class="section" id="authorizations-in-geomesa">
<h2>Authorizations in GeoMesa<a class="headerlink" href="#authorizations-in-geomesa" title="Permalink to this headline">¶</a></h2>
<p>When performing a query, GeoMesa delegates the retrieval of
authorizations to <strong>*service providers*</strong> that implement the following
interface:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">org.locationtech.geomesa.security</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorizationsProvider</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">AUTH_PROVIDER_SYS_PROPERTY</span> <span class="o">=</span> <span class="s">&quot;geomesa.auth.provider.impl&quot;</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Gets the authorizations for the current context. This may change over time</span>
<span class="cm">     * (e.g. in a multi-user environment), so the result should not be cached.</span>
<span class="cm">     *</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAuthorizations</span><span class="o">();</span>

    <span class="cm">/**</span>
<span class="cm">     * Configures this instance with parameters passed into the DataStoreFinder</span>
<span class="cm">     *</span>
<span class="cm">     * @param params</span>
<span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Serializable</span><span class="o">&gt;</span> <span class="n">params</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>When a GeoMesa <code class="docutils literal"><span class="pre">DataStore</span></code> is instantiated, it will scan for available
service providers. Third-party implementations can be enabled by placing
them on the classpath and including a special service descriptor file.
See the Oracle
<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html">Javadoc</a>
for details on implementing a service provider.</p>
<p>The GeoMesa <code class="docutils literal"><span class="pre">DataStore</span></code> will call <code class="docutils literal"><span class="pre">configure()</span></code> on the
<code class="docutils literal"><span class="pre">AuthorizationsProvider</span></code> implementation, passing in the parameter map
from the call to <code class="docutils literal"><span class="pre">DataStoreFinder.getDataStore(Map</span> <span class="pre">params)</span></code>. This
allows the <code class="docutils literal"><span class="pre">AuthorizationsProvider</span></code> to configure itself based on the
environment.</p>
<p>To ensure that the correct <code class="docutils literal"><span class="pre">AuthorizationsProvider</span></code> is used, GeoMesa
will throw an exception if multiple third-party service providers are
found on the classpath. In this scenario, the particular service
provider class to use can be specified by the following system property:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">geomesa</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">AuthorizationsProvider</span><span class="o">.</span><span class="na">AUTH_PROVIDER_SYS_PROPERTY</span> <span class="o">=</span> <span class="s">&quot;geomesa.auth.provider.impl&quot;</span><span class="o">;</span>
</pre></div>
</div>
<p>For simple scenarios, the set of authorizations to apply to all queries
can be specified when creating the GeoMesa <code class="docutils literal"><span class="pre">DataStore</span></code> by using the
<code class="docutils literal"><span class="pre">auths</span></code> configuration parameter. This will use the
<code class="docutils literal"><span class="pre">DefaultAuthorizationsProvider</span></code> implementation provided by GeoMesa.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// create a map containing initialization data for the GeoMesa data store</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
<span class="n">configuration</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;auths&quot;</span><span class="o">,</span> <span class="s">&quot;user,admin&quot;</span><span class="o">);</span>
<span class="n">DataStore</span> <span class="n">dataStore</span> <span class="o">=</span> <span class="n">DataStoreFinder</span><span class="o">.</span><span class="na">getDataStore</span><span class="o">(</span><span class="n">configuration</span><span class="o">);</span>
</pre></div>
</div>
<p>If there are no <code class="docutils literal"><span class="pre">AuthorizationsProvider</span></code>s found on the classpath,
and the <code class="docutils literal"><span class="pre">auths</span></code> parameter is not set, GeoMesa will default to using
the authorizations associated with the underlying Accumulo connection
(i.e. the <code class="docutils literal"><span class="pre">user</span></code> configuration value).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is not a recommended approach for a production
system.</p>
</div>
<p>In addition, please note that the authorizations used in any scenario
cannot exceed the authorizations of the underlying Accumulo connection.</p>
</div>
<div class="section" id="ingest-gdelt-data-with-visibilities">
<h2>Ingest GDELT Data with Visibilities<a class="headerlink" href="#ingest-gdelt-data-with-visibilities" title="Permalink to this headline">¶</a></h2>
<p>The rest of this tutorial will use the GDELT data set, described in the
<a class="reference internal" href="geomesa-examples-gdelt.html"><span class="doc">Map-Reduce Ingest of GDELT</span></a> tutorial. Even if you have
already ingested the GDELT data, you will need to ingest it again with
visibilities.</p>
<p>Follow the instructions in the <a class="reference internal" href="geomesa-examples-gdelt.html"><span class="doc">Map-Reduce Ingest of GDELT</span></a> tutorial, with the
following changes:</p>
<ul class="simple">
<li>When executing the map/reduce job, include the following parameter:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>-visibilities &lt;visibilities&gt;
</pre></div>
</div>
<p>You can also ingest data with visibilities using geomesa command line
tools by including the –visibilities option, specifically
<code class="docutils literal"><span class="pre">--visibilities</span> <span class="pre">user</span></code> in this example.</p>
<p>The visibility string can be anything valid for your Accumulo instance.
For the rest of this exercise, we are going to assume the visibility
string is <code class="docutils literal"><span class="pre">user</span></code>, and the Accumulo table is <code class="docutils literal"><span class="pre">gdelt_auths</span></code>. You can
see the visibilities that are currently enabled for your user through
the Accumulo shell:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ accumulo shell -u &lt;username&gt; -p &lt;password&gt;

Shell - Apache Accumulo Interactive Shell
-
- version: <span class="m">1</span>.5.4
- instance name: mycloud
- instance id: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
-
- <span class="nb">type</span> <span class="s1">&#39;help&#39;</span> <span class="k">for</span> a list of available commands
-
myuser@mycloud&gt; getauths
user,admin
</pre></div>
</div>
<p>If your user does not already have authorizations, you can add them
through the Accumulo shell with the <code class="docutils literal"><span class="pre">addauths</span></code> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>myuser@mycloud&gt; getauths
user
myuser@mycloud&gt; addauths -s admin -u myuser
myuser@mycloud&gt; getauths
user,admin
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A user cannot set authorizations unless the user has
the System.ALTER_USER permission.</p>
</div>
<p>Next we’ll grant permissions to read the appropriate tables to <code class="docutils literal"><span class="pre">user</span></code>
and <code class="docutils literal"><span class="pre">admin</span></code>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt; grant -u user -p &lt;table&gt;.* Table.READ
&gt; grant -u admin -p &lt;table&gt;.* Table.READ
</pre></div>
</div>
<p>Once the GDELT data is ingested, you should see a visibility label in
square brackets when you scan the spatio-temporal index table through
the Accumulo shell:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>myuser@mycloud&gt; scan -t gdelt_auths_records
<span class="se">\x</span><span class="m">0100700230</span>-fdfe-422e-b4d1-8072db6f3dda SFT: <span class="o">[</span>user<span class="o">]</span>    <span class="se">\x</span><span class="m">02</span><span class="se">\x</span><span class="m">00</span><span class="se">\x</span><span class="m">00</span><span class="se">\x</span>01b00700230...
</pre></div>
</div>
</div>
<div class="section" id="download-and-build-the-tutorial">
<h2>Download and Build the Tutorial<a class="headerlink" href="#download-and-build-the-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Pick a reasonable directory on your machine, and run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone https://github.com/geomesa/geomesa-tutorials.git
$ <span class="nb">cd</span> geomesa-tutorials
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may need to download a particular release of the tutorials project
to target a particular GeoMesa release. See <a class="reference internal" href="index.html#tutorial-versions"><span class="std std-ref">About Tutorial Versions</span></a>.</p>
</div>
<p>Cloning the repository should only take a few seconds. To build it, run</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mvn clean install -pl geomesa-examples-authorizations
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ensure that the version of Accumulo, Hadoop, etc in
the root <code class="docutils literal"><span class="pre">pom.xml</span></code> match your environment.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Depending on the version, you may also need to build
GeoMesa locally. Instructions can be found
in <a class="reference internal" href="../developer/index.html"><span class="doc">Developer Manual</span></a>.</p>
</div>
</div>
<div class="section" id="run-the-tutorial">
<h2>Run the Tutorial<a class="headerlink" href="#run-the-tutorial" title="Permalink to this headline">¶</a></h2>
<p>On the command-line, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ java -cp ./geomesa-examples-authorizations/target/geomesa-examples-authorizations-&lt;version&gt;.jar <span class="se">\</span>
    com.example.geomesa.authorizations.AuthorizationsTutorial <span class="se">\</span>
    -instanceId &lt;instance&gt;                                    <span class="se">\</span>
    -zookeepers &lt;zoos&gt;                                        <span class="se">\</span>
    -user &lt;user&gt;                                              <span class="se">\</span>
    -password &lt;pwd&gt;                                           <span class="se">\</span>
    -visibilities &lt;visibilities&gt;                              <span class="se">\</span>
    -tableName &lt;table&gt;                                        <span class="se">\</span>
    -featureName &lt;feature&gt;
</pre></div>
</div>
<p>where you provide the following arguments:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;instance&gt;</span></code> the name of your Accumulo instance</li>
<li><code class="docutils literal"><span class="pre">&lt;zoos&gt;</span></code> comma-separated list of your Zookeeper nodes, e.g.
<code class="docutils literal"><span class="pre">zoo1:2181,zoo2:2181,zoo3:2181</span></code></li>
<li><code class="docutils literal"><span class="pre">&lt;user&gt;</span></code> the name of an Accumulo user that will execute the scans,
e.g. <code class="docutils literal"><span class="pre">root</span></code></li>
<li><code class="docutils literal"><span class="pre">&lt;pwd&gt;</span></code> the password for the previously-mentioned Accumulo user</li>
<li><code class="docutils literal"><span class="pre">&lt;visibilities&gt;</span></code> the visibilities used to ingest the GDELT dataset,
e.g. <code class="docutils literal"><span class="pre">user</span></code></li>
<li><code class="docutils literal"><span class="pre">&lt;table&gt;</span></code> the name of the Accumulo table that has the GeoMesa GDELT
dataset, e.g. <code class="docutils literal"><span class="pre">gdelt_auths</span></code></li>
<li><code class="docutils literal"><span class="pre">&lt;feature&gt;</span></code> the feature name used to ingest the GeoMesa GDELT
dataset, e.g. <code class="docutils literal"><span class="pre">gdelt</span></code></li>
</ul>
<p>You should see two queries run and the results printed out to your
console. You should see output similar to the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Executing query with AUTHORIZED data store: auths are <span class="s1">&#39;user,admin&#39;</span>
Results:
<span class="m">1</span><span class="p">|</span><span class="nv">geom</span><span class="o">=</span>POINT <span class="o">(</span><span class="m">33</span>.9744 <span class="m">45</span>.2908<span class="o">)</span>
...

Executing query with UNAUTHORIZED data store: auths are <span class="s1">&#39;&#39;</span>
No results
</pre></div>
</div>
<p>The first query should return 1 or more results. The second query should
return 0 results, since they are hidden by visibilities.</p>
</div>
<div class="section" id="insight-into-how-the-authorizations-tutorial-works">
<h2>Insight into How the Authorizations Tutorial Works<a class="headerlink" href="#insight-into-how-the-authorizations-tutorial-works" title="Permalink to this headline">¶</a></h2>
<p>The code for querying with authorizations is available in the class
<a class="reference external" href="https://github.com/geomesa/geomesa-tutorials/blob/master/geomesa-examples-authorizations/src/main/java/com/example/geomesa/authorizations/AuthorizationsTutorial.java">AuthorizationsTutorial</a>. The interesting code for this tutorial is contained in the <code class="docutils literal"><span class="pre">main</span></code>
method:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// get an instance of the data store that uses the default authorizations provider, which</span>
<span class="c1">// will use whatever auths the connector has available</span>
<span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">AuthorizationsProvider</span><span class="o">.</span><span class="na">AUTH_PROVIDER_SYS_PROPERTY</span><span class="o">,</span>
    <span class="n">DefaultAuthorizationsProvider</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
<span class="n">DataStore</span> <span class="n">authDataStore</span> <span class="o">=</span> <span class="n">DataStoreFinder</span><span class="o">.</span><span class="na">getDataStore</span><span class="o">(</span><span class="n">dsConf</span><span class="o">);</span>

<span class="c1">// get another instance of the data store that uses our authorizations provider that</span>
<span class="c1">// always returns empty auths</span>
<span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">AuthorizationsProvider</span><span class="o">.</span><span class="na">AUTH_PROVIDER_SYS_PROPERTY</span><span class="o">,</span>
    <span class="n">EmptyAuthorizationsProvider</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
<span class="n">DataStore</span> <span class="n">noAuthDataStore</span> <span class="o">=</span> <span class="n">DataStoreFinder</span><span class="o">.</span><span class="na">getDataStore</span><span class="o">(</span><span class="n">dsConf</span><span class="o">);</span>
</pre></div>
</div>
<p>This code snippet shows how you can specify the
<code class="docutils literal"><span class="pre">AuthorizationProvider</span></code> to use with a system property. The
<code class="docutils literal"><span class="pre">DefaultAuthorizationsProvider</span></code> class is provided by GeoMesa, and used
when no other implementations are found.</p>
<p>The <code class="docutils literal"><span class="pre">com.example.geomesa.authorizations.EmptyAuthorizationsProvider</span></code>
class is included in the tutorial. The <code class="docutils literal"><span class="pre">EmptyAuthorizationsProvider</span></code>
will always return an empty <code class="docutils literal"><span class="pre">Authorizations</span></code> object, which means that
any data stored with visibilities will not be returned.</p>
<p>There is a more useful implementation of <code class="docutils literal"><span class="pre">AuthorizationsProvider</span></code> that
will be explored in more detail in the next section, the
<code class="docutils literal"><span class="pre">LdapAuthorizationsProvider</span></code>.</p>
</div>
<div class="section" id="applying-authorizations-and-visibilities-to-geoserver-using-pkis-and-ldap">
<span id="authorizations-gs-pki-ldap"></span><h2>Applying Authorizations and Visibilities to GeoServer Using PKIS and LDAP<a class="headerlink" href="#applying-authorizations-and-visibilities-to-geoserver-using-pkis-and-ldap" title="Permalink to this headline">¶</a></h2>
<p>This section will show you how to configure GeoServer to authenticate
users with PKIs, use LDAP to store authorizations, and apply
authorizations on a per-user/per-query basis.</p>
<p>Basic user authentication will take place via user certificates. Each
user will have their own public/private key pair that uniquely
identifies them.</p>
<p>User authorizations will come from LDAP. Once a user’s identity has been
verified via PKI, we will look up the user’s details in LDAP.</p>
<p>Once we have a user’s authentication and authorizations, we will apply
them to the GeoMesa query using a custom <code class="docutils literal"><span class="pre">AuthorizationsProvider</span></code>
implementation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is assumed for the rest of the tutorial that you have created
the GeoServer data stores and layers outlined in the <a class="reference internal" href="geomesa-examples-gdelt.html"><span class="doc">Map-Reduce Ingest of GDELT</span></a>
tutorial.</p>
</div>
<div class="section" id="run-geoserver-in-tomcat">
<h3>Run GeoServer in Tomcat<a class="headerlink" href="#run-geoserver-in-tomcat" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are already running GeoServer in Tomcat, you
can skip this step.</p>
</div>
<p>GeoServer ships by default with an embedded Jetty servlet. In order to
use PKI login, we need to install it in Tomcat instead.</p>
<ol class="arabic">
<li><p class="first">Download and install <a class="reference external" href="http://tomcat.apache.org/download-70.cgi">Tomcat
7</a>.</p>
</li>
<li><p class="first">Create an environment variable pointing to your tomcat installation
(you may want to add this to your bash init scripts):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">CATALINA_HOME</span><span class="o">=</span>/path/to/tomcat
</pre></div>
</div>
</li>
<li><p class="first">If you want to reuse your existing GeoServer configuration, create an
environment variable pointing to your GeoServer data directory (you
may want to add this to your shell initialization scripts):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">GEOSERVER_DATA_DIR</span><span class="o">=</span>/path/to/geoserver/data_dir
</pre></div>
</div>
</li>
<li><p class="first">Copy the GeoServer webapp from the GeoServer distribution into the
tomcat servlet:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cp -r /path/to/geoserver/webapps/geoserver/ <span class="nv">$CATALINA_HOME</span>/webapps/
</pre></div>
</div>
</li>
<li><p class="first">Increase the memory allocated to Tomcat, which you will need for
running complex queries in GeoServer (the values here may not be
applicable for every installation):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$CATALINA_HOME</span>/bin
$ <span class="nb">echo</span> <span class="s1">&#39;CATALINA_OPTS=&quot;-Xmx2g -XX:MaxPermSize=128m&quot;&#39;</span> &gt;&gt; setenv.sh
</pre></div>
</div>
</li>
<li><p class="first">Start Tomcat, either as a service or through the startup scripts, and
ensure that GeoServer is available at
<a class="reference external" href="http://localhost:8080/geoserver/web/">http://localhost:8080/geoserver/web/</a>.</p>
</li>
</ol>
</div>
<div class="section" id="create-the-accumulo-data-store-and-layer-in-geoserver">
<h3>Create the Accumulo Data Store and Layer in GeoServer<a class="headerlink" href="#create-the-accumulo-data-store-and-layer-in-geoserver" title="Permalink to this headline">¶</a></h3>
<p>If you haven’t already, create an AccumuloDataStore and associated Layer
pointing to the data with visibilities, as described in <a class="reference internal" href="geomesa-examples-gdelt.html"><span class="doc">Map-Reduce Ingest of GDELT</span></a>.</p>
<p>When configuring the DataStore, leave the <strong>auths</strong> field empty and
set the <strong>visibilities</strong> field to what you used when ingesting data
above.</p>
</div>
<div class="section" id="configure-geoserver-for-pki-login">
<h3>Configure GeoServer for PKI Login<a class="headerlink" href="#configure-geoserver-for-pki-login" title="Permalink to this headline">¶</a></h3>
<p>Follow the instructions located
<a class="reference external" href="http://docs.geoserver.org/2.9.1/user/security/tutorials/cert/index.html">here</a>
in order to enable PKI login to GeoServer.</p>
<p>In the step where you add the ‘cert’ filter to the ‘Filter Chains’, also
add it to the ‘rest’, ‘gwc’ and ‘default’ chains (in addition to web).</p>
<p>We will be using the ‘rod’ and ‘scott’ users, so be sure to install
those into your browser.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Make sure that you click the ‘Save’ button on all
GeoServer screens. Otherwise, your changes may be lost.</p>
</div>
<p>Verify that the changes were applied by re-starting Tomcat, and checking
that the ‘web’ filter chain has the ‘cert’ filter selected:</p>
<div class="figure" id="id1">
<img alt="Web Filter Panel" src="../_images/filter-chain-cert.jpg" />
<p class="caption"><span class="caption-text">Web Filter Panel</span></p>
</div>
</div>
<div class="section" id="install-an-ldap-server-for-storing-authorizations">
<h3>Install an LDAP Server for Storing Authorizations<a class="headerlink" href="#install-an-ldap-server-for-storing-authorizations" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are already have an LDAP server set up, you
can skip this step.</p>
</div>
<ol class="arabic simple">
<li>Download and install
<a class="reference external" href="http://directory.apache.org/apacheds/">ApacheDS</a></li>
<li>Either run as a service, or run through the start scripts:</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> apacheds-2.0.0-M20/bin
$ chmod <span class="m">755</span> *.sh
$ ./apacheds.sh
</pre></div>
</div>
</div>
<div class="section" id="configure-ldap-for-storing-authorizations">
<h3>Configure LDAP for Storing Authorizations<a class="headerlink" href="#configure-ldap-for-storing-authorizations" title="Permalink to this headline">¶</a></h3>
<p>We want to configure LDAP with a user to match the Spring Security PKIs
we are testing with. The end result we want is to create the following
user:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">DN</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">rod</span><span class="p">,</span><span class="n">ou</span><span class="o">=</span><span class="n">Spring</span> <span class="n">Security</span><span class="p">,</span><span class="n">o</span><span class="o">=</span><span class="n">Spring</span> <span class="n">Framework</span>
</pre></div>
</div>
<p>In order to do that, we will use Apache Directory Studio.</p>
<ol class="arabic simple">
<li>Download and run <a class="reference external" href="http://directory.apache.org/studio/">Apache Directory
Studio</a>.</li>
<li>Connect to the your LDAP instance (ApacheDS), using the instructions
<a class="reference external" href="http://directory.apache.org/apacheds/basic-ug/1.4.2-changing-admin-password.html">here</a>
(note: you do not need to change the password unless you want to).</li>
<li>Create a partition for our data:<ol class="arabic">
<li>Right-click the ‘ApacheDS (localhost)’ entry under the
‘Connection’ tab and select ‘Open Configuration’.</li>
<li>Click ‘Advanced Partitions Configuration…’.</li>
<li>Click ‘Add’.</li>
<li>Set the ID field to be ‘Spring Framework’.</li>
<li>Set the Suffix field to be ‘o=Spring Framework’.</li>
<li>Uncheck ‘Auto-generate context entry from suffix DN’.</li>
<li>Set the following attributes in Context Entry:<ul>
<li>objectclass: extensibleObject</li>
<li>objectclass: top</li>
<li>objectclass: domain</li>
<li>dc: Spring Framework2</li>
<li>o: Spring Framework2</li>
</ul>
</li>
<li>Hit <strong>Ctrl-s</strong> to save the partition. <img alt="ApacheDS Partition" src="../_images/apache-ds-partition.png" /></li>
</ol>
</li>
<li><strong>Restart ApacheDS.</strong> Otherwise the partition will not be available
and the LDIF import will fail.</li>
<li>Load the following LDIF file, which will create the Spring Security
OU and the ‘rod’ user:<ul>
<li><a class="reference download internal" href="../_downloads/spring-security-rod.ldif" download=""><code class="xref download docutils literal"><span class="pre">spring-security-rod.ldif</span></code></a></li>
<li>Right-click the ‘Root DSE’ node in the LDAP browser, and select
‘Import-&gt;LDIF import…’</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="test-ldap-connection-using-tutorial-code">
<h3>Test LDAP Connection Using Tutorial Code<a class="headerlink" href="#test-ldap-connection-using-tutorial-code" title="Permalink to this headline">¶</a></h3>
<p>The tutorial code includes an <code class="docutils literal"><span class="pre">AuthorizationsProvider</span></code> implementation
that will connect to LDAP to retrieve authorizations, in the class
<code class="docutils literal"><span class="pre">com.example.geomesa.authorizations.LdapAuthorizationsProvider</span></code>.</p>
<p>The provider will configure itself based on the
<code class="docutils literal"><span class="pre">geomesa-ldap.properties</span></code> file on the classpath (under
<code class="docutils literal"><span class="pre">src/main/resources</span></code>):</p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># ldap connection properties</span>
<span class="na">java.naming.factory.initial</span><span class="o">=</span><span class="s">com.sun.jndi.ldap.LdapCtxFactory</span>
<span class="na">java.naming.provider.url</span><span class="o">=</span><span class="s">ldap://localhost:10389</span>
<span class="na">java.naming.security.authentication</span><span class="o">=</span><span class="s">simple</span>
<span class="na">java.naming.security.principal</span><span class="o">=</span><span class="s">uid=admin,ou=system</span>
<span class="na">java.naming.security.credentials</span><span class="o">=</span><span class="s">secret</span>

<span class="c"># the ldap node to start the query from</span>
<span class="na">geomesa.ldap.search.root</span><span class="o">=</span><span class="s">o=Spring Framework</span>
<span class="c"># the query that will be applied to find the user&#39;s record</span>
<span class="c"># the &#39;{}&#39; will be replaced with the common name from the certificate the user has logged in with</span>
<span class="na">geomesa.ldap.search.filter</span><span class="o">=</span><span class="s">(&amp;(objectClass=person)(cn={}))</span>
<span class="c"># the ldap attribute that holds the comma-delimited authorizations for the user</span>
<span class="na">geomesa.ldap.auths.attribute</span><span class="o">=</span><span class="s">employeeType</span>
</pre></div>
</div>
<p>The default file included with the tutorial will connect to the LDAP
instance we set up in the previous steps. If you are using a different
LDAP configuration, you will need to modify the file appropriately.</p>
<p>The <code class="docutils literal"><span class="pre">LdapAuthorizationsProvider</span></code> will look for a particular LDAP
attribute that stores the user’s authorizations in a comma-delimited
list. For simplicity, in this tutorial we have re-purposed an existing
attribute, <code class="docutils literal"><span class="pre">employeeType</span></code>. The attribute to use can be modified
through the property file.</p>
<p>When we inserted the ‘rod’ record into LDAP, we set his <code class="docutils literal"><span class="pre">employeeType</span></code>
to ‘user,admin’, corresponding to our Accumulo authorizations. If you
are using different authorizations, you will need to update the
attribute to match.</p>
<p>The tutorial code includes a test case for connecting to LDAP, in the
class
<code class="docutils literal"><span class="pre">`com.example.geomesa.authorizations.LdapAuthorizationsProviderTest</span></code> &lt;<a class="reference external" href="https://github.com/geomesa/geomesa-tutorials/blob/master/geomesa-examples-authorizations/src/main/java/com/example/geomesa/authorizations/LdapAuthorizationsProviderTest.java">https://github.com/geomesa/geomesa-tutorials/blob/master/geomesa-examples-authorizations/src/main/java/com/example/geomesa/authorizations/LdapAuthorizationsProviderTest.java</a>&gt;`__.</p>
<p>Once you have modified <code class="docutils literal"><span class="pre">geomesa-ldap.properties</span></code> to connect to your
LDAP, you can test the connection by running this test class:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ java -cp ./geomesa-examples-authorizations/target/geomesa-examples-authorizations-&lt;version&gt;.jar <span class="se">\</span>
   com.example.geomesa.authorizations.LdapAuthorizationsProviderTest rod
</pre></div>
</div>
<p>The argument to the program (‘rod’) is the user to retrieve
authorizations for. You should get the following output:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Checking auths from LDAP <span class="k">for</span> user <span class="s1">&#39;rod&#39;</span>
Retrieved auths: user,admin
</pre></div>
</div>
</div>
<div class="section" id="installing-the-ldap-authorizationprovider-in-geoserver">
<h3>Installing the LDAP AuthorizationProvider in GeoServer<a class="headerlink" href="#installing-the-ldap-authorizationprovider-in-geoserver" title="Permalink to this headline">¶</a></h3>
<p>In order to use the <code class="docutils literal"><span class="pre">LdapAuthorizationsProvider</span></code>, we need to install
it as a service provider into GeoServer, where it will automatically be
picked up by GeoMesa.</p>
<p>The tutorial code includes a service provider registry in the
<code class="docutils literal"><span class="pre">META-INF/services</span></code> folder. By default, the provider class is
specified as the <code class="docutils literal"><span class="pre">EmptyAuthorizationsProvider</span></code>.</p>
<ol class="arabic">
<li><p class="first">Ensure that your LDAP configuration is correct by running
<code class="docutils literal"><span class="pre">LdapAuthorizationsProviderTest</span></code>, as described above.</p>
</li>
<li><p class="first">Change the provider class in the single line file
<code class="docutils literal"><span class="pre">src/main/resources/META-INF/services/org.locationtech.geomesa.security.AuthorizationsProvider</span></code>
to be
<code class="docutils literal"><span class="pre">com.example.geomesa.authorizations.LdapAuthorizationsProvider</span></code></p>
</li>
<li><p class="first">Rebuild the tutorial JAR and install the <strong>*unshaded original*</strong> jar
in GeoServer:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mvn clean install
$ cp ./geomesa-examples-authorizations/target/original-geomesa-examples-authorizations-&lt;version&gt;.jar <span class="se">\</span>
   /path/to/tomcat/webapps/geoserver/WEB-INF/lib/
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We want to use the unshaded jar since all the
required dependencies are already installed in GeoServer.</p>
</div>
<ol class="arabic simple" start="4">
<li>Restart GeoServer (or start it if it is not running).</li>
</ol>
<p>At this point you should have everything configured and in-place.</p>
</div>
<div class="section" id="verifying-the-ldap-authorizations-in-geoserver">
<h3>Verifying the LDAP Authorizations in GeoServer<a class="headerlink" href="#verifying-the-ldap-authorizations-in-geoserver" title="Permalink to this headline">¶</a></h3>
<p>In order to verify that the authorizations are working correctly,
execute a query against GeoMesa by calling the WMS provider over HTTPS
in your browser:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>https://localhost:8443/geoserver/wms?service<span class="o">=</span>WMS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span><span class="m">1</span>.1.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>GetMap<span class="p">&amp;</span><span class="nv">layers</span><span class="o">=</span>geomesa:gdelt_auths<span class="p">&amp;</span><span class="nv">styles</span><span class="o">=</span><span class="p">&amp;</span><span class="nv">bbox</span><span class="o">=</span><span class="m">31</span>.6,44,37.4,47.75<span class="p">&amp;</span><span class="nv">width</span><span class="o">=</span><span class="m">1200</span><span class="p">&amp;</span><span class="nv">height</span><span class="o">=</span><span class="m">600</span><span class="p">&amp;</span><span class="nv">srs</span><span class="o">=</span>EPSG:4326<span class="p">&amp;</span><span class="nv">format</span><span class="o">=</span>application/openlayers<span class="p">&amp;</span><span class="nv">TIME</span><span class="o">=</span><span class="m">2013</span>-01-01T00:00:00.000Z/2014-04-30T23:00:00.000Z
</pre></div>
</div>
<p>When prompted, select the ‘rod’ certificate.</p>
<p>You should see the normal data come back, with many red points
indicating the data:</p>
<div class="figure" id="id2">
<img alt="Authorized Results" src="../_images/Ukraine_Unfiltered.png" />
<p class="caption"><span class="caption-text">Authorized Results</span></p>
</div>
<p>Now try the same query, but use the ‘scott’ certificate. This time,
there should be no data returned, as the ‘scott’ user does not have any
authorizations set up in LDAP.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A simple way to use different certificates at once
is to open multiple ‘incognito’ or ‘private’ browser windows.</p>
</div>
</div>
</div>
<div class="section" id="querying-geoserver-through-a-web-feature-service-wfs-with-a-java-client">
<h2>Querying GeoServer through a Web Feature Service (WFS) with a Java Client<a class="headerlink" href="#querying-geoserver-through-a-web-feature-service-wfs-with-a-java-client" title="Permalink to this headline">¶</a></h2>
<p>GeoServer provides the ability to query data through a Web Feature
Service (WFS). Using GeoTools, we can create a client in Java through a
WFSDataStore. More details are available
<a class="reference external" href="http://docs.geotools.org/latest/userguide/library/data/wfs.html">here</a>
and
<a class="reference external" href="http://docs.geoserver.org/2.9.1/user/services/wfs/reference.html">here</a>,
although some of the documentation is out of date.</p>
<p>We can leverage the same PKI and LDAP setup that we used through the web
interface to authenticate our client.</p>
<p>Go back to the tutorial folder, and execute the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ java -cp geomesa-examples-authorizations/target/geomesa-examples-authorizations-&lt;version&gt;.jar <span class="se">\</span>
    -Djavax.net.ssl.keyStore<span class="o">=</span>/path/to/certs/rod.p12                    <span class="se">\</span>
    -Djavax.net.ssl.keyStorePassword<span class="o">=</span>password                          <span class="se">\</span>
    -Djavax.net.ssl.keyStoreType<span class="o">=</span>PKCS12                                <span class="se">\</span>
    -Djavax.net.ssl.trustStore<span class="o">=</span>/path/to/certs/server.jks               <span class="se">\</span>
    -Djavax.net.ssl.trustStorePassword<span class="o">=</span>password                        <span class="se">\</span>
    -Djavax.net.ssl.trustStoreType<span class="o">=</span>JKS                                 <span class="se">\</span>
    com.example.geomesa.authorizations.GeoServerAuthorizationsTutorial <span class="se">\</span>
    -geoserverUrl &lt;url&gt;                                                <span class="se">\</span>
    -featureStore &lt;featureStore&gt;
</pre></div>
</div>
<p>where you provide the following arguments:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;url&gt;</span></code> the <strong>HTTPS</strong> path to GeoServer, e.g.
<code class="docutils literal"><span class="pre">https://localhost:8443/geoserver/</span></code></li>
<li><code class="docutils literal"><span class="pre">&lt;featureStore&gt;</span></code> the name of the data store created in GeoServer,
including the workspace, e.g. <code class="docutils literal"><span class="pre">geomesa:gdelt</span></code></li>
<li><code class="docutils literal"><span class="pre">javax.net.ssl.*</span></code> SSL configuration system properties. Note that
these need to be before the class name, otherwise they will be
treated as arguments to the program.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ensure that the URL for GeoServer is using HTTPS.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The feature store needs to be namespaced with the
GeoServer workspace. The workspace and store name are separated with
a colon.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you happen to have two GeoServer data stores with
the same name but different workspaces, you will need to delete or
rename one of them. There is a bug in GeoServer where it might
return the wrong features if there are two data stores with the same
name.</p>
</div>
<p>The system properties will control the keystore that is used for
authentication. For the first command, we are using the <code class="docutils literal"><span class="pre">rod.p12</span></code>
certificate. Upon execution, you should see the following output:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Executing query against <span class="s1">&#39;https://localhost:8443/geoserver/wfs?request=GetCapabilities&amp;version=1.0.0&#39;</span> with client keystore <span class="s1">&#39;/path/to/certs/rod.p12&#39;</span>
INFO: Cached XML schema: https://localhost:8443/geoserver/wfs?service<span class="o">=</span>WFS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span><span class="m">1</span>.0.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>DescribeFeatureType<span class="p">&amp;</span><span class="nv">typeName</span><span class="o">=</span>geomesa%3Agdelt
Results:
<span class="m">1</span><span class="p">|</span><span class="nv">geom</span><span class="o">=</span>POINT <span class="o">(</span><span class="m">33</span>.9744 <span class="m">45</span>.2908<span class="o">)</span>
...
</pre></div>
</div>
<p>If you re-execute the command, but use the <code class="docutils literal"><span class="pre">scott.p12</span></code> cert instead,
you should get no results:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Executing query against <span class="s1">&#39;https://localhost:8443/geoserver/wfs?request=GetCapabilities&amp;version=1.0.0&#39;</span> with client keystore <span class="s1">&#39;/path/to/certs/scott.p12&#39;</span>
INFO: Cached XML schema: https://localhost:8443/geoserver/wfs?service<span class="o">=</span>WFS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span><span class="m">1</span>.0.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>DescribeFeatureType<span class="p">&amp;</span><span class="nv">typeName</span><span class="o">=</span>geomesa%3Agdelt
No results
</pre></div>
</div>
</div>
<div class="section" id="insight-into-how-the-geoserverauthorizations-tutorial-works">
<h2>Insight into How the GeoServerAuthorizations Tutorial Works<a class="headerlink" href="#insight-into-how-the-geoserverauthorizations-tutorial-works" title="Permalink to this headline">¶</a></h2>
<p>The code for querying through WFS is available in the class
<code class="docutils literal"><span class="pre">`com.example.geomesa.authorizations.GeoServerAuthorizationsTutorial</span></code> &lt;<a class="reference external" href="https://github.com/geomesa/geomesa-tutorials/blob/master/geomesa-examples-authorizations/src/main/java/com/example/geomesa/authorizations/GeoServerAuthorizationsTutorial.java">https://github.com/geomesa/geomesa-tutorials/blob/master/geomesa-examples-authorizations/src/main/java/com/example/geomesa/authorizations/GeoServerAuthorizationsTutorial.java</a>&gt;`__.
The interesting code for this tutorial is contained in the <code class="docutils literal"><span class="pre">main</span></code>
method:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// create the URL to GeoServer. Note that we need to point to the &#39;GetCapabilities&#39; request,</span>
<span class="c1">// and that we are using WFS version 1.0.0</span>
<span class="n">String</span> <span class="n">geoserverUrl</span> <span class="o">=</span> <span class="n">geoserverHost</span> <span class="o">+</span> <span class="s">&quot;wfs?request=GetCapabilities&amp;version=1.0.0&quot;</span><span class="o">;</span>

<span class="c1">// create the geotools configuration for a WFS data store</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
<span class="n">configuration</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">WFSDataStoreFactory</span><span class="o">.</span><span class="na">URL</span><span class="o">.</span><span class="na">key</span><span class="o">,</span> <span class="n">geoserverUrl</span><span class="o">);</span>
<span class="n">configuration</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">WFSDataStoreFactory</span><span class="o">.</span><span class="na">WFS_STRATEGY</span><span class="o">.</span><span class="na">key</span><span class="o">,</span> <span class="s">&quot;geoserver&quot;</span><span class="o">);</span>
<span class="n">configuration</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">WFSDataStoreFactory</span><span class="o">.</span><span class="na">TIMEOUT</span><span class="o">.</span><span class="na">key</span><span class="o">,</span> <span class="n">cmd</span><span class="o">.</span><span class="na">getOptionValue</span><span class="o">(</span><span class="n">SetupUtil</span><span class="o">.</span><span class="na">TIMEOUT</span><span class="o">,</span> <span class="s">&quot;99999&quot;</span><span class="o">));</span>
<span class="o">...</span>

<span class="c1">// verify we have gotten the correct datastore</span>
<span class="n">WFSDataStore</span> <span class="n">wfsDataStore</span> <span class="o">=</span> <span class="o">(</span><span class="n">WFSDataStore</span><span class="o">)</span> <span class="n">DataStoreFinder</span><span class="o">.</span><span class="na">getDataStore</span><span class="o">(</span><span class="n">configuration</span><span class="o">);</span>
</pre></div>
</div>
<p>This code snippet shows how you can get a GeoTools <code class="docutils literal"><span class="pre">DataStore</span></code> that
connects to GeoServer through WFS. Once you have obtained the data
store, you can query it just like any other data store, and the
implementation details will be transparent.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="geomesa-examples-featurelevelvis.html" class="btn btn-neutral float-right" title="Feature Level Visibility and Security" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="geomesa-tubeselect.html" class="btn btn-neutral" title="Web Processing Services (WPS) Tube Select" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2017 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>