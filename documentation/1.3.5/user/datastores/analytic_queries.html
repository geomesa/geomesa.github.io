

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.7. Analytic Querying &mdash; GeoMesa 1.3.5 Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.10/segment.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.10/menu.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="GeoMesa 1.3.5 Manuals" href="../../index.html"/>
        <link rel="up" title="6. GeoMesa Data Stores" href="index.html"/>
        <link rel="next" title="6.8. Logging Configuration" href="logging.html"/>
        <link rel="prev" title="6.6. Query Properties" href="query_config.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.3.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">2. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">4. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">5. Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">6. GeoMesa Data Stores</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index_overview.html">6.1. Index Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_basics.html">6.2. Index Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_config.html">6.3. Index Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="runtime_config.html">6.4. Runtime Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="explaining.html">6.5. Explaining Query Plans</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_config.html">6.6. Query Properties</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">6.7. Analytic Querying</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#feature-sampling">6.7.1. Feature Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#density-query">6.7.2. Density Query</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arrow-encoding">6.7.3. Arrow Encoding</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="logging.html">6.8. Logging Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="reserved_words.html">6.9. Reserved Words</a></li>
<li class="toctree-l3"><a class="reference internal" href="security.html">6.10. Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="authorizations.html">6.11. DataStore Authorizations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">7. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">8. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bigtable/index.html">9. Bigtable Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">10. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">11. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">12. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem/index.html">13. FileSystem Datastore (Amazon S3, HDFS Datastore)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">14. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blobstore.html">15. GeoMesa Blob Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">16. GeoMesa Convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geojson.html">17. GeoMesa GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">18. GeoMesa Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_api.html">19. GeoMesa Native API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi.html">20. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">21. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">22. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">23. GeoMesa Stream Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web_data.html">24. GeoMesa Web Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">User Manual</a> &raquo;</li>
      
          <li><a href="index.html">6. GeoMesa Data Stores</a> &raquo;</li>
      
    <li>6.7. Analytic Querying</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/user/datastores/analytic_queries.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="analytic-querying">
<h1>6.7. Analytic Querying<a class="headerlink" href="#analytic-querying" title="Permalink to this headline">¶</a></h1>
<p>GeoMesa provides advanced query capabilities through GeoTools query hints. You can use these hints to control
various aspects of query processing, or to trigger distributed analytic processing. See <a class="reference internal" href="query_config.html#query-hints"><span class="std std-ref">Setting Query Hints</span></a>
for details on setting query hints.</p>
<div class="section" id="feature-sampling">
<span id="analytic-queries"></span><h2>6.7.1. Feature Sampling<a class="headerlink" href="#feature-sampling" title="Permalink to this headline">¶</a></h2>
<p>Instead of returning all features for a query, GeoMesa can use statistical sampling to return a certain
percentage of results. This can be useful when rendering maps, or when there are too many features to
be meaningful.</p>
<p>Features can either be sampled absolutely, or sampled by a certain attribute. For example, given a series of
points in a track, you may wish to sample by the track identifier so that no tracks are completely sampled out.</p>
<p>The sampling value should be a float in the range (0, 1), which represents the fractional value of features that will
be returned. Due to distributed processing, the actual count returned is not guaranteed to equal the requested
percentage - however, there will never be less features than requested. For example, if you sample 5 features
at 10%, you will get back anywhere from 1 to 5 features, depending on how your data is distributed in the cluster.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="45%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Type</th>
<th class="head">GeoServer Conversion</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>QueryHints.SAMPLING</td>
<td>Float</td>
<td>any float</td>
</tr>
<tr class="row-odd"><td>QueryHints.SAMPLE_BY</td>
<td>String - attribute name (optional)</td>
<td>any string</td>
</tr>
</tbody>
</table>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-SmF2YQ== docutils container">
<div class="docutils container">
Java</div>
</div>
<div class="item sphinx-data-tab-U2NhbGE= docutils container">
<div class="docutils container">
Scala</div>
</div>
<div class="item sphinx-data-tab-R2VvU2VydmVy docutils container">
<div class="docutils container">
GeoServer</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SmF2YQ== active docutils container">
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.locationtech.geomesa.index.conf.QueryHints</span><span class="o">;</span>

 <span class="c1">// returns 10% of features, threaded by &#39;track&#39; attribute</span>
<span class="n">query</span><span class="o">.</span><span class="na">getHints</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="n">QueryHints</span><span class="o">.</span><span class="na">SAMPLING</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Float</span><span class="o">(</span><span class="mf">0.1</span><span class="o">));</span>
<span class="n">query</span><span class="o">.</span><span class="na">getHints</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="n">QueryHints</span><span class="o">.</span><span class="na">SAMPLE_BY</span><span class="o">(),</span> <span class="s">&quot;track&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U2NhbGE= docutils container">
<div class="highlight-scala"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.locationtech.geomesa.index.conf.QueryHints</span>

<span class="c1">// returns 10% of features, threaded by &#39;track&#39; attribute</span>
<span class="n">query</span><span class="o">.</span><span class="n">getHints</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="nc">QueryHints</span><span class="o">.</span><span class="nc">SAMPLING</span><span class="o">,</span> <span class="mf">0.1f</span><span class="o">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">getHints</span><span class="o">().</span><span class="n">put</span><span class="o">(</span><span class="nc">QueryHints</span><span class="o">.</span><span class="nc">SAMPLE_BY</span><span class="o">,</span> <span class="s">&quot;track&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-R2VvU2VydmVy docutils container">
<div class="highlight-none"><div class="highlight"><pre><span></span>...&amp;viewparams=SAMPLING:0.1
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="density-query">
<h2>6.7.2. Density Query<a class="headerlink" href="#density-query" title="Permalink to this headline">¶</a></h2>
<p>To populate heatmaps or other pre-rendered maps, GeoMesa can use server-side aggregation to map features to
pixels. This results in much less network traffic, and subsequently much faster queries.</p>
<p>The result from a density query is an encoded iterator of <code class="docutils literal"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">count)</span></code>, where <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code> refer to
the coordinates for the center of a pixel. In GeoServer, you can use the WPS DensityProcess to create a
heatmap from the query result. See <a class="reference internal" href="../../tutorials/geomesa-examples-gdelt.html#gdelt-heatmaps"><span class="std std-ref">Heatmaps</span></a> for more information.</p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="33%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Type</th>
<th class="head">GeoServer Conversion</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>QueryHints.DENSITY_BBOX</td>
<td><code class="docutils literal"><span class="pre">ReferencedEnvelope</span></code></td>
<td rowspan="4">Use WPS</td>
</tr>
<tr class="row-odd"><td>QueryHints.DENSITY_WEIGHT</td>
<td>String</td>
</tr>
<tr class="row-even"><td>QueryHints.DENSITY_WIDTH</td>
<td>Integer</td>
</tr>
<tr class="row-odd"><td>QueryHints.DENSITY_HEIGHT</td>
<td>Integer</td>
</tr>
</tbody>
</table>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U2NhbGE= docutils container">
<div class="docutils container">
Scala</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U2NhbGE= active docutils container">
<div class="highlight-scala"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.geotools.data.Transaction</span>
<span class="k">import</span> <span class="nn">org.geotools.geometry.jts.ReferencedEnvelope.ReferencedEnvelope</span>
<span class="k">import</span> <span class="nn">org.geotools.referencing.CRS</span>
<span class="k">import</span> <span class="nn">org.locationtech.geomesa.accumulo.iterators.KryoLazyDensityIterator</span>
<span class="k">import</span> <span class="nn">org.locationtech.geomesa.index.conf.QueryHints</span>

<span class="k">val</span> <span class="n">bounds</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ReferencedEnvelope</span><span class="o">(-</span><span class="mf">120.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">110.0</span><span class="o">,</span> <span class="mf">45.0</span><span class="o">,</span> <span class="mf">55.0</span><span class="o">,</span> <span class="nc">CRS</span><span class="o">.</span><span class="n">decode</span><span class="o">(</span><span class="s">&quot;EPSG:4326&quot;</span><span class="o">))</span>
<span class="n">query</span><span class="o">.</span><span class="n">getHints</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="nc">QueryHints</span><span class="o">.</span><span class="nc">DENSITY_BBOX</span><span class="o">,</span> <span class="n">bounds</span><span class="o">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">getHints</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="nc">QueryHints</span><span class="o">.</span><span class="nc">DENSITY_WIDTH</span><span class="o">,</span> <span class="mi">500</span><span class="o">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">getHints</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="nc">QueryHints</span><span class="o">.</span><span class="nc">DENSITY_HEIGHT</span><span class="o">,</span> <span class="mi">500</span><span class="o">)</span>

<span class="k">val</span> <span class="n">reader</span> <span class="k">=</span> <span class="n">dataStore</span><span class="o">.</span><span class="n">getFeatureReader</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="nc">Transaction</span><span class="o">.</span><span class="nc">AUTO_COMMIT</span><span class="o">)</span>

<span class="k">val</span> <span class="n">decode</span> <span class="k">=</span> <span class="nc">KryoLazyDensityIterator</span><span class="o">.</span><span class="n">decodeResult</span><span class="o">(</span><span class="n">bounds</span><span class="o">,</span> <span class="mi">500</span><span class="o">,</span> <span class="mi">500</span><span class="o">)</span>

<span class="k">while</span> <span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">pts</span> <span class="k">=</span> <span class="n">decode</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="o">())</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">pts</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">val</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">weight</span><span class="o">)</span> <span class="k">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">next</span><span class="o">()</span>
        <span class="c1">// do something with the cell</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="o">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="arrow-encoding">
<h2>6.7.3. Arrow Encoding<a class="headerlink" href="#arrow-encoding" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa supports returning features as <a class="reference external" href="https://arrow.apache.org/">Apache Arrow</a> encoded vectors. This provides
an optimized columnar memory layout for fast processing and interoperability with other systems.</p>
<p>The result of an Arrow query will be an iterator of SimpleFeatures, where the first attribute of each will be a
byte array. Concatenated together, the byte arrays will form an Arrow file, in the Arrow streaming format
(i.e. no footer).</p>
<p>In GeoServer you can use the <code class="docutils literal"><span class="pre">ArrowConversionProcess</span></code>. Otherwise, the encoding is controlled through the
following query hints:</p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="25%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Type</th>
<th class="head">GeoServer Conversion</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>QueryHints.ARROW_ENCODE</td>
<td>Boolean</td>
<td rowspan="10">Use WPS</td>
</tr>
<tr class="row-odd"><td>QueryHints.ARROW_INCLUDE_FID</td>
<td>Boolean (optional)</td>
</tr>
<tr class="row-even"><td>QueryHints.ARROW_SORT_FIELD</td>
<td>String (optional)</td>
</tr>
<tr class="row-odd"><td>QueryHints.ARROW_SORT_REVERSE</td>
<td>Boolean (optional)</td>
</tr>
<tr class="row-even"><td>QueryHints.ARROW_DICTIONARY_FIELDS</td>
<td>String  (optional)</td>
</tr>
<tr class="row-odd"><td>QueryHints.ARROW_DICTIONARY_VALUES</td>
<td>String  (optional)</td>
</tr>
<tr class="row-even"><td>QueryHints.ARROW_DICTIONARY_CACHED</td>
<td>Boolean (optional)</td>
</tr>
<tr class="row-odd"><td>QueryHints.ARROW_MULTI_FILE</td>
<td>Boolean (optional)</td>
</tr>
<tr class="row-even"><td>QueryHints.ARROW_DOUBLE_PASS</td>
<td>Boolean (optional)</td>
</tr>
<tr class="row-odd"><td>QueryHints.ARROW_BATCH_SIZE</td>
<td>Integer (optional)</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Arrow conversion requires <code class="docutils literal"><span class="pre">jackson-core-2.6.x</span></code>. Some versions of GeoServer ship with an older
version, <code class="docutils literal"><span class="pre">jackson-core-2.5.0.jar</span></code>. After installing the GeoMesa GeoServer plugin, be sure to delete
the older JAR from GeoServer’s <code class="docutils literal"><span class="pre">WEB-INF/lib</span></code> folder.</p>
</div>
<div class="section" id="explanation-of-hints">
<h3>6.7.3.1. Explanation of Hints<a class="headerlink" href="#explanation-of-hints" title="Permalink to this headline">¶</a></h3>
<div class="section" id="arrow-encode">
<h4>6.7.3.1.1. ARROW_ENCODE<a class="headerlink" href="#arrow-encode" title="Permalink to this headline">¶</a></h4>
<p>This hint is used to trigger an Arrow query.</p>
</div>
<div class="section" id="arrow-include-fid">
<h4>6.7.3.1.2. ARROW_INCLUDE_FID<a class="headerlink" href="#arrow-include-fid" title="Permalink to this headline">¶</a></h4>
<p>This hint controls whether to include the feature ID as an Arrow vector or not. The default is to include it.</p>
</div>
<div class="section" id="arrow-sort-field">
<h4>6.7.3.1.3. ARROW_SORT_FIELD<a class="headerlink" href="#arrow-sort-field" title="Permalink to this headline">¶</a></h4>
<p>This hint allows for sorting the results by a particular attribute. Only attribute names are supported, not
arbitrary CQL.</p>
</div>
<div class="section" id="arrow-sort-reverse">
<h4>6.7.3.1.4. ARROW_SORT_REVERSE<a class="headerlink" href="#arrow-sort-reverse" title="Permalink to this headline">¶</a></h4>
<p>This hint is used to flip sort order from normal (ascending) to reverse (descending).</p>
</div>
<div class="section" id="arrow-dictionary-fields">
<h4>6.7.3.1.5. ARROW_DICTIONARY_FIELDS<a class="headerlink" href="#arrow-dictionary-fields" title="Permalink to this headline">¶</a></h4>
<p>This hint indicates which simple feature attributes should be dictionary encoded. It should be a comma-separated
list of attribute names.</p>
</div>
<div class="section" id="arrow-dictionary-values">
<h4>6.7.3.1.6. ARROW_DICTIONARY_VALUES<a class="headerlink" href="#arrow-dictionary-values" title="Permalink to this headline">¶</a></h4>
<p>This hint indicates known dictionary values to use for encoding each field. This allows for specifying a known
dictionary up front, which means the dictionary doesn’t have to be computed. Values which are not indicated
in the dictionary will be grouped under ‘other’.</p>
<p>The hint should be an encoded map of attribute names to attribute values. The hint should be encoded in
comma-separated values format, where each line indicates a different attribute. The first item in each line is
the attribute name, and the subsequent items are dictionary values. Standard CSV escaping can be used. The function
<code class="docutils literal"><span class="pre">org.locationtech.geomesa.utils.text.StringSerialization.encodeSeqMap</span></code> can be used to encode a map of values.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U2NhbGE= docutils container">
<div class="docutils container">
Scala</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U2NhbGE= active docutils container">
<div class="highlight-scala"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.locationtech.geomesa.index.conf.QueryHints</span>
<span class="k">import</span> <span class="nn">org.locationtech.geomesa.utils.text.StringSerialization.encodeSeqMap</span>

<span class="k">val</span> <span class="n">dictionaries1</span> <span class="k">=</span>
    <span class="s">&quot;&quot;&quot;</span>
<span class="s">      |name,Harry,Hermione,Severus</span>
<span class="s">      |age,20,25,30</span>
<span class="s">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">stripMargin</span><span class="o">.</span><span class="n">trim</span>

<span class="c1">// equivalent to dictionaries1</span>
<span class="k">val</span> <span class="n">dictionaries2</span> <span class="k">=</span> <span class="n">encodSeqMap</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span><span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="nc">Array</span><span class="o">(</span><span class="s">&quot;Harry&quot;</span><span class="o">,</span> <span class="s">&quot;Hermione&quot;</span><span class="o">,</span> <span class="s">&quot;Severus&quot;</span><span class="o">),</span> <span class="s">&quot;age&quot;</span> <span class="o">-&gt;</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="mi">30</span><span class="o">)))</span>

<span class="n">query</span><span class="o">.</span><span class="n">getHints</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="nc">QueryHints</span><span class="o">.</span><span class="nc">ARROW_DICTIONARY_VALUES</span><span class="o">,</span> <span class="n">dictionaries1</span><span class="o">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="arrow-dictionary-cached">
<h4>6.7.3.1.7. ARROW_DICTIONARY_CACHED<a class="headerlink" href="#arrow-dictionary-cached" title="Permalink to this headline">¶</a></h4>
<p>This hint indicates that cached statistics (top-k) will be used for dictionaries, if available. Otherwise,
dictionaries will be computed based on the data returned, which may be slower.</p>
</div>
<div class="section" id="arrow-multi-file">
<h4>6.7.3.1.8. ARROW_MULTI_FILE<a class="headerlink" href="#arrow-multi-file" title="Permalink to this headline">¶</a></h4>
<p>This hint will cause multiple logical Arrow files to be returned, instead of a single file. This will generally
be faster, as no client-side merging needs to be done. However, any sorting will only be applied per file, not
globally. Also, the end result tends to be larger (in bytes), as metadata and dictionary values may be repeated
in different logical files.</p>
</div>
<div class="section" id="arrow-double-pass">
<h4>6.7.3.1.9. ARROW_DOUBLE_PASS<a class="headerlink" href="#arrow-double-pass" title="Permalink to this headline">¶</a></h4>
<p>This hint will cause any dictionaries to be computed first, through a separate scan. A second scan will
construct the Arrow files. This is the behavior of the initial GeoMesa Arrow implementation, and is only
included for back compatibility.</p>
</div>
<div class="section" id="arrow-batch-size">
<h4>6.7.3.1.10. ARROW_BATCH_SIZE<a class="headerlink" href="#arrow-batch-size" title="Permalink to this headline">¶</a></h4>
<p>This hint will restrict the number of features included in each Arrow record batch. An Arrow file contains
a series of record batches -limiting the max size of each batch can allow memory-constrained systems to
operate more easily.</p>
</div>
</div>
<div class="section" id="example-query">
<h3>6.7.3.2. Example Query<a class="headerlink" href="#example-query" title="Permalink to this headline">¶</a></h3>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U2NhbGE= docutils container">
<div class="docutils container">
Scala</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U2NhbGE= active docutils container">
<div class="highlight-scala"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.geotools.data.Transaction</span>
<span class="k">import</span> <span class="nn">org.geotools.geometry.jts.ReferencedEnvelope.ReferencedEnvelope</span>
<span class="k">import</span> <span class="nn">org.geotools.referencing.CRS</span>
<span class="k">import</span> <span class="nn">org.locationtech.geomesa.accumulo.iterators.KryoLazyDensityIterator</span>
<span class="k">import</span> <span class="nn">org.locationtech.geomesa.index.conf.QueryHints</span>

<span class="n">query</span><span class="o">.</span><span class="n">getHints</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="nc">QueryHints</span><span class="o">.</span><span class="nc">ARROW_ENCODE</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">Boolean</span><span class="o">.</span><span class="nc">TRUE</span><span class="o">)</span>

<span class="k">val</span> <span class="n">reader</span> <span class="k">=</span> <span class="n">dataStore</span><span class="o">.</span><span class="n">getFeatureReader</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="nc">Transaction</span><span class="o">.</span><span class="nc">AUTO_COMMIT</span><span class="o">)</span>
<span class="k">val</span> <span class="n">os</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">()</span>

<span class="k">while</span> <span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="o">().</span><span class="n">getAttribute</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]])</span>
<span class="o">}</span>
<span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="o">()</span>

<span class="c1">// use ArrowStreamReader or other Arrow libraries to process bytes</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="logging.html" class="btn btn-neutral float-right" title="6.8. Logging Configuration" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="query_config.html" class="btn btn-neutral" title="6.6. Query Properties" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2017 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.3.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_tabs/tabs.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>