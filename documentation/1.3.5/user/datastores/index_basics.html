

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.2. Index Basics &mdash; GeoMesa 1.3.5 Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="GeoMesa 1.3.5 Manuals" href="../../index.html"/>
        <link rel="up" title="6. GeoMesa Data Stores" href="index.html"/>
        <link rel="next" title="6.3. Index Configuration" href="index_config.html"/>
        <link rel="prev" title="6.1. Index Overview" href="index_overview.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.3.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">2. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">4. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">5. Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">6. GeoMesa Data Stores</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index_overview.html">6.1. Index Overview</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">6.2. Index Basics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#spatial-index-z2-xz2">6.2.1. Spatial Index (Z2/XZ2)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spatio-temporal-index-z3-xz3">6.2.2. Spatio-temporal Index (Z3/XZ3)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id-index">6.2.3. ID Index</a></li>
<li class="toctree-l4"><a class="reference internal" href="#attribute-index">6.2.4. Attribute Index</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index_config.html">6.3. Index Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="runtime_config.html">6.4. Runtime Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="explaining.html">6.5. Explaining Query Plans</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_config.html">6.6. Query Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="analytic_queries.html">6.7. Analytic Querying</a></li>
<li class="toctree-l3"><a class="reference internal" href="logging.html">6.8. Logging Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="reserved_words.html">6.9. Reserved Words</a></li>
<li class="toctree-l3"><a class="reference internal" href="security.html">6.10. Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="authorizations.html">6.11. DataStore Authorizations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">7. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">8. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bigtable/index.html">9. Bigtable Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">10. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">11. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">12. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem/index.html">13. FileSystem Datastore (Amazon S3, HDFS Datastore)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">14. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blobstore.html">15. GeoMesa Blob Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">16. GeoMesa Convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geojson.html">17. GeoMesa GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">18. GeoMesa Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_api.html">19. GeoMesa Native API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi.html">20. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">21. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">22. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">23. GeoMesa Stream Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web_data.html">24. GeoMesa Web Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">User Manual</a> &raquo;</li>
      
          <li><a href="index.html">6. GeoMesa Data Stores</a> &raquo;</li>
      
    <li>6.2. Index Basics</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/user/datastores/index_basics.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="index-basics">
<h1>6.2. Index Basics<a class="headerlink" href="#index-basics" title="Permalink to this headline">¶</a></h1>
<p>GeoMesa will create various indices for a given <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> schema (see <a class="reference internal" href="index_overview.html#index-overview"><span class="std std-ref">Index Overview</span></a>). This
allows us to answer a variety of queries in a optimized manner. GeoMesa will make a best effort to determine
the attributes used for indexing. The attributes to use can also be specified as part of the <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code>.</p>
<div class="section" id="spatial-index-z2-xz2">
<h2>6.2.1. Spatial Index (Z2/XZ2)<a class="headerlink" href="#spatial-index-z2-xz2" title="Permalink to this headline">¶</a></h2>
<p>If the <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> has a <code class="docutils literal"><span class="pre">Geometry</span></code>-type attribute (<code class="docutils literal"><span class="pre">Point</span></code>, <code class="docutils literal"><span class="pre">LineString</span></code>, <code class="docutils literal"><span class="pre">Polygon</span></code>, etc),
GeoMesa will create a spatial index on that attribute. If there is more than one <code class="docutils literal"><span class="pre">Geometry</span></code>-type attribute,
the default one will be used. The default geometry is generally specified with a <code class="docutils literal"><span class="pre">*</span></code> prefix in the
<code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> string, and is the one returned by <code class="docutils literal"><span class="pre">SimpleFeatureType.getGeometryDescriptor</span></code>.</p>
</div>
<div class="section" id="spatio-temporal-index-z3-xz3">
<h2>6.2.2. Spatio-temporal Index (Z3/XZ3)<a class="headerlink" href="#spatio-temporal-index-z3-xz3" title="Permalink to this headline">¶</a></h2>
<p>If the <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> has both a <code class="docutils literal"><span class="pre">Geometry</span></code>-type attribute and a <code class="docutils literal"><span class="pre">Date</span></code> attribute, GeoMesa will
create a spatio-temporal index on those attributes. The <code class="docutils literal"><span class="pre">Geometry</span></code>-type attribute used is the same as
for the spatial index, above. The <code class="docutils literal"><span class="pre">Date</span></code> attribute selected will be the first one declared, or can be
set explicitly. See <a class="reference internal" href="index_config.html#set-date-attribute"><span class="std std-ref">Setting the Indexed Date Attribute</span></a> for details on setting the indexed date.</p>
</div>
<div class="section" id="id-index">
<h2>6.2.3. ID Index<a class="headerlink" href="#id-index" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa will always create an ID index on <code class="docutils literal"><span class="pre">SimpleFeature.getID()</span></code>.</p>
</div>
<div class="section" id="attribute-index">
<span id="attribute-indices"></span><h2>6.2.4. Attribute Index<a class="headerlink" href="#attribute-index" title="Permalink to this headline">¶</a></h2>
<p>Some queries are slow to answer using the default indices. For example, with twitter data you
might want to return all tweets for a given user. To speed up this type of query, any
attribute in your simple feature type may be indexed individually.</p>
<p>To index an attribute, add an <code class="docutils literal"><span class="pre">index</span></code> hint to the attribute descriptor with a value of <code class="docutils literal"><span class="pre">true</span></code>. To set
the cardinality of an attribute, use the hint <code class="docutils literal"><span class="pre">cardinality</span></code> with a value of <code class="docutils literal"><span class="pre">high</span></code> or <code class="docutils literal"><span class="pre">low</span></code> (see below
for a description of cardinality hints).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Accumulo data stores have an additional option to create reduced ‘join’ attribute indices, and will
use the reduced format by default. See <a class="reference internal" href="../accumulo/data_management.html#accumulo-attribute-indices"><span class="std std-ref">Accumulo Attribute Indices</span></a> for details.</p>
</div>
<p>Setting the hint can be done in multiple ways. If you are using a string to indicate your simple feature type
(e.g. through the command line tools, or when using <code class="docutils literal"><span class="pre">SimpleFeatureTypes.createType</span></code>), you can append
the hint to the attribute to be indexed, like so:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// append the hint after the attribute type, separated by a colon</span>
<span class="n">String</span> <span class="n">spec</span> <span class="o">=</span> <span class="s">&quot;name:String:index=true:cardinality=high,age:Int:index=true,dtg:Date,*geom:Point:srid=4326&quot;</span>
<span class="n">SimpleFeatureType</span> <span class="n">sft</span> <span class="o">=</span> <span class="n">SimpleFeatureTypes</span><span class="o">.</span><span class="na">createType</span><span class="o">(</span><span class="s">&quot;mySft&quot;</span><span class="o">,</span> <span class="n">spec</span><span class="o">);</span>
</pre></div>
</div>
<p>If you have an existing simple feature type, or you are not using <code class="docutils literal"><span class="pre">SimpleFeatureTypes.createType</span></code>,
you may set the hint directly in the feature type:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// set the hint directly</span>
<span class="n">SimpleFeatureType</span> <span class="n">sft</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">sft</span><span class="o">.</span><span class="na">getDescriptor</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;index&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">);</span>
<span class="n">sft</span><span class="o">.</span><span class="na">getDescriptor</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;cardinality&quot;</span><span class="o">,</span> <span class="s">&quot;high&quot;</span><span class="o">);</span>
<span class="n">sft</span><span class="o">.</span><span class="na">getDescriptor</span><span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">).</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;index&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>If you are using TypeSafe configuration files to define your simple feature type, you may include the hint in
the attribute field:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">geomesa</span> <span class="p">{</span>
  <span class="nx">sfts</span> <span class="p">{</span>
    <span class="s2">&quot;mySft&quot;</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">index</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">cardinality</span> <span class="o">=</span> <span class="nx">high</span> <span class="p">}</span>
        <span class="p">{</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">age</span><span class="p">,</span>  <span class="nx">type</span> <span class="o">=</span> <span class="nx">Int</span><span class="p">,</span>    <span class="nx">index</span> <span class="o">=</span> <span class="kc">true</span>                     <span class="p">}</span>
        <span class="p">{</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">dtg</span><span class="p">,</span>  <span class="nx">type</span> <span class="o">=</span> <span class="nb">Date</span>                                     <span class="p">}</span>
        <span class="p">{</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">geom</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">Point</span><span class="p">,</span>  <span class="nx">srid</span> <span class="o">=</span> <span class="mi">4326</span>                      <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you are using the GeoMesa <code class="docutils literal"><span class="pre">SftBuilder</span></code>, you may call the overloaded attribute methods:</p>
<div class="highlight-scala"><div class="highlight"><pre><span></span><span class="c1">// scala example</span>
<span class="k">import</span> <span class="nn">org.locationtech.geomesa.utils.geotools.SftBuilder.SftBuilder</span>
<span class="k">import</span> <span class="nn">org.locationtech.geomesa.utils.stats.Cardinality</span>

<span class="k">val</span> <span class="n">sft</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SftBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="n">stringType</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="nc">Opts</span><span class="o">(</span><span class="n">index</span> <span class="k">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">cardinality</span> <span class="k">=</span> <span class="nc">Cardinality</span><span class="o">.</span><span class="nc">HIGH</span><span class="o">))</span>
    <span class="o">.</span><span class="n">intType</span><span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">,</span> <span class="nc">Opts</span><span class="o">(</span><span class="n">index</span> <span class="k">=</span> <span class="kc">true</span><span class="o">))</span>
    <span class="o">.</span><span class="n">date</span><span class="o">(</span><span class="s">&quot;dtg&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="n">geometry</span><span class="o">(</span><span class="s">&quot;geom&quot;</span><span class="o">,</span> <span class="n">default</span> <span class="k">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="n">build</span><span class="o">(</span><span class="s">&quot;mySft&quot;</span><span class="o">)</span>
</pre></div>
</div>
<div class="section" id="cardinality-hints">
<h3>6.2.4.1. Cardinality Hints<a class="headerlink" href="#cardinality-hints" title="Permalink to this headline">¶</a></h3>
<p>GeoMesa has a query planner that tries to find the best strategy for answering a given query. In
general, this means using the index that will filter the result set the most, before considering
the entire query filter on the reduced data set. For simple queries, there is often only one
suitable index. However, for mixed queries, there can be multiple options.</p>
<p>For example, given the query <code class="docutils literal"><span class="pre">bbox(geom,</span> <span class="pre">-120,</span> <span class="pre">-60,</span> <span class="pre">120,</span> <span class="pre">60)</span> <span class="pre">AND</span> <span class="pre">IN('id-01')</span></code>, we could try to
execute against the spatial index using the bounding box, or we could try to execute against the
ID index using the feature ID. In this case, we know that the ID filter will match at most one
record, while the bbox filter could match many records, so we will choose the ID index.</p>
<p>Attributes that are know to have many distinct values, i.e. a high cardinality, are likely to filter
out many false positives through the index structure, and thus a query against the attribute index will
touch relatively few records. Conversely, in the worst case, a Boolean attribute (for example), with only
two distinct values, would likely require scanning half of the entire data set.</p>
<p>Cardinality hints may be used to influence the query planner when considering attribute indices.
If an attribute is marked as having a high cardinality, the attribute index will be prioritized.
Conversely, if an attribute is marked with low cardinality, the attribute index will be de-prioritized.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="index_config.html" class="btn btn-neutral float-right" title="6.3. Index Configuration" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index_overview.html" class="btn btn-neutral" title="6.1. Index Overview" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2017 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.3.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>