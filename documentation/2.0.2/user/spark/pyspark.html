

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>16.7. GeoMesa PySpark &mdash; GeoMesa 2.0.2 Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="GeoMesa 2.0.2 Manuals" href="../../index.html"/>
        <link rel="up" title="16. GeoMesa Spark" href="index.html"/>
        <link rel="next" title="16.8. Deploying GeoMesa Spark with Jupyter Notebook" href="jupyter.html"/>
        <link rel="prev" title="16.6. SparkSQL Functions" href="sparksql_functions.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                2.0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">2. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">3. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">4. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">5. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastores/index.html">6. GeoMesa Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/index.html">7. Command-Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">8. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">9. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bigtable/index.html">10. Bigtable Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">11. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">12. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">13. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem/index.html">14. FileSystem Datastore (Amazon S3, HDFS Datastore)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">15. GeoServer Plugins</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">16. GeoMesa Spark</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="architecture.html">16.1. Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="spark_jts.html">16.2. Spark JTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="core.html">16.3. Spark Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="providers.html">16.4. Spatial RDD Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparksql.html">16.5. SparkSQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparksql_functions.html">16.6. SparkSQL Functions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">16.7. GeoMesa PySpark</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">16.7.1. Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation">16.7.2. Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-geomesa-pyspark">16.7.3. Using Geomesa PySpark</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jupyter">16.7.4. Jupyter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="jupyter.html">16.8. Deploying GeoMesa Spark with Jupyter Notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="zeppelin.html">16.9. Deploying GeoMesa Spark with Zeppelin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">17. GeoMesa Convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">18. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geojson.html">19. GeoMesa GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi.html">20. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blobstore.html">21. GeoMesa Blob Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_api.html">22. GeoMesa Native API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">23. GeoMesa Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">24. GeoMesa Stream Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web_data.html">25. GeoMesa Web Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade.html">26. Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">User Manual</a> &raquo;</li>
      
          <li><a href="index.html">16. GeoMesa Spark</a> &raquo;</li>
      
    <li>16.7. GeoMesa PySpark</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/user/spark/pyspark.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomesa-pyspark">
<h1>16.7. GeoMesa PySpark<a class="headerlink" href="#geomesa-pyspark" title="Permalink to this headline">¶</a></h1>
<p>GeoMesa provides integration with the Spark Python API for accessing data in GeoMesa data stores.</p>
<div class="section" id="prerequisites">
<h2>16.7.1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://spark.apache.org/">Spark</a> 2.2.x should be installed.</li>
<li><a class="reference external" href="https://www.python.org/">Python</a> 2.7 or 3.x should be installed.</li>
<li><a class="reference external" href="https://packaging.python.org/tutorials/installing-packages/">pip</a> or <code class="docutils literal"><span class="pre">pip3</span></code> should be installed.</li>
</ul>
</div>
<div class="section" id="installation">
<h2>16.7.2. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">geomesa_pyspark</span></code> package is not available for download. Build the artifact locally with the profile
<code class="docutils literal"><span class="pre">-Ppython</span></code>. Then install using <code class="docutils literal"><span class="pre">pip</span></code> or <code class="docutils literal"><span class="pre">pip3</span></code> as below. You will also need an appropriate
<code class="docutils literal"><span class="pre">geomesa-spark-runtime</span></code> JAR. We assume the use of Accumulo here, but you may alternatively use any of
the providers outlined in <a class="reference internal" href="providers.html#spatial-rdd-providers"><span class="std std-ref">Spatial RDD Providers</span></a>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mvn clean install -Ppython
pip3 install geomesa-spark/geomesa_pyspark/target/geomesa_pyspark-<span class="nv">$VERSION</span>.tar.gz
cp  geomesa-accumulo/geomesa-accumulo-spark-runtime/target/geomesa-accumulo-spark-runtime_2.11-<span class="nv">$VERSION</span>.jar /path/to/
</pre></div>
</div>
</div>
<div class="section" id="using-geomesa-pyspark">
<h2>16.7.3. Using Geomesa PySpark<a class="headerlink" href="#using-geomesa-pyspark" title="Permalink to this headline">¶</a></h2>
<p>You may then access Spark using a Yarn master by default. Importantly, because of the way the <code class="docutils literal"><span class="pre">geomesa_pyspark</span></code>
library interacts with the underlying Java libraries, you must set up the GeoMesa configuration before referencing
the <code class="docutils literal"><span class="pre">pyspark</span></code> library.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geomesa_pyspark</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">geomesa_pyspark</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">jars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;/path/to/geomesa-accumulo-spark-runtime_2.11-$VERSION.jar&#39;</span><span class="p">],</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geomesa_pyspark&#39;</span><span class="p">,</span><span class="s1">&#39;pytz&#39;</span><span class="p">],</span>
    <span class="n">spark_home</span><span class="o">=</span><span class="s1">&#39;/path/to/spark/&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">setAppName</span><span class="p">(</span><span class="s1">&#39;MyTestApp&#39;</span><span class="p">)</span>

<span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spark.master&#39;</span><span class="p">)</span>
<span class="c1"># u&#39;yarn&#39;</span>

<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="p">(</span> <span class="n">SparkSession</span>
    <span class="o">.</span><span class="n">builder</span>
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>
    <span class="o">.</span><span class="n">enableHiveSupport</span><span class="p">()</span>
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>At this point you are ready to create a dict of connection parameters to your Accumulo data store and get a spatial
data frame.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;accumulo.instance.id&quot;</span><span class="p">:</span> <span class="s2">&quot;myInstance&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accumulo.zookeepers&quot;</span><span class="p">:</span> <span class="s2">&quot;zoo1,zoo2,zoo3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accumulo.user&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accumulo.password&quot;</span><span class="p">:</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accumulo.catalog&quot;</span><span class="p">:</span> <span class="s2">&quot;myCatalog&quot;</span>
<span class="p">}</span>
<span class="n">feature</span> <span class="o">=</span> <span class="s2">&quot;mySchema&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">(</span> <span class="n">spark</span>
    <span class="o">.</span><span class="n">read</span>
    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;geomesa&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;geomesa.feature&quot;</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
    <span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;tbl&quot;</span><span class="p">)</span>
<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;show tables&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Count features in a bounding box.</span>
<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select count(*)</span>
<span class="s2">from tbl</span>
<span class="s2">where st_contains(st_makeBBOX(-72.0, 40.0, -71.0, 41.0), geom)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>You can terminate the Spark job on YARN using <code class="docutils literal"><span class="pre">spark.stop()</span></code>.</p>
</div>
<div class="section" id="jupyter">
<h2>16.7.4. Jupyter<a class="headerlink" href="#jupyter" title="Permalink to this headline">¶</a></h2>
<p>To use the <code class="docutils literal"><span class="pre">geomesa_pyspark</span></code> package within Jupyter, you only needs a Python2 or Python3 kernel, which is
provided by default. Substitute the appropriate Spark home and runtime JAR paths in the above code blocks. Be sure
the GeoMesa Accumulo client and server side versions match, as described in <a class="reference internal" href="../accumulo/install.html"><span class="doc">Installing GeoMesa Accumulo</span></a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="jupyter.html" class="btn btn-neutral float-right" title="16.8. Deploying GeoMesa Spark with Jupyter Notebook" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sparksql_functions.html" class="btn btn-neutral" title="16.6. SparkSQL Functions" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2017 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>