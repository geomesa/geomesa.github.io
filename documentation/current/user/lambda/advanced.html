

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>21.7. Advanced Topics &mdash; GeoMesa 3.5.0 Manuals</title>
  

  
  
  
  
    <link rel="canonical" href="https://www.geomesa.org/documentation/user/lambda/advanced.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="22. Combined Data Store Views" href="../ds_views.html" />
    <link rel="prev" title="21.6. Lambda Data Store Configuration" href="configuration.html" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-53087457-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53087457-1');
</script>



  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                4.0.0-SNAPSHOT
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">2. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">3. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">4. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">5. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geotools.html">6. GeoTools Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastores/index.html">7. GeoMesa Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/index.html">8. Command-Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">9. GeoMesa Converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">10. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">11. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi/index.html">12. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">13. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">14. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">15. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">16. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">17. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../redis/index.html">18. Redis Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem/index.html">19. FileSystem Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../postgis/index.html">20. Partitioned PostGIS Data Store</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">21. Lambda Data Store</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">21.1. Overview of the Lambda Data Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html">21.2. Installing GeoMesa Lambda</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html">21.3. Using the Lambda Data Store Programmatically</a></li>
<li class="toctree-l3"><a class="reference internal" href="geoserver.html">21.4. Using the Lambda Data Store in GeoServer</a></li>
<li class="toctree-l3"><a class="reference internal" href="commandline.html">21.5. Lambda Command-Line Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">21.6. Lambda Data Store Configuration</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">21.7. Advanced Topics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parallelism">21.7.1. Parallelism</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-tips">21.7.2. Installation Tips</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manual-persistence">21.7.3. Manual Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitoring-state">21.7.4. Monitoring State</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ds_views.html">22. Combined Data Store Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade.html">23. Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GeoMesa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User Manual</a> &raquo;</li>
        
          <li><a href="index.html">21. Lambda Data Store</a> &raquo;</li>
        
      <li>21.7. Advanced Topics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="advanced-topics">
<h1>21.7. Advanced Topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="parallelism">
<h2>21.7.1. Parallelism<a class="headerlink" href="#parallelism" title="Permalink to this headline">¶</a></h2>
<p>There are two types of parallelism for the Lambda store - the number of simultaneous writers for long-term
persistence, and the number of Kafka consumers per data store.</p>
<p>The number of writers is determined by the number of data stores instances with a valid <code class="docutils literal notranslate"><span class="pre">lambda.expiry</span></code> parameter;
however the parallelism on writes is limited by how many partitions are in the Kafka topic (writes are
synchronized across instances by topic and partition). The <code class="docutils literal notranslate"><span class="pre">lambda.kafka.partitions</span></code> parameter can be used to control
the number of partitions, but note that once a topic is created, you will need to use Kafka scripts (i.e.
<code class="docutils literal notranslate"><span class="pre">kafka-topics.sh</span></code>) to modify partitions.</p>
<p>The number of consumers used to load features into the in-memory cache is controlled by the <code class="docutils literal notranslate"><span class="pre">lambda.kafka.consumers</span></code>
parameter. This is the number of consumers per data store instance per simple feature type accessed. Note that
having more consumers than topic partitions is not recommended and will cause some consumers to be idle.</p>
</div>
<div class="section" id="installation-tips">
<h2>21.7.2. Installation Tips<a class="headerlink" href="#installation-tips" title="Permalink to this headline">¶</a></h2>
<p>The typical use case for a Lambda data store is to be fed by an analytic streaming process. The analytic will
update summary <code class="docutils literal notranslate"><span class="pre">SimpleFeature</span></code>s with derived attributes containing analytic results. For example, when
aggregating GPS tracks, there could be a dynamically updated field for current estimated heading.</p>
<p>Typical streaming analytics will run in many concurrent threads, for example using <a class="reference external" href="http://storm.apache.org/">Apache Storm</a>. The Lambda
store achieves parallelism based on the <code class="docutils literal notranslate"><span class="pre">lambda.kafka.partitions</span></code> parameter. Generally you should start with this
set to the number of writer threads being used, and adjust up or down as needed.</p>
<p>Any data store instances used only for reads (e.g. GeoServer) should generally disable writing by setting the
<code class="docutils literal notranslate"><span class="pre">expiry</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">Inf</span></code>. Note that there must be at least one data store instance with a valid <code class="docutils literal notranslate"><span class="pre">expiry</span></code>,
or features will never be removed from memory and persisted to long-term storage.</p>
</div>
<div class="section" id="manual-persistence">
<h2>21.7.3. Manual Persistence<a class="headerlink" href="#manual-persistence" title="Permalink to this headline">¶</a></h2>
<p>Instead of allowing features to be persisted to long-term storage automatically, you may instead control exactly
when features are written. To do this, set the <code class="docutils literal notranslate"><span class="pre">lambda.persist</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">false</span></code> on all data store instances.
Write and remove features from the Lambda data store using <code class="docutils literal notranslate"><span class="pre">SimpleFeatureWriter</span></code>s as usual to
add and delete them from the in-memory cache. With <code class="docutils literal notranslate"><span class="pre">lambda.persist</span></code> disabled, this will not affect long-term storage.
Note that data stores will still expire features from memory - this is required to clean up internal state.
Make sure that the <code class="docutils literal notranslate"><span class="pre">lambda.expiry</span></code> parameter is set high enough that it won’t remove features that you still want
available in memory.</p>
<p>To write features to long-term storage, instantiate an instance of the delegate data store (<code class="docutils literal notranslate"><span class="pre">AccumuloDataStore</span></code>)
using the same connection parameters as for the Lambda store. Any features written to the delegate store will
then be queryable by the Lambda store, and merged with the in-memory cache.</p>
</div>
<div class="section" id="monitoring-state">
<h2>21.7.4. Monitoring State<a class="headerlink" href="#monitoring-state" title="Permalink to this headline">¶</a></h2>
<p>The state of a Lambda data store can be monitored by enabling logging on the following classes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="7%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Class</th>
<th class="head">Level</th>
<th class="head">Info</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>org.locationtech.geomesa.lambda.stream.kafka.DataStorePersistence</td>
<td><code class="docutils literal notranslate"><span class="pre">debug</span></code></td>
<td>Count of features written to long-term storage</td>
</tr>
<tr class="row-odd"><td>org.locationtech.geomesa.lambda.stream.kafka.DataStorePersistence</td>
<td><code class="docutils literal notranslate"><span class="pre">trace</span></code></td>
<td>All features written to long-term storage</td>
</tr>
<tr class="row-even"><td>org.locationtech.geomesa.lambda.stream.kafka.KafkaStore</td>
<td><code class="docutils literal notranslate"><span class="pre">trace</span></code></td>
<td>All features written to Kafka</td>
</tr>
<tr class="row-odd"><td>org.locationtech.geomesa.lambda.stream.kafka.KafkaCacheLoader</td>
<td><code class="docutils literal notranslate"><span class="pre">trace</span></code></td>
<td>All features read from Kafka</td>
</tr>
<tr class="row-even"><td>org.locationtech.geomesa.lambda.stream.kafka.KafkaFeatureCache</td>
<td><code class="docutils literal notranslate"><span class="pre">debug</span></code></td>
<td>Size of in-memory cache</td>
</tr>
<tr class="row-odd"><td>org.locationtech.geomesa.lambda.stream.kafka.KafkaFeatureCache</td>
<td><code class="docutils literal notranslate"><span class="pre">trace</span></code></td>
<td>All features added/removed from in-memory cache</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ds_views.html" class="btn btn-neutral float-right" title="22. Combined Data Store Views" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configuration.html" class="btn btn-neutral" title="21.6. Lambda Data Store Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2021 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

<div role="contentinfo">
  <p>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a>
    using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>
    
    - view <a href="../../_sources/user/lambda/advanced.rst.txt" rel="nofollow">page source</a>
    
  </p>
</div>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../../_static/copybutton.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>