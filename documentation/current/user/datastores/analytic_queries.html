<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7.14. Analytic Querying &mdash; GeoMesa 4.0.1 Manuals</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="canonical" href="https://www.geomesa.org/documentation/user/datastores/analytic_queries.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/tabs.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="7.15. Data Security" href="security.html" />
    <link rel="prev" title="7.13. Filter Functions" href="filter_functions.html" />


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          </a>
              <div class="version">
                4.1.0-SNAPSHOT
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">2. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">3. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">4. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">5. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geotools.html">6. GeoTools Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">7. GeoMesa Data Stores</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="attributes.html">7.1. GeoTools Feature Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html">7.2. JSON Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_overview.html">7.3. Index Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_basics.html">7.4. Index Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_basics.html#index-versioning">7.5. Index Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_ext.html">7.6. Additional Index Implementations</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_config.html">7.7. Index Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="runtime_config.html">7.8. Runtime Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_planning.html">7.9. Query Planning</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_planning.html#explaining-query-plans">7.10. Explaining Query Plans</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_interceptor.html">7.11. Query Interceptors and Guards</a></li>
<li class="toctree-l3"><a class="reference internal" href="query_config.html">7.12. Query Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="filter_functions.html">7.13. Filter Functions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">7.14. Analytic Querying</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#feature-sampling">7.14.1. Feature Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#density-queries">7.14.2. Density Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#statistical-queries">7.14.3. Statistical Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arrow-encoding">7.14.4. Arrow Encoding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#binary-encoding">7.14.5. Binary Encoding</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="security.html">7.15. Data Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="auditing.html">7.16. Query Auditing</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html">7.17. Moving and Migrating Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="reserved_words.html">7.18. Reserved Words</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cli/index.html">8. Command-Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">9. GeoMesa Converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">10. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">11. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi/index.html">12. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">13. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">14. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">15. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">16. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">17. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../redis/index.html">18. Redis Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem/index.html">19. FileSystem Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../postgis/index.html">20. Partitioned PostGIS Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">21. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds_views.html">22. Combined Data Store Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade.html">23. Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GeoMesa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">User Manual</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">7. </span>GeoMesa Data Stores</a></li>
      <li class="breadcrumb-item active"><span class="section-number">7.14. </span>Analytic Querying</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="analytic-querying">
<span id="analytic-queries"></span><h1><span class="section-number">7.14. </span>Analytic Querying<a class="headerlink" href="#analytic-querying" title="Permalink to this headline">Â¶</a></h1>
<p>GeoMesa provides advanced query capabilities through GeoTools query hints. You can use these hints to control
various aspects of query processing or to trigger distributed analytic processing. See <a class="reference internal" href="query_config.html#query-hints"><span class="std std-ref">Setting Query Hints</span></a>
for details on setting query hints.</p>
<section id="feature-sampling">
<h2><span class="section-number">7.14.1. </span>Feature Sampling<a class="headerlink" href="#feature-sampling" title="Permalink to this headline">Â¶</a></h2>
<p>Instead of returning all features for a query, GeoMesa can use statistical sampling to return a certain
percentage of results. This can be useful when rendering maps, or when there are too many features to
be meaningful.</p>
<p>Features can either be sampled absolutely, or sampled by a certain attribute. For example, given a series of
points in a track, you may wish to sample by the track identifier so that no tracks are completely sampled out.</p>
<p>The sampling value should be a float in the range (0, 1), which represents the fractional value of features that will
be returned. Due to distributed processing, the actual count returned is not guaranteed to equal the requested
percentage - however, there will never be less features than requested. For example, if you sample 5 features
at 10%, you will get back anywhere from 1 to 5 features, depending on how your data is distributed in the cluster.</p>
<p>Sampling can also be combined with the other analytic queries mentioned below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 45%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>GeoServer Conversion</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>QueryHints.SAMPLING</p></td>
<td><p>Float</p></td>
<td><p>any float</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.SAMPLE_BY</p></td>
<td><p>String - attribute name (optional)</p></td>
<td><p>any string</p></td>
</tr>
</tbody>
</table>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-SmF2YQ==" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-SmF2YQ==" name="SmF2YQ==" role="tab" tabindex="0">Java</button><button aria-controls="panel-0-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button><button aria-controls="panel-0-R2VvU2VydmVy" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-R2VvU2VydmVy" name="R2VvU2VydmVy" role="tab" tabindex="-1">GeoServer</button></div><div aria-labelledby="tab-0-SmF2YQ==" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-SmF2YQ==" name="SmF2YQ==" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.index.conf.QueryHints</span><span class="p">;</span>

<span class="c1">// returns 10% of features, threaded by &#39;track&#39; attribute</span>
<span class="n">query</span><span class="p">.</span><span class="na">getHints</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="n">QueryHints</span><span class="p">.</span><span class="na">SAMPLING</span><span class="p">(),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Float</span><span class="p">(</span><span class="mf">0.1</span><span class="p">));</span>
<span class="n">query</span><span class="p">.</span><span class="na">getHints</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="n">QueryHints</span><span class="p">.</span><span class="na">SAMPLE_BY</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;track&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">index</span><span class="p">.</span><span class="nn">conf</span><span class="p">.</span><span class="nc">QueryHints</span>

<span class="c1">// returns 10% of features, threaded by &#39;track&#39; attribute</span>
<span class="n">query</span><span class="p">.</span><span class="n">getHints</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">QueryHints</span><span class="p">.</span><span class="nc">SAMPLING</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">)</span>
<span class="n">query</span><span class="p">.</span><span class="n">getHints</span><span class="p">().</span><span class="n">put</span><span class="p">(</span><span class="nc">QueryHints</span><span class="p">.</span><span class="nc">SAMPLE_BY</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;track&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-R2VvU2VydmVy" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-R2VvU2VydmVy" name="R2VvU2VydmVy" role="tabpanel" tabindex="0"><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...&amp;viewparams=SAMPLING:0.1
</pre></div>
</div>
</div></div>
</section>
<section id="density-queries">
<h2><span class="section-number">7.14.2. </span>Density Queries<a class="headerlink" href="#density-queries" title="Permalink to this headline">Â¶</a></h2>
<p>To populate heatmaps or other pre-rendered maps, GeoMesa can use server-side aggregation to map features to
pixels. This results in much less network traffic, and subsequently much faster queries.</p>
<p>The result from a density query is an encoded iterator of <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">count)</span></code>, where <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> refer to
the coordinates for the center of a pixel. In GeoServer, you can use the WPS DensityProcess to create a
heatmap from the query result. See <a class="reference internal" href="../../tutorials/geomesa-examples-gdelt.html#gdelt-heatmaps"><span class="std std-ref">Heatmaps</span></a> for more information.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 33%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>GeoServer Conversion</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>QueryHints.DENSITY_BBOX</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ReferencedEnvelope</span></code></p></td>
<td rowspan="5"><p>Use WPS</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.DENSITY_GEOM</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>QueryHints.DENSITY_WEIGHT</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.DENSITY_WIDTH</p></td>
<td><p>Integer</p></td>
</tr>
<tr class="row-even"><td><p>QueryHints.DENSITY_HEIGHT</p></td>
<td><p>Integer</p></td>
</tr>
</tbody>
</table>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-U2NhbGE=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="0">Scala</button></div><div aria-labelledby="tab-1-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" id="panel-1-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">geotools</span><span class="p">.</span><span class="nn">data</span><span class="p">.</span><span class="nc">Transaction</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">geotools</span><span class="p">.</span><span class="nn">geometry</span><span class="p">.</span><span class="nn">jts</span><span class="p">.</span><span class="nc">ReferencedEnvelope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">geotools</span><span class="p">.</span><span class="nn">referencing</span><span class="p">.</span><span class="nc">CRS</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">index</span><span class="p">.</span><span class="nn">conf</span><span class="p">.</span><span class="nc">QueryHints</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">index</span><span class="p">.</span><span class="nn">iterators</span><span class="p">.</span><span class="nc">DensityScan</span>

<span class="kd">val</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">ReferencedEnvelope</span><span class="p">(</span><span class="o">-</span><span class="mf">120.0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">110.0</span><span class="p">,</span><span class="w"> </span><span class="mf">45.0</span><span class="p">,</span><span class="w"> </span><span class="mf">55.0</span><span class="p">,</span><span class="w"> </span><span class="nc">CRS</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;EPSG:4326&quot;</span><span class="p">))</span>
<span class="n">query</span><span class="p">.</span><span class="n">getHints</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">QueryHints</span><span class="p">.</span><span class="nc">DENSITY_BBOX</span><span class="p">,</span><span class="w"> </span><span class="n">bounds</span><span class="p">)</span>
<span class="n">query</span><span class="p">.</span><span class="n">getHints</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">QueryHints</span><span class="p">.</span><span class="nc">DENSITY_WIDTH</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>
<span class="n">query</span><span class="p">.</span><span class="n">getHints</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">QueryHints</span><span class="p">.</span><span class="nc">DENSITY_HEIGHT</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataStore</span><span class="p">.</span><span class="n">getFeatureReader</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="nc">Transaction</span><span class="p">.</span><span class="nc">AUTO_COMMIT</span><span class="p">)</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">DensityScan</span><span class="p">.</span><span class="n">decodeResult</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">hasNext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">pts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decode</span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">next</span><span class="p">())</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">pts</span><span class="p">.</span><span class="n">hasNext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pts</span><span class="p">.</span><span class="n">next</span><span class="p">()</span>
<span class="w">      </span><span class="c1">// do something with the cell</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">reader</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div>
</section>
<section id="statistical-queries">
<span id="id1"></span><h2><span class="section-number">7.14.3. </span>Statistical Queries<a class="headerlink" href="#statistical-queries" title="Permalink to this headline">Â¶</a></h2>
<p>GeoMesa supports generating various statistics against a data set. These stats are generated in a distributed
scan, so provide built-in parallelism and require less network traffic. The following stats are supported:</p>
<ul class="simple">
<li><p>count</p></li>
<li><p>min/max values (bounds)</p></li>
<li><p>enumeration of values</p></li>
<li><p>top-k values</p></li>
<li><p>frequency of values</p></li>
<li><p>histogram of values</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Descriptive_statistics">descriptive statistics</a></p></li>
</ul>
<p>In GeoServer you can use the <code class="docutils literal notranslate"><span class="pre">StatsProcess</span></code>. Otherwise, the query is controlled through the
following query hints:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 25%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>GeoServer Conversion</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>QueryHints.STATS_STRING</p></td>
<td><p>String</p></td>
<td rowspan="2"><p>Use WPS</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.ENCODE_STATS</p></td>
<td><p>Boolean (optional)</p></td>
</tr>
</tbody>
</table>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-U2NhbGE=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="0">Scala</button></div><div aria-labelledby="tab-2-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" id="panel-2-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">geotools</span><span class="p">.</span><span class="nn">data</span><span class="p">.</span><span class="nc">Transaction</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">index</span><span class="p">.</span><span class="nn">conf</span><span class="p">.</span><span class="nc">QueryHints</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">index</span><span class="p">.</span><span class="nn">iterators</span><span class="p">.</span><span class="nc">StatsScan</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">utils</span><span class="p">.</span><span class="nn">stats</span><span class="p">.</span><span class="nc">Stat</span>

<span class="n">query</span><span class="p">.</span><span class="n">getHints</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">QueryHints</span><span class="p">.</span><span class="nc">STATS_STRING</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Count()&quot;</span><span class="p">)</span>
<span class="n">query</span><span class="p">.</span><span class="n">getHints</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">QueryHints</span><span class="p">.</span><span class="nc">ENCODE_STATS</span><span class="p">,</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="nc">Boolean</span><span class="p">.</span><span class="nc">TRUE</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataStore</span><span class="p">.</span><span class="n">getFeatureReader</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="nc">Transaction</span><span class="p">.</span><span class="nc">AUTO_COMMIT</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="nc">Stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// stats should always return exactly one result, even if there are no features in the table</span>
<span class="w">  </span><span class="nc">StatsScan</span><span class="p">.</span><span class="n">decodeStat</span><span class="p">(</span><span class="n">sft</span><span class="p">)(</span><span class="n">reader</span><span class="p">.</span><span class="n">next</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="k">asInstanceOf</span><span class="p">[</span><span class="nc">String</span><span class="p">])</span>
<span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">reader</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div>
<p>See <a class="reference internal" href="../cli/analytic.html#cli-analytic"><span class="std std-ref">Analytic Commands</span></a> for information on running statistical queries through the GeoMesa command-line
tools.</p>
<section id="explanation-of-hints">
<h3><span class="section-number">7.14.3.1. </span>Explanation of Hints<a class="headerlink" href="#explanation-of-hints" title="Permalink to this headline">Â¶</a></h3>
<section id="stats-string">
<h4><span class="section-number">7.14.3.1.1. </span>STATS_STRING<a class="headerlink" href="#stats-string" title="Permalink to this headline">Â¶</a></h4>
<p>This hint is a string describing the stats to be collected. Each type of stat has a corresponding string
representation. Multiple stats can be collected at once by delimiting them with a semi-colon. Instead
of constructing stat strings by hand, there are convenience methods in <code class="docutils literal notranslate"><span class="pre">org.locationtech.geomesa.utils.stats.Stat</span></code>
that will generate valid stat strings. Stat strings can be validated by trying to parse them with
<code class="docutils literal notranslate"><span class="pre">org.locationtech.geomesa.utils.stats.Stat.apply</span></code>. The implementing classes are contained in the package
<code class="docutils literal notranslate"><span class="pre">org.locationtech.geomesa.utils.stats</span></code>.</p>
<p>Stat strings are as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 19%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Implementation</p></th>
<th class="head"><p>Representation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>count</p></td>
<td><p>CountStat</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Count()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>min/max</p></td>
<td><p>MinMax</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MinMax(&quot;foo&quot;)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>enumeration</p></td>
<td><p>EnumerationStat</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Enumeration(&quot;foo&quot;)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>top-k</p></td>
<td><p>TopK</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TopK(&quot;foo&quot;)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>frequency</p></td>
<td><p>Frequency</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Frequency(&quot;foo&quot;,&lt;precision&gt;)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>frequency (by time period)</p></td>
<td><p>Frequency</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Frequency(&quot;foo&quot;,&quot;dtg&quot;,&lt;time</span> <span class="pre">period&gt;,&lt;precision&gt;)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Z3 frequency</p></td>
<td><p>Z3Frequency</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Z3Frequency(&quot;geom&quot;,&quot;dtg&quot;,&lt;time</span> <span class="pre">period&gt;,&lt;precision&gt;)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>histogram</p></td>
<td><p>Histogram</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Histogram(&quot;foo&quot;,&lt;bins&gt;,&lt;min&gt;,&lt;max&gt;)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Z3 histogram</p></td>
<td><p>Z3Histogram</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Z3Histogram(&quot;geom&quot;,&quot;dtg&quot;,&lt;time</span> <span class="pre">period&gt;,&lt;bins&gt;)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>descriptive statistics</p></td>
<td><p>DescriptiveStats</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DescriptiveStats(&quot;foo&quot;,&quot;bar&quot;)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>multiple stats</p></td>
<td><p>SeqStat</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Count();MinMax(&quot;foo&quot;)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>grouped stats</p></td>
<td><p>GroupBy</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GroupBy(&quot;foo&quot;,MinMax(&quot;bar&quot;))</span></code></p></td>
</tr>
</tbody>
</table>
<p>As seen in the table above, multiple stats can be calculated at once through semi-colon delimiting. In addition,
stats can be calculated on grouped values by using <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> on a nested stat expression.</p>
<p>The Z3 frequency and histogram are special stats that will operate on the Z3 value created from the geometry and date.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;time</span> <span class="pre">period&gt;</span></code> can be one of <code class="docutils literal notranslate"><span class="pre">day</span></code>, <code class="docutils literal notranslate"><span class="pre">week</span></code>, <code class="docutils literal notranslate"><span class="pre">month</span></code>, or <code class="docutils literal notranslate"><span class="pre">year</span></code>, and indicates how data should be grouped.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;precision&gt;</span></code> for frequencies is defined as:</p>
<ul class="simple">
<li><p>for geometry and Z3 types, it is the number of bits of z-index to keep (max of 64). Note that the first 2
bits do not hold any information</p></li>
<li><p>for date types, it is the number of milliseconds to group for binning</p></li>
<li><p>for number types, it is the number of digits that will be grouped together</p></li>
<li><p>for floating point types, it is the number of decimal places that will be considered</p></li>
<li><p>for string types, it is the number of characters that will be considered</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;bins&gt;</span></code> for a histogram indicate how many groupings should be made. The <code class="docutils literal notranslate"><span class="pre">&lt;min&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;max&gt;</span></code> values
set the initial sizes of the groupings, but are not hard limits. The histogram will expand if needed as
new values are added, but some precision may be lost.</p>
</section>
<section id="encode-stats">
<h4><span class="section-number">7.14.3.1.2. </span>ENCODE_STATS<a class="headerlink" href="#encode-stats" title="Permalink to this headline">Â¶</a></h4>
<p>This hint controls whether the stat will be returned as a serialized (encoded) object, or as a JSON string.
Serialized stats can be deserialized using an instance of <code class="docutils literal notranslate"><span class="pre">org.locationtech.geomesa.utils.stats.StatSerializer</span></code>,
obtained through its factory <code class="docutils literal notranslate"><span class="pre">apply</span></code> method.</p>
</section>
</section>
<section id="accessing-stats-through-the-geomesa-api">
<span id="stats-api"></span><h3><span class="section-number">7.14.3.2. </span>Accessing Stats through the GeoMesa API<a class="headerlink" href="#accessing-stats-through-the-geomesa-api" title="Permalink to this headline">Â¶</a></h3>
<p>In addition to queries through the GeoTools API, stats can be accessed directly through the GeoMesa API. Most
GeoMesa datastores implement <code class="docutils literal notranslate"><span class="pre">org.locationtech.geomesa.index.stats.HasGeoMesaStats</span></code>, which defines a single method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stats</span><span class="p">:</span> <span class="n">org</span><span class="o">.</span><span class="n">locationtech</span><span class="o">.</span><span class="n">geomesa</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">GeoMesaStats</span>
</pre></div>
</div>
<p>In addition to running queries, the <code class="docutils literal notranslate"><span class="pre">GeoMesaStats</span></code> interface can be used to retrieve cached stats.
See <a class="reference internal" href="index_config.html#stat-config"><span class="std std-ref">Configuring Cached Statistics</span></a> for details on configuring cached stats.</p>
</section>
</section>
<section id="arrow-encoding">
<span id="id2"></span><h2><span class="section-number">7.14.4. </span>Arrow Encoding<a class="headerlink" href="#arrow-encoding" title="Permalink to this headline">Â¶</a></h2>
<p>GeoMesa supports returning features as <a class="reference external" href="https://arrow.apache.org/">Apache Arrow</a> encoded vectors. This provides
an optimized columnar memory layout for fast processing and interoperability with other systems.</p>
<p>The result of an Arrow query will be an iterator of SimpleFeatures, where the first attribute of each will be a
byte array. Concatenated together, the byte arrays will form an Arrow file, in the Arrow streaming format
(i.e. no footer).</p>
<p>In GeoServer you can use the <code class="docutils literal notranslate"><span class="pre">ArrowConversionProcess</span></code>, or through WFS by setting
<code class="docutils literal notranslate"><span class="pre">outputFormat=application/vnd.arrow</span></code> and controlling the configuration through the <code class="docutils literal notranslate"><span class="pre">format_options</span></code> parameter,
e.g. <code class="docutils literal notranslate"><span class="pre">format_options=includeFids:true;batchSize:1000</span></code>. Otherwise, the encoding is controlled through the
following query hints:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 22%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>GeoServer Format Option</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>QueryHints.ARROW_ENCODE</p></td>
<td><p>Boolean</p></td>
<td><p>outputFormat=application/vnd.arrow</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.ARROW_INCLUDE_FID</p></td>
<td><p>Boolean (optional)</p></td>
<td><p>includeFids</p></td>
</tr>
<tr class="row-even"><td><p>QueryHints.ARROW_PROXY_FID</p></td>
<td><p>Boolean (optional)</p></td>
<td><p>proxyFids</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.ARROW_SORT_FIELD</p></td>
<td><p>String (optional)</p></td>
<td><p>sortField</p></td>
</tr>
<tr class="row-even"><td><p>QueryHints.ARROW_SORT_REVERSE</p></td>
<td><p>Boolean (optional)</p></td>
<td><p>sortReverse</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.ARROW_DICTIONARY_FIELDS</p></td>
<td><p>String (optional)</p></td>
<td><p>dictionaryFields</p></td>
</tr>
<tr class="row-even"><td><p>QueryHints.ARROW_BATCH_SIZE</p></td>
<td><p>Integer (optional)</p></td>
<td><p>batchSize</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.ARROW_FORMAT_VERSION</p></td>
<td><p>String (optional)</p></td>
<td><p>formatVersion</p></td>
</tr>
<tr class="row-even"><td><p>QueryHints.ARROW_PROCESS_DELTAS</p></td>
<td><p>Boolean (optional)</p></td>
<td><p>processDeltas</p></td>
</tr>
</tbody>
</table>
<section id="id3">
<h3><span class="section-number">7.14.4.1. </span>Explanation of Hints<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h3>
<section id="arrow-encode">
<h4><span class="section-number">7.14.4.1.1. </span>ARROW_ENCODE<a class="headerlink" href="#arrow-encode" title="Permalink to this headline">Â¶</a></h4>
<p>This hint is used to trigger an Arrow query.</p>
</section>
<section id="arrow-include-fid">
<h4><span class="section-number">7.14.4.1.2. </span>ARROW_INCLUDE_FID<a class="headerlink" href="#arrow-include-fid" title="Permalink to this headline">Â¶</a></h4>
<p>This hint controls whether to include the feature ID as an Arrow vector or not. The default is to include it.</p>
</section>
<section id="arrow-proxy-fid">
<h4><span class="section-number">7.14.4.1.3. </span>ARROW_PROXY_FID<a class="headerlink" href="#arrow-proxy-fid" title="Permalink to this headline">Â¶</a></h4>
<p>This hint controls whether to return the full feature ID, or a 4-byte proxy ID. Proxy IDs can be used
for callbacks by using the <code class="docutils literal notranslate"><span class="pre">proxyID()</span></code> CQL filter function.</p>
</section>
<section id="arrow-sort-field">
<h4><span class="section-number">7.14.4.1.4. </span>ARROW_SORT_FIELD<a class="headerlink" href="#arrow-sort-field" title="Permalink to this headline">Â¶</a></h4>
<p>This hint allows for sorting the results by a particular attribute. Only attribute names are supported, not
arbitrary CQL.</p>
</section>
<section id="arrow-sort-reverse">
<h4><span class="section-number">7.14.4.1.5. </span>ARROW_SORT_REVERSE<a class="headerlink" href="#arrow-sort-reverse" title="Permalink to this headline">Â¶</a></h4>
<p>This hint is used to flip sort order from normal (ascending) to reverse (descending).</p>
</section>
<section id="arrow-dictionary-fields">
<h4><span class="section-number">7.14.4.1.6. </span>ARROW_DICTIONARY_FIELDS<a class="headerlink" href="#arrow-dictionary-fields" title="Permalink to this headline">Â¶</a></h4>
<p>This hint indicates which simple feature attributes should be dictionary encoded. It should be a comma-separated
list of attribute names.</p>
</section>
<section id="arrow-batch-size">
<h4><span class="section-number">7.14.4.1.7. </span>ARROW_BATCH_SIZE<a class="headerlink" href="#arrow-batch-size" title="Permalink to this headline">Â¶</a></h4>
<p>This hint will restrict the number of features included in each Arrow record batch. An Arrow file contains
a series of record batches - limiting the max size of each batch can allow memory-constrained systems to
operate more easily.</p>
</section>
<section id="arrow-format-version">
<h4><span class="section-number">7.14.4.1.8. </span>ARROW_FORMAT_VERSION<a class="headerlink" href="#arrow-format-version" title="Permalink to this headline">Â¶</a></h4>
<p>This hint controls the IPC format version for Arrow binary encoding. It should be a valid Arrow format version,
i.e. <code class="docutils literal notranslate"><span class="pre">0.16</span></code> or <code class="docutils literal notranslate"><span class="pre">0.10</span></code>. The Arrow IPC format changed slightly starting with version <code class="docutils literal notranslate"><span class="pre">0.15</span></code>.</p>
</section>
<section id="arrow-process-deltas">
<h4><span class="section-number">7.14.4.1.9. </span>ARROW_PROCESS_DELTAS<a class="headerlink" href="#arrow-process-deltas" title="Permalink to this headline">Â¶</a></h4>
<p>This is an advanced hint, which can be used to disable normal processing on Arrow queries. When set to false,
data will be returned in a custom binary format, and needs to be processed before it can be read by standard
Arrow libraries. When returned un-processed, data can begin streaming back to the client immediately.</p>
</section>
</section>
<section id="example-query">
<h3><span class="section-number">7.14.4.2. </span>Example Query<a class="headerlink" href="#example-query" title="Permalink to this headline">Â¶</a></h3>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-U2NhbGE=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="0">Scala</button></div><div aria-labelledby="tab-3-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" id="panel-3-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">java</span><span class="p">.</span><span class="nn">io</span><span class="p">.</span><span class="nc">ByteArrayOutputStream</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">geotools</span><span class="p">.</span><span class="nn">data</span><span class="p">.</span><span class="nc">Transaction</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">index</span><span class="p">.</span><span class="nn">conf</span><span class="p">.</span><span class="nc">QueryHints</span>

<span class="n">query</span><span class="p">.</span><span class="n">getHints</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">QueryHints</span><span class="p">.</span><span class="nc">ARROW_ENCODE</span><span class="p">,</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="nc">Boolean</span><span class="p">.</span><span class="nc">TRUE</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataStore</span><span class="p">.</span><span class="n">getFeatureReader</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="nc">Transaction</span><span class="p">.</span><span class="nc">AUTO_COMMIT</span><span class="p">)</span>
<span class="kd">val</span><span class="w"> </span><span class="n">os</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">ByteArrayOutputStream</span><span class="p">()</span>

<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">hasNext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">os</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="n">getAttribute</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="k">asInstanceOf</span><span class="p">[</span><span class="nc">Array</span><span class="p">[</span><span class="nc">Byte</span><span class="p">]])</span>
<span class="p">}</span>
<span class="n">reader</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">// use ArrowStreamReader or other Arrow libraries to process bytes</span>
</pre></div>
</div>
</div></div>
</section>
</section>
<section id="binary-encoding">
<h2><span class="section-number">7.14.5. </span>Binary Encoding<a class="headerlink" href="#binary-encoding" title="Permalink to this headline">Â¶</a></h2>
<p>GeoMesa supports returning features in a custom binary format (referred to as BIN) that uses 16 or 24 bytes
per feature. This provides an extremely compact representation of a few key attributes.</p>
<p>The 16 byte BIN format is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="mi">4</span> <span class="n">byte</span> <span class="nb">int</span><span class="o">&gt;&lt;</span><span class="mi">4</span> <span class="n">byte</span> <span class="nb">int</span><span class="o">&gt;&lt;</span><span class="mi">4</span> <span class="n">byte</span> <span class="n">floating</span> <span class="n">point</span><span class="o">&gt;&lt;</span><span class="mi">4</span> <span class="n">byte</span> <span class="n">floating</span> <span class="n">point</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The first integer is referred to as a track ID, and is generally used to group related points. For example,
a line string may be turned into several BIN records with a common track ID. The second integer is a date
represented as the number of seconds since the Java epoch (Jan. 1, 1970). The two floating point numbers
represent the latitude and longitude of the record, respectively.</p>
<p>The 24 byte BIN format is the same as the 16 byte version, but with an additional 8 bytes at the end for
arbitrary data.</p>
<p>The result of a BIN query will be an iterator of SimpleFeatures, where the first attribute of each will be a
byte array containing one or more BIN-encoded features.</p>
<p>In GeoServer you can use the <code class="docutils literal notranslate"><span class="pre">BinConversionProcess</span></code>. Otherwise, the encoding is controlled through the
following query hints:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 29%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>GeoServer Conversion</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>QueryHints.BIN_TRACK</p></td>
<td><p>String</p></td>
<td rowspan="6"><p>Use WPS</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.BIN_GEOM</p></td>
<td><p>String (optional)</p></td>
</tr>
<tr class="row-even"><td><p>QueryHints.BIN_DTG</p></td>
<td><p>String (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.BIN_LABEL</p></td>
<td><p>String (optional)</p></td>
</tr>
<tr class="row-even"><td><p>QueryHints.BIN_SORT</p></td>
<td><p>Boolean (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>QueryHints.BIN_BATCH_SIZE</p></td>
<td><p>Integer (optional)</p></td>
</tr>
</tbody>
</table>
<section id="id4">
<h3><span class="section-number">7.14.5.1. </span>Explanation of Hints<a class="headerlink" href="#id4" title="Permalink to this headline">Â¶</a></h3>
<section id="bin-track">
<h4><span class="section-number">7.14.5.1.1. </span>BIN_TRACK<a class="headerlink" href="#bin-track" title="Permalink to this headline">Â¶</a></h4>
<p>This hint is used to trigger a BIN query. It should be the name of an attribute that will be used to
generate the track ID for each record.</p>
</section>
<section id="bin-geom">
<h4><span class="section-number">7.14.5.1.2. </span>BIN_GEOM<a class="headerlink" href="#bin-geom" title="Permalink to this headline">Â¶</a></h4>
<p>This hint controls the geometry attribute used for each record. If omitted, the default geometry of the
feature type is used.</p>
</section>
<section id="bin-dtg">
<h4><span class="section-number">7.14.5.1.3. </span>BIN_DTG<a class="headerlink" href="#bin-dtg" title="Permalink to this headline">Â¶</a></h4>
<p>This hint controls the date attribute used for each record. If omitted, the default date of the feature type
is used.</p>
</section>
<section id="bin-label">
<h4><span class="section-number">7.14.5.1.4. </span>BIN_LABEL<a class="headerlink" href="#bin-label" title="Permalink to this headline">Â¶</a></h4>
<p>This hint will trigger the creation of 24-byte records, instead of the standard 16. It should be the
name of an attribute that will be used to generate the label for each record.</p>
</section>
<section id="bin-sort">
<h4><span class="section-number">7.14.5.1.5. </span>BIN_SORT<a class="headerlink" href="#bin-sort" title="Permalink to this headline">Â¶</a></h4>
<p>This hint will cause the records to be sorted. It should be the name of an attribute in the feature type.</p>
</section>
<section id="bin-batch-size">
<h4><span class="section-number">7.14.5.1.6. </span>BIN_BATCH_SIZE<a class="headerlink" href="#bin-batch-size" title="Permalink to this headline">Â¶</a></h4>
<p>This hint controls the batch size used when generating BIN records.</p>
</section>
</section>
<section id="id5">
<h3><span class="section-number">7.14.5.2. </span>Example Query<a class="headerlink" href="#id5" title="Permalink to this headline">Â¶</a></h3>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-U2NhbGE=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="0">Scala</button></div><div aria-labelledby="tab-4-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" id="panel-4-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">java</span><span class="p">.</span><span class="nn">io</span><span class="p">.</span><span class="nc">ByteArrayOutputStream</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">geotools</span><span class="p">.</span><span class="nn">data</span><span class="p">.</span><span class="nc">Transaction</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">index</span><span class="p">.</span><span class="nn">conf</span><span class="p">.</span><span class="nc">QueryHints</span>

<span class="n">query</span><span class="p">.</span><span class="n">getHints</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">QueryHints</span><span class="p">.</span><span class="nc">BIN_TRACK</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataStore</span><span class="p">.</span><span class="n">getFeatureReader</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="nc">Transaction</span><span class="p">.</span><span class="nc">AUTO_COMMIT</span><span class="p">)</span>
<span class="kd">val</span><span class="w"> </span><span class="n">os</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">ByteArrayOutputStream</span><span class="p">()</span>

<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">hasNext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">os</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="n">getAttribute</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="k">asInstanceOf</span><span class="p">[</span><span class="nc">Array</span><span class="p">[</span><span class="nc">Byte</span><span class="p">]])</span>
<span class="p">}</span>
<span class="n">reader</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">// process bytes appropriately</span>
</pre></div>
</div>
</div></div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="filter_functions.html" class="btn btn-neutral float-left" title="7.13. Filter Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="security.html" class="btn btn-neutral float-right" title="7.15. Data Security" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2023 <a href="https://www.ga-ccri.com/">General Atomics</a>
    <br/>
    Licensed under the <a href="https://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

<div role="contentinfo">
  <p>
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
    using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>
    - contribute to this page on
    <a href="https://github.com/locationtech/geomesa/edit/main/docs/user/datastores/analytic_queries.rst">GitHub <img src="../../_static/launch.svg"/></a>
  </p>

</div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>