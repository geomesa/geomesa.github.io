

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.1. Installing GeoMesa HBase &mdash; GeoMesa 1.4.0-SNAPSHOT Manuals</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.7/segment.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.7/menu.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="GeoMesa 1.4.0-SNAPSHOT Manuals" href="../../index.html"/>
        <link rel="up" title="8. HBase Data Store" href="index.html"/>
        <link rel="next" title="8.2. Using the HBase Data Store Programmatically" href="usage.html"/>
        <link rel="prev" title="8. HBase Data Store" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.4.0-SNAPSHOT
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">2. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">4. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">5. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastores/index.html">6. GeoMesa Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">7. Accumulo Data Store</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">8. HBase Data Store</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">8.1. Installing GeoMesa HBase</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing-the-binary-distribution">8.1.1. Installing the Binary Distribution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-and-classpaths">8.1.2. Configuration and Classpaths</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deploying-the-geomesa-hbase-distributed-runtime-jar">8.1.3. Deploying the GeoMesa HBase distributed runtime jar</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-from-source">8.1.4. Building from Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="#register-the-coprocessors">8.1.5. Register the Coprocessors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-geomesa-hbase-in-geoserver">8.1.6. Installing GeoMesa HBase in GeoServer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connecting-to-external-hbase-clusters-backed-by-s3">8.1.7. Connecting to External HBase Clusters Backed By S3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="usage.html">8.2. Using the HBase Data Store Programmatically</a></li>
<li class="toctree-l3"><a class="reference internal" href="geoserver.html">8.3. Using the HBase Data Store in GeoServer</a></li>
<li class="toctree-l3"><a class="reference internal" href="heatmaps.html">8.4. HBase Heatmaps</a></li>
<li class="toctree-l3"><a class="reference internal" href="visibilities.html">8.5. HBase Visibilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="kerberos.html">8.6. Kerberos</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../bigtable/index.html">9. Bigtable Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">10. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">11. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">12. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem/index.html">13. FileSystem Datastore (Amazon S3, HDFS Datastore)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">14. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blobstore.html">15. GeoMesa Blob Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">16. GeoMesa Convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geojson.html">17. GeoMesa GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">18. GeoMesa Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_api.html">19. GeoMesa Native API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi.html">20. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">21. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">22. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">23. GeoMesa Stream Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web_data.html">24. GeoMesa Web Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade.html">25. Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GeoMesa</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User Manual</a> &raquo;</li>
        
          <li><a href="index.html">8. HBase Data Store</a> &raquo;</li>
        
      <li>8.1. Installing GeoMesa HBase</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/user/hbase/install.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installing-geomesa-hbase">
<h1>8.1. Installing GeoMesa HBase<a class="headerlink" href="#installing-geomesa-hbase" title="Permalink to this headline">¶</a></h1>
<p>GeoMesa supports traditional HBase installations as well as HBase running on <a class="reference external" href="https://aws.amazon.com/emr/">Amazon&#8217;s EMR</a>
and <a class="reference external" href="https://hortonworks.com/products/data-center/hdp/">Hortonworks&#8217; Data Platform (HDP)</a>. For instructions on
bootstrapping an EMR cluster, please read this tutorial: <a class="reference internal" href="../../tutorials/geomesa-hbase-s3-on-aws.html"><span class="doc">Bootstrapping GeoMesa HBase on AWS S3</span></a>.</p>
<div class="section" id="installing-the-binary-distribution">
<span id="setting-up-hbase-commandline"></span><h2>8.1.1. Installing the Binary Distribution<a class="headerlink" href="#installing-the-binary-distribution" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa HBase artifacts are available for download or can be built from source.
The easiest way to get started is to download the most recent binary version (<code class="docutils literal"><span class="pre">$VERSION</span></code> = 1.4.0-SNAPSHOT)
and untar it somewhere convenient:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Install to /opt/ adapt as needed for your environment</span>
$ wget http://repo.locationtech.org/content/repositories/geomesa-releases/org/locationtech/geomesa/geomesa-hbase-dist_2.11/<span class="nv">$VERSION</span>/geomesa-hbase-dist_2.11-<span class="nv">$VERSION</span>-bin.tar.gz
$ tar xvf geomesa-hbase-dist_2.11-<span class="nv">$VERSION</span>-bin.tar.gz -C /opt/

<span class="c1"># Add symbolic links</span>
$ ln -s /opt/geomesa-hbase-dist_2.11-<span class="nv">$VERSION</span> /opt/geomesa
$ ls /opt/geomesa
bin/  conf/  dist/  docs/  examples/  lib/  LICENSE.txt  logs/
</pre></div>
</div>
</div>
<div class="section" id="configuration-and-classpaths">
<h2>8.1.2. Configuration and Classpaths<a class="headerlink" href="#configuration-and-classpaths" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa HBase requires Hadoop and HBase jars and configuration files to be available on the classpath. This includes
files such as the hbase-site.xml and core-site.xml files in addition to standard jars and libraries. Configuring the
classpath is important if you plan to use the GeoMesa HBase command line tools to ingest and manage GeoMesa.</p>
<p>By default, GeoMesa HBase will attempt to read various HBase and Hadoop related environmental variables in order to
build the classpath. You can configure environment variables and classpath settings in
<code class="docutils literal"><span class="pre">geomesa-hbase_2.11-$VERSION/conf/geomesa-env.sh</span></code> or in your external env (e.g. bashrc file). The logic GeoMesa
uses to determine which external entries to include on the classpath is:</p>
<blockquote>
<div><p>1. If the environmental variables <code class="docutils literal"><span class="pre">GEOMESA_HADOOP_CLASSPATH</span></code> and <code class="docutils literal"><span class="pre">GEOMESA_HBASE_CLASSPATH</span></code> are set then GeoMesa
HBase will use these variables to set the classpath and skip all other logic.</p>
<p>2. Next, if <code class="docutils literal"><span class="pre">$HBASE_HOME</span></code> and <code class="docutils literal"><span class="pre">$HADOOP_HOME</span></code> are set then GeoMesa HBase will attempt to build the classpath by
searching for jar files and configuration in standard locations. Note that this is very specific to the
installation or distribution of Hadoop you are using and may not be reliable.</p>
<p>3. If no environmental variables are set but the <code class="docutils literal"><span class="pre">hbase</span></code> and <code class="docutils literal"><span class="pre">hadoop</span></code> commands are available then GeoMesa will
interrogate them for their classpaths by running the <code class="docutils literal"><span class="pre">hadoop</span> <span class="pre">classpath</span></code> and <code class="docutils literal"><span class="pre">hbase</span> <span class="pre">classpath</span></code> commands. This
method of classpath determination is slow due to the fact that the <code class="docutils literal"><span class="pre">hbase</span> <span class="pre">classpath</span></code> command forks a new JVM. It
is therefore recommended that you set manually set these variables in your environment or the
<code class="docutils literal"><span class="pre">conf/geomesa-env.sh</span></code> file.</p>
</div></blockquote>
<p>In addition, <code class="docutils literal"><span class="pre">geomesa-hbase</span></code> will pull any additional entries from the <code class="docutils literal"><span class="pre">GEOMESA_EXTRA_CLASSPATHS</span></code>
environment variable.</p>
<p>Note that the <code class="docutils literal"><span class="pre">GEOMESA_EXTRA_CLASSPATHS</span></code>, <code class="docutils literal"><span class="pre">GEOMESA_HADOOP_CLASSPATH</span></code>, and <code class="docutils literal"><span class="pre">GEOMESA_HBASE_CLASSPATH</span></code> variables
all follow standard
<a class="reference external" href="http://docs.oracle.com/javase/8/docs/technotes/tools/windows/classpath.html">Java Classpath</a> conventions, which
generally means that entries must be directories, JAR, or zip files. Individual XML files will be ignored. For example,
to add a <code class="docutils literal"><span class="pre">hbase-site.xml</span></code> or <code class="docutils literal"><span class="pre">core-site.xml</span></code> file to the classpath you must either include a directory on the
classpath or add the file to a zip or JAR archive to be included on the classpath.</p>
<p>Use the <code class="docutils literal"><span class="pre">geomesa</span> <span class="pre">classpath</span></code> command in order to see what JARs are being used.</p>
<p>A few suggested configurations are below:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-amazon-emr docutils container">
Amazon EMR</div>
<div class="item sphinx-data-tab-standard docutils container">
Standard</div>
<div class="item sphinx-data-tab-hdp docutils container">
HDP</div>
<div class="item sphinx-data-tab-manual-install docutils container">
Manual Install</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-amazon-emr active docutils container">
<p>When using EMR to install HBase or Hadoop there are AWS specific jars that need to be used (e.g. EMR FS).
It is recommended to use EMR to install Hadoop and/or HBase in order to properly configure and install these
dependencies (especially when using HBase on S3).</p>
<p>If you used EMR to install Hadoop and HBase, you can view their classpaths using the <code class="docutils literal"><span class="pre">hadoop</span> <span class="pre">classpath</span></code> and
<code class="docutils literal"><span class="pre">hbase</span> <span class="pre">classpath</span></code> commands to build an appropriate classpath to include jars and configuration files for
GeoMesa HBase:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">GEOMESA_HADOOP_CLASSPATH</span><span class="o">=</span><span class="k">$(</span>hadoop classpath<span class="k">)</span>
<span class="nb">export</span> <span class="nv">GEOMESA_HBASE_CLASSPATH</span><span class="o">=</span><span class="k">$(</span>hbase classpath<span class="k">)</span>
<span class="nb">export</span> <span class="nv">GEOMESA_HBASE_HOME</span><span class="o">=</span>/opt/geomesa
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">GEOMESA_HBASE_HOME</span><span class="si">}</span><span class="s2">/bin&quot;</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-standard docutils container">
<p>Configure GeoMesa to use pre-installed HBase and Hadoop distributions:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">HADOOP_HOME</span><span class="o">=</span>/path/to/hadoop
<span class="nb">export</span> <span class="nv">HBASE_HOME</span><span class="o">=</span>/path/to/hbase
<span class="nb">export</span> <span class="nv">GEOMESA_HBASE_HOME</span><span class="o">=</span>/opt/geomesa
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">GEOMESA_HOME</span><span class="si">}</span><span class="s2">/bin&quot;</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-hdp docutils container">
<p>Configure the environment to use an HDP install</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">HADOOP_HOME</span><span class="o">=</span>/usr/hdp/current/hadoop-client/
<span class="nb">export</span> <span class="nv">HBASE_HOME</span><span class="o">=</span>/usr/hdp/current/hbase-client/
<span class="nb">export</span> <span class="nv">GEOMESA_HBASE_HOME</span><span class="o">=</span>/opt/geomesa
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">GEOMESA_HBASE_HOME</span><span class="si">}</span><span class="s2">/bin&quot;</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-manual-install docutils container">
<p>If no HBase or Hadoop distribution is installed, try manually installing the JARs from maven:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">GEOMESA_HBASE_HOME</span><span class="o">=</span>/opt/geomesa
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">GEOMESA_HBASE_HOME</span><span class="si">}</span><span class="s2">/bin&quot;</span>
<span class="nb">cd</span> GEOMESA_HBASE_HOME
bin/install-hadoop.sh lib
bin/install-hbase.sh lib
</pre></div>
</div>
<p>You will also need to provide the hbase-site.xml file within a the GeoMesa <code class="docutils literal"><span class="pre">conf</span></code> directory, an external
directory, zip, or JAR archive (an entry referencing the XML file directly will not work with the Java
classpath)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># try this</span>
cp /path/to/hbase-site.xml <span class="si">${</span><span class="nv">GEOMESA_HBASE_HOME</span><span class="si">}</span>/conf/

<span class="c1"># or this</span>
<span class="nb">export</span> <span class="nv">GEOMESA_EXTRA_CLASSPATHS</span><span class="o">=</span>/path/to/confdir:/path/to/conf.zip:/path/to/conf.jar
</pre></div>
</div>
</div>
</div>
<p>Due to licensing restrictions, dependencies for shape file support must be separately installed.
Do this with the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ bin/install-jai.sh
$ bin/install-jline.sh
</pre></div>
</div>
</div>
<div class="section" id="deploying-the-geomesa-hbase-distributed-runtime-jar">
<span id="hbase-deploy-distributed-runtime"></span><h2>8.1.3. Deploying the GeoMesa HBase distributed runtime jar<a class="headerlink" href="#deploying-the-geomesa-hbase-distributed-runtime-jar" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa uses an HBase custom filter to improve processing of CQL queries.  In order to use the custom filter, you must
deploy the distributed runtime jar to the HBase to the directory specified by the HBase configuration variable called
<code class="docutils literal"><span class="pre">hbase.dynamic.jars.dir</span></code>.  This is set to <code class="docutils literal"><span class="pre">${hbase.rootdir}/lib</span></code> by default.  Copy the distribute runtime jar to
this directory as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>hadoop fs -put <span class="si">${</span><span class="nv">GEOMESA_HBASE_HOME</span><span class="si">}</span>/dist/hbase/geomesa-hbase-distributed-runtime-<span class="nv">$VERSION</span>.jar <span class="si">${</span><span class="nv">hbase</span><span class="p">.dynamic.jars.dir</span><span class="si">}</span>/
</pre></div>
</div>
<p>If running on top of Amazon S3, you will need to use the <code class="docutils literal"><span class="pre">aws</span> <span class="pre">s3</span></code> command line tool.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>aws s3 cp <span class="si">${</span><span class="nv">GEOMESA_HBASE_HOME</span><span class="si">}</span>/dist/hbase/geomesa-hbase-distributed-runtime-<span class="nv">$VERSION</span>.jar s3://<span class="si">${</span><span class="nv">hbase</span><span class="p">.dynamic.jars.dir</span><span class="si">}</span>/
</pre></div>
</div>
<p>If required, you may disable distributed processing by setting the system property <code class="docutils literal"><span class="pre">geomesa.hbase.remote.filtering</span></code>
to <code class="docutils literal"><span class="pre">false</span></code>. Note that this may have an adverse effect on performance.</p>
</div>
<div class="section" id="building-from-source">
<span id="hbase-install-source"></span><h2>8.1.4. Building from Source<a class="headerlink" href="#building-from-source" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa HBase may also be built from source. For more information refer to <a class="reference internal" href="../../developer/introduction.html#building-from-source"><span class="std std-ref">Building from Source</span></a>
in the developer manual, or to the <code class="docutils literal"><span class="pre">README.md</span></code> file in the the source distribution.
The remainder of the instructions in this chapter assume the use of the binary GeoMesa HBase
distribution. If you have built from source, the distribution is created in the <code class="docutils literal"><span class="pre">target</span></code> directory of
<code class="docutils literal"><span class="pre">geomesa-hbase/geomesa-hbase-dist</span></code>.</p>
<p>More information about developing with GeoMesa may be found in the <a class="reference internal" href="../../developer/index.html"><span class="doc">Developer Manual</span></a>.</p>
</div>
<div class="section" id="register-the-coprocessors">
<span id="registering-coprocessors"></span><h2>8.1.5. Register the Coprocessors<a class="headerlink" href="#register-the-coprocessors" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa utilizes server side processing to accelerate some queries. Currently the only processing done server side is
density (heatmap) calculations. In order to utilize this feature the GeoMesa coprocessor must be registered on all GeoMesa tables
or registered site-wide and the <code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> code must be available on the classpath or at an
HDFS url, depending on the registration method used.</p>
<p>There are a number of ways to register the coprocessors, which are detailed later.</p>
<p>The following ways to register coprocessors can be done anytime and constitute the &#8216;upgrade path&#8217;, however, they may
require HBase or tables to be taken offline.</p>
<blockquote>
<div><ul class="simple">
<li>Register Site-Wide using the <code class="docutils literal"><span class="pre">hbase-site.xml</span></code></li>
<li>Register Per-Table using the <code class="docutils literal"><span class="pre">hbase</span> <span class="pre">shell</span></code></li>
</ul>
</div></blockquote>
<p>The following ways to register coprocessors must be done <strong>before</strong> the tables are created.</p>
<blockquote>
<div><ul class="simple">
<li>Classpath Auto-Registration</li>
<li>System Property or geomesa-site.xml</li>
<li>DataStore Param Registration</li>
</ul>
</div></blockquote>
<p>There are two ways to get the coprocessor code on the classpath.</p>
<blockquote>
<div><ul class="simple">
<li>Modify the <code class="docutils literal"><span class="pre">hbase-env.sh</span></code> file and provide the path to the <code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> JAR in the
<code class="docutils literal"><span class="pre">HBASE_CLASSPATH</span></code> property. If this method is used, the <code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> JAR must be available at
the given location on all master and region servers.</li>
<li>If registering the coprocessors on a per-table basis using the hbase shell, it is possible to provide the HDFS path to the
<code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> JAR that was deployed in <a class="reference internal" href="#hbase-deploy-distributed-runtime"><span class="std std-ref">Deploying the GeoMesa HBase distributed runtime jar</span></a>.</li>
</ul>
</div></blockquote>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0 docutils container">
Site-Wide</div>
<div class="item sphinx-data-tab-1 docutils container">
Per-Table</div>
<div class="item sphinx-data-tab-2 docutils container">
Classpath</div>
<div class="item sphinx-data-tab-3 docutils container">
System-Property</div>
<div class="item sphinx-data-tab-4 docutils container">
DS-Parameter</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0 active docutils container">
<p>The easiest method to register the coprocessors is to specify the coprocessors in the <code class="docutils literal"><span class="pre">hbase-site.xml</span></code>.
To do this simply add the coprocessors classname to the <code class="docutils literal"><span class="pre">hbase.coprocessor.user.region.classes</span></code> key.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>hbase.coprocessor.user.region.classes<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;value&gt;</span>org.locationtech.geomesa.hbase.coprocessor.GeoMesaCoprocessor<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<p>All new and existing non-system tables will have access to the GeoMesa Coprocessor.</p>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1 docutils container">
<p>If your hbase instance is used for more than GeoMesa table or would like to utilize HDFS to deploy the
<code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> JAR or for some other reason do not wish to register the coprocessor
site wide you may configure the coprocessor on a per-table basis. This can be done by utilizing the the hbase shell
as shown below. When specifying a coprocessor, the coprocessor must be available on the HBase classpath on all
of the master and region servers or you must provide the HDFS URL for the <code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> JAR that
was deployed in <a class="reference internal" href="#hbase-deploy-distributed-runtime"><span class="std std-ref">Deploying the GeoMesa HBase distributed runtime jar</span></a>.</p>
<p>To run the hbase shell simply execute:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="si">${</span><span class="nv">HBASE_HOME</span><span class="si">}</span>/bin/hbase shell
HBase Shell<span class="p">;</span> enter <span class="s1">&#39;help&lt;RETURN&gt;&#39;</span> <span class="k">for</span> list of supported commands.
Type <span class="s2">&quot;exit&lt;RETURN&gt;&quot;</span> to leave the HBase Shell
hbase<span class="o">(</span>main<span class="o">)</span>:001:0&gt;
</pre></div>
</div>
<p>To get a list of the current tables run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>hbase<span class="o">(</span>main<span class="o">)</span>:001:0&gt; list
TABLE
geomesa
geomesa_QuickStart_id
geomesa_QuickStart_z2
geomesa_QuickStart_z3
<span class="m">4</span> row<span class="o">(</span>s<span class="o">)</span> in <span class="m">0</span>.1380 seconds
</pre></div>
</div>
<p>You will need to install the coprocessor on all table indexes list. The <code class="docutils literal"><span class="pre">geomesa</span></code> table in this example is the metadata
table and does not need the coprocessor installed.</p>
<p>We use the <code class="docutils literal"><span class="pre">alter</span></code> command to modify the configuration of the tables. The <code class="docutils literal"><span class="pre">coprocessor</span></code> parameter in the <code class="docutils literal"><span class="pre">alter</span></code>
command may be modified to change the registration of the GeoMesa coprocessors.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="s1">&#39;coprocessor&#39;</span><span class="o">=</span>&gt;<span class="s1">&#39;HDFS_URL|org.locationtech.geomesa.hbase.coprocessor.GeoMesaCoprocessor|PRIORITY|&#39;</span>
</pre></div>
</div>
<p>The &#8216;value&#8217; of the <code class="docutils literal"><span class="pre">coprocessor</span></code> parameter has four parts, separated by <code class="docutils literal"><span class="pre">|</span></code>, two of which, <code class="docutils literal"><span class="pre">HDFS_URL</span></code> and
<code class="docutils literal"><span class="pre">PRIORITY</span></code>, are configurable depending on your environment.</p>
<blockquote>
<div><ul class="simple">
<li>To provide the HDFS URL of the <code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> JAR replace HDFS_URL in the coprocessor value with the
HDFS URL. This is only need if the <code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> JAR will not be on the classpath by other means.</li>
<li>To alter the priority (execution order) of the coprocessor change PRIRORITY to the desired value, this is optional and
should be left blank if now used.</li>
</ul>
</div></blockquote>
<div class="highlight-bash"><div class="highlight"><pre><span></span>hbase<span class="o">(</span>main<span class="o">)</span>:040:0&gt; alter <span class="s1">&#39;geomesa_QuickStart_id&#39;</span>, <span class="nv">METHOD</span> <span class="o">=</span>&gt; <span class="s1">&#39;table_att&#39;</span>, <span class="s1">&#39;coprocessor&#39;</span><span class="o">=</span>&gt;<span class="s1">&#39;|org.locationtech.geomesa.hbase.coprocessor.GeoMesaCoprocessor||&#39;</span>
Updating all regions with the new schema...
<span class="m">22</span>/22 regions updated.
Done.
<span class="m">0</span> row<span class="o">(</span>s<span class="o">)</span> in <span class="m">5</span>.0000 seconds

hbase<span class="o">(</span>main<span class="o">)</span>:041:0&gt; alter <span class="s1">&#39;geomesa_QuickStart_z2&#39;</span>, <span class="nv">METHOD</span> <span class="o">=</span>&gt; <span class="s1">&#39;table_att&#39;</span>, <span class="s1">&#39;coprocessor&#39;</span><span class="o">=</span>&gt;<span class="s1">&#39;|org.locationtech.geomesa.hbase.coprocessor.GeoMesaCoprocessor||&#39;</span>
Updating all regions with the new schema...
<span class="m">4</span>/4 regions updated.
Done.
<span class="m">0</span> row<span class="o">(</span>s<span class="o">)</span> in <span class="m">2</span>.8850 seconds

hbase<span class="o">(</span>main<span class="o">)</span>:042:0&gt; alter <span class="s1">&#39;geomesa_QuickStart_z3&#39;</span>, <span class="nv">METHOD</span> <span class="o">=</span>&gt; <span class="s1">&#39;table_att&#39;</span>, <span class="s1">&#39;coprocessor&#39;</span><span class="o">=</span>&gt;<span class="s1">&#39;|org.locationtech.geomesa.hbase.coprocessor.GeoMesaCoprocessor||&#39;</span>
Updating all regions with the new schema...
<span class="m">4</span>/4 regions updated.
Done.
<span class="m">0</span> row<span class="o">(</span>s<span class="o">)</span> in <span class="m">2</span>.9150 seconds
</pre></div>
</div>
<p>To verify this worked successfully, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>hbase<span class="o">(</span>main<span class="o">)</span>:002:0&gt; describe <span class="s1">&#39;TABLE_NAME&#39;</span>
Table TABLE_NAME is ENABLED
TABLE_NAME, <span class="o">{</span><span class="nv">TABLE_ATTRIBUTES</span> <span class="o">=</span>&gt; <span class="o">{</span>coprocessor<span class="nv">$1</span> <span class="o">=</span>&gt; <span class="s1">&#39;|org.locationtech.geomesa.hbase.coprocessor.GeoMesaCoprocessor||&#39;</span><span class="o">}</span>
COLUMN FAMILIES DESCRIPTION
<span class="o">{</span><span class="nv">NAME</span> <span class="o">=</span>&gt; <span class="s1">&#39;m&#39;</span>, <span class="nv">BLOOMFILTER</span> <span class="o">=</span>&gt; <span class="s1">&#39;ROW&#39;</span>, <span class="nv">VERSIONS</span> <span class="o">=</span>&gt; <span class="s1">&#39;1&#39;</span>, <span class="nv">IN_MEMORY</span> <span class="o">=</span>&gt; <span class="s1">&#39;false&#39;</span>, <span class="nv">KEEP_DELETED_CELLS</span> <span class="o">=</span>&gt; <span class="s1">&#39;FALSE&#39;</span>, DATA_BLOCK_EN
<span class="nv">CODING</span> <span class="o">=</span>&gt; <span class="s1">&#39;NONE&#39;</span>, <span class="nv">TTL</span> <span class="o">=</span>&gt; <span class="s1">&#39;FOREVER&#39;</span>, <span class="nv">COMPRESSION</span> <span class="o">=</span>&gt; <span class="s1">&#39;NONE&#39;</span>, <span class="nv">MIN_VERSIONS</span> <span class="o">=</span>&gt; <span class="s1">&#39;0&#39;</span>, <span class="nv">BLOCKCACHE</span> <span class="o">=</span>&gt; <span class="s1">&#39;true&#39;</span>, <span class="nv">BLOCKSIZE</span> <span class="o">=</span>&gt; <span class="s1">&#39;655</span>
<span class="s1">36&#39;</span>, <span class="nv">REPLICATION_SCOPE</span> <span class="o">=</span>&gt; <span class="s1">&#39;0&#39;</span><span class="o">}</span>
<span class="m">1</span> row<span class="o">(</span>s<span class="o">)</span> in <span class="m">0</span>.1940 seconds
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-2 docutils container">
If the <code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> JAR is available on the HBase classpath when the table is created then the
GeoMesa coprocessors will be automatically registered for that table.</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-3 docutils container">
<p>System Property or geomesa-site.xml are essentially the same as they utilize the same mechanism, but two
different approaches.</p>
<p>If the Java system property <code class="docutils literal"><span class="pre">geomesa.hbase.coprocessor.path</span></code> is set in the environment running the GeoMesa ingest
then the HDFS or S3 URL provided as the value will be automatically registered in the table descriptor. There are three
to do this.</p>
<ul class="simple">
<li>Set the system property in your shell environment using the <code class="docutils literal"><span class="pre">JAVA_TOOL_OPTIONS</span></code> environment variable.</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">JAVA_TOOL_OPTIONS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JAVA_TOOL_OPTIONS</span><span class="si">}</span><span class="s2"> -Dgeomesa.hbase.coprocessor.path=hdfs://path/to/geomesa-runtime.jar&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>Set the system property in the <code class="docutils literal"><span class="pre">geomesa-env.sh</span></code> script.</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>setvar CUSTOM_JAVA_OPTS <span class="s2">&quot;</span><span class="si">${</span><span class="nv">JAVA_OPTS</span><span class="si">}</span><span class="s2"> -Dgeomesa.hbase.coprocessor.path=hdfs://path/to/geomesa-runtime.jar&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>Set the system property using the <code class="docutils literal"><span class="pre">geomesa-site.xml</span></code> configuration file.</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>geomesa.hbase.coprocessor.path<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;value&gt;</span>hdfs://path/to/geomesa-runtime.jar<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;description&gt;</span>HDFS or local path to GeoMesa-HBase Coprocessor JAR. If a local path is provided it must be the same for
        all region server. A path provided through the DataStore parameters will always override this property.
    <span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;final&gt;</span>false<span class="nt">&lt;/final&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-4 docutils container">
If you are using GeoMesa-HBase programmatically you can use the datastore parameter <code class="docutils literal"><span class="pre">coprocessor.url</span></code> to set an HDFS or
S3 path to the <code class="docutils literal"><span class="pre">geomesa-hbase-distributed-runtime</span></code> JAR.</div>
</div>
<p>For more information on managing coprocessors see
<a class="reference external" href="https://blogs.apache.org/hbase/entry/coprocessor_introduction">Coprocessor Introduction</a> on Apache&#8217;s Blog.</p>
</div>
<div class="section" id="installing-geomesa-hbase-in-geoserver">
<h2>8.1.6. Installing GeoMesa HBase in GeoServer<a class="headerlink" href="#installing-geomesa-hbase-in-geoserver" title="Permalink to this headline">¶</a></h2>
<p>The HBase GeoServer plugin is bundled by default in a GeoMesa binary distribution. To install, extract
<code class="docutils literal"><span class="pre">$GEOMESA_HBASE_HOME/dist/gs-plugins/geomesa-hbase-gs-plugin_2.11-$VERSION-install.tar.gz</span></code> into GeoServer&#8217;s
<code class="docutils literal"><span class="pre">WEB-INF/lib</span></code> directory. Note that this plugin contains a shaded JAR with HBase 1.2.3
bundled. If you require a different version, modify the <code class="docutils literal"><span class="pre">pom.xml</span></code> and build the GeoMesa HBase plugin project from
scratch with Maven.</p>
<p>This distribution does not include the Hadoop or Zookeeper JARs; the following JARs
should be copied from the <code class="docutils literal"><span class="pre">lib</span></code> directory of your HBase or Hadoop installations into
GeoServer&#8217;s <code class="docutils literal"><span class="pre">WEB-INF/lib</span></code> directory:</p>
<p>(Note the versions may vary depending on your installation.)</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-standard docutils container">
Standard</div>
<div class="item sphinx-data-tab-hdp docutils container">
HDP</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-standard active docutils container">
<ul class="simple">
<li>hadoop-annotations-2.7.4.jar</li>
<li>hadoop-auth-2.7.4.jar</li>
<li>hadoop-common-2.7.4.jar</li>
<li>hadoop-mapreduce-client-core-2.7.4.jar</li>
<li>hadoop-yarn-api-2.7.4.jar</li>
<li>hadoop-yarn-common-2.7.4.jar</li>
<li>htrace-core-3.1.0-incubating.jar</li>
<li>commons-cli-1.2.jar</li>
<li>commons-io-2.5.jar (you may need to remove an older version (2.1) from geoserver)</li>
<li>hbase-common-1.2.6.jar</li>
<li>hbase-client-1.2.6.jar</li>
<li>hbase-server-1.2.6.jar</li>
<li>hbase-protocol-1.2.6.jar</li>
<li>metrics-core-2.2.0.jar</li>
<li>netty-3.6.2.Final.jar</li>
<li>netty-all-4.0.41.Final.jar</li>
<li>zookeeper-3.4.10.jar</li>
<li>commons-configuration-1.6.jar</li>
</ul>
<p>You can use the bundled <code class="docutils literal"><span class="pre">$GEOMESA_HBASE_HOME/bin/install-hadoop.sh</span></code> script to install these JARs.</p>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-hdp docutils container">
<ul class="simple">
<li>hadoop-annotations.jar</li>
<li>hadoop-auth.jar</li>
<li>hadoop-common.jar</li>
<li>protobuf-java.jar</li>
<li>commons-io.jar</li>
<li>hbase-server-1.2.6.jar</li>
<li>zookeeper-3.4.10.jar</li>
<li>commons-configuration-1.6.jar</li>
</ul>
</div>
</div>
<p>The HBase data store requires the configuration file <code class="docutils literal"><span class="pre">hbase-site.xml</span></code> to be on the classpath. This can
be accomplished by placing the file in <code class="docutils literal"><span class="pre">geoserver/WEB-INF/classes</span></code> (you should make the directory if it
doesn&#8217;t exist). Utilizing a symbolic link will be use full here so any changes are reflected in GeoServer.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-standard docutils container">
Standard</div>
<div class="item sphinx-data-tab-hdp docutils container">
HDP</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-standard active docutils container">
<div class="highlight-bash"><div class="highlight"><pre><span></span>ln -s /path/to/hbase-site.xml /path/to/geoserver/WEB-INF/classes/hbase-site.xml
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-hdp docutils container">
<div class="highlight-bash"><div class="highlight"><pre><span></span>ln -s /usr/hdp/current/hbase-client/hbase-site.xml /path/to/geoserver/WEB-INF/classes/hbase-site.xml
</pre></div>
</div>
</div>
</div>
<p>Restart GeoServer after the JARs are installed.</p>
</div>
<div class="section" id="connecting-to-external-hbase-clusters-backed-by-s3">
<h2>8.1.7. Connecting to External HBase Clusters Backed By S3<a class="headerlink" href="#connecting-to-external-hbase-clusters-backed-by-s3" title="Permalink to this headline">¶</a></h2>
<p>To use a EMR cluster to connect to an existing, external HBase Cluster first follow the above instructions to setup the
new cluster and install GeoMesa.</p>
<p>The next step is to obtain the <code class="docutils literal"><span class="pre">hbase-site.xml</span></code> for the external HBase Cluster, copy to the new EMR cluster and
copy it into <code class="docutils literal"><span class="pre">${GEOMESA_HBASE_HOME}/conf</span></code>. At this point you may run the geomesa-hbase command line tools.</p>
<p>If you wish to execute SQL queries using Spark, you must first zip the <code class="docutils literal"><span class="pre">hbase-site.xml</span></code> file for the external cluster:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>zip hbase-site.zip hbase-site.xml
</pre></div>
</div>
<p>Then copy the zip file to  <code class="docutils literal"><span class="pre">${GEOMESA_HBASE_HOME}/conf</span></code> then add the zipped configuration file to the Spark classpath:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SPARK_JARS</span><span class="o">=</span>file:///opt/geomesa/dist/spark/geomesa-hbase-spark-runtime_2.11-<span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span>.jar,file:///opt/geomesa/conf/hbase-site.zip
</pre></div>
</div>
<p>Then start up the Spark shell:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>spark-shell --jars <span class="nv">$SPARK_JARS</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usage.html" class="btn btn-neutral float-right" title="8.2. Using the HBase Data Store Programmatically" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="8. HBase Data Store" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2017 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.4.0-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../_static/sphinx_tabs/tabs.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>