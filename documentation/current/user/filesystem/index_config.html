<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>19.7. Index Configuration &mdash; GeoMesa 3.5.1 Manuals</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="canonical" href="https://www.geomesa.org/documentation/user/filesystem/index_config.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/tabs.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="19.8. Partition Schemes" href="partition_schemes.html" />
    <link rel="prev" title="19.6. FileSystem DataStore Configuration" href="configuration.html" />


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          </a>
              <div class="version">
                4.0.0-SNAPSHOT
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">2. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">3. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">4. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">5. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geotools.html">6. GeoTools Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastores/index.html">7. GeoMesa Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/index.html">8. Command-Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">9. GeoMesa Converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">10. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">11. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi/index.html">12. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">13. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">14. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">15. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">16. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">17. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../redis/index.html">18. Redis Data Store</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">19. FileSystem Data Store</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="architecture.html">19.1. Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html">19.2. Installing GeoMesa FileSystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html">19.3. Using the FileSystem Data Store Programmatically</a></li>
<li class="toctree-l3"><a class="reference internal" href="geoserver.html">19.4. Using the FileSystem Data Store in GeoServer</a></li>
<li class="toctree-l3"><a class="reference internal" href="commandline.html">19.5. FileSystem Command-Line Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">19.6. FileSystem DataStore Configuration</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">19.7. Index Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuring-the-file-encoding">19.7.1. Configuring the File Encoding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-the-partition-scheme">19.7.2. Configuring the Partition Scheme</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-leaf-storage">19.7.3. Configuring Leaf Storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-target-file-size">19.7.4. Configuring Target File Size</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-metadata-persistence">19.7.5. Configuring Metadata Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-custom-observer-callbacks">19.7.6. Configuring Custom Observer Callbacks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="partition_schemes.html">19.8. Partition Schemes</a></li>
<li class="toctree-l3"><a class="reference internal" href="metadata.html">19.9. FileSystem Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="modify_features.html">19.10. Modifying Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="example.html">19.11. FileSystem Data Store Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="spark_example.html">19.12. FileSystem Data Store Spark SQL Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../postgis/index.html">20. Partitioned PostGIS Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">21. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds_views.html">22. Combined Data Store Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade.html">23. Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GeoMesa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">User Manual</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">19. </span>FileSystem Data Store</a></li>
      <li class="breadcrumb-item active"><span class="section-number">19.7. </span>Index Configuration</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="index-configuration">
<span id="fsds-index-config"></span><h1><span class="section-number">19.7. </span>Index Configuration<a class="headerlink" href="#index-configuration" title="Permalink to this headline">¶</a></h1>
<p>When creating a new feature type using the GeoMesa FileSystem data store (FSDS), there are several required options
that must be specified. Through the command line tools, these options are exposed as flags. If using the GeoTools
data store API, the options must be set as user data before calling <code class="docutils literal notranslate"><span class="pre">createSchema</span></code>.</p>
<section id="configuring-the-file-encoding">
<h2><span class="section-number">19.7.1. </span>Configuring the File Encoding<a class="headerlink" href="#configuring-the-file-encoding" title="Permalink to this headline">¶</a></h2>
<p>The FSDS currently supports three options for file encoding: <code class="docutils literal notranslate"><span class="pre">orc</span></code>, <code class="docutils literal notranslate"><span class="pre">parquet</span></code>, and <code class="docutils literal notranslate"><span class="pre">converter</span></code>. Both ORC and
Parquet support reading and writing, while <code class="docutils literal notranslate"><span class="pre">converter</span></code> is a synthetic, read-only format that supports querying
a wide variety of data files using the <a class="reference internal" href="../convert/index.html#converters"><span class="std std-ref">GeoMesa Converters</span></a> API.</p>
<p>File encoding can be specified through the user data key <code class="docutils literal notranslate"><span class="pre">geomesa.fs.encoding</span></code>:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-SmF2YQ==" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-SmF2YQ==" name="SmF2YQ==" role="tab" tabindex="0">Java</button><button aria-controls="panel-0-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-0-SmF2YQ==" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-SmF2YQ==" name="SmF2YQ==" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.fs.storage.common.interop.ConfigurationUtils</span><span class="p">;</span>

<span class="n">SimpleFeatureType</span><span class="w"> </span><span class="n">sft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="c1">// use the utility method</span>
<span class="n">ConfigurationUtils</span><span class="p">.</span><span class="na">setEncoding</span><span class="p">(</span><span class="n">sft</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parquet&quot;</span><span class="p">);</span>
<span class="c1">// or set directly in the user data</span>
<span class="n">sft</span><span class="p">.</span><span class="na">getUserData</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.encoding&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parquet&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">fs</span><span class="p">.</span><span class="nn">storage</span><span class="p">.</span><span class="nn">common</span><span class="p">.</span><span class="nc">RichSimpleFeatureType</span>

<span class="kd">val</span><span class="w"> </span><span class="n">sft</span><span class="p">:</span><span class="w"> </span><span class="nc">SimpleFeatureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">???</span>
<span class="c1">// use the implicit method from RichSimpleFeatureType</span>
<span class="n">sft</span><span class="p">.</span><span class="n">setEncoding</span><span class="p">(</span><span class="s">&quot;parquet&quot;</span><span class="p">)</span>
<span class="c1">// or set directly in the user data</span>
<span class="n">sft</span><span class="p">.</span><span class="n">getUserData</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.encoding&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parquet&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div></div>
</section>
<section id="configuring-the-partition-scheme">
<span id="partition-scheme-config"></span><h2><span class="section-number">19.7.2. </span>Configuring the Partition Scheme<a class="headerlink" href="#configuring-the-partition-scheme" title="Permalink to this headline">¶</a></h2>
<p>Partition schemes define how data files are laid out in folders on the file system. Schemes are defined by a
well-known name, and an optional map of configuration values. See <a class="reference internal" href="partition_schemes.html#fsds-partition-schemes"><span class="std std-ref">Partition Schemes</span></a> for more details.</p>
<p>Partition schemes can be specified through the user data key <code class="docutils literal notranslate"><span class="pre">geomesa.fs.scheme</span></code>:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-SmF2YQ==" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-SmF2YQ==" name="SmF2YQ==" role="tab" tabindex="0">Java</button><button aria-controls="panel-1-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-1-SmF2YQ==" class="sphinx-tabs-panel code-tab group-tab" id="panel-1-SmF2YQ==" name="SmF2YQ==" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.fs.storage.common.interop.ConfigurationUtils</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collections</span><span class="p">;</span>

<span class="n">SimpleFeatureType</span><span class="w"> </span><span class="n">sft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="c1">// use the utility method</span>
<span class="n">ConfigurationUtils</span><span class="p">.</span><span class="na">setScheme</span><span class="p">(</span><span class="n">sft</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;daily&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonMap</span><span class="p">(</span><span class="s">&quot;dtg-attribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dtg&quot;</span><span class="p">));</span>
<span class="c1">// or set directly in the user data as JSON</span>
<span class="n">sft</span><span class="p">.</span><span class="na">getUserData</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.scheme&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;{ \&quot;name\&quot;: \&quot;daily\&quot;, \&quot;options\&quot;: { \&quot;dtg-attribute\&quot;: \&quot;dtg\&quot; } }&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-1-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">fs</span><span class="p">.</span><span class="nn">storage</span><span class="p">.</span><span class="nn">common</span><span class="p">.</span><span class="nc">RichSimpleFeatureType</span>

<span class="kd">val</span><span class="w"> </span><span class="n">sft</span><span class="p">:</span><span class="w"> </span><span class="nc">SimpleFeatureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">???</span>
<span class="c1">// use the implicit method from RichSimpleFeatureType</span>
<span class="n">sft</span><span class="p">.</span><span class="n">setScheme</span><span class="p">(</span><span class="s">&quot;daily&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">Map</span><span class="p">(</span><span class="s">&quot;dtg-attribute&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;dtg&quot;</span><span class="p">))</span>
<span class="c1">// or set directly in the user data</span>
<span class="n">sft</span><span class="p">.</span><span class="n">getUserData</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.scheme&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;&quot;&quot;{ &quot;name&quot;: &quot;daily&quot;, &quot;options&quot;: { &quot;dtg-attribute&quot;: &quot;dtg&quot; } }&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</section>
<section id="configuring-leaf-storage">
<h2><span class="section-number">19.7.3. </span>Configuring Leaf Storage<a class="headerlink" href="#configuring-leaf-storage" title="Permalink to this headline">¶</a></h2>
<p>Leaf storage controls the final layout of files and folders. When using leaf storage (which is enabled by default),
the last component of the partition path is used as a prefix to the data file name, instead of as a separate folder.
This can result in less directory overhead for filesystems such as S3.</p>
<p>As an example, a partition scheme of <code class="docutils literal notranslate"><span class="pre">yyyy/MM/dd</span></code> would produce a partition path like <code class="docutils literal notranslate"><span class="pre">2016/01/01</span></code>. With
leaf storage, the data files for that partition would be <code class="docutils literal notranslate"><span class="pre">2016/01/01_&lt;datafile&gt;.parquet</span></code>. If leaf storage is
disabled, the data files would be <code class="docutils literal notranslate"><span class="pre">2016/01/01/&lt;datafile&gt;.parquet</span></code>, creating an extra level of directories.</p>
<p>Leaf storage can be specified through the user data key <code class="docutils literal notranslate"><span class="pre">geomesa.fs.leaf-storage</span></code>:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-SmF2YQ==" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-SmF2YQ==" name="SmF2YQ==" role="tab" tabindex="0">Java</button><button aria-controls="panel-2-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-2-SmF2YQ==" class="sphinx-tabs-panel code-tab group-tab" id="panel-2-SmF2YQ==" name="SmF2YQ==" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.fs.storage.common.interop.ConfigurationUtils</span><span class="p">;</span>

<span class="n">SimpleFeatureType</span><span class="w"> </span><span class="n">sft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="c1">// use the utility method</span>
<span class="n">ConfigurationUtils</span><span class="p">.</span><span class="na">setLeafStorage</span><span class="p">(</span><span class="n">sft</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="c1">// or set directly in the user data as a string</span>
<span class="n">sft</span><span class="p">.</span><span class="na">getUserData</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.leaf-storage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-2-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">fs</span><span class="p">.</span><span class="nn">storage</span><span class="p">.</span><span class="nn">common</span><span class="p">.</span><span class="nc">RichSimpleFeatureType</span>

<span class="kd">val</span><span class="w"> </span><span class="n">sft</span><span class="p">:</span><span class="w"> </span><span class="nc">SimpleFeatureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">???</span>
<span class="c1">// use the implicit method from RichSimpleFeatureType</span>
<span class="n">sft</span><span class="p">.</span><span class="n">setLeafStorage</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="c1">// or set directly in the user data as a string</span>
<span class="n">sft</span><span class="p">.</span><span class="n">getUserData</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.leaf-storage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</section>
<section id="configuring-target-file-size">
<span id="fsds-file-size-config"></span><h2><span class="section-number">19.7.4. </span>Configuring Target File Size<a class="headerlink" href="#configuring-target-file-size" title="Permalink to this headline">¶</a></h2>
<p>By default data files can grow to unlimited size as more data is written and files are compacted. This may lead
to poor performance, if a file becomes too large. To manage this, a target file size can be configured through
the user data key <code class="docutils literal notranslate"><span class="pre">geomesa.fs.file-size</span></code>:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-SmF2YQ==" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-SmF2YQ==" name="SmF2YQ==" role="tab" tabindex="0">Java</button><button aria-controls="panel-3-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-3-SmF2YQ==" class="sphinx-tabs-panel code-tab group-tab" id="panel-3-SmF2YQ==" name="SmF2YQ==" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.fs.storage.common.interop.ConfigurationUtils</span><span class="p">;</span>

<span class="n">SimpleFeatureType</span><span class="w"> </span><span class="n">sft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="c1">// use the utility method</span>
<span class="n">ConfigurationUtils</span><span class="p">.</span><span class="na">setTargetFileSize</span><span class="p">(</span><span class="n">sft</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="c1">// or set directly in the user data as a string</span>
<span class="n">sft</span><span class="p">.</span><span class="na">getUserData</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.file-size&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1GB&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-3-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">fs</span><span class="p">.</span><span class="nn">storage</span><span class="p">.</span><span class="nn">common</span><span class="p">.</span><span class="nc">RichSimpleFeatureType</span>

<span class="kd">val</span><span class="w"> </span><span class="n">sft</span><span class="p">:</span><span class="w"> </span><span class="nc">SimpleFeatureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">???</span>
<span class="c1">// use the implicit method from RichSimpleFeatureType</span>
<span class="n">sft</span><span class="p">.</span><span class="n">setTargetFileSize</span><span class="p">(</span><span class="s">&quot;1GB&quot;</span><span class="p">)</span>
<span class="c1">// or set directly in the user data as a string</span>
<span class="n">sft</span><span class="p">.</span><span class="n">getUserData</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.file-size&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1GB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<p>Note that target file size can also be specified in some operations, which will override any default configured
in the feature type. See <a class="reference internal" href="commandline.html#fsds-compact-command"><span class="std std-ref">compact</span></a> and <a class="reference internal" href="commandline.html#fsds-ingest-command"><span class="std std-ref">ingest</span></a> for details. See
<a class="reference internal" href="configuration.html#fsds-size-threshold-prop"><span class="std std-ref">geomesa.fs.size.threshold</span></a> for controlling the file size error margin.</p>
</section>
<section id="configuring-metadata-persistence">
<span id="fsds-metadata-config"></span><h2><span class="section-number">19.7.5. </span>Configuring Metadata Persistence<a class="headerlink" href="#configuring-metadata-persistence" title="Permalink to this headline">¶</a></h2>
<p>The FSDS keeps metadata on partitions and data files, to avoid repeatedly interrogating the file system. By default,
metadata information is stored as a change log in the file system, which does not require any additional
infrastructure. For more advanced use-cases, the FSDS also supports persisting metadata in a relational database
using JDBC. For more information, see <a class="reference internal" href="metadata.html#fsds-metadata"><span class="std std-ref">FileSystem Metadata</span></a>.</p>
<p>Metadata persistence can be specified through the user data key <code class="docutils literal notranslate"><span class="pre">geomesa.fs.metadata</span></code>:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-SmF2YQ==" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-SmF2YQ==" name="SmF2YQ==" role="tab" tabindex="0">Java</button><button aria-controls="panel-4-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-4-SmF2YQ==" class="sphinx-tabs-panel code-tab group-tab" id="panel-4-SmF2YQ==" name="SmF2YQ==" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.fs.storage.common.interop.ConfigurationUtils</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collections</span><span class="p">;</span>

<span class="n">SimpleFeatureType</span><span class="w"> </span><span class="n">sft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="c1">// use the utility method</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonMap</span><span class="p">(</span><span class="s">&quot;jdbc.url&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;jdbc:postgresql://localhost/geomesa&quot;</span><span class="p">);</span>
<span class="n">ConfigurationUtils</span><span class="p">.</span><span class="na">setMetadata</span><span class="p">(</span><span class="n">sft</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;jdbc&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
<span class="c1">// or set directly in the user data as JSON</span>
<span class="n">sft</span><span class="p">.</span><span class="na">getUserData</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.metadata&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;{ \&quot;name\&quot;: \&quot;jdbc\&quot;, \&quot;options\&quot;: { \&quot;jdbc.url\&quot;: \&quot;jdbc:postgresql://localhost/geomesa\&quot; } }&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-4-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">fs</span><span class="p">.</span><span class="nn">storage</span><span class="p">.</span><span class="nn">common</span><span class="p">.</span><span class="nc">RichSimpleFeatureType</span>

<span class="kd">val</span><span class="w"> </span><span class="n">sft</span><span class="p">:</span><span class="w"> </span><span class="nc">SimpleFeatureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">???</span>
<span class="c1">// use the implicit method from RichSimpleFeatureType</span>
<span class="n">sft</span><span class="p">.</span><span class="n">setMetadata</span><span class="p">(</span><span class="s">&quot;jdbc&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">Map</span><span class="p">(</span><span class="s">&quot;jdbc.url&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;jdbc:postgresql://localhost/geomesa&quot;</span><span class="p">))</span>
<span class="c1">// or set directly in the user data as JSON</span>
<span class="n">sft</span><span class="p">.</span><span class="n">getUserData</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.metadata&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;&quot;&quot;{ &quot;name&quot;: &quot;jdbc&quot;, &quot;options&quot;: { &quot;jdbc.url&quot;: &quot;jdbc:postgresql://localhost/geomesa&quot; } }&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The metadata configuration supports property substitution using environment variables and Java system
properties. Property substitutions are specified using <code class="docutils literal notranslate"><span class="pre">${}</span></code> syntax, e.g. <code class="docutils literal notranslate"><span class="pre">${HOME}</span></code> or <code class="docutils literal notranslate"><span class="pre">${user.home}</span></code>.</p>
</div>
</section>
<section id="configuring-custom-observer-callbacks">
<h2><span class="section-number">19.7.6. </span>Configuring Custom Observer Callbacks<a class="headerlink" href="#configuring-custom-observer-callbacks" title="Permalink to this headline">¶</a></h2>
<p>The FSDS provides a mechanism to add custom handling during file writing. Users can implement observer factories,
which will be invoked for each new file that is created. Observer factories must extend the trait
<code class="docutils literal notranslate"><span class="pre">FileSystemObserverFactory</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">package</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">fs</span><span class="p">.</span><span class="nn">storage</span><span class="p">.</span><span class="nn">common</span><span class="p">.</span><span class="n">observer</span>

<span class="k">trait</span><span class="w"> </span><span class="nc">FileSystemObserverFactory</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Closeable</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Called once after instantiating the factory</span>
<span class="cm">   *</span>
<span class="cm">   * @param conf hadoop configuration</span>
<span class="cm">   * @param root root path</span>
<span class="cm">   * @param sft simple feature type</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">conf</span><span class="p">:</span><span class="w"> </span><span class="nc">Configuration</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">:</span><span class="w"> </span><span class="nc">Path</span><span class="p">,</span><span class="w"> </span><span class="n">sft</span><span class="p">:</span><span class="w"> </span><span class="nc">SimpleFeatureType</span><span class="p">):</span><span class="w"> </span><span class="nc">Unit</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Create an observer for the given path</span>
<span class="cm">   *</span>
<span class="cm">   * @param path file path being written</span>
<span class="cm">   * @return</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="nc">Path</span><span class="p">):</span><span class="w"> </span><span class="nc">FileSystemObserver</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Observer factories must have a default no-arg constructor in order to be instantiated by the framework.</p>
</div>
<p>Observers can be specified through the user data key <code class="docutils literal notranslate"><span class="pre">geomesa.fs.observers</span></code>:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-SmF2YQ==" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-5-SmF2YQ==" name="SmF2YQ==" role="tab" tabindex="0">Java</button><button aria-controls="panel-5-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-5-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-5-SmF2YQ==" class="sphinx-tabs-panel code-tab group-tab" id="panel-5-SmF2YQ==" name="SmF2YQ==" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.locationtech.geomesa.fs.storage.common.interop.ConfigurationUtils</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Arrays</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collections</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="n">SimpleFeatureType</span><span class="w"> </span><span class="n">sft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">factories</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;com.example.MyCustomObserverFactory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;com.example.MySecondObserverFactory&quot;</span><span class="p">);</span>
<span class="c1">// use the static utility method</span>
<span class="n">ConfigurationUtils</span><span class="p">.</span><span class="na">setObservers</span><span class="p">(</span><span class="n">sft</span><span class="p">,</span><span class="w"> </span><span class="n">factories</span><span class="p">);</span>
<span class="c1">// or set directly in the user data as a comma-delimited string</span>
<span class="n">sft</span><span class="p">.</span><span class="na">getUserData</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.observers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">factories</span><span class="p">));</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-5-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-5-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">locationtech</span><span class="p">.</span><span class="nn">geomesa</span><span class="p">.</span><span class="nn">fs</span><span class="p">.</span><span class="nn">storage</span><span class="p">.</span><span class="nn">common</span><span class="p">.</span><span class="nc">RichSimpleFeatureType</span>

<span class="kd">val</span><span class="w"> </span><span class="n">sft</span><span class="p">:</span><span class="w"> </span><span class="nc">SimpleFeatureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">???</span>
<span class="kd">val</span><span class="w"> </span><span class="n">factories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Seq</span><span class="p">(</span><span class="s">&quot;com.example.MyCustomObserverFactory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;com.example.MySecondObserverFactory&quot;</span><span class="p">)</span>
<span class="c1">// use the implicit method from RichSimpleFeatureType</span>
<span class="n">sft</span><span class="p">.</span><span class="n">setObservers</span><span class="p">(</span><span class="n">factories</span><span class="p">)</span>
<span class="c1">// or set directly in the user data as a comma-delimited string</span>
<span class="n">sft</span><span class="p">.</span><span class="n">getUserData</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;geomesa.fs.observers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">factories</span><span class="p">.</span><span class="n">mkString</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div></div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="configuration.html" class="btn btn-neutral float-left" title="19.6. FileSystem DataStore Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="partition_schemes.html" class="btn btn-neutral float-right" title="19.8. Partition Schemes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2023 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="https://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

<div role="contentinfo">
  <p>
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
    using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>
    - contribute to this page on
    <a href="https://github.com/locationtech/geomesa/edit/main/docs/user/filesystem/index_config.rst">GitHub <img src="../../_static/launch.svg"/></a>
  </p>

</div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>