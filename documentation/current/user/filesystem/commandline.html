

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>14.6. FileSystem Command-Line Tools &mdash; GeoMesa 1.4.0-SNAPSHOT Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="GeoMesa 1.4.0-SNAPSHOT Manuals" href="../../index.html"/>
        <link rel="up" title="14. FileSystem Datastore (Amazon S3, HDFS Datastore)" href="index.html"/>
        <link rel="next" title="14.7. FileSystem Datastore Example" href="example.html"/>
        <link rel="prev" title="14.5. Using the FileSystem Data Store in GeoServer" href="geoserver.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.4.0-SNAPSHOT
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">2. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">3. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">4. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">5. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastores/index.html">6. GeoMesa Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/index.html">7. Command-Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">8. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">9. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bigtable/index.html">10. Bigtable Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">11. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">12. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">13. Lambda Data Store</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">14. FileSystem Datastore (Amazon S3, HDFS Datastore)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="architecture.html">14.1. FileSystem Datastore Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="partition_schemes.html">14.2. Partition Schemes</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html">14.3. Installing GeoMesa FileSystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">14.4. FileSystem DataStore Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="geoserver.html">14.5. Using the FileSystem Data Store in GeoServer</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">14.6. FileSystem Command-Line Tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-arguments">14.6.1. General Arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#commands">14.6.2. Commands</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="example.html">14.7. FileSystem Datastore Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="sql.html">14.8. GeoMesa FileSystem Data Store with Spark SQL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">15. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blobstore.html">16. GeoMesa Blob Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">17. GeoMesa Convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geojson.html">18. GeoMesa GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">19. GeoMesa Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_api.html">20. GeoMesa Native API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi.html">21. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">22. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">23. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">24. GeoMesa Stream Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web_data.html">25. GeoMesa Web Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade.html">26. Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">User Manual</a> &raquo;</li>
      
          <li><a href="index.html">14. FileSystem Datastore (Amazon S3, HDFS Datastore)</a> &raquo;</li>
      
    <li>14.6. FileSystem Command-Line Tools</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/user/filesystem/commandline.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="filesystem-command-line-tools">
<span id="fsds-tools"></span><h1>14.6. FileSystem Command-Line Tools<a class="headerlink" href="#filesystem-command-line-tools" title="Permalink to this headline">¶</a></h1>
<p>The GeoMesa FileSystem distribution includes a set of command-line tools for feature
management, ingest, export and debugging.</p>
<p>To install the tools, see <a class="reference internal" href="install.html#setting-up-fsds-commandline"><span class="std std-ref">Setting up the FileSystem Command Line Tools</span></a>.</p>
<p>Once installed, the tools should be available through the command <code class="docutils literal"><span class="pre">geomesa-fs</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ geomesa-fs
INFO  Usage: geomesa-fs [command] [command options]
  Commands:
    ...
</pre></div>
</div>
<p>Commands that are common to multiple back ends are described in <a class="reference internal" href="../cli/index.html"><span class="doc">Command-Line Tools</span></a>. The commands
here are FileSystem-specific.</p>
<div class="section" id="general-arguments">
<h2>14.6.1. General Arguments<a class="headerlink" href="#general-arguments" title="Permalink to this headline">¶</a></h2>
<p>Most commands require you to specify the file system used. This generally includes the path and encoding
(parquet, csv, etc). Specify the path with <code class="docutils literal"><span class="pre">--path</span></code> (or <code class="docutils literal"><span class="pre">-p</span></code>), and the encoding with <code class="docutils literal"><span class="pre">--encoding</span></code> (or <code class="docutils literal"><span class="pre">-e</span></code>).</p>
</div>
<div class="section" id="commands">
<h2>14.6.2. Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="compact">
<h3>14.6.2.1. <code class="docutils literal"><span class="pre">compact</span></code><a class="headerlink" href="#compact" title="Permalink to this headline">¶</a></h3>
<p>Compact one or more filesystem partitions.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">-f,</span> <span class="pre">--feature-name</span> <span class="pre">*</span></code></td>
<td>The name of the schema</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">--partitions</span></code></td>
<td>Partitions to compact (omit to compact all partitions)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">--mode</span></code></td>
<td>One of <code class="docutils literal"><span class="pre">local</span></code> or <code class="docutils literal"><span class="pre">distributed</span></code> (to use map/reduce)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">--temp-path</span></code></td>
<td>Path to a temp directory used for working files</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">--temp-path</span></code> argument may be useful when working with <code class="docutils literal"><span class="pre">s3</span></code> data, as <code class="docutils literal"><span class="pre">s3</span></code> is slow to write to.</p>
</div>
<div class="section" id="get-files">
<h3>14.6.2.2. <code class="docutils literal"><span class="pre">get-files</span></code><a class="headerlink" href="#get-files" title="Permalink to this headline">¶</a></h3>
<p>Displays the files for one or more filesystem partitions.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">-f,</span> <span class="pre">--feature-name</span> <span class="pre">*</span></code></td>
<td>The name of the schema</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">--partitions</span></code></td>
<td>Partitions to compact (omit to list all partitions)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="get-partitions">
<h3>14.6.2.3. <code class="docutils literal"><span class="pre">get-partitions</span></code><a class="headerlink" href="#get-partitions" title="Permalink to this headline">¶</a></h3>
<p>Displays the partitions for a given filesystem store.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">-f,</span> <span class="pre">--feature-name</span> <span class="pre">*</span></code></td>
<td>The name of the schema</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ingest">
<span id="fsds-ingest-command"></span><h3>14.6.2.4. <code class="docutils literal"><span class="pre">ingest</span></code><a class="headerlink" href="#ingest" title="Permalink to this headline">¶</a></h3>
<p>For an overview of ingestion options, see <a class="reference internal" href="../cli/ingest.html#cli-ingest"><span class="std std-ref">ingest</span></a>.</p>
<p>This command ingests files into a GeoMesa FS Datastore. Note that a &#8220;datastore&#8221; is simply a path in the filesystem.
All data and metadata will be stored in the filesystem under the hierarchy of the root path.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">--partition-scheme</span> <span class="pre">*</span></code></td>
<td>Common partition scheme name (e.g. daily, z2) or path to a file containing a scheme config</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">--num-reducers</span></code></td>
<td>Number of reducers to use (required for distributed ingest)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">--leaf-storage</span></code></td>
<td>Use leaf storage</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">--temp-path</span></code></td>
<td>Path to a temp directory used for working files</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">--storage-opt</span></code></td>
<td>Additional storage options, as <code class="docutils literal"><span class="pre">key=value</span></code></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">--partition-scheme</span></code> argument should be the well-known name of a provided partition scheme, or the name
of a file containing a partition scheme. See <a class="reference internal" href="partition_schemes.html#fsds-partition-schemes"><span class="std std-ref">Partition Schemes</span></a> for more information.</p>
<p>The <code class="docutils literal"><span class="pre">--num-reducers</span></code> should generally be set to half the number of partitions.</p>
<p>The <code class="docutils literal"><span class="pre">--temp-path</span></code> argument may be useful when working with <code class="docutils literal"><span class="pre">s3</span></code> data, as <code class="docutils literal"><span class="pre">s3</span></code> is slow to write to.</p>
<div class="section" id="example">
<h4>14.6.2.4.1. Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>Lets say that we have all our data for 2016 stored in an S3 bucket:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ geomesa-fs ingest \
   -p &#39;s3a://mybucket/datastores/test&#39; \
   -e parquet \
   --partition-scheme daily,z2-2bits \
   -s s3a://mybucket/schemas/my-config.conf \
   -C s3a://mybucket/schemas/my-config.conf \
   --temp-dir hdfs://namenode:port/tmp/gm/1 \
   --num-reducers 20 \
   &#39;s3a://mybucket/data/2016/*&#39;
</pre></div>
</div>
<p>After ingest we expect to see a file structure with metadata and parquet files in S3 for our type named &#8220;myfeature&#8221;:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">aws</span> <span class="n">s3</span> <span class="n">ls</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">mybucket</span><span class="o">/</span><span class="n">datastores</span><span class="o">/</span><span class="n">test</span>

<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">sft</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="n">metadata</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
<span class="n">datastores</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">myfeature</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="mf">0000.</span><span class="n">parquet</span>
</pre></div>
</div>
<p>Two metadata files (<code class="docutils literal"><span class="pre">schema.sft</span></code> and <code class="docutils literal"><span class="pre">metadata</span></code>) store information about the schema, partition scheme, and list of
files that have been created. Note that the list of created files allows the datastore to quickly compute available
files to avoid possibly expensive directly listings against the filesystem. You may need to run <code class="docutils literal"><span class="pre">update-metadata</span></code>
if you decide to insert new files.</p>
<p>Notice that the bucket &#8220;directory structure&#8221; includes year, month, day and then a 0,1,2,3 representing a quadrant of the
Z2 Space Filling Curve with 2bit resolution (i.e. 0 = lower left, 1 = lower right, 2 = upper left, 3 = upper right).
Note that in our example January 1st and 2nd both do not have all four quadrants represented. This means that the input
dataset for that day didn&#8217;t have any data in that region of the world. If additional data were ingested, the directory
and a corresponding file would be created.</p>
</div>
</div>
<div class="section" id="update-metadata">
<h3>14.6.2.5. <code class="docutils literal"><span class="pre">update-metadata</span></code><a class="headerlink" href="#update-metadata" title="Permalink to this headline">¶</a></h3>
<p>Recompute the list of partitions stored within the metadata file in a filesystem datastore. This metadata file
is used at query time in lieu of performing repeated directory listings.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example.html" class="btn btn-neutral float-right" title="14.7. FileSystem Datastore Example" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="geoserver.html" class="btn btn-neutral" title="14.5. Using the FileSystem Data Store in GeoServer" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2017 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.4.0-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>