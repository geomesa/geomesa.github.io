

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GeoMesa Kafka Quick Start &mdash; GeoMesa 1.3.3-SNAPSHOT Manuals</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme_custom.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/sphinx_tabs/tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/segment.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/menu.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="GeoMesa 1.3.3-SNAPSHOT Manuals" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="GeoMesa Lambda Quick Start" href="geomesa-quickstart-lambda.html"/>
        <link rel="prev" title="GeoMesa Cassandra Quick Start" href="geomesa-quickstart-cassandra.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.3.3-SNAPSHOT
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#getting-started">Getting Started</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-accumulo.html">GeoMesa Accumulo Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-hbase.html">GeoMesa HBase Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-cassandra.html">GeoMesa Cassandra Quick Start</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">GeoMesa Kafka Quick Start</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#download-and-build-the-tutorial">Download and Build the Tutorial</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-code">Run the Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#register-the-store-in-geoserver">Register the Store in GeoServer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#publish-the-layer">Publish the Layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#view-the-layer">View the layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#produce-some-data">Produce Some Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-s-happening-in-geoserver">What&#8217;s Happening in GeoServer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#consumers-explained">Consumers Explained</a></li>
<li class="toctree-l4"><a class="reference internal" href="#view-the-consumer-output">View the Consumer Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-listening-for-featureevents">(Optional) Listening for FeatureEvents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kafkadatastore-load-test">KafkaDataStore Load Test</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-lambda.html">GeoMesa Lambda Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="geodocker-geomesa-spark-on-aws.html">Geodocker: Bootstrapping GeoMesa Accumulo and Spark on AWS</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-hbase-s3-on-aws.html">Bootstrapping GeoMesa HBase on AWS S3</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-nifi.html">GeoMesa NiFi Quick Start</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-in-out">Data In/Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-analysis">Data Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#security">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indexing-and-queries">Indexing and Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#about-tutorial-versions">About Tutorial Versions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GeoMesa</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>GeoMesa Kafka Quick Start</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/geomesa-quickstart-kafka.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomesa-kafka-quick-start">
<h1>GeoMesa Kafka Quick Start<a class="headerlink" href="#geomesa-kafka-quick-start" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will show you how to:</p>
<ol class="arabic simple">
<li>Write custom Java code to produce and consume messages in <a class="reference external" href="http://kafka.apache.org/">Apache
Kafka</a> using GeoMesa.</li>
<li>Query the data and replay the messages in a Kafka topic to achieve an
earlier state.</li>
<li>Visualize the changes being made in Kafka with GeoServer.</li>
</ol>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://kafka.apache.org/">Apache Kafka</a> is &#8220;publish-subscribe
messaging rethought as a distributed commit log.&#8221;</p>
<p>In the context of GeoMesa, Kafka is a useful tool for working with
streams of geospatial data. Interaction with Kafka in GeoMesa occurs
with the KafkaDataStore which implements the GeoTools
<a class="reference external" href="http://docs.geotools.org/latest/userguide/library/data/datastore.html">DataStore</a>
interface.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>basic knowledge of <a class="reference external" href="http://www.geotools.org">GeoTools</a>,
<a class="reference external" href="http://geoserver.org">GeoServer</a>, and Kafka,</li>
<li>an instance of Kafka 0.8.2.x, 0.9.0.1, or 0.10.0.1 with (an)
appropriate Zookeeper instance(s),</li>
<li>an instance of GeoServer version 2.9.1 with the GeoMesa Kafka plugin
installed,</li>
<li><a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java JDK
8</a>,</li>
<li><a class="reference external" href="http://maven.apache.org/">Apache Maven</a> 3.2.2 or better,</li>
<li>a <a class="reference external" href="http://git-scm.com/">git</a> client.</li>
</ul>
<p>In order to install the GeoMesa Kafka GeoServer plugin, follow the instructions
here: <a class="reference internal" href="../user/kafka/install.html#install-kafka-geoserver"><span class="std std-ref">Installing GeoMesa Kafka in GeoServer</span></a>.</p>
<p>Ensure your Kafka and Zookeeper instances are running. You can use
Kafka&#8217;s
<a class="reference external" href="http://kafka.apache.org/documentation.html#quickstart">quickstart</a>
to get Kafka/Zookeeper instances up and running quickly.</p>
<p>There are now three versions of Kafka that are supported with GeoMesa,
and there are separate tutorials for each build.</p>
</div>
<div class="section" id="download-and-build-the-tutorial">
<h2>Download and Build the Tutorial<a class="headerlink" href="#download-and-build-the-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Pick a reasonable directory on your machine, and run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git clone https://github.com/geomesa/geomesa-tutorials.git
<span class="nv">$ </span><span class="nb">cd </span>geomesa-tutorials
</pre></div>
</div>
<p>To build, run</p>
<p>For Kafka 0.8.2.1</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mvn clean install -pl geomesa-quickstart-kafka/geomesa-quickstart-kafka-08
</pre></div>
</div>
<p>For Kafka 0.9.0.1</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mvn clean install -pl geomesa-quickstart-kafka/geomesa-quickstart-kafka-09
</pre></div>
</div>
<p>For Kafka 0.10.0.1</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mvn clean install -pl geomesa-quickstart-kafka/geomesa-quickstart-kafka-10
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ensure that the version of Kafka and Zookeeper in
the root <code class="docutils literal"><span class="pre">pom.xml</span></code> match your environment.</p>
</div>
</div>
<div class="section" id="run-the-code">
<h2>Run the Code<a class="headerlink" href="#run-the-code" title="Permalink to this headline">¶</a></h2>
<p>On the command-line, run:</p>
<p>For Kafka 0.8.2.1</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>java -cp geomesa-quickstart-kafka/geomesa-quickstart-kafka-08/target/geomesa-quickstart-kafka-08-<span class="nv">$VERSION</span>.jar com.example.geomesa.kafka08.KafkaQuickStart <span class="se">\</span>
&gt; -brokers &lt;brokers&gt; -zookeepers &lt;zookeepers&gt;
</pre></div>
</div>
<p>For Kafka 0.9.0.1</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>java -cp geomesa-quickstart-kafka/geomesa-quickstart-kafka-09/target/geomesa-quickstart-kafka-09-<span class="nv">$VERSION</span>.jar com.example.geomesa.kafka09.KafkaQuickStart <span class="se">\</span>
&gt; -brokers &lt;brokers&gt; -zookeepers &lt;zookeepers&gt;
</pre></div>
</div>
<p>For Kafka 0.10.0.1</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>java -cp geomesa-quickstart-kafka/geomesa-quickstart-kafka-10/target/geomesa-quickstart-kafka-10-<span class="nv">$VERSION</span>.jar com.example.geomesa.kafka10.KafkaQuickStart <span class="se">\</span>
&gt; -brokers &lt;brokers&gt; -zookeepers &lt;zookeepers&gt;
</pre></div>
</div>
<p>where you provide the values for the following arguments:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;brokers&gt;</span></code> your Kafka broker instances, comma separated. For a
local install, this would be <code class="docutils literal"><span class="pre">localhost:9092</span></code>.</li>
<li><code class="docutils literal"><span class="pre">&lt;zookeepers&gt;</span></code> your Zookeeper nodes, comma separated. For a local
install, this would be <code class="docutils literal"><span class="pre">localhost:2181</span></code>.</li>
</ul>
<p>The program will create some metadata in Zookeeper and an associated
topic in your Kafka instance, and pause execution to let you add the
newly created <code class="docutils literal"><span class="pre">KafkaDataStore</span></code> to GeoServer. Once GeoServer has been
configured, we&#8217;ll pick back up with the paused program.</p>
<p>Optional command-line arguments for <code class="docutils literal"><span class="pre">KafkaQuickStart</span></code> are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-zkPath</span> <span class="pre">&lt;zkpath&gt;</span></code>: used for specifying the Zookeeper path for
storing GeoMesa metadata. Defaults to &#8220;/geomesa/ds/kafka&#8221; and
ordinarily does not need to be changed</li>
<li><code class="docutils literal"><span class="pre">-automated</span></code>: omits the pause in execution for configuring
GeoServer.</li>
</ul>
<p>The class may also be run using Maven via the <code class="docutils literal"><span class="pre">live-test</span></code> profile.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mvn -Plive-test <span class="nb">exec</span>:exec -Dbrokers<span class="o">=</span>&lt;brokers&gt; -Dzookeepers<span class="o">=</span>&lt;zookeepers&gt;
</pre></div>
</div>
</div>
<div class="section" id="register-the-store-in-geoserver">
<h2>Register the Store in GeoServer<a class="headerlink" href="#register-the-store-in-geoserver" title="Permalink to this headline">¶</a></h2>
<p>Log into GeoServer using your credentials. Click “Stores” in the
left-hand gutter and “Add new Store”. If you do not see the Kafka Data
Store listed under Vector Data Sources, ensure the plugin and
dependencies are in the right directory and restart GeoServer.</p>
<p>Select the <code class="docutils literal"><span class="pre">Kafka</span> <span class="pre">(GeoMesa)</span></code> vector data source and enter the
following parameters:</p>
<ul class="simple">
<li>Basic Store Info</li>
<li><code class="docutils literal"><span class="pre">workspace</span></code> this is dependent upon your GeoServer installation</li>
<li><code class="docutils literal"><span class="pre">data</span> <span class="pre">source</span> <span class="pre">name</span></code> pick a sensible name, such as,
<code class="docutils literal"><span class="pre">geomesa_kafka_quickstart</span></code></li>
<li><code class="docutils literal"><span class="pre">description</span></code> pick a sensible description, such as
<code class="docutils literal"><span class="pre">GeoMesa</span> <span class="pre">Kafka</span> <span class="pre">quick</span> <span class="pre">start</span></code></li>
<li>Connection Parameters</li>
<li><code class="docutils literal"><span class="pre">brokers</span></code> your Kafka broker instances, comma separated. Use the
same ones you used on the command line.</li>
<li><code class="docutils literal"><span class="pre">zookeepers</span></code> your Zookeeper nodes, comma separated. Use the same
ones you used on the command line.</li>
</ul>
<p>Leave all other fields empty or with the default value.</p>
<p>Click &#8220;Save&#8221; and GeoServer will search your Kafka instance for any
GeoMesa-managed feature types.</p>
</div>
<div class="section" id="publish-the-layer">
<h2>Publish the Layer<a class="headerlink" href="#publish-the-layer" title="Permalink to this headline">¶</a></h2>
<p>GeoServer should find the <code class="docutils literal"><span class="pre">KafkaQuickStart</span></code> feature type in the data
store and redirect you to the &#8220;New Layer&#8221; page, presenting the feature
type as a layer that can be published. Click on the &#8220;Publish&#8221; link. You
will be taken to the &#8220;Edit Layer&#8221; page.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you have not yet run the quick start code as described
in <strong>Run the Code</strong> above, the feature type will not have been
registered and you will not get a &#8220;New Layer&#8221; page after saving the
store. In this case, run the code as described above, click on
&#8220;Layers&#8221; in the left-hand gutter, click on &#8220;Add a new resource&#8221;, and
select your data store in the pulldown next to &#8220;Add layer from&#8221;. The
link to publish the <code class="docutils literal"><span class="pre">KafkaQuickStart</span></code> feature should appear.</p>
</div>
<p>You can leave most fields as default. In the Data pane, you&#8217;ll need to
enter values for the bounding boxes. In this case, you can click on the
links to compute these values from the data. Click &#8220;Save&#8221;.</p>
</div>
<div class="section" id="view-the-layer">
<h2>View the layer<a class="headerlink" href="#view-the-layer" title="Permalink to this headline">¶</a></h2>
<p>Click on the &#8220;Layer Preview&#8221; link in the left-hand gutter. If you don&#8217;t
see the quick-start layer on the first page of results, enter the name
of the layer you just created into the search box, and press &lt;Enter&gt;.</p>
<p>Once you see your layer, click on the &#8220;OpenLayers&#8221; link, which will open
a new tab. At this point, there are no messages in Kafka so nothing will
be shown.</p>
</div>
<div class="section" id="produce-some-data">
<h2>Produce Some Data<a class="headerlink" href="#produce-some-data" title="Permalink to this headline">¶</a></h2>
<p>Resume the program&#8217;s execution by inputting &lt;Enter&gt; in your terminal now
that the <code class="docutils literal"><span class="pre">KafkaDataStore</span></code> is registered in GeoServer. The program will
create two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s and then write a stream of updates to
the two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s over the course of about a minute.</p>
<p>You can refresh the GeoServer layer preview repeatedly to visualize the
updates being written to Kafka.</p>
</div>
<div class="section" id="what-s-happening-in-geoserver">
<h2>What&#8217;s Happening in GeoServer<a class="headerlink" href="#what-s-happening-in-geoserver" title="Permalink to this headline">¶</a></h2>
<p>The layer preview of GeoServer uses the
<code class="docutils literal"><span class="pre">LiveKafkaConsumerFeatureSource</span></code> to show a real time view of the
current state of the data stream. Two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s are being
updated over time in Kafka which is reflected in the GeoServer display.</p>
<p>As you refresh the page, you should see two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s that
start on the left side gradually move to the right side while crossing
each other in the middle. As the two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s get updated,
the older <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s disappear from the display.</p>
<div class="figure" id="id1">
<img alt="GeoServer view" src="../_images/layer-preview.png" />
<p class="caption"><span class="caption-text">GeoServer view</span></p>
</div>
</div>
<div class="section" id="consumers-explained">
<h2>Consumers Explained<a class="headerlink" href="#consumers-explained" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa wraps Kafka consumers in two different ways; as a
<code class="docutils literal"><span class="pre">LiveKafkaConsumerFeatureSource</span></code> or a
<code class="docutils literal"><span class="pre">ReplayKafkaConsumerFeatureSource</span></code>. Both of these classes implement
GeoTools&#8217;
<a class="reference external" href="http://docs.geotools.org/latest/javadocs/org/geotools/data/FeatureSource.html">FeatureSource</a>
API.</p>
<p>The <code class="docutils literal"><span class="pre">LiveKafkaConsumerFeatureSource</span></code> will consume messages as they are
being produced and maintain the real time state of SimpleFeatures
pertaining to a Kafka topic.</p>
<p>The <code class="docutils literal"><span class="pre">ReplayKafkaConsumerFeatureSource</span></code> allows users to specify any
range of time in order to obtain the state of SimpleFeatures from any
previous moment.</p>
</div>
<div class="section" id="view-the-consumer-output">
<h2>View the Consumer Output<a class="headerlink" href="#view-the-consumer-output" title="Permalink to this headline">¶</a></h2>
<p>The program will construct the live and replay consumers and log
SimpleFeatures to the console after all the messages are sent to Kafka
and therefore after all the updates are made.</p>
<p>The live consumer will log the state of the two SimpleFeatures after all
updates are finished. The replay consumer will log the state of the two
SimpleFeatures five seconds earlier than the last update. The replay
consumer will create a new <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> with an additional
attribute <code class="docutils literal"><span class="pre">KafkaLogTime</span></code>. By preserving the <code class="docutils literal"><span class="pre">KafkaLogTime</span></code> as an
attribute, we can create the state of SimpleFeatures at time <em>x</em> by
querying for when <code class="docutils literal"><span class="pre">KafkaLogTime</span></code> equals <em>x</em>.</p>
<div class="highlight-bash"><div class="highlight"><pre>Consuming with the live consumer...
2 features were written to Kafka
Here are the two SimpleFeatures that were obtained with the live consumer:
fid:1 | name:James | age:20 | dtg:Mon Dec 14 19:08:23 EST 2015 | geom:POINT <span class="o">(</span>180 90<span class="o">)</span>
fid:2 | name:John | age:62 | dtg:Fri Oct 02 09:56:49 EDT 2015 | geom:POINT <span class="o">(</span>180 -90<span class="o">)</span>

Consuming with the replay consumer...
2 features were written to Kafka
Here are the two SimpleFeatures that were obtained with the replay consumer:
fid:2 | name:John | age:52 | dtg:Thu May 21 21:27:19 EDT 2015 | geom:POINT <span class="o">(</span>132 -66<span class="o">)</span> | KafkaLogTime:Tue Jun 09 13:33:47 EDT 2015
fid:1 | name:James | age:59 | dtg:Sat Jan 24 06:26:44 EST 2015 | geom:POINT <span class="o">(</span>132 66<span class="o">)</span> | KafkaLogTime:Tue Jun 09 13:33:47 EDT 2015
</pre></div>
</div>
<p>For a deeper understanding of what&#8217;s going on, we recommend exploring
the source code.</p>
</div>
<div class="section" id="optional-listening-for-featureevents">
<h2>(Optional) Listening for FeatureEvents<a class="headerlink" href="#optional-listening-for-featureevents" title="Permalink to this headline">¶</a></h2>
<p>The GeoTools API also includes a mechanism to fire off a
<a class="reference external" href="http://docs.geotools.org/stable/javadocs/index.html?org/geotools/data/FeatureEvent.Type.html">FeatureEvent</a>
each time there is an event (typically when the data are changed) in a
<code class="docutils literal"><span class="pre">DataStore</span></code>. A client may implement a
<a class="reference external" href="http://docs.geotools.org/stable/javadocs/index.html?org/geotools/data/FeatureEvent.Type.html">FeatureListener</a>,
which has a single method called <code class="docutils literal"><span class="pre">changed()</span></code> that is invoked as each
<code class="docutils literal"><span class="pre">FeatureEvent</span></code> is fired.</p>
<p>The code in <code class="docutils literal"><span class="pre">KafkaListener</span></code> implements a simple <code class="docutils literal"><span class="pre">FeatureListener</span></code>
that prints the messages received. Open up a second terminal window and
run (with <code class="docutils literal"><span class="pre">$KAFKA_VERSION</span></code> set to &#8220;08&#8221;, &#8220;09&#8221;, or &#8220;10&#8221; as appropriate):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>java -cp geomesa-quickstart-kafka/geomesa-quickstart-kafka-<span class="nv">$KAFKA_VERSION</span>/target/geomesa-quickstart-kafka-<span class="nv">$KAFKA_VERSION</span>-<span class="k">${</span><span class="nv">geomesa</span><span class="p">.version</span><span class="k">}</span>.jar <span class="se">\</span>
&gt; com.example.geomesa.kafka<span class="nv">$KAFKA_VERSION</span>.KafkaListener <span class="se">\</span>
&gt; -brokers &lt;brokers&gt; -zookeepers &lt;zookeepers&gt;
</pre></div>
</div>
<p>and use the same settings for <code class="docutils literal"><span class="pre">&lt;brokers&gt;</span></code> and <code class="docutils literal"><span class="pre">&lt;zookeepers&gt;</span></code>. Then
in the first terminal window, re-run the <code class="docutils literal"><span class="pre">KafkaQuickStart</span></code> code as
before. The <code class="docutils literal"><span class="pre">KafkaListener</span></code> terminal should produce messages like the
following:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">Received</span> <span class="n">FeatureEvent</span> <span class="n">of</span> <span class="n">Type</span><span class="p">:</span> <span class="n">CHANGED</span>
<span class="n">fid</span><span class="p">:</span><span class="mi">1</span> <span class="o">|</span> <span class="n">name</span><span class="p">:</span><span class="n">Hannah</span> <span class="o">|</span> <span class="n">age</span><span class="p">:</span><span class="mi">53</span> <span class="o">|</span> <span class="n">dtg</span><span class="p">:</span><span class="n">Sun</span> <span class="n">Dec</span> <span class="mi">13</span> <span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">40</span> <span class="n">EST</span> <span class="mi">2015</span> <span class="o">|</span> <span class="n">geom</span><span class="p">:</span><span class="n">POINT</span> <span class="p">(</span><span class="o">-</span><span class="mi">66</span> <span class="o">-</span><span class="mi">33</span><span class="p">)</span>
<span class="n">Received</span> <span class="n">FeatureEvent</span> <span class="n">of</span> <span class="n">Type</span><span class="p">:</span> <span class="n">CHANGED</span>
<span class="n">fid</span><span class="p">:</span><span class="mi">2</span> <span class="o">|</span> <span class="n">name</span><span class="p">:</span><span class="n">Claire</span> <span class="o">|</span> <span class="n">age</span><span class="p">:</span><span class="mi">77</span> <span class="o">|</span> <span class="n">dtg</span><span class="p">:</span><span class="n">Thu</span> <span class="n">Feb</span> <span class="mi">26</span> <span class="mi">02</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">41</span> <span class="n">EST</span> <span class="mi">2015</span> <span class="o">|</span> <span class="n">geom</span><span class="p">:</span><span class="n">POINT</span> <span class="p">(</span><span class="o">-</span><span class="mi">66</span> <span class="mi">33</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">KafkaListener</span></code> code will run until interrupted.</p>
<p>The portion of <code class="docutils literal"><span class="pre">KafkaListener</span></code> that creates and implements the
<code class="docutils literal"><span class="pre">FeatureListener</span></code> is:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// the live consumer must be created before the producer writes features</span>
<span class="c1">// in order to read streaming data.</span>
<span class="c1">// i.e. the live consumer will only read data written after its instantiation</span>
<span class="n">SimpleFeatureSource</span> <span class="n">consumerFS</span> <span class="o">=</span> <span class="n">consumerDS</span><span class="o">.</span><span class="na">getFeatureSource</span><span class="o">(</span><span class="n">sftName</span><span class="o">);</span>

<span class="n">consumerFS</span><span class="o">.</span><span class="na">addFeatureListener</span><span class="o">(</span><span class="k">new</span> <span class="n">FeatureListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">changed</span><span class="o">(</span><span class="n">FeatureEvent</span> <span class="n">featureEvent</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Received FeatureEvent of Type: &quot;</span> <span class="o">+</span> <span class="n">featureEvent</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">featureEvent</span><span class="o">.</span><span class="na">getType</span><span class="o">()</span> <span class="o">==</span> <span class="n">FeatureEvent</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">CHANGED</span> <span class="o">&amp;&amp;</span>
                <span class="n">featureEvent</span> <span class="k">instanceof</span> <span class="n">KafkaFeatureEvent</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">printFeature</span><span class="o">(((</span><span class="n">KafkaFeatureEvent</span><span class="o">)</span> <span class="n">featureEvent</span><span class="o">).</span><span class="na">feature</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">featureEvent</span><span class="o">.</span><span class="na">getType</span><span class="o">()</span> <span class="o">==</span> <span class="n">FeatureEvent</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">REMOVED</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Received Delete for filter: &quot;</span> <span class="o">+</span> <span class="n">featureEvent</span><span class="o">.</span><span class="na">getFilter</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>
</div>
<p>Additionally, the <code class="docutils literal"><span class="pre">KafkaQuickStart</span></code> class run above can generate a
&#8216;clear&#8217; control message at the end of the run if you specify
&#8220;-Dclear=true&#8221; on the commandline. This will generate a Feature removed
<code class="docutils literal"><span class="pre">FeatureEvent</span></code> with a <code class="docutils literal"><span class="pre">Filter.INCLUDE</span></code>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>java -Dclear<span class="o">=</span><span class="nb">true</span> -cp geomesa-quickstart-kafka/geomesa-quickstart-kafka-<span class="nv">$KAFKA_VERSION</span>/target/geomesa-quickstart-kafka-<span class="nv">$KAFKA_VERSION</span>-<span class="k">${</span><span class="nv">geomesa</span><span class="p">.version</span><span class="k">}</span>.jar <span class="se">\</span>
  com.example.geomesa.kafka<span class="nv">$KAFKA_VERSION</span>.KafkaQuickStart <span class="se">\</span>
  -brokers &lt;brokers&gt; -zookeepers &lt;zookeepers&gt;
</pre></div>
</div>
</div>
<div class="section" id="kafkadatastore-load-test">
<h2>KafkaDataStore Load Test<a class="headerlink" href="#kafkadatastore-load-test" title="Permalink to this headline">¶</a></h2>
<p>For those interested in load testing the KafkaDataStore, there is a
simple utility with constructs any number of SimpleFeatures, rolls a
random latitude, and then have them step left or right.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>java -cp geomesa-quickstart-kafka/geomesa-quickstart-kafka-<span class="nv">$KAFKA_VERSION</span>/target/geomesa-quickstart-kafka-<span class="nv">$KAFKA_VERSION</span>-<span class="k">${</span><span class="nv">geomesa</span><span class="p">.version</span><span class="k">}</span>.jar <span class="se">\</span>
  com.example.geomesa.kafka<span class="nv">$KAFKA_VERSION</span>.KafkaLoadTester <span class="se">\</span>
  -brokers &lt;brokers&gt; -zookeepers &lt;zookeepers&gt; -count &lt;count&gt;
</pre></div>
</div>
<p>The &#8216;count&#8217; parameter is optional. Without it, the tool defaults to 1000
SimpleFeatures.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Given a stream of geospatial data, GeoMesa&#8217;s integration with Kafka
enables users to maintain a real time state of SimpleFeatures or
retrieve any arbitrary state preserved in history. One can additionally
process and analyze streams of data by integrating a data processing
system like <a class="reference external" href="https://storm.apache.org/">Storm</a> or
<a class="reference external" href="http://samza.apache.org">Samza</a>. See the <a class="reference internal" href="geomesa-quickstart-storm.html"><span class="doc">GeoMesa Storm Quick Start</span></a>
tutorial for more information on using Storm with GeoMesa.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="geomesa-quickstart-lambda.html" class="btn btn-neutral float-right" title="GeoMesa Lambda Quick Start" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="geomesa-quickstart-cassandra.html" class="btn btn-neutral" title="GeoMesa Cassandra Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2017 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.3-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../_static/sphinx_tabs/tabs.js"></script>
      <script type="text/javascript" src="../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>