

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Web Processing Services (WPS) Tube Select &mdash; GeoMesa 3.2.0-SNAPSHOT Manuals</title>
  

  
  
  
  
    <link rel="canonical" href="https://www.geomesa.org/documentation/tutorials/geomesa-tubeselect.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme_custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GeoMesa Authorizations" href="geomesa-examples-authorizations.html" />
    <link rel="prev" title="GeoMesa Spark: Spatial Join and Aggregation" href="dwithin-join.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                3.2.0-SNAPSHOT
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#quick-starts">Quick Starts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-in-out">Data In/Out</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#data-analysis">Data Analysis</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="spark.html">GeoMesa Spark: Basic Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="broadcast-join.html">GeoMesa Spark: Broadcast Join and Aggregation</a></li>
<li class="toctree-l3"><a class="reference internal" href="dwithin-join.html">GeoMesa Spark: Spatial Join and Aggregation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Web Processing Services (WPS) Tube Select</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-geoserver-plugin">Using the GeoServer Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#downloading-and-building-the-tutorial-code">Downloading and Building the Tutorial Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#collecting-twitter-data">Collecting Twitter Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ingesting-twitter-data">Ingesting Twitter Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-web-processing-service-wps-request">Creating a Web Processing Service (WPS) Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tube-selections">Tube Selections</a></li>
<li class="toctree-l4"><a class="reference internal" href="#saving-the-output-as-a-layer">Saving The Output as a Layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tweaking-parameters">Tweaking Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#beyond-curl">Beyond Curl</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#security">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indexing-and-queries">Indexing and Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#about-tutorial-versions">About Tutorial Versions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GeoMesa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Web Processing Services (WPS) Tube Select</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="web-processing-services-wps-tube-select">
<h1>Web Processing Services (WPS) Tube Select<a class="headerlink" href="#web-processing-services-wps-tube-select" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will show you how to:</p>
<ol class="arabic simple">
<li>Ingest a set of Twitter data.</li>
<li>Use GeoServer Web Processing Services (WPS) to generate
time-interpolated queries.</li>
<li>Query from and save results to GeoServer layers.</li>
</ol>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>A time-interpolated query finds features that intersect in both <strong>space
and time</strong>. Normal spatial or temporal queries select features that
fall within a specified geometry, time range, or both. A
time-interpolated query has a changing geometry as you move forward in
time.</p>
<p>Imagine you are traveling from Washington, DC to New York City and are
interested in people traveling the same route at the same time. These
travelers would be within a given distance from you at any point in the
trip. They wouldn’t be in DC while you were arriving in New York. Thus
the geometry of results of your query would be <strong>a function of time</strong>.</p>
<p>Time-interpolated queries are more complex than normal spatial or
temporal queries, as the input is a sequence of points or lines with an
increasing time attribute. Time-interpolated queries are colloquially
known as <strong>tube selects</strong>.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Make sure that you’ve worked through the steps described in the
<a class="reference internal" href="../user/install.html#installation"><span class="std std-ref">Installation</span></a> section of the GeoMesa User
Manual, particularly the tasks relevant to Accumulo. Afterwards, it may be
necessary to change the versions of Accumulo and Hadoop that the tutorial
uses. After completing the deployment tutorial, you should have:</p>
<ul class="simple">
<li>an instance of Accumulo 1.7.x, 1.8.x, 1.9.x or 2.0.x running on Hadoop 2.8 or later,</li>
<li>access to an Accumulo user that has both create-table and write
permissions, and</li>
<li>an instance of GeoServer 2.5.2 with the GeoMesa plugin installed.</li>
</ul>
<p>Because this tutorial requires building custom Java code, development
tools should also be installed and configured:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java JDK 8</a>,</li>
<li><a class="reference external" href="http://maven.apache.org/">Apache Maven</a> 3.5.2 or later, and</li>
<li>a <a class="reference external" href="http://git-scm.com/">git</a> client.</li>
</ul>
</div>
<div class="section" id="using-the-geoserver-plugin">
<h2>Using the GeoServer Plugin<a class="headerlink" href="#using-the-geoserver-plugin" title="Permalink to this headline">¶</a></h2>
<p>Once everything is installed you should see “geomesa:TubeSelect” appear
in the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/services/wps/requestbuilder.html">WPS Request
Builder</a>,
which is found under the <em>Demos</em> link in the menu bar on the left side
of the GeoServer web administration interface.</p>
<div class="figure" id="id1">
<img alt="&quot;geomesa:TubeSelect WPS plugin&quot;" src="../_images/wps_builder1.png" />
<p class="caption"><span class="caption-text">“geomesa:TubeSelect WPS plugin”</span></p>
</div>
</div>
<div class="section" id="downloading-and-building-the-tutorial-code">
<h2>Downloading and Building the Tutorial Code<a class="headerlink" href="#downloading-and-building-the-tutorial-code" title="Permalink to this headline">¶</a></h2>
<p>Clone the <strong>geomesa</strong> project and build it, if you haven’t already:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/locationtech/geomesa.git
$ <span class="nb">cd</span> geomesa
$ mvn clean install
</pre></div>
</div>
<p>This is needed to install the GeoMesa JAR files in your local Maven
repository. For more information see the <a class="reference external" href="/geomesa-quickstart/">GeoMesa Accumulo Quick
Start</a> tutorial. We’ll be using Twitter data
from the public Twitter API for this tutorial and ingesting it using a
single node ingester that uses a
<a class="reference external" href="http://www.geotools.org/">GeoTools</a>-based <code class="docutils literal notranslate"><span class="pre">FeatureSource</span></code> to
ingest into GeoMesa. First, check out the code and take a look at it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/geomesa/geomesa-twitter
$ <span class="nb">cd</span> geomesa-twitter
</pre></div>
</div>
<p>To build the project, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mvn clean install
</pre></div>
</div>
</div>
<div class="section" id="collecting-twitter-data">
<h2>Collecting Twitter Data<a class="headerlink" href="#collecting-twitter-data" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It will take several hours to collect a large enough set of Twitter data for the analysis below.</p>
</div>
<p>The <strong>twitter-collect</strong> module collects
<a class="reference external" href="http://twitter.com/">Twitter</a> data in JSON format and writes it a
local file. To run the code, you will need a Twitter account, as well as
access tokens. Go to the Twitter development app management console at
<a class="reference external" href="https://apps.twitter.com/">https://apps.twitter.com/</a> and create a new application, then go to the
“Keys and Access Tokens” page to generate an “Access Token.” The
consumer API key, the consumer secret, the access token, and the access
token secret are all needed to run the collection process.</p>
<p>Run the program:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ java -jar twitter-collect/target/twitter-collect-accumulo1.5-1.0-SNAPSHOT.jar <span class="se">\</span>
    --consumerKey &lt;CONSUMER_KEY&gt; <span class="se">\</span>
    --consumerSecret &lt;CONSUMER_SECRET&gt; <span class="se">\</span>
    --outputDir ./tmp <span class="se">\</span>
    --secret &lt;ACCESS_SECRET&gt; <span class="se">\</span>
    --token &lt;ACCESS_TOKEN&gt;
</pre></div>
</div>
<p>This will collect live Twitter data and save it in JSON files in the
<code class="docutils literal notranslate"><span class="pre">tmp</span></code> subdirectory; this will collect data indefinitely until it is
interrupted.</p>
</div>
<div class="section" id="ingesting-twitter-data">
<h2>Ingesting Twitter Data<a class="headerlink" href="#ingesting-twitter-data" title="Permalink to this headline">¶</a></h2>
<p>The <strong>twitter-ingest</strong> module takes a set of JSON files.</p>
<p>There are three classes in the module:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Runner</span></code>: Provides the main method to handle command line argument
parsing</li>
<li><code class="docutils literal notranslate"><span class="pre">TwitterFeatureIngester</span></code>: Inserts features into GeoMesa using a
GeoTools <code class="docutils literal notranslate"><span class="pre">FeatureSource</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TwitterParser</span></code>: Parses Twitter JSON files and turns them into
<code class="docutils literal notranslate"><span class="pre">SimpleFeature</span></code>s</li>
</ul>
<p>Run the ingest program:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ java -jar twitter-ingest/target/twitter-ingest-accumulo1.5-1.0-SNAPSHOT.jar <span class="se">\</span>
    --featureName &lt;featureName&gt; <span class="se">\</span>
    --tableName &lt;tableName&gt; <span class="se">\</span>
    --instanceId &lt;instance&gt; <span class="se">\</span>
    --user &lt;user&gt; <span class="se">\</span>
    --password &lt;password&gt; <span class="se">\</span>
    --zookeepers &lt;zookeepers&gt; <span class="se">\</span>
    tmp/20151201/20151201-090959.txt
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;featureName&gt;</span></code> is the name of the SimpleFeatureType to create,
<code class="docutils literal notranslate"><span class="pre">&lt;tableName&gt;</span></code> is the name of the GeoMesa catalog table to use, and
<code class="docutils literal notranslate"><span class="pre">&lt;instance&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;user&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;password&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;zookeepers&gt;</span></code>are
needed to connect to Accumulo. The final argument is the name of one of
the Twitter JSON files created by the <strong>twitter-collect</strong> module.</p>
<p>After ingesting the data, create a data store and layer in GeoServer
from the data ingested into GeoMesa (see the <strong>VISUALIZE DATA WITH
GEOSERVER</strong> section of the <a class="reference external" href="/geomesa-quickstart/">GeoMesa Accumulo Quick Start
tutorial</a> for more details about how to do
this).</p>
<div class="section" id="more-about-parsing-twitter-json-data">
<h3>More about parsing Twitter JSON data<a class="headerlink" href="#more-about-parsing-twitter-json-data" title="Permalink to this headline">¶</a></h3>
<p>The JSON object returned from the tweets stream is documented on the
<a class="reference external" href="https://dev.twitter.com/docs/platform-objects/tweets">Twitter developer
site</a>. For this
tutorial we’ll be interested in the following fields:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">coordinates</span></code>: a <a class="reference external" href="http://geojson.org/">geoJSON</a> object with
lat/lon (do not use the deprecated <code class="docutils literal notranslate"><span class="pre">geo</span></code> field)</li>
<li><code class="docutils literal notranslate"><span class="pre">user</span></code>: the user object</li>
<li><code class="docutils literal notranslate"><span class="pre">id</span></code>: the user id</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: the user name</li>
<li><code class="docutils literal notranslate"><span class="pre">id</span></code>: the tweet id</li>
<li><code class="docutils literal notranslate"><span class="pre">created_at</span></code>: the time when the tweet was created</li>
<li><code class="docutils literal notranslate"><span class="pre">text</span></code>: the text of the tweet</li>
</ul>
<p>The Twitter JSON looks something like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;retweeted&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;source&quot;</span> <span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span>
  <span class="nt">&quot;favorited&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;coordinates&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;coordinates&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="mf">-75.14310264</span><span class="p">,</span>
      <span class="mf">40.05701649</span>
    <span class="p">],</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;Point&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;place&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;retweet_count&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;entities&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;hashtags&quot;</span> <span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&quot;user_mentions&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;Twitter API&quot;</span><span class="p">,</span>
        <span class="nt">&quot;indices&quot;</span> <span class="p">:</span> <span class="p">[</span>
          <span class="mi">19</span><span class="p">,</span>
          <span class="mi">30</span>
        <span class="p">],</span>
        <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">6253282</span><span class="p">,</span>
        <span class="nt">&quot;id_str&quot;</span> <span class="p">:</span> <span class="s2">&quot;6253282&quot;</span><span class="p">,</span>
        <span class="nt">&quot;screen_name&quot;</span> <span class="p">:</span> <span class="s2">&quot;twitterapi&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;urls&quot;</span> <span class="p">:</span> <span class="p">[]</span>
  <span class="p">},</span>
  <span class="nt">&quot;truncated&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;in_reply_to_status_id_str&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;created_at&quot;</span> <span class="p">:</span> <span class="s2">&quot;Wed Feb 29 19:42:02 +0000 2012&quot;</span><span class="p">,</span>
  <span class="nt">&quot;contributors&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;text&quot;</span> <span class="p">:</span> <span class="s2">&quot;Man I like me some @twitterapi&quot;</span><span class="p">,</span>
  <span class="nt">&quot;in_reply_to_user_id&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;user&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;friends_count&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="nt">&quot;follow_request_sent&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;profile_sidebar_fill_color&quot;</span> <span class="p">:</span> <span class="s2">&quot;ffffff&quot;</span><span class="p">,</span>
    <span class="nt">&quot;profile_image_url&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://a1.twimg.com/profile_images/1540298033/phatkicks_normal.jpg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;profile_background_image_url_https&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://si0.twimg.com/profile_background_images/365782739/doof.jpg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;profile_background_color&quot;</span> <span class="p">:</span> <span class="s2">&quot;C0DEED&quot;</span><span class="p">,</span>
    <span class="nt">&quot;notifications&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;url&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://blog.roomanna.com&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">370773112</span><span class="p">,</span>
    <span class="nt">&quot;is_translator&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;following&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;screen_name&quot;</span> <span class="p">:</span> <span class="s2">&quot;fakekurrik&quot;</span><span class="p">,</span>
    <span class="nt">&quot;lang&quot;</span> <span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
    <span class="nt">&quot;location&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;followers_count&quot;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="nt">&quot;statuses_count&quot;</span> <span class="p">:</span> <span class="mi">142</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;fakekurrik&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;I am just a testing account, following me probably won&#39;t gain you very much&quot;</span><span class="p">,</span>
    <span class="nt">&quot;favourites_count&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;profile_background_tile&quot;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;listed_count&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;contributors_enabled&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;profile_link_color&quot;</span> <span class="p">:</span> <span class="s2">&quot;0084B4&quot;</span><span class="p">,</span>
    <span class="nt">&quot;profile_image_url_https&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://si0.twimg.com/profile_images/1540298033/phatkicks_normal.jpg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;profile_sidebar_border_color&quot;</span> <span class="p">:</span> <span class="s2">&quot;C0DEED&quot;</span><span class="p">,</span>
    <span class="nt">&quot;created_at&quot;</span> <span class="p">:</span> <span class="s2">&quot;Fri Sep 09 16:13:20 +0000 2011&quot;</span><span class="p">,</span>
    <span class="nt">&quot;utc_offset&quot;</span> <span class="p">:</span> <span class="mi">-28800</span><span class="p">,</span>
    <span class="nt">&quot;verified&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;show_all_inline_media&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;profile_background_image_url&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://a3.twimg.com/profile_background_images/365782739/doof.jpg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;default_profile&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;protected&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;id_str&quot;</span> <span class="p">:</span> <span class="s2">&quot;370773112&quot;</span><span class="p">,</span>
    <span class="nt">&quot;profile_text_color&quot;</span> <span class="p">:</span> <span class="s2">&quot;333333&quot;</span><span class="p">,</span>
    <span class="nt">&quot;default_profile_image&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;time_zone&quot;</span> <span class="p">:</span> <span class="s2">&quot;Pacific Time (US &amp; Canada)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;geo_enabled&quot;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;profile_use_background_image&quot;</span> <span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">174942523154894848</span><span class="p">,</span>
  <span class="nt">&quot;in_reply_to_status_id&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;geo&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;in_reply_to_user_id_str&quot;</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;id_str&quot;</span> <span class="p">:</span> <span class="s2">&quot;174942523154894848&quot;</span><span class="p">,</span>
  <span class="nt">&quot;in_reply_to_screen_name&quot;</span> <span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We parse this object manually with <a class="reference external" href="https://github.com/google/gson">GSON
(google-json)</a>. Optionally,
you can create Java Object bindings for GSON and parse the entire tweet
into an object. For more information about connecting to the twitter
public stream check out the <a class="reference external" href="https://dev.twitter.com/docs/streaming-apis/streams/public">Twitter Public Stream
website</a>.</p>
</div>
</div>
<div class="section" id="creating-a-web-processing-service-wps-request">
<h2>Creating a Web Processing Service (WPS) Request<a class="headerlink" href="#creating-a-web-processing-service-wps-request" title="Permalink to this headline">¶</a></h2>
<p>The WPS builder will provide us with a sample XML document as a starting
point to perform a tube select. Entering the values we want and clicking
the “Generate XML” button produces the request document that we’ll save
as <code class="docutils literal notranslate"><span class="pre">tube-select.xml</span></code> for use later.</p>
<div class="figure" id="id2">
<img alt="&quot;Generating XML from inputs&quot;" src="../_images/generate_xml.png" />
<p class="caption"><span class="caption-text">“Generating XML from inputs”</span></p>
</div>
<div class="section" id="chaining-processes">
<h3>Chaining Processes<a class="headerlink" href="#chaining-processes" title="Permalink to this headline">¶</a></h3>
<p>WPS supports chaining other WPS processes. This is useful when selecting
data from an existing layer or storing data back into GeoServer to
create a new layer. The GeoServer User Guide has a section on <a class="reference external" href="http://docs.geoserver.org/stable/en/user/services/wps/processes/chaining.html">Process
Chaining</a>.</p>
</div>
</div>
<div class="section" id="tube-selections">
<h2>Tube Selections<a class="headerlink" href="#tube-selections" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-a-layer-as-input">
<h3>Using a Layer as Input<a class="headerlink" href="#using-a-layer-as-input" title="Permalink to this headline">¶</a></h3>
<p>For this demonstration, let’s assume someone is traveling from
Wilmington, DE to north of Philadelphia, PA along the New Jersey
Turnpike and is tweeting. Each tweet would have a GPS coordinate and a
timestamp allowing us to infer that the person was traveling somewhere
around 55mph (25 m/s) on the Turnpike. This track is the input that
defines the “tube” geometry for our query. Using the <code class="docutils literal notranslate"><span class="pre">maxSpeed</span></code> of 25
m/s and a <code class="docutils literal notranslate"><span class="pre">maxTime</span></code> of 120s we will create a space/time query tube.
Here’s a GeoServer rendering of a possible track:</p>
<div class="figure" id="id3">
<img alt="&quot;Tube Features&quot;" src="../_images/tube_features.png" />
<p class="caption"><span class="caption-text">“Tube Features”</span></p>
</div>
</div>
<div class="section" id="using-json-as-input">
<h3>Using JSON as Input<a class="headerlink" href="#using-json-as-input" title="Permalink to this headline">¶</a></h3>
<p>Instead of using a layer as input, you can manually define an input
<code class="docutils literal notranslate"><span class="pre">FeatureCollection</span></code> track with JSON using
<a class="reference external" href="http://geojson.org/">GeoJSON</a>. The features need a unique <strong>id</strong>,
a <strong>geometry</strong> object, and a property named <strong>dtg</strong> representing the
observation time of the feature. A sample of two of our input track
points is shown below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span> <span class="nt">&lt;wps:Input&gt;</span>
    <span class="nt">&lt;ows:Identifier&gt;</span>tubeFeatures<span class="nt">&lt;/ows:Identifier&gt;</span>
    <span class="nt">&lt;wps:Data&gt;</span>
         <span class="nt">&lt;wps:ComplexData</span> <span class="na">mimeType=</span><span class="s">&quot;application/json&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;![CDATA[</span>
<span class="cp">            {</span>
<span class="cp">               &quot;features&quot; : [</span>
<span class="cp">                    {</span>
<span class="cp">                        &quot;id&quot; : &quot;0&quot;,</span>
<span class="cp">                        &quot;geometry&quot; : {</span>
<span class="cp">                            &quot;coordinates&quot;: [-75.6002273 , 39.669456],</span>
<span class="cp">                            &quot;type&quot; : &quot;Point&quot;</span>
<span class="cp">                        },</span>
<span class="cp">                        &quot;type&quot; : &quot;Feature&quot;,</span>
<span class="cp">                        &quot;properties&quot; : {</span>
<span class="cp">                            &quot;dtg&quot; : &quot;2014-05-17T15:33:16.000+0000&quot;,</span>
<span class="cp">                        }</span>
<span class="cp">                    }, {</span>
<span class="cp">                        &quot;id&quot; : &quot;1&quot;,</span>
<span class="cp">                        &quot;geometry&quot; : {</span>
<span class="cp">                            &quot;coordinates&quot;: [-75.5102991 , 39.6857254],</span>
<span class="cp">                            &quot;type&quot; : &quot;Point&quot;</span>
<span class="cp">                        },</span>
<span class="cp">                        &quot;type&quot; : &quot;Feature&quot;,</span>
<span class="cp">                        &quot;properties&quot; : {</span>
<span class="cp">                            &quot;dtg&quot; : &quot;2014-05-17T15:39:28.000+0000&quot;,</span>
<span class="cp">                        }</span>
<span class="cp">                    }</span>
<span class="cp">               ],</span>
<span class="cp">               &quot;type&quot; : &quot;FeatureCollection&quot;</span>
<span class="cp">            }</span>
<span class="cp">            ]]&gt;</span>
        <span class="nt">&lt;/wps:ComplexData&gt;</span>
    <span class="nt">&lt;/wps:Data&gt;</span>
<span class="nt">&lt;/wps:Input&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="posting-a-query">
<h3>Posting a Query<a class="headerlink" href="#posting-a-query" title="Permalink to this headline">¶</a></h3>
<p>After creating our tube query XML we can post it to GeoServer with
<code class="docutils literal notranslate"><span class="pre">curl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -u admin:geoserver -H <span class="s1">&#39;Content-type: xml&#39;</span> -XPOST -d@<span class="s1">&#39;/tmp/query.xml&#39;</span> http://localhost:8081/geoserver/wps <span class="p">|</span> json_pp
</pre></div>
</div>
<p>In this request, the MIME type of the result variable is set to <code class="docutils literal notranslate"><span class="pre">json</span></code>
in our file <code class="docutils literal notranslate"><span class="pre">query.xml</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;wps:ResponseForm&gt;</span>
  <span class="nt">&lt;wps:RawDataOutput</span> <span class="na">mimeType=</span><span class="s">&quot;application/json&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ows:Identifier&gt;</span>result<span class="nt">&lt;/ows:Identifier&gt;</span>
  <span class="nt">&lt;/wps:RawDataOutput&gt;</span>
<span class="nt">&lt;/wps:ResponseForm&gt;</span>
</pre></div>
</div>
<p>We piped the output into
<a class="reference external" href="http://search.cpan.org/~makamaka/JSON-PP-2.27103/bin/json_pp">json_pp</a>,
which will pretty print the output (native packages are available for
most Linux distributions).</p>
</div>
</div>
<div class="section" id="saving-the-output-as-a-layer">
<h2>Saving The Output as a Layer<a class="headerlink" href="#saving-the-output-as-a-layer" title="Permalink to this headline">¶</a></h2>
<p>Chaining your result with a <strong>gs:import</strong> process allows you to store
your layer back into GeoMesa, allowing you to render a layer. Below we
have created a layer combination with a map, our original tube track,
and our results with <code class="docutils literal notranslate"><span class="pre">maxSpeed</span></code> 25 m/s and <code class="docutils literal notranslate"><span class="pre">maxTime</span></code> 120 s. These
layers are <strong>mapproxy:globe.osm.toner</strong>, <strong>accumulo:njtrack</strong>, and
<strong>accumulo:nj120</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>http://localhost:8081/geoserver/wms?service<span class="o">=</span>WMS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span><span class="m">1</span>.1.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>GetMap<span class="p">&amp;</span><span class="nv">layers</span><span class="o">=</span>mapproxy:globe.osm.toner,accumulo:njtrack,accumulo:nj120<span class="p">&amp;</span><span class="nv">styles</span><span class="o">=</span><span class="p">&amp;</span><span class="nv">bbox</span><span class="o">=</span>-75.62390877,39.65103897,-74.81563784,40.04023423<span class="p">&amp;</span><span class="nv">width</span><span class="o">=</span><span class="m">1440</span><span class="p">&amp;</span><span class="nv">height</span><span class="o">=</span><span class="m">960</span><span class="p">&amp;</span><span class="nv">srs</span><span class="o">=</span>EPSG:4326<span class="p">&amp;</span><span class="nv">format</span><span class="o">=</span>application/openlayers
</pre></div>
</div>
<div class="figure" id="id4">
<img alt="&quot;Tube Result at 25m/s 120s&quot;" src="../_images/tube-25-120.png" />
<p class="caption"><span class="caption-text">“Tube Result at 25m/s 120s”</span></p>
</div>
</div>
<div class="section" id="tweaking-parameters">
<h2>Tweaking Parameters<a class="headerlink" href="#tweaking-parameters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="maxspeed-maxtime-buffersize">
<h3>maxSpeed, maxTime, bufferSize<a class="headerlink" href="#maxspeed-maxtime-buffersize" title="Permalink to this headline">¶</a></h3>
<p>Adjusting the <code class="docutils literal notranslate"><span class="pre">maxSpeed</span></code> and <code class="docutils literal notranslate"><span class="pre">maxTime</span></code> parameters will increase the
size of the tube from both a spatial and temporal aspect. Features that
are further away in either time or geometry could possibly be reached by
the input track by increasing these parameters. Below, we have doubled
our <code class="docutils literal notranslate"><span class="pre">maxTime</span></code> to 240 s creating a wider tube. Perhaps our friend
strayed off the highway and visited a restaurant or gas station. We’d
like to account for that possibility. Once again, a chained
<strong>gs:import</strong> command has stored the layer as <strong>nj240</strong>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>http://localhost:8081/geoserver/wms?service<span class="o">=</span>WMS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span><span class="m">1</span>.1.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>GetMap<span class="p">&amp;</span><span class="nv">layers</span><span class="o">=</span>mapproxy:globe.osm.toner,accumulo:njtrack,accumulo:nj240<span class="p">&amp;</span><span class="nv">styles</span><span class="o">=</span><span class="p">&amp;</span><span class="nv">bbox</span><span class="o">=</span>-75.62390877,39.65103897,-74.81563784,40.04023423<span class="p">&amp;</span><span class="nv">width</span><span class="o">=</span><span class="m">1440</span><span class="p">&amp;</span><span class="nv">height</span><span class="o">=</span><span class="m">960</span><span class="p">&amp;</span><span class="nv">srs</span><span class="o">=</span>EPSG:4326<span class="p">&amp;</span><span class="nv">format</span><span class="o">=</span>application/openlayers
</pre></div>
</div>
<div class="figure" id="id5">
<img alt="&quot;Tube Result at 25m/s 240s&quot;" src="../_images/tube-25-240.png" />
<p class="caption"><span class="caption-text">“Tube Result at 25m/s 240s”</span></p>
</div>
</div>
<div class="section" id="gapfill">
<h3>gapFill<a class="headerlink" href="#gapfill" title="Permalink to this headline">¶</a></h3>
<p>Many input tracks can be sparse. Our friend driving the Turnpike didn’t
tweet every 5 seconds. Selecting a <code class="docutils literal notranslate"><span class="pre">gapFill</span></code> method fills in those
missing tracks. In this tutorial we used the <strong>line</strong> option for gap
filling. The options available for the <code class="docutils literal notranslate"><span class="pre">gapFill</span></code> method are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">none</span></code> - use when you have a dense track</li>
<li><code class="docutils literal notranslate"><span class="pre">line</span></code> - draws a line between points two points and uses the time
range of both points</li>
</ul>
</div>
</div>
<div class="section" id="beyond-curl">
<h2>Beyond Curl<a class="headerlink" href="#beyond-curl" title="Permalink to this headline">¶</a></h2>
<p>WPS services can also be accessed by a variety of clients including
<a class="reference external" href="http://openlayers.org/">OpenLayers</a>, which has implemented a
<a class="reference external" href="http://dev.openlayers.org/releases/OpenLayers-2.13.1/examples/wps.html">JavaScript WPS
Builder</a>
tutorial similar to the one built into GeoServer.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="geomesa-examples-authorizations.html" class="btn btn-neutral float-right" title="GeoMesa Authorizations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dwithin-join.html" class="btn btn-neutral" title="GeoMesa Spark: Spatial Join and Aggregation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2021 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

<div role="contentinfo">
  <p>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a>
    using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>
    
    - view <a href="../_sources/tutorials/geomesa-tubeselect.rst.txt" rel="nofollow">page source</a>
    
  </p>
</div>



</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 

<!-- analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-53087457-1', 'auto');
ga('send', 'pageview');
</script>




</body>
</html>