

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GeoMesa NiFi Quick Start &mdash; GeoMesa 1.3.2-SNAPSHOT Manuals</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme_custom.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/sphinx_tabs/tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/segment.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/menu.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="GeoMesa 1.3.2-SNAPSHOT Manuals" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="GeoMesa Storm Quick Start" href="geomesa-quickstart-storm.html"/>
        <link rel="prev" title="Bootstrapping GeoMesa HBase on AWS S3" href="geomesa-hbase-s3-on-aws.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.3.2-SNAPSHOT
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#getting-started">Getting Started</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-accumulo.html">GeoMesa Accumulo Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-cassandra.html">GeoMesa Cassandra Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-kafka.html">GeoMesa Kafka Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-quickstart-hbase.html">GeoMesa HBase Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="geodocker-geomesa-spark-on-aws.html">Geodocker: Bootstrapping GeoMesa Accumulo and Spark on AWS</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-hbase-s3-on-aws.html">Bootstrapping GeoMesa HBase on AWS S3</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">GeoMesa NiFi Quick Start</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#about-this-tutorial">About this Tutorial</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtain-gdelt-data">Obtain GDELT data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#download-and-build-the-geomesa-nifi-project">Download and Build the GeoMesa NiFi project</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-geomesa-processor">Install the GeoMesa Processor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#upload-the-nifi-flow-template">Upload the NiFi flow template</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualize-data-with-geoserver">Visualize Data With GeoServer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-in-out">Data In/Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-analysis">Data Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#security">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indexing-and-queries">Indexing and Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#about-tutorial-versions">About Tutorial Versions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GeoMesa</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>GeoMesa NiFi Quick Start</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/geomesa-quickstart-nifi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomesa-nifi-quick-start">
<h1>GeoMesa NiFi Quick Start<a class="headerlink" href="#geomesa-nifi-quick-start" title="Permalink to this headline">¶</a></h1>
<p>This tutorial provides an example implementation for using GeoMesa with
NiFi. This walk-through will guide you in setting up the components
required for ingesting GDELT files into GeoMesa running on Accumulo.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before you begin, you must have the following:</p>
<ul class="simple">
<li>an instance of Accumulo 1.7 or 1.8 running on Hadoop 2.2 or better</li>
<li>an Accumulo user that has both create-table and write permissions</li>
<li>the GeoMesa Accumulo distributed runtime <a class="reference external" href="http://www.geomesa.org/documentation/user/installation_and_configuration.html#installing-the-accumulo-distributed-runtime-library">installed for your Accumulo
instance</a></li>
<li>a local copy of the <a class="reference external" href="http://java.oracle.com/">Java</a> JDK 8</li>
<li>Apache <a class="reference external" href="http://maven.apache.org/">Maven</a> installed</li>
<li>an instance of Apache <a class="reference external" href="http://nifi.apache.org/">NiFi</a> 0.4.1 or
better</li>
<li>(Optional) an installation of <a class="reference external" href="http://geoserver.org/">GeoServer</a>
with the <a class="reference external" href="http://www.geomesa.org/documentation/user/accumulo/install.html#install-accumulo-geoserver">GeoMesa Accumulo GeoServer
plugin</a>
to visualize the ingested data.</li>
<li>a GitHub client installed</li>
</ul>
</div>
<div class="section" id="about-this-tutorial">
<h2>About this Tutorial<a class="headerlink" href="#about-this-tutorial" title="Permalink to this headline">¶</a></h2>
<p>This QuickStart operates by reading csv files from <code class="docutils literal"><span class="pre">/tmp/gdelt/</span></code> and
using the PutGeoMesa processor, ingests the files into GeoMesa running
on Accumulo.</p>
</div>
<div class="section" id="obtain-gdelt-data">
<h2>Obtain GDELT data<a class="headerlink" href="#obtain-gdelt-data" title="Permalink to this headline">¶</a></h2>
<p>In this QuickStart we will be ingesting GDELT data. If you already have
some GDELT data available locally or previously ran the <a class="reference external" href="http://www.geomesa.org/documentation/tutorials/geomesa-examples-gdelt.html">Map-Reduce
Ingest of
GDELT</a>
example then you may skip this section. Simply copy the data you have
into /tmp/gdelt.</p>
<p>The <a class="reference external" href="http://www.gdeltproject.org">GDELT Event database</a> provides a
comprehensive time- and location-indexed archive of events reported in
broadcast, print, and web news media worldwide from 1979 to today. You
can download raw GDELT data files at
<a class="reference external" href="http://data.gdeltproject.org/events/index.html">http://data.gdeltproject.org/events/index.html</a>. For example, the
following Bash commands use <code class="docutils literal"><span class="pre">wget</span></code> to download all event files for
2013 (2 GB compressed, 14 GB uncompressed) and <code class="docutils literal"><span class="pre">md5sum</span></code> to verify each
by their MD5 hash:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mkdir /tmp/gdelt <span class="o">&amp;&amp;</span> <span class="nb">cd</span> /tmp/gdelt
$ wget http://data.gdeltproject.org/events/md5sums
$ <span class="k">for</span> file in <span class="sb">`</span>cat md5sums <span class="p">|</span> cut -d<span class="s1">&#39; &#39;</span> -f3 <span class="p">|</span> grep <span class="s1">&#39;^2013&#39;</span><span class="sb">`</span> <span class="p">;</span> <span class="k">do</span> wget http://data.gdeltproject.org/events/<span class="nv">$file</span> <span class="p">;</span> <span class="k">done</span>
$ md5sum -c md5sums <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s1">&#39;^2013&#39;</span>
$ unzip <span class="s1">&#39;*.zip&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="download-and-build-the-geomesa-nifi-project">
<h2>Download and Build the GeoMesa NiFi project<a class="headerlink" href="#download-and-build-the-geomesa-nifi-project" title="Permalink to this headline">¶</a></h2>
<p>Pick a reasonable directory on your machine, and run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone https://github.com/geomesa/geomesa-nifi.git
$ <span class="nb">cd</span> geomesa-nifi
</pre></div>
</div>
<p>To build, run</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mvn clean install
</pre></div>
</div>
<p>This will build three processors.</p>
<ul class="simple">
<li>PutGeoMesa - Ingest data into GeoMesa with a GeoMesa converter or
from geoavro</li>
<li>PutGeoTools - Ingest data into an arbitrary GeoTools Datastore based
on parameters using a GeoMesa converter or avro</li>
<li>ConvertToGeoAvro - Use a GeoMesa converter to create geoavro</li>
</ul>
<p>However we will only be using the PutGeoMesa for this QuickStart.</p>
</div>
<div class="section" id="install-the-geomesa-processor">
<h2>Install the GeoMesa Processor<a class="headerlink" href="#install-the-geomesa-processor" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-the-geomesa-nifi-processor">
<h3>Install the GeoMesa NiFi Processor<a class="headerlink" href="#install-the-geomesa-nifi-processor" title="Permalink to this headline">¶</a></h3>
<p>In order to use NiFi with GeoMesa we need to first install the GeoMesa
processor. To do this simply copy the <code class="docutils literal"><span class="pre">geomesa-nifi-nar-$VERSION.nar</span></code>
that you just built from <code class="docutils literal"><span class="pre">geomesa-nifi/geomesa-nifi-nar/target</span></code> to the
<code class="docutils literal"><span class="pre">lib/</span></code> directory of you NiFi installation.</p>
</div>
<div class="section" id="install-the-sfts-and-converters">
<h3>Install the SFTs and Converters<a class="headerlink" href="#install-the-sfts-and-converters" title="Permalink to this headline">¶</a></h3>
<p>Additionally we need to copy the <code class="docutils literal"><span class="pre">geomesa-accumulo-$VERSION-data.jar</span></code>
from the geomesa-accumulo-dist to the <code class="docutils literal"><span class="pre">lib/</span></code> of the NiFi installation.
The <code class="docutils literal"><span class="pre">geomesa-accumulo-$VERSION-data.jar</span></code> is located in the
<code class="docutils literal"><span class="pre">dist/sfts-converters</span></code> directory of the geomesa-accumulo-dist. This
jar contains the sfts and converters needed for GeoMesa to ingest the
GDELT data. You can obtain the geomesa-accumulo-dist from
<a class="reference external" href="https://repo.locationtech.org/content/repositories/geomesa-releases/org/locationtech/geomesa/geomesa-accumulo-dist_2.11/1.3.1/geomesa-accumulo-dist_2.11-1.3.1-bin.tar.gz">here</a>
or you may build it locally if you have geomesa source available using:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mvn clean install -am -pl :geomesa-accumulo-dist_2.11
</pre></div>
</div>
</div>
</div>
<div class="section" id="upload-the-nifi-flow-template">
<h2>Upload the NiFi flow template<a class="headerlink" href="#upload-the-nifi-flow-template" title="Permalink to this headline">¶</a></h2>
<p>The NiFi template provided
<a class="reference external" href="_static/geomesa-quickstart-nifi/GeoMesa_Quickstart.xml">here</a> sets
up a basic NiFi flow from a GetFile processor to a PutGeoMesa processor.
To upload the NiFi template, download it to your local machine and in
NiFi select the <code class="docutils literal"><span class="pre">Upload</span> <span class="pre">Template</span></code> option in the <code class="docutils literal"><span class="pre">Operate</span></code> side
panel. After uploading the template you can add it to the workspace by
dragging the <code class="docutils literal"><span class="pre">New</span> <span class="pre">Template</span></code> option from the NiFi main header into the
workspace and selecting the template from the drop down. You will need
to configure the PutGeoMesa processor for your Accumulo Instance. Simply
edit the PutGeoMesa configuration and edit the following properties:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">instanceId</span></code> Your Accumulo instance ID.</li>
<li><code class="docutils literal"><span class="pre">zookeepers</span></code> A comma separated list of zookeeper IPs or hostnames.</li>
<li><code class="docutils literal"><span class="pre">user</span></code> Accumulo username that has both create-table and write
permissions.</li>
<li><code class="docutils literal"><span class="pre">password</span></code> Password to above user.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you have set up the GeoMesa Accumulo distributed
runtime to be isolated within a namespace <a class="reference external" href="http://www.geomesa.org/documentation/user/installation_and_configuration.html#for-accumulo-1-6">as described in the
GeoMesa installation
guide</a>,
the value of <code class="docutils literal"><span class="pre">tableName</span></code> should include the namespace (e.g.
<code class="docutils literal"><span class="pre">myNamespace.gdelt</span></code>).</p>
</div>
</div>
<div class="section" id="visualize-data-with-geoserver">
<h2>Visualize Data With GeoServer<a class="headerlink" href="#visualize-data-with-geoserver" title="Permalink to this headline">¶</a></h2>
<div class="section" id="register-the-geomesa-store-with-geoserver">
<h3>Register the GeoMesa store with GeoServer<a class="headerlink" href="#register-the-geomesa-store-with-geoserver" title="Permalink to this headline">¶</a></h3>
<p>Log into GeoServer using your user and password credentials. Click
&#8220;Stores&#8221; and &#8220;Add new Store&#8221;. If you do not see the Accumulo Feature
Data Store listed under Vector Data Sources, ensure the plugin is in the
right directory and restart GeoServer.</p>
<p>Select the <code class="docutils literal"><span class="pre">Accumulo</span> <span class="pre">Feature</span> <span class="pre">Data</span> <span class="pre">Store</span></code> vector data source, and enter
the following parameters:</p>
<ul class="simple">
<li>basic store info</li>
<li><code class="docutils literal"><span class="pre">workspace</span></code> this is dependent upon your GeoServer installation</li>
<li><code class="docutils literal"><span class="pre">data</span> <span class="pre">source</span> <span class="pre">name</span></code> pick a sensible name, such as,
<code class="docutils literal"><span class="pre">geomesa_nifi_quick_start</span></code></li>
<li><code class="docutils literal"><span class="pre">description</span></code> this is strictly decorative;
<code class="docutils literal"><span class="pre">GeoMesa</span> <span class="pre">NiFi</span> <span class="pre">quick</span> <span class="pre">start</span></code></li>
<li>connection parameters</li>
<li>these are the same parameter values that you supplied to the
processor when you ran the tutorial; they describe how to connect to
the Accumulo instance where your data resides.</li>
</ul>
<p>Click &#8220;Save&#8221;, and GeoServer will search your Accumulo table for any
GeoMesa-managed feature types.</p>
</div>
<div class="section" id="publish-the-layer">
<h3>Publish the layer<a class="headerlink" href="#publish-the-layer" title="Permalink to this headline">¶</a></h3>
<p>GeoServer should recognize the feature type, and should present that as
a layer that could be published. Click on the &#8220;Publish&#8221; link.</p>
<p>You will be taken to the Edit Layer screen. Two of the tabs need to be
updated: Data and Dimensions.</p>
<p>In the Data pane, enter values for the bounding boxes. In this case, you
can click on the link to compute these values from the data.</p>
<p>In the Dimensions tab, check the &#8220;Enabled&#8221; checkbox under Time. Then
select &#8220;When&#8221; in the Attribute and End Attribute dropdowns, and
&#8220;Continuous Interval&#8221; in the Presentation dropdown.</p>
<p>Click on the &#8220;Save&#8221; button when you are done.</p>
</div>
<div class="section" id="take-a-look">
<h3>Take a look<a class="headerlink" href="#take-a-look" title="Permalink to this headline">¶</a></h3>
<p>Click on the &#8220;Layer Preview&#8221; link in the left-hand gutter. If you don&#8217;t
see the quick-start layer on the first page of results, enter the name
of the layer you just created into the search box, and press .</p>
<p>Once you see your layer, click on the &#8220;OpenLayers&#8221; link, which will open
a new tab. By default, the display that opens will not show all the
data, because we have enabled the time dimension for this layer, but the
preview does not specify a time. In the URL bar for the visualization,
add the following to the end:</p>
<p><code class="docutils literal"><span class="pre">&amp;TIME=2014-01-01T00:00:00.000Z/2014-01-31T23:59:59.999Z</span></code></p>
<p>That tells GeoServer to display the records for the entire month of
January 2014. You can find more information about the TIME parameter
from <a class="reference external" href="http://docs.geoserver.org/latest/en/user/services/wms/time.html">GeoServer&#8217;s
documentation</a>.</p>
<p>Once you press , the display will update, and you should see a
collection of red dots similar to the following image.</p>
<div class="figure" id="id1">
<img alt="Visualizing quick-start data" src="../_images/geoserver-layer-preview.png" />
<p class="caption"><span class="caption-text">Visualizing quick-start data</span></p>
</div>
</div>
<div class="section" id="tweaking-the-display">
<h3>Tweaking the display<a class="headerlink" href="#tweaking-the-display" title="Permalink to this headline">¶</a></h3>
<p>Here are just a few simple ways you can play with the visualization:</p>
<ul class="simple">
<li>Click on one of the red points in the display, and GeoServer will
report the detail records underneath the map area.</li>
<li>Shift-click to highlight a region within the map that you would like
to zoom into.</li>
<li>Alter the <code class="docutils literal"><span class="pre">TIME=</span></code> parameter in the URL to a different date range,
and you can filter to see only the records that satisfy the temporal
constraint.</li>
<li>Click on the &#8220;Toggle options toolbar&#8221; icon in the upper-left corner
of the preview window. The right-hand side of the screen will include
a &#8220;Filter&#8221; text box. Enter <code class="docutils literal"><span class="pre">Who</span> <span class="pre">=</span> <span class="pre">'Bierce'</span></code>, and press on the
&#8220;play&#8221; icon. The display will now show only those points matching
your filter criterion. This is a CQL filter, which can be constructed
in various ways to query our data. You can find more information
about CQL from <a class="reference external" href="http://docs.geoserver.org/latest/en/user/tutorials/cql/cql_tutorial.html">GeoServer&#8217;s CQL
tutorial</a>.</li>
</ul>
</div>
<div class="section" id="generating-heatmaps">
<h3>Generating Heatmaps<a class="headerlink" href="#generating-heatmaps" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>To try out the DensityIterator, you can install the Heatmap SLD from
the <a class="reference external" href="../geomesa-examples-gdelt">GDELT Tutorial</a>.</li>
<li>After configuring the SLD, in the URL, change <code class="docutils literal"><span class="pre">styles=</span></code> to be
<code class="docutils literal"><span class="pre">styles=heatmap&amp;density=true</span></code>. Once you press , the display will
change to a density heat-map. (NB: For this to work, you will have to
first install the WPS module for GeoServer. See the official web site
for a download.)</li>
</ul>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="geomesa-quickstart-storm.html" class="btn btn-neutral float-right" title="GeoMesa Storm Quick Start" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="geomesa-hbase-s3-on-aws.html" class="btn btn-neutral" title="Bootstrapping GeoMesa HBase on AWS S3" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2017 Commonwealth Computer Research, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.2-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../_static/sphinx_tabs/tabs.js"></script>
      <script type="text/javascript" src="../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>