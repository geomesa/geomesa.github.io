<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>20.11. FileSystem Data Store Example &mdash; GeoMesa 3.3.0 Manuals</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="canonical" href="https://www.geomesa.org/documentation/user/filesystem/example.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="20.12. FileSystem Data Store Spark SQL Example" href="spark_example.html" />
    <link rel="prev" title="20.10. Modifying Features" href="modify_features.html" />


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          </a>
              <div class="version">
                3.3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">2. Versions and Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html">3. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">4. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geotools.html">5. GeoTools Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">6. Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastores/index.html">7. GeoMesa Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/index.html">8. Command-Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../convert/index.html">9. GeoMesa Convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoserver.html">10. GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark/index.html">11. GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nifi/index.html">12. GeoMesa NiFi Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">13. GeoMesa Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hbase/index.html">14. HBase Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accumulo/index.html">15. Accumulo Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra/index.html">16. Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bigtable/index.html">17. Bigtable Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka/index.html">18. Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../redis/index.html">19. Redis Data Store</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">20. FileSystem Data Store</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="architecture.html">20.1. Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html">20.2. Installing GeoMesa FileSystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html">20.3. Using the FileSystem Data Store Programmatically</a></li>
<li class="toctree-l3"><a class="reference internal" href="geoserver.html">20.4. Using the FileSystem Data Store in GeoServer</a></li>
<li class="toctree-l3"><a class="reference internal" href="commandline.html">20.5. FileSystem Command-Line Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">20.6. FileSystem DataStore Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_config.html">20.7. Index Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="partition_schemes.html">20.8. Partition Schemes</a></li>
<li class="toctree-l3"><a class="reference internal" href="metadata.html">20.9. FileSystem Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="modify_features.html">20.10. Modifying Features</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">20.11. FileSystem Data Store Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="spark_example.html">20.12. FileSystem Data Store Spark SQL Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../kudu/index.html">21. Kudu Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lambda/index.html">22. Lambda Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ds_views.html">23. Combined Data Store Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geojson.html">24. GeoMesa GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">25. GeoMesa Stream Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade.html">26. Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GeoMesa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">User Manual</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">20. </span>FileSystem Data Store</a></li>
      <li class="breadcrumb-item active"><span class="section-number">20.11. </span>FileSystem Data Store Example</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="filesystem-data-store-example">
<h1><span class="section-number">20.11. </span>FileSystem Data Store Example<a class="headerlink" href="#filesystem-data-store-example" title="Permalink to this headline">¶</a></h1>
<p>In this simple example we will ingest a small CSV into a local filesystem data store partitioned by an daily,z2-2bit
scheme. To begin, start by untaring the geomesa-fs distribution. Inside this distribution you will find an examples
folder which contains an example csv file that we will ingest:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the following examples, replace <code class="docutils literal notranslate"><span class="pre">${TAG}</span></code> with the corresponding GeoMesa version (e.g. <code class="docutils literal notranslate"><span class="pre">3.3.0</span></code>), and
<code class="docutils literal notranslate"><span class="pre">${VERSION}</span></code> with the appropriate Scala plus GeoMesa versions (e.g. <code class="docutils literal notranslate"><span class="pre">2.12-3.3.0</span></code>).</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># download and unpackage the most recent distribution:</span>
$<span class="w"> </span>wget<span class="w"> </span><span class="s2">&quot;https://github.com/locationtech/geomesa/releases/download/geomesa-</span><span class="si">${</span><span class="nv">TAG</span><span class="si">}</span><span class="s2">/geomesa-fs_</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">-bin.tar.gz&quot;</span>
$<span class="w"> </span>tar<span class="w"> </span>xvf<span class="w"> </span>geomesa-fs_<span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span>-bin.tar.gz
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>geomesa-fs_<span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span>

$<span class="w"> </span>cat<span class="w"> </span>examples/ingest/csv/example.csv
ID,Name,Age,LastSeen,Friends,Lon,Lat,Vis
<span class="m">23623</span>,Harry,20,2015-05-06,<span class="s2">&quot;Will, Mark, Suzan&quot;</span>,<span class="s2">&quot;patronus-&gt;10,expelliarmus-&gt;9&quot;</span>,-100.236523,23,user
<span class="m">26236</span>,Hermione,25,2015-06-07,<span class="s2">&quot;Edward, Bill, Harry&quot;</span>,<span class="s2">&quot;accio-&gt;10&quot;</span>,40.232,-53.2356,user
<span class="m">3233</span>,Severus,30,2015-10-23,<span class="s2">&quot;Tom, Riddle, Voldemort&quot;</span>,<span class="s2">&quot;potions-&gt;10&quot;</span>,3,-62.23,user<span class="p">&amp;</span>admin
</pre></div>
</div>
<p>As you can see, there are 3 records in the file. GeoMesa ships with a pre-installed SimpleFeatureType and converter
for this example file which can be found in the <code class="docutils literal notranslate"><span class="pre">conf/application.conf</span></code> file. Running <code class="docutils literal notranslate"><span class="pre">bin/geomesa-fs</span> <span class="pre">env</span></code> will
show that there is an <code class="docutils literal notranslate"><span class="pre">example-csv</span></code> type and converter installed along with many other types including twitter, gdelt,
osm, etc:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>bin/geomesa-fs<span class="w"> </span>env
<span class="w">    </span>Simple<span class="w"> </span>Feature<span class="w"> </span>Types:
<span class="w">    </span>example-avro
<span class="w">    </span>example-csv
<span class="w">    </span>example-csv-complex
<span class="w">    </span>...

<span class="w">    </span>Simple<span class="w"> </span>Feature<span class="w"> </span>Type<span class="w"> </span>Converters:
<span class="w">    </span>example-avro-header
<span class="w">    </span>example-avro-no-header
<span class="w">    </span>example-csv
<span class="w">    </span>...
</pre></div>
</div>
<p>For this example we’ll ingest the three rows to a local filesystem. Note that the records are all on different days:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2015</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">06</span>
<span class="mi">2015</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">07</span>
<span class="mi">2015</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">23</span>
</pre></div>
</div>
<p>and that the geometries fall into two quadrants of the world. The first record is in the upper left quadrant and the
second and third records are in the lower right quadrant:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Lon</span>          <span class="n">Lat</span>
<span class="o">-</span><span class="mf">100.236523</span>  <span class="mi">23</span>
<span class="mf">40.232</span>      <span class="o">-</span><span class="mf">53.2356</span>
<span class="mi">3</span>           <span class="o">-</span><span class="mf">62.23</span>
</pre></div>
</div>
<p>Now lets ingest.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>bin/geomesa-fs<span class="w"> </span>ingest<span class="w"> </span>-p<span class="w"> </span>/tmp/dstest<span class="w"> </span>-e<span class="w"> </span>parquet<span class="w"> </span>-s<span class="w"> </span>example-csv<span class="w"> </span>-C<span class="w"> </span>example-csv<span class="w"> </span><span class="se">\</span>
--partition-scheme<span class="w"> </span>daily,z2-2bit<span class="w"> </span>examples/ingest/csv/example.csv

INFO<span class="w">  </span>Creating<span class="w"> </span>schema<span class="w"> </span>example-csv
INFO<span class="w">  </span>Running<span class="w"> </span>ingestion<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">local</span><span class="w"> </span>mode
INFO<span class="w">  </span>Ingesting<span class="w"> </span><span class="m">1</span><span class="w"> </span>file<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>thread
<span class="o">[============================================================]</span><span class="w"> </span><span class="m">100</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>ingested<span class="w"> </span><span class="m">0</span><span class="w"> </span>failed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">00</span>:00:01
INFO<span class="w">  </span>Local<span class="w"> </span>ingestion<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">00</span>:00:01
INFO<span class="w">  </span>Ingested<span class="w"> </span><span class="m">3</span><span class="w"> </span>features<span class="w"> </span>with<span class="w"> </span>no<span class="w"> </span>failures.
</pre></div>
</div>
<p>We can verify our ingest by running an export:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>bin/geomesa-fs<span class="w"> </span><span class="nb">export</span><span class="w"> </span>-p<span class="w"> </span>/tmp/dstest<span class="w"> </span>-f<span class="w"> </span>example-csv

id,fid:Integer:index<span class="o">=</span>false,name:String:index<span class="o">=</span>true,age:Integer:index<span class="o">=</span>false,lastseen:Date:default<span class="o">=</span>true:index<span class="o">=</span>false,*geom:Point:srid<span class="o">=</span><span class="m">4326</span>
<span class="m">26236</span>,26236,Hermione,25,2015-06-07T00:00:00.000Z,POINT<span class="w"> </span><span class="o">(</span><span class="m">40</span>.232<span class="w"> </span>-53.2356<span class="o">)</span>
<span class="m">3233</span>,3233,Severus,30,2015-10-23T00:00:00.000Z,POINT<span class="w"> </span><span class="o">(</span><span class="m">3</span><span class="w"> </span>-62.23<span class="o">)</span>
<span class="m">23623</span>,23623,Harry,20,2015-05-06T00:00:00.000Z,POINT<span class="w"> </span><span class="o">(</span>-100.236523<span class="w"> </span><span class="m">23</span><span class="o">)</span>
INFO<span class="w">  </span>Feature<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nb">complete</span><span class="w"> </span>to<span class="w"> </span>standard<span class="w"> </span>out<span class="w"> </span><span class="k">in</span><span class="w"> </span>1676ms<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>features
</pre></div>
</div>
<p>Now lets inspect the filesystem to see what it looks like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>find<span class="w"> </span>/tmp/dstest<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort
/tmp/dstest/
/tmp/dstest/example-csv
/tmp/dstest/example-csv/2015
/tmp/dstest/example-csv/2015/05
/tmp/dstest/example-csv/2015/05/06
/tmp/dstest/example-csv/2015/05/06/2_Wcec6a2ec594a4a2eb7c7980a1baf4ab3.parquet
/tmp/dstest/example-csv/2015/05/06/.2_Wcec6a2ec594a4a2eb7c7980a1baf4ab3.parquet.crc
/tmp/dstest/example-csv/2015/06
/tmp/dstest/example-csv/2015/06/07
/tmp/dstest/example-csv/2015/06/07/1_Wcc082b9cf9bc4965b4cbf64741fee5b6.parquet
/tmp/dstest/example-csv/2015/06/07/.1_Wcc082b9cf9bc4965b4cbf64741fee5b6.parquet.crc
/tmp/dstest/example-csv/2015/10
/tmp/dstest/example-csv/2015/10/23
/tmp/dstest/example-csv/2015/10/23/1_W741f2151a4ed4eec97461a174a8588b7.parquet
/tmp/dstest/example-csv/2015/10/23/.1_W741f2151a4ed4eec97461a174a8588b7.parquet.crc
/tmp/dstest/example-csv/metadata
/tmp/dstest/example-csv/metadata/storage.json
/tmp/dstest/example-csv/metadata/.storage.json.crc
/tmp/dstest/example-csv/metadata/update-2015-05-06-2-12240906-4171-4ab0-acfe-d2ce9c5fff76.json
/tmp/dstest/example-csv/metadata/.update-2015-05-06-2-12240906-4171-4ab0-acfe-d2ce9c5fff76.json.crc
/tmp/dstest/example-csv/metadata/update-2015-06-07-1-ecd68700-88e3-4f04-9438-84b6ab935907.json
/tmp/dstest/example-csv/metadata/.update-2015-06-07-1-ecd68700-88e3-4f04-9438-84b6ab935907.json.crc
/tmp/dstest/example-csv/metadata/update-2015-10-23-1-667f27a7-4f64-472a-80ed-82e8f1e65575.json
/tmp/dstest/example-csv/metadata/.update-2015-10-23-1-667f27a7-4f64-472a-80ed-82e8f1e65575.json.crc
</pre></div>
</div>
<p>Notice that we have a directory structure laid out based on our <code class="docutils literal notranslate"><span class="pre">daily,z2-2bit</span></code> scheme. Notice the first parquet
file path is composed of a date path <code class="docutils literal notranslate"><span class="pre">2016/05/06</span></code> and then a z2 ordinate of <code class="docutils literal notranslate"><span class="pre">2</span></code>, which is part of the file name</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">dstest</span><span class="o">/</span><span class="n">example</span><span class="o">-</span><span class="n">csv</span><span class="o">/</span><span class="mi">2015</span><span class="o">/</span><span class="mi">05</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="n">_Wcec6a2ec594a4a2eb7c7980a1baf4ab3</span><span class="o">.</span><span class="n">parquet</span>
</pre></div>
</div>
<p>The rest of the parquet file name is a UUID, which allows for multiple threads to write different files at once
without interference. If we ingested additional data, another file would be created under the partition, and
GeoMesa would scan them both at query time.</p>
<p>Each new file (or file deletion) will create a separate metadata file, which contains details on the file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>/tmp/dstest/example-csv/metadata/update-2015-05-06-629788a4-6a70-4009-ae20-c45602a88483.json
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;action&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;Add&quot;</span>,
<span class="w">    </span><span class="s2">&quot;count&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">    </span><span class="s2">&quot;envelope&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;xmax&quot;</span><span class="w"> </span>:<span class="w"> </span>-100.2365,
<span class="w">        </span><span class="s2">&quot;xmin&quot;</span><span class="w"> </span>:<span class="w"> </span>-100.2365,
<span class="w">        </span><span class="s2">&quot;ymax&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">23</span>.0,
<span class="w">        </span><span class="s2">&quot;ymin&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">23</span>.0
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;files&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;2_Wcec6a2ec594a4a2eb7c7980a1baf4ab3.parquet&quot;</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;2015/05/06/2&quot;</span>,
<span class="w">    </span><span class="s2">&quot;timestamp&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">1538148168948</span>
<span class="o">}</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modify_features.html" class="btn btn-neutral float-left" title="20.10. Modifying Features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="spark_example.html" class="btn btn-neutral float-right" title="20.12. FileSystem Data Store Spark SQL Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  

<div role="contentinfo">
  <p>
    &copy; Copyright 2013-2021 <a href="https://www.ccri.com/">Commonwealth Computer Research, Inc.</a>
    <br/>
    Licensed under the <a href="http://www.opensource.org/licenses/apache2.0.php">Apache License, Version 2.0</a>
  </p>
</div>

<div role="contentinfo">
  <p>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a>
    using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>
    
    - view <a href="../../_sources/user/filesystem/example.rst.txt" rel="nofollow">page source</a>
    
  </p>
</div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>